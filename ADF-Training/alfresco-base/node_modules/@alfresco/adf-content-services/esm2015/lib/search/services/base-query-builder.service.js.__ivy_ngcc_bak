import { __awaiter } from "tslib";
import { Injectable } from '@angular/core';
import { Subject, from, ReplaySubject } from 'rxjs';
import { AlfrescoApiService, AppConfigService } from '@alfresco/adf-core';
import { RequestSortDefinitionInner, SearchApi } from '@alfresco/js-api';
import * as i0 from "@angular/core";
import * as i1 from "@alfresco/adf-core";
export class BaseQueryBuilderService {
    constructor(appConfig, alfrescoApiService) {
        this.appConfig = appConfig;
        this.alfrescoApiService = alfrescoApiService;
        this.configUpdated = new Subject();
        this.updated = new Subject();
        this.executed = new Subject();
        this.error = new Subject();
        this.searchForms = new ReplaySubject(1);
        this.categories = [];
        this.queryFragments = {};
        this.filterQueries = [];
        this.paging = null;
        this.sorting = [];
        this.sortingOptions = [];
        this._userQuery = '';
        this.userFacetBuckets = {};
        this.config = {
            categories: []
        };
        this.ranges = {};
        this.resetToDefaults();
    }
    get searchApi() {
        var _a;
        this._searchApi = (_a = this._searchApi) !== null && _a !== void 0 ? _a : new SearchApi(this.alfrescoApiService.getInstance());
        return this._searchApi;
    }
    get userQuery() {
        return this._userQuery;
    }
    set userQuery(value) {
        value = (value || '').trim();
        this._userQuery = value ? `(${value})` : '';
    }
    resetToDefaults() {
        const currentConfig = this.getDefaultConfiguration();
        this.resetSearchOptions();
        this.configUpdated.next(currentConfig);
        this.searchForms.next(this.getSearchFormDetails());
        this.setUpSearchConfiguration(currentConfig);
    }
    getDefaultConfiguration() {
        const configurations = this.loadConfiguration();
        if (this.selectedConfiguration !== undefined) {
            return configurations[this.selectedConfiguration];
        }
        if (Array.isArray(configurations)) {
            return configurations.find((configuration) => configuration.default);
        }
        return configurations;
    }
    updateSelectedConfiguration(index) {
        const currentConfig = this.loadConfiguration();
        if (Array.isArray(currentConfig) && currentConfig[index] !== undefined) {
            this.selectedConfiguration = index;
            this.configUpdated.next(currentConfig[index]);
            this.searchForms.next(this.getSearchFormDetails());
            this.resetSearchOptions();
            this.setUpSearchConfiguration(currentConfig[index]);
            this.update();
        }
    }
    resetSearchOptions() {
        this.categories = [];
        this.queryFragments = {};
        this.filterQueries = [];
        this.sorting = [];
        this.sortingOptions = [];
        this.userFacetBuckets = {};
        this.scope = null;
    }
    getSearchFormDetails() {
        const configurations = this.loadConfiguration();
        if (Array.isArray(configurations)) {
            return configurations.map((configuration, index) => ({
                index,
                name: configuration.name || 'SEARCH.UNKNOWN_CONFIGURATION',
                default: configuration.default || false,
                selected: this.selectedConfiguration !== undefined ? index === this.selectedConfiguration : configuration.default
            }));
        }
        else if (!!configurations) {
            return [{
                    index: 0,
                    name: configurations.name || 'SEARCH.UNKNOWN_CONFIGURATION',
                    default: true,
                    selected: true
                }];
        }
        return [];
    }
    setUpSearchConfiguration(currentConfiguration) {
        if (currentConfiguration) {
            this.config = JSON.parse(JSON.stringify(currentConfiguration));
            this.categories = (this.config.categories || []).filter(category => category.enabled);
            this.filterQueries = this.config.filterQueries || [];
            this.userFacetBuckets = {};
            if (this.config.sorting) {
                this.sorting = this.config.sorting.defaults || [];
                this.sortingOptions = this.config.sorting.options || [];
            }
        }
    }
    addUserFacetBucket(field, bucket) {
        if (field && field.field && bucket) {
            const buckets = this.userFacetBuckets[field.field] || [];
            const existing = buckets.find((facetBucket) => facetBucket.label === bucket.label);
            if (!existing) {
                buckets.push(bucket);
            }
            this.userFacetBuckets[field.field] = buckets;
        }
    }
    getUserFacetBuckets(field) {
        return this.userFacetBuckets[field] || [];
    }
    removeUserFacetBucket(field, bucket) {
        if (field && field.field && bucket) {
            const buckets = this.userFacetBuckets[field.field] || [];
            this.userFacetBuckets[field.field] = buckets
                .filter((facetBucket) => facetBucket.label !== bucket.label);
        }
    }
    addFilterQuery(query) {
        if (query) {
            const existing = this.filterQueries.find((filterQuery) => filterQuery.query === query);
            if (!existing) {
                this.filterQueries.push({ query: query });
            }
        }
    }
    removeFilterQuery(query) {
        if (query) {
            this.filterQueries = this.filterQueries
                .filter((filterQuery) => filterQuery.query !== query);
        }
    }
    getFacetQuery(label) {
        if (label && this.hasFacetQueries) {
            const result = this.config.facetQueries.queries.find((query) => query.label === label);
            if (result) {
                return Object.assign({}, result);
            }
        }
        return null;
    }
    getFacetField(label) {
        if (label) {
            const fields = this.config.facetFields.fields || [];
            const result = fields.find((field) => field.label === label);
            if (result) {
                result.label = this.getSupportedLabel(result.label);
                return Object.assign({}, result);
            }
        }
        return null;
    }
    setScope(scope) {
        this.scope = scope;
    }
    getScope() {
        return this.scope;
    }
    update(queryBody) {
        const query = queryBody ? queryBody : this.buildQuery();
        this.updated.next(query);
    }
    execute(queryBody) {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                const query = queryBody ? queryBody : this.buildQuery();
                if (query) {
                    const resultSetPaging = yield this.searchApi.search(query);
                    this.executed.next(resultSetPaging);
                }
            }
            catch (error) {
                this.error.next(error);
                this.executed.next({
                    list: {
                        pagination: {
                            totalItems: 0
                        },
                        entries: []
                    }
                });
            }
        });
    }
    search(queryBody) {
        const promise = this.searchApi.search(queryBody);
        promise.then((resultSetPaging) => {
            this.executed.next(resultSetPaging);
        });
        return from(promise);
    }
    buildQuery() {
        const query = this.getFinalQuery();
        const include = this.config.include || [];
        if (include.length === 0) {
            include.push('path', 'allowableOperations');
        }
        if (query) {
            const result = {
                query: {
                    query: query,
                    language: 'afts'
                },
                include: include,
                paging: this.paging,
                fields: this.config.fields,
                filterQueries: this.filterQueries,
                facetQueries: this.facetQueries,
                facetIntervals: this.facetIntervals,
                facetFields: this.facetFields,
                sort: this.sort,
                highlight: this.highlight
            };
            if (this.scope) {
                result['scope'] = this.scope;
            }
            result['facetFormat'] = 'V2';
            return result;
        }
        return null;
    }
    getPrimarySorting() {
        if (this.sorting && this.sorting.length > 0) {
            return this.sorting[0];
        }
        return null;
    }
    getSortingOptions() {
        if (this.config && this.config.sorting) {
            return this.config.sorting.options || [];
        }
        return [];
    }
    getQueryGroup(query) {
        return query.group || this.config.facetQueries.label || 'Facet Queries';
    }
    get hasFacetQueries() {
        if (this.config
            && this.config.facetQueries
            && this.config.facetQueries.queries
            && this.config.facetQueries.queries.length > 0) {
            return true;
        }
        return false;
    }
    get hasFacetIntervals() {
        return this.config
            && this.config.facetIntervals
            && this.config.facetIntervals.intervals
            && this.config.facetIntervals.intervals.length > 0;
    }
    get hasFacetHighlight() {
        return !!(this.config && this.config.highlight);
    }
    get sort() {
        return this.sorting.map((def) => {
            return new RequestSortDefinitionInner({
                type: def.type,
                field: def.field,
                ascending: def.ascending
            });
        });
    }
    get facetQueries() {
        if (this.hasFacetQueries) {
            return this.config.facetQueries.queries.map((query) => {
                query.group = this.getQueryGroup(query);
                return Object.assign({}, query);
            });
        }
        return null;
    }
    get facetIntervals() {
        if (this.hasFacetIntervals) {
            const configIntervals = this.config.facetIntervals;
            return {
                intervals: configIntervals.intervals.map((interval) => ({
                    label: this.getSupportedLabel(interval.label),
                    field: interval.field,
                    sets: interval.sets.map((set) => ({
                        label: this.getSupportedLabel(set.label),
                        start: set.start,
                        end: set.end,
                        startInclusive: set.startInclusive,
                        endInclusive: set.endInclusive
                    }))
                }))
            };
        }
        return null;
    }
    get highlight() {
        return this.hasFacetHighlight ? this.config.highlight : null;
    }
    getFinalQuery() {
        let query = '';
        this.categories.forEach((facet) => {
            const customQuery = this.queryFragments[facet.id];
            if (customQuery) {
                if (query.length > 0) {
                    query += ' AND ';
                }
                query += `(${customQuery})`;
            }
        });
        let result = [this.userQuery, query]
            .filter((entry) => entry)
            .join(' AND ');
        if (this.userFacetBuckets) {
            Object.keys(this.userFacetBuckets).forEach((key) => {
                const subQuery = (this.userFacetBuckets[key] || [])
                    .filter((bucket) => bucket.filterQuery)
                    .map((bucket) => bucket.filterQuery)
                    .join(' OR ');
                if (subQuery) {
                    if (result.length > 0) {
                        result += ' AND ';
                    }
                    result += `(${subQuery})`;
                }
            });
        }
        return result;
    }
    get facetFields() {
        const facetFields = this.config.facetFields && this.config.facetFields.fields;
        if (facetFields && facetFields.length > 0) {
            return {
                facets: facetFields.map((facet) => ({
                    field: facet.field,
                    mincount: facet.mincount,
                    label: this.getSupportedLabel(facet.label),
                    limit: facet.limit,
                    offset: facet.offset,
                    prefix: facet.prefix
                }))
            };
        }
        return null;
    }
    getSupportedLabel(configLabel) {
        const spaceInsideLabelIndex = configLabel.search(/\s/g);
        if (spaceInsideLabelIndex > -1) {
            return `"${configLabel}"`;
        }
        return configLabel;
    }
}
BaseQueryBuilderService.ɵprov = i0.ɵɵdefineInjectable({ factory: function BaseQueryBuilderService_Factory() { return new BaseQueryBuilderService(i0.ɵɵinject(i1.AppConfigService), i0.ɵɵinject(i1.AlfrescoApiService)); }, token: BaseQueryBuilderService, providedIn: "root" });
BaseQueryBuilderService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
BaseQueryBuilderService.ctorParameters = () => [
    { type: AppConfigService },
    { type: AlfrescoApiService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS1xdWVyeS1idWlsZGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9jb250ZW50LXNlcnZpY2VzL3NyYy8iLCJzb3VyY2VzIjpbImxpYi9zZWFyY2gvc2VydmljZXMvYmFzZS1xdWVyeS1idWlsZGVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQWlCQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxPQUFPLEVBQWMsSUFBSSxFQUFFLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUMxRSxPQUFPLEVBSUgsMEJBQTBCLEVBSTFCLFNBQVMsRUFDWixNQUFNLGtCQUFrQixDQUFDOzs7QUFjMUIsTUFBTSxPQUFnQix1QkFBdUI7SUFtRHpDLFlBQXNCLFNBQTJCLEVBQVksa0JBQXNDO1FBQTdFLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBQVksdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQTFDbkcsa0JBQWEsR0FBRyxJQUFJLE9BQU8sRUFBdUIsQ0FBQztRQUduRCxZQUFPLEdBQUcsSUFBSSxPQUFPLEVBQWEsQ0FBQztRQUduQyxhQUFRLEdBQUcsSUFBSSxPQUFPLEVBQW1CLENBQUM7UUFHMUMsVUFBSyxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7UUFHdEIsZ0JBQVcsR0FBRyxJQUFJLGFBQWEsQ0FBZSxDQUFDLENBQUMsQ0FBQztRQUVqRCxlQUFVLEdBQXFCLEVBQUUsQ0FBQztRQUNsQyxtQkFBYyxHQUE2QixFQUFFLENBQUM7UUFDOUMsa0JBQWEsR0FBa0IsRUFBRSxDQUFDO1FBQ2xDLFdBQU0sR0FBOEMsSUFBSSxDQUFDO1FBQ3pELFlBQU8sR0FBOEIsRUFBRSxDQUFDO1FBQ3hD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QUFJLFdBQVcsR0FBRyxDQUFDO1NBQzdCO1FBQ0QsT0FBTyxXQUFXLENBQUM7SUFDdkIsQ0FBQzs7OztZQW5mSixVQUFVLFNBQUM7Z0JBQ1IsVUFBVSxFQUFFLE1BQU07YUFDckI7OztZQXZCNEIsZ0JBQWdCO1lBQXBDLGtCQUFrQiIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YmplY3QsIE9ic2VydmFibGUsIGZyb20sIFJlcGxheVN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEFsZnJlc2NvQXBpU2VydmljZSwgQXBwQ29uZmlnU2VydmljZSB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQge1xuICAgIFF1ZXJ5Qm9keSxcbiAgICBSZXF1ZXN0RmFjZXRGaWVsZHMsXG4gICAgUmVxdWVzdEZhY2V0RmllbGQsXG4gICAgUmVxdWVzdFNvcnREZWZpbml0aW9uSW5uZXIsXG4gICAgUmVzdWx0U2V0UGFnaW5nLFxuICAgIFJlcXVlc3RIaWdobGlnaHQsXG4gICAgUmVxdWVzdFNjb3BlLFxuICAgIFNlYXJjaEFwaVxufSBmcm9tICdAYWxmcmVzY28vanMtYXBpJztcbmltcG9ydCB7IFNlYXJjaENhdGVnb3J5IH0gZnJvbSAnLi4vbW9kZWxzL3NlYXJjaC1jYXRlZ29yeS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgRmlsdGVyUXVlcnkgfSBmcm9tICcuLi9tb2RlbHMvZmlsdGVyLXF1ZXJ5LmludGVyZmFjZSc7XG5pbXBvcnQgeyBTZWFyY2hSYW5nZSB9IGZyb20gJy4uL21vZGVscy9zZWFyY2gtcmFuZ2UuaW50ZXJmYWNlJztcbmltcG9ydCB7IFNlYXJjaENvbmZpZ3VyYXRpb24gfSBmcm9tICcuLi9tb2RlbHMvc2VhcmNoLWNvbmZpZ3VyYXRpb24uaW50ZXJmYWNlJztcbmltcG9ydCB7IEZhY2V0UXVlcnkgfSBmcm9tICcuLi9tb2RlbHMvZmFjZXQtcXVlcnkuaW50ZXJmYWNlJztcbmltcG9ydCB7IFNlYXJjaFNvcnRpbmdEZWZpbml0aW9uIH0gZnJvbSAnLi4vbW9kZWxzL3NlYXJjaC1zb3J0aW5nLWRlZmluaXRpb24uaW50ZXJmYWNlJztcbmltcG9ydCB7IEZhY2V0RmllbGQgfSBmcm9tICcuLi9tb2RlbHMvZmFjZXQtZmllbGQuaW50ZXJmYWNlJztcbmltcG9ydCB7IEZhY2V0RmllbGRCdWNrZXQgfSBmcm9tICcuLi9tb2RlbHMvZmFjZXQtZmllbGQtYnVja2V0LmludGVyZmFjZSc7XG5pbXBvcnQgeyBTZWFyY2hGb3JtIH0gZnJvbSAnLi4vbW9kZWxzL3NlYXJjaC1mb3JtLmludGVyZmFjZSc7XG5cbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQmFzZVF1ZXJ5QnVpbGRlclNlcnZpY2Uge1xuXG4gICAgX3NlYXJjaEFwaTogU2VhcmNoQXBpO1xuICAgIGdldCBzZWFyY2hBcGkoKTogU2VhcmNoQXBpIHtcbiAgICAgICAgdGhpcy5fc2VhcmNoQXBpID0gdGhpcy5fc2VhcmNoQXBpID8/IG5ldyBTZWFyY2hBcGkodGhpcy5hbGZyZXNjb0FwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWFyY2hBcGk7XG4gICAgfVxuXG4gICAgLyogIFN0cmVhbSB0aGF0IGVtaXRzIHRoZSBzZWFyY2ggY29uZmlndXJhdGlvbiB3aGVuZXZlciB0aGUgdXNlciBjaGFuZ2UgdGhlIHNlYXJjaCBmb3JtcyAqL1xuICAgIGNvbmZpZ1VwZGF0ZWQgPSBuZXcgU3ViamVjdDxTZWFyY2hDb25maWd1cmF0aW9uPigpO1xuXG4gICAgLyogIFN0cmVhbSB0aGF0IGVtaXRzIHRoZSBxdWVyeSBiZWZvcmUgc2VhcmNoIHdoZW5ldmVyIHVzZXIgc2VhcmNoICAqL1xuICAgIHVwZGF0ZWQgPSBuZXcgU3ViamVjdDxRdWVyeUJvZHk+KCk7XG5cbiAgICAvKiAgU3RyZWFtIHRoYXQgZW1pdHMgdGhlIHJlc3VsdHMgd2hlbmV2ZXIgdXNlciBzZWFyY2ggICovXG4gICAgZXhlY3V0ZWQgPSBuZXcgU3ViamVjdDxSZXN1bHRTZXRQYWdpbmc+KCk7XG5cbiAgICAvKiAgU3RyZWFtIHRoYXQgZW1pdHMgdGhlIGVycm9yIHdoZW5ldmVyIHVzZXIgc2VhcmNoICAqL1xuICAgIGVycm9yID0gbmV3IFN1YmplY3QoKTtcblxuICAgIC8qICBTdHJlYW0gdGhhdCBlbWl0cyBzZWFyY2ggZm9ybXMgICovXG4gICAgc2VhcmNoRm9ybXMgPSBuZXcgUmVwbGF5U3ViamVjdDxTZWFyY2hGb3JtW10+KDEpO1xuXG4gICAgY2F0ZWdvcmllczogU2VhcmNoQ2F0ZWdvcnlbXSA9IFtdO1xuICAgIHF1ZXJ5RnJhZ21lbnRzOiB7IFtpZDogc3RyaW5nXTogc3RyaW5nIH0gPSB7fTtcbiAgICBmaWx0ZXJRdWVyaWVzOiBGaWx0ZXJRdWVyeVtdID0gW107XG4gICAgcGFnaW5nOiB7IG1heEl0ZW1zPzogbnVtYmVyOyBza2lwQ291bnQ/OiBudW1iZXIgfSA9IG51bGw7XG4gICAgc29ydGluZzogU2VhcmNoU29ydGluZ0RlZmluaXRpb25bXSA9IFtdO1xuICAgIHNvcnRpbmdPcHRpb25zOiBTZWFyY2hTb3J0aW5nRGVmaW5pdGlvbltdID0gW107XG4gICAgcHJpdmF0ZSBzY29wZTogUmVxdWVzdFNjb3BlO1xuICAgIHByaXZhdGUgc2VsZWN0ZWRDb25maWd1cmF0aW9uOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBfdXNlclF1ZXJ5ID0gJyc7XG5cbiAgICBwcm90ZWN0ZWQgdXNlckZhY2V0QnVja2V0czogeyBba2V5OiBzdHJpbmddOiBGYWNldEZpZWxkQnVja2V0W10gfSA9IHt9O1xuXG4gICAgZ2V0IHVzZXJRdWVyeSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5fdXNlclF1ZXJ5O1xuICAgIH1cblxuICAgIHNldCB1c2VyUXVlcnkodmFsdWU6IHN0cmluZykge1xuICAgICAgICB2YWx1ZSA9ICh2YWx1ZSB8fCAnJykudHJpbSgpO1xuICAgICAgICB0aGlzLl91c2VyUXVlcnkgPSB2YWx1ZSA/IGAoJHt2YWx1ZX0pYCA6ICcnO1xuICAgIH1cblxuICAgIGNvbmZpZzogU2VhcmNoQ29uZmlndXJhdGlvbiA9IHtcbiAgICAgICAgY2F0ZWdvcmllczogW11cbiAgICB9O1xuXG4gICAgLy8gVE9ETzogdG8gYmUgc3VwcG9ydGVkIGluIGZ1dHVyZSBpdGVyYXRpb25zXG4gICAgcmFuZ2VzOiB7IFtpZDogc3RyaW5nXTogU2VhcmNoUmFuZ2UgfSA9IHt9O1xuXG4gICAgY29uc3RydWN0b3IocHJvdGVjdGVkIGFwcENvbmZpZzogQXBwQ29uZmlnU2VydmljZSwgcHJvdGVjdGVkIGFsZnJlc2NvQXBpU2VydmljZTogQWxmcmVzY29BcGlTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMucmVzZXRUb0RlZmF1bHRzKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGFic3RyYWN0IGxvYWRDb25maWd1cmF0aW9uKCk6IFNlYXJjaENvbmZpZ3VyYXRpb24gfCBTZWFyY2hDb25maWd1cmF0aW9uW107XG5cbiAgICBwdWJsaWMgYWJzdHJhY3QgaXNGaWx0ZXJTZXJ2aWNlQWN0aXZlKCk6IGJvb2xlYW47XG5cbiAgICBwdWJsaWMgcmVzZXRUb0RlZmF1bHRzKCkge1xuICAgICAgICBjb25zdCBjdXJyZW50Q29uZmlnID0gdGhpcy5nZXREZWZhdWx0Q29uZmlndXJhdGlvbigpO1xuICAgICAgICB0aGlzLnJlc2V0U2VhcmNoT3B0aW9ucygpO1xuICAgICAgICB0aGlzLmNvbmZpZ1VwZGF0ZWQubmV4dChjdXJyZW50Q29uZmlnKTtcbiAgICAgICAgdGhpcy5zZWFyY2hGb3Jtcy5uZXh0KHRoaXMuZ2V0U2VhcmNoRm9ybURldGFpbHMoKSk7XG4gICAgICAgIHRoaXMuc2V0VXBTZWFyY2hDb25maWd1cmF0aW9uKGN1cnJlbnRDb25maWcpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXREZWZhdWx0Q29uZmlndXJhdGlvbigpOiBTZWFyY2hDb25maWd1cmF0aW9uIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgY29uc3QgY29uZmlndXJhdGlvbnMgPSB0aGlzLmxvYWRDb25maWd1cmF0aW9uKCk7XG5cbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRDb25maWd1cmF0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25maWd1cmF0aW9uc1t0aGlzLnNlbGVjdGVkQ29uZmlndXJhdGlvbl07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWd1cmF0aW9ucykpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25maWd1cmF0aW9ucy5maW5kKChjb25maWd1cmF0aW9uKSA9PiBjb25maWd1cmF0aW9uLmRlZmF1bHQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb25maWd1cmF0aW9ucztcbiAgICB9XG5cbiAgICBwdWJsaWMgdXBkYXRlU2VsZWN0ZWRDb25maWd1cmF0aW9uKGluZGV4OiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgY3VycmVudENvbmZpZyA9IHRoaXMubG9hZENvbmZpZ3VyYXRpb24oKTtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY3VycmVudENvbmZpZykgJiYgY3VycmVudENvbmZpZ1tpbmRleF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZENvbmZpZ3VyYXRpb24gPSBpbmRleDtcbiAgICAgICAgICAgIHRoaXMuY29uZmlnVXBkYXRlZC5uZXh0KGN1cnJlbnRDb25maWdbaW5kZXhdKTtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoRm9ybXMubmV4dCh0aGlzLmdldFNlYXJjaEZvcm1EZXRhaWxzKCkpO1xuICAgICAgICAgICAgdGhpcy5yZXNldFNlYXJjaE9wdGlvbnMoKTtcbiAgICAgICAgICAgIHRoaXMuc2V0VXBTZWFyY2hDb25maWd1cmF0aW9uKGN1cnJlbnRDb25maWdbaW5kZXhdKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHJlc2V0U2VhcmNoT3B0aW9ucygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jYXRlZ29yaWVzID0gW107XG4gICAgICAgIHRoaXMucXVlcnlGcmFnbWVudHMgPSB7fTtcbiAgICAgICAgdGhpcy5maWx0ZXJRdWVyaWVzID0gW107XG4gICAgICAgIHRoaXMuc29ydGluZyA9IFtdO1xuICAgICAgICB0aGlzLnNvcnRpbmdPcHRpb25zID0gW107XG4gICAgICAgIHRoaXMudXNlckZhY2V0QnVja2V0cyA9IHt9O1xuICAgICAgICB0aGlzLnNjb3BlID0gbnVsbDtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0U2VhcmNoRm9ybURldGFpbHMoKTogU2VhcmNoRm9ybVtdIHtcbiAgICAgICAgY29uc3QgY29uZmlndXJhdGlvbnMgPSB0aGlzLmxvYWRDb25maWd1cmF0aW9uKCk7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvbmZpZ3VyYXRpb25zKSkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZ3VyYXRpb25zLm1hcCgoY29uZmlndXJhdGlvbiwgaW5kZXgpID0+ICh7XG4gICAgICAgICAgICAgICAgaW5kZXgsXG4gICAgICAgICAgICAgICAgbmFtZTogY29uZmlndXJhdGlvbi5uYW1lIHx8ICdTRUFSQ0guVU5LTk9XTl9DT05GSUdVUkFUSU9OJyxcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBjb25maWd1cmF0aW9uLmRlZmF1bHQgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHRoaXMuc2VsZWN0ZWRDb25maWd1cmF0aW9uICE9PSB1bmRlZmluZWQgPyBpbmRleCA9PT0gdGhpcy5zZWxlY3RlZENvbmZpZ3VyYXRpb24gOiBjb25maWd1cmF0aW9uLmRlZmF1bHRcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSBlbHNlIGlmICghIWNvbmZpZ3VyYXRpb25zKSB7XG4gICAgICAgICAgICByZXR1cm4gW3tcbiAgICAgICAgICAgICAgICBpbmRleDogMCxcbiAgICAgICAgICAgICAgICBuYW1lOiBjb25maWd1cmF0aW9ucy5uYW1lIHx8ICdTRUFSQ0guVU5LTk9XTl9DT05GSUdVUkFUSU9OJyxcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiB0cnVlLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkOiB0cnVlXG4gICAgICAgICAgICB9XTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRVcFNlYXJjaENvbmZpZ3VyYXRpb24oY3VycmVudENvbmZpZ3VyYXRpb246IFNlYXJjaENvbmZpZ3VyYXRpb24pIHtcbiAgICAgICAgaWYgKGN1cnJlbnRDb25maWd1cmF0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY3VycmVudENvbmZpZ3VyYXRpb24pKTtcbiAgICAgICAgICAgIHRoaXMuY2F0ZWdvcmllcyA9ICh0aGlzLmNvbmZpZy5jYXRlZ29yaWVzIHx8IFtdKS5maWx0ZXIoXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnkgPT4gY2F0ZWdvcnkuZW5hYmxlZFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyUXVlcmllcyA9IHRoaXMuY29uZmlnLmZpbHRlclF1ZXJpZXMgfHwgW107XG4gICAgICAgICAgICB0aGlzLnVzZXJGYWNldEJ1Y2tldHMgPSB7fTtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5zb3J0aW5nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zb3J0aW5nID0gdGhpcy5jb25maWcuc29ydGluZy5kZWZhdWx0cyB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLnNvcnRpbmdPcHRpb25zID0gdGhpcy5jb25maWcuc29ydGluZy5vcHRpb25zIHx8IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkcyBhIGZhY2V0IGJ1Y2tldCB0byBhIGZpZWxkLlxuICAgICAqIEBwYXJhbSBmaWVsZCBUaGUgdGFyZ2V0IGZpZWxkXG4gICAgICogQHBhcmFtIGJ1Y2tldCBCdWNrZXQgdG8gYWRkXG4gICAgICovXG4gICAgYWRkVXNlckZhY2V0QnVja2V0KGZpZWxkOiBGYWNldEZpZWxkLCBidWNrZXQ6IEZhY2V0RmllbGRCdWNrZXQpIHtcbiAgICAgICAgaWYgKGZpZWxkICYmIGZpZWxkLmZpZWxkICYmIGJ1Y2tldCkge1xuICAgICAgICAgICAgY29uc3QgYnVja2V0cyA9IHRoaXMudXNlckZhY2V0QnVja2V0c1tmaWVsZC5maWVsZF0gfHwgW107XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZyA9IGJ1Y2tldHMuZmluZCgoZmFjZXRCdWNrZXQpID0+IGZhY2V0QnVja2V0LmxhYmVsID09PSBidWNrZXQubGFiZWwpO1xuICAgICAgICAgICAgaWYgKCFleGlzdGluZykge1xuICAgICAgICAgICAgICAgIGJ1Y2tldHMucHVzaChidWNrZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy51c2VyRmFjZXRCdWNrZXRzW2ZpZWxkLmZpZWxkXSA9IGJ1Y2tldHM7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBidWNrZXRzIGN1cnJlbnRseSBhZGRlZCB0byBhIGZpZWxkXG4gICAgICogQHBhcmFtIGZpZWxkIFRoZSB0YXJnZXQgZmllbGRzXG4gICAgICogQHJldHVybnMgQnVja2V0IGFycmF5XG4gICAgICovXG4gICAgZ2V0VXNlckZhY2V0QnVja2V0cyhmaWVsZDogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnVzZXJGYWNldEJ1Y2tldHNbZmllbGRdIHx8IFtdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgYW4gZXhpc3RpbmcgYnVja2V0IGZyb20gYSBmaWVsZC5cbiAgICAgKiBAcGFyYW0gZmllbGQgVGhlIHRhcmdldCBmaWVsZFxuICAgICAqIEBwYXJhbSBidWNrZXQgQnVja2V0IHRvIHJlbW92ZVxuICAgICAqL1xuICAgIHJlbW92ZVVzZXJGYWNldEJ1Y2tldChmaWVsZDogRmFjZXRGaWVsZCwgYnVja2V0OiBGYWNldEZpZWxkQnVja2V0KSB7XG4gICAgICAgIGlmIChmaWVsZCAmJiBmaWVsZC5maWVsZCAmJiBidWNrZXQpIHtcbiAgICAgICAgICAgIGNvbnN0IGJ1Y2tldHMgPSB0aGlzLnVzZXJGYWNldEJ1Y2tldHNbZmllbGQuZmllbGRdIHx8IFtdO1xuICAgICAgICAgICAgdGhpcy51c2VyRmFjZXRCdWNrZXRzW2ZpZWxkLmZpZWxkXSA9IGJ1Y2tldHNcbiAgICAgICAgICAgICAgICAuZmlsdGVyKChmYWNldEJ1Y2tldCkgPT4gZmFjZXRCdWNrZXQubGFiZWwgIT09IGJ1Y2tldC5sYWJlbCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGRzIGEgZmlsdGVyIHF1ZXJ5IHRvIHRoZSBjdXJyZW50IHF1ZXJ5LlxuICAgICAqIEBwYXJhbSBxdWVyeSBRdWVyeSBzdHJpbmcgdG8gYWRkXG4gICAgICovXG4gICAgYWRkRmlsdGVyUXVlcnkocXVlcnk6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBpZiAocXVlcnkpIHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nID0gdGhpcy5maWx0ZXJRdWVyaWVzLmZpbmQoKGZpbHRlclF1ZXJ5KSA9PiBmaWx0ZXJRdWVyeS5xdWVyeSA9PT0gcXVlcnkpO1xuICAgICAgICAgICAgaWYgKCFleGlzdGluZykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyUXVlcmllcy5wdXNoKHsgcXVlcnk6IHF1ZXJ5IH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhbiBleGlzdGluZyBmaWx0ZXIgcXVlcnkuXG4gICAgICogQHBhcmFtIHF1ZXJ5IFRoZSBxdWVyeSB0byByZW1vdmVcbiAgICAgKi9cbiAgICByZW1vdmVGaWx0ZXJRdWVyeShxdWVyeTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGlmIChxdWVyeSkge1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJRdWVyaWVzID0gdGhpcy5maWx0ZXJRdWVyaWVzXG4gICAgICAgICAgICAgICAgLmZpbHRlcigoZmlsdGVyUXVlcnkpID0+IGZpbHRlclF1ZXJ5LnF1ZXJ5ICE9PSBxdWVyeSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIGEgZmFjZXQgcXVlcnkgYnkgbGFiZWwuXG4gICAgICogQHBhcmFtIGxhYmVsIExhYmVsIG9mIHRoZSBxdWVyeVxuICAgICAqIEByZXR1cm5zIEZhY2V0IHF1ZXJ5IGRhdGFcbiAgICAgKi9cbiAgICBnZXRGYWNldFF1ZXJ5KGxhYmVsOiBzdHJpbmcpOiBGYWNldFF1ZXJ5IHtcbiAgICAgICAgaWYgKGxhYmVsICYmIHRoaXMuaGFzRmFjZXRRdWVyaWVzKSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmNvbmZpZy5mYWNldFF1ZXJpZXMucXVlcmllcy5maW5kKChxdWVyeSkgPT4gcXVlcnkubGFiZWwgPT09IGxhYmVsKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5yZXN1bHQgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIGEgZmFjZXQgZmllbGQgYnkgbGFiZWwuXG4gICAgICogQHBhcmFtIGxhYmVsIExhYmVsIG9mIHRoZSBmYWNldCBmaWVsZFxuICAgICAqIEByZXR1cm5zIEZhY2V0IGZpZWxkIGRhdGFcbiAgICAgKi9cbiAgICBnZXRGYWNldEZpZWxkKGxhYmVsOiBzdHJpbmcpOiBGYWNldEZpZWxkIHtcbiAgICAgICAgaWYgKGxhYmVsKSB7XG4gICAgICAgICAgICBjb25zdCBmaWVsZHMgPSB0aGlzLmNvbmZpZy5mYWNldEZpZWxkcy5maWVsZHMgfHwgW107XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmaWVsZHMuZmluZCgoZmllbGQpID0+IGZpZWxkLmxhYmVsID09PSBsYWJlbCk7XG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmxhYmVsID0gdGhpcy5nZXRTdXBwb3J0ZWRMYWJlbChyZXN1bHQubGFiZWwpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7IC4uLnJlc3VsdCB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHNldFNjb3BlKHNjb3BlOiBSZXF1ZXN0U2NvcGUpIHtcbiAgICAgICAgdGhpcy5zY29wZSA9IHNjb3BlO1xuICAgIH1cblxuICAgIGdldFNjb3BlKCk6IFJlcXVlc3RTY29wZSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNjb3BlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJ1aWxkcyB0aGUgY3VycmVudCBxdWVyeSBhbmQgdHJpZ2dlcnMgdGhlIGB1cGRhdGVkYCBldmVudC5cbiAgICAgKi9cbiAgICB1cGRhdGUocXVlcnlCb2R5PzogUXVlcnlCb2R5KTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gcXVlcnlCb2R5ID8gcXVlcnlCb2R5IDogdGhpcy5idWlsZFF1ZXJ5KCk7XG4gICAgICAgIHRoaXMudXBkYXRlZC5uZXh0KHF1ZXJ5KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBCdWlsZHMgYW5kIGV4ZWN1dGVzIHRoZSBjdXJyZW50IHF1ZXJ5LlxuICAgICAqIEByZXR1cm5zIE5vdGhpbmdcbiAgICAgKi9cbiAgICBhc3luYyBleGVjdXRlKHF1ZXJ5Qm9keT86IFF1ZXJ5Qm9keSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcXVlcnkgPSBxdWVyeUJvZHkgPyBxdWVyeUJvZHkgOiB0aGlzLmJ1aWxkUXVlcnkoKTtcbiAgICAgICAgICAgIGlmIChxdWVyeSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdFNldFBhZ2luZzogUmVzdWx0U2V0UGFnaW5nID0gYXdhaXQgdGhpcy5zZWFyY2hBcGkuc2VhcmNoKHF1ZXJ5KTtcbiAgICAgICAgICAgICAgICB0aGlzLmV4ZWN1dGVkLm5leHQocmVzdWx0U2V0UGFnaW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IubmV4dChlcnJvcik7XG5cbiAgICAgICAgICAgIHRoaXMuZXhlY3V0ZWQubmV4dCh7XG4gICAgICAgICAgICAgICAgbGlzdDoge1xuICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEl0ZW1zOiAwXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVudHJpZXM6IFtdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZWFyY2gocXVlcnlCb2R5OiBRdWVyeUJvZHkpOiBPYnNlcnZhYmxlPFJlc3VsdFNldFBhZ2luZz4ge1xuICAgICAgICBjb25zdCBwcm9taXNlID0gdGhpcy5zZWFyY2hBcGkuc2VhcmNoKHF1ZXJ5Qm9keSk7XG5cbiAgICAgICAgcHJvbWlzZS50aGVuKChyZXN1bHRTZXRQYWdpbmcpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZXhlY3V0ZWQubmV4dChyZXN1bHRTZXRQYWdpbmcpO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gZnJvbShwcm9taXNlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBCdWlsZHMgdGhlIGN1cnJlbnQgcXVlcnkuXG4gICAgICogQHJldHVybnMgVGhlIGZpbmlzaGVkIHF1ZXJ5XG4gICAgICovXG4gICAgYnVpbGRRdWVyeSgpOiBRdWVyeUJvZHkge1xuICAgICAgICBjb25zdCBxdWVyeSA9IHRoaXMuZ2V0RmluYWxRdWVyeSgpO1xuXG4gICAgICAgIGNvbnN0IGluY2x1ZGUgPSB0aGlzLmNvbmZpZy5pbmNsdWRlIHx8IFtdO1xuICAgICAgICBpZiAoaW5jbHVkZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGluY2x1ZGUucHVzaCgncGF0aCcsICdhbGxvd2FibGVPcGVyYXRpb25zJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocXVlcnkpIHtcblxuICAgICAgICAgICAgY29uc3QgcmVzdWx0OiBRdWVyeUJvZHkgPSA8UXVlcnlCb2R5PiB7XG4gICAgICAgICAgICAgICAgcXVlcnk6IHtcbiAgICAgICAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LFxuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogJ2FmdHMnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpbmNsdWRlOiBpbmNsdWRlLFxuICAgICAgICAgICAgICAgIHBhZ2luZzogdGhpcy5wYWdpbmcsXG4gICAgICAgICAgICAgICAgZmllbGRzOiB0aGlzLmNvbmZpZy5maWVsZHMsXG4gICAgICAgICAgICAgICAgZmlsdGVyUXVlcmllczogdGhpcy5maWx0ZXJRdWVyaWVzLFxuICAgICAgICAgICAgICAgIGZhY2V0UXVlcmllczogdGhpcy5mYWNldFF1ZXJpZXMsXG4gICAgICAgICAgICAgICAgZmFjZXRJbnRlcnZhbHM6IHRoaXMuZmFjZXRJbnRlcnZhbHMsXG4gICAgICAgICAgICAgICAgZmFjZXRGaWVsZHM6IHRoaXMuZmFjZXRGaWVsZHMsXG4gICAgICAgICAgICAgICAgc29ydDogdGhpcy5zb3J0LFxuICAgICAgICAgICAgICAgIGhpZ2hsaWdodDogdGhpcy5oaWdobGlnaHRcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnNjb3BlKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0WydzY29wZSddID0gdGhpcy5zY29wZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVzdWx0WydmYWNldEZvcm1hdCddID0gJ1YyJztcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBwcmltYXJ5IHNvcnRpbmcgZGVmaW5pdGlvbi5cbiAgICAgKiBAcmV0dXJucyBUaGUgcHJpbWFyeSBzb3J0aW5nIGRlZmluaXRpb25cbiAgICAgKi9cbiAgICBnZXRQcmltYXJ5U29ydGluZygpOiBTZWFyY2hTb3J0aW5nRGVmaW5pdGlvbiB7XG4gICAgICAgIGlmICh0aGlzLnNvcnRpbmcgJiYgdGhpcy5zb3J0aW5nLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNvcnRpbmdbMF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhbGwgcHJlLWNvbmZpZ3VyZWQgc29ydGluZyBvcHRpb25zIHRoYXQgdXNlcnMgY2FuIGNob29zZSBmcm9tLlxuICAgICAqIEByZXR1cm5zIFByZS1jb25maWd1cmVkIHNvcnRpbmcgb3B0aW9uc1xuICAgICAqL1xuICAgIGdldFNvcnRpbmdPcHRpb25zKCk6IFNlYXJjaFNvcnRpbmdEZWZpbml0aW9uW10ge1xuICAgICAgICBpZiAodGhpcy5jb25maWcgJiYgdGhpcy5jb25maWcuc29ydGluZykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnLnNvcnRpbmcub3B0aW9ucyB8fCBbXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgcXVlcnkgZ3JvdXAuXG4gICAgICogQHBhcmFtIHF1ZXJ5IFRhcmdldCBxdWVyeVxuICAgICAqIEByZXR1cm5zIFF1ZXJ5IGdyb3VwXG4gICAgICovXG4gICAgZ2V0UXVlcnlHcm91cChxdWVyeSkge1xuICAgICAgICByZXR1cm4gcXVlcnkuZ3JvdXAgfHwgdGhpcy5jb25maWcuZmFjZXRRdWVyaWVzLmxhYmVsIHx8ICdGYWNldCBRdWVyaWVzJztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgRmFjZXRRdWVyaWVzIGhhcyBiZWVuIGRlZmluZWRcbiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIGRlZmluZWQsIGZhbHNlIG90aGVyd2lzZVxuICAgICAqL1xuICAgIGdldCBoYXNGYWNldFF1ZXJpZXMoKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZ1xuICAgICAgICAgICAgJiYgdGhpcy5jb25maWcuZmFjZXRRdWVyaWVzXG4gICAgICAgICAgICAmJiB0aGlzLmNvbmZpZy5mYWNldFF1ZXJpZXMucXVlcmllc1xuICAgICAgICAgICAgJiYgdGhpcy5jb25maWcuZmFjZXRRdWVyaWVzLnF1ZXJpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBGYWNldEludGVydmFscyBoYXMgYmVlbiBkZWZpbmVkXG4gICAgICogQHJldHVybnMgVHJ1ZSBpZiBkZWZpbmVkLCBmYWxzZSBvdGhlcndpc2VcbiAgICAgKi9cbiAgICBnZXQgaGFzRmFjZXRJbnRlcnZhbHMoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbmZpZ1xuICAgICAgICAgICAgJiYgdGhpcy5jb25maWcuZmFjZXRJbnRlcnZhbHNcbiAgICAgICAgICAgICYmIHRoaXMuY29uZmlnLmZhY2V0SW50ZXJ2YWxzLmludGVydmFsc1xuICAgICAgICAgICAgJiYgdGhpcy5jb25maWcuZmFjZXRJbnRlcnZhbHMuaW50ZXJ2YWxzLmxlbmd0aCA+IDA7XG5cbiAgICB9XG5cbiAgICBnZXQgaGFzRmFjZXRIaWdobGlnaHQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhISh0aGlzLmNvbmZpZyAmJiB0aGlzLmNvbmZpZy5oaWdobGlnaHQpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgc29ydCgpOiBSZXF1ZXN0U29ydERlZmluaXRpb25Jbm5lcltdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc29ydGluZy5tYXAoKGRlZikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXF1ZXN0U29ydERlZmluaXRpb25Jbm5lcih7XG4gICAgICAgICAgICAgICAgdHlwZTogZGVmLnR5cGUsXG4gICAgICAgICAgICAgICAgZmllbGQ6IGRlZi5maWVsZCxcbiAgICAgICAgICAgICAgICBhc2NlbmRpbmc6IGRlZi5hc2NlbmRpbmdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IGZhY2V0UXVlcmllcygpOiBGYWNldFF1ZXJ5W10ge1xuICAgICAgICBpZiAodGhpcy5oYXNGYWNldFF1ZXJpZXMpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5mYWNldFF1ZXJpZXMucXVlcmllcy5tYXAoKHF1ZXJ5KSA9PiB7XG4gICAgICAgICAgICAgICAgcXVlcnkuZ3JvdXAgPSB0aGlzLmdldFF1ZXJ5R3JvdXAocXVlcnkpO1xuICAgICAgICAgICAgICAgIHJldHVybiA8RmFjZXRRdWVyeT4geyAuLi5xdWVyeSB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IGZhY2V0SW50ZXJ2YWxzKCk6IGFueSB7XG4gICAgICAgIGlmICh0aGlzLmhhc0ZhY2V0SW50ZXJ2YWxzKSB7XG4gICAgICAgICAgICBjb25zdCBjb25maWdJbnRlcnZhbHMgPSB0aGlzLmNvbmZpZy5mYWNldEludGVydmFscztcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBpbnRlcnZhbHM6IGNvbmZpZ0ludGVydmFscy5pbnRlcnZhbHMubWFwKChpbnRlcnZhbCkgPT4gPGFueT4ge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdGhpcy5nZXRTdXBwb3J0ZWRMYWJlbChpbnRlcnZhbC5sYWJlbCksXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBpbnRlcnZhbC5maWVsZCxcbiAgICAgICAgICAgICAgICAgICAgc2V0czogaW50ZXJ2YWwuc2V0cy5tYXAoKHNldCkgPT4gPGFueT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRoaXMuZ2V0U3VwcG9ydGVkTGFiZWwoc2V0LmxhYmVsKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzZXQuc3RhcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IHNldC5lbmQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEluY2x1c2l2ZTogc2V0LnN0YXJ0SW5jbHVzaXZlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5kSW5jbHVzaXZlOiBzZXQuZW5kSW5jbHVzaXZlXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IGhpZ2hsaWdodCgpOiBSZXF1ZXN0SGlnaGxpZ2h0IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzRmFjZXRIaWdobGlnaHQgPyB0aGlzLmNvbmZpZy5oaWdobGlnaHQgOiBudWxsO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXRGaW5hbFF1ZXJ5KCk6IHN0cmluZyB7XG4gICAgICAgIGxldCBxdWVyeSA9ICcnO1xuXG4gICAgICAgIHRoaXMuY2F0ZWdvcmllcy5mb3JFYWNoKChmYWNldCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY3VzdG9tUXVlcnkgPSB0aGlzLnF1ZXJ5RnJhZ21lbnRzW2ZhY2V0LmlkXTtcbiAgICAgICAgICAgIGlmIChjdXN0b21RdWVyeSkge1xuICAgICAgICAgICAgICAgIGlmIChxdWVyeS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5ICs9ICcgQU5EICc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHF1ZXJ5ICs9IGAoJHtjdXN0b21RdWVyeX0pYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IHJlc3VsdCA9IFt0aGlzLnVzZXJRdWVyeSwgcXVlcnldXG4gICAgICAgICAgICAuZmlsdGVyKChlbnRyeSkgPT4gZW50cnkpXG4gICAgICAgICAgICAuam9pbignIEFORCAnKTtcblxuICAgICAgICBpZiAodGhpcy51c2VyRmFjZXRCdWNrZXRzKSB7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyh0aGlzLnVzZXJGYWNldEJ1Y2tldHMpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN1YlF1ZXJ5ID0gKHRoaXMudXNlckZhY2V0QnVja2V0c1trZXldIHx8IFtdKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChidWNrZXQpID0+IGJ1Y2tldC5maWx0ZXJRdWVyeSlcbiAgICAgICAgICAgICAgICAgICAgLm1hcCgoYnVja2V0KSA9PiBidWNrZXQuZmlsdGVyUXVlcnkpXG4gICAgICAgICAgICAgICAgICAgIC5qb2luKCcgT1IgJyk7XG4gICAgICAgICAgICAgICAgaWYgKHN1YlF1ZXJ5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgQU5EICc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGAoJHtzdWJRdWVyeX0pYDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBmYWNldEZpZWxkcygpOiBSZXF1ZXN0RmFjZXRGaWVsZHMge1xuICAgICAgICBjb25zdCBmYWNldEZpZWxkcyA9IHRoaXMuY29uZmlnLmZhY2V0RmllbGRzICYmIHRoaXMuY29uZmlnLmZhY2V0RmllbGRzLmZpZWxkcztcblxuICAgICAgICBpZiAoZmFjZXRGaWVsZHMgJiYgZmFjZXRGaWVsZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBmYWNldHM6IGZhY2V0RmllbGRzLm1hcCgoZmFjZXQpID0+IDxSZXF1ZXN0RmFjZXRGaWVsZD4ge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogZmFjZXQuZmllbGQsXG4gICAgICAgICAgICAgICAgICAgIG1pbmNvdW50OiBmYWNldC5taW5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRoaXMuZ2V0U3VwcG9ydGVkTGFiZWwoZmFjZXQubGFiZWwpLFxuICAgICAgICAgICAgICAgICAgICBsaW1pdDogZmFjZXQubGltaXQsXG4gICAgICAgICAgICAgICAgICAgIG9mZnNldDogZmFjZXQub2Zmc2V0LFxuICAgICAgICAgICAgICAgICAgICBwcmVmaXg6IGZhY2V0LnByZWZpeFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW5jbG9zZXMgYSBsYWJlbCBuYW1lIHdpdGggZG91YmxlIHF1b3RlcyBpZiBpdCBjb250YWlucyB3aGl0ZXNwYWNlIGNoYXJhY3RlcnMuXG4gICAgICogQHBhcmFtIGNvbmZpZ0xhYmVsIE9yaWdpbmFsIGxhYmVsIHRleHRcbiAgICAgKiBAcmV0dXJucyBMYWJlbCwgcG9zc2libHkgd2l0aCBxdW90ZXMgaWYgaXQgY29udGFpbnMgc3BhY2VzXG4gICAgICovXG4gICAgZ2V0U3VwcG9ydGVkTGFiZWwoY29uZmlnTGFiZWw6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IHNwYWNlSW5zaWRlTGFiZWxJbmRleCA9IGNvbmZpZ0xhYmVsLnNlYXJjaCgvXFxzL2cpO1xuICAgICAgICBpZiAoc3BhY2VJbnNpZGVMYWJlbEluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBgXCIke2NvbmZpZ0xhYmVsfVwiYDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29uZmlnTGFiZWw7XG4gICAgfVxufVxuIl19