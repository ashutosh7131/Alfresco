import { Inject, Injectable } from '@angular/core';
import { Subject } from 'rxjs';
import { SEARCH_QUERY_SERVICE_TOKEN } from '../search-query-service.token';
import { SearchQueryBuilderService } from './search-query-builder.service';
import { SearchService, TranslationService } from '@alfresco/adf-core';
import { takeUntil } from 'rxjs/operators';
import { SearchFilterList } from '../models/search-filter-list.model';
import * as i0 from "@angular/core";
import * as i1 from "../search-query-service.token";
import * as i2 from "@alfresco/adf-core";
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@alfresco/adf-core';
import * as ɵngcc2 from './search-query-builder.service';
export class SearchFacetFiltersService {
    constructor(queryBuilder, searchService, translationService) {
        this.queryBuilder = queryBuilder;
        this.searchService = searchService;
        this.translationService = translationService;
        this.responseFacets = null;
        this.selectedBuckets = [];
        this.DEFAULT_PAGE_SIZE = 5;
        this.facetQueriesPageSize = this.DEFAULT_PAGE_SIZE;
        this.onDestroy$ = new Subject();
        if (queryBuilder.config && queryBuilder.config.facetQueries) {
            this.facetQueriesPageSize = queryBuilder.config.facetQueries.pageSize || this.DEFAULT_PAGE_SIZE;
        }
        this.queryBuilder.configUpdated
            .pipe(takeUntil(this.onDestroy$))
            .subscribe(() => {
            this.selectedBuckets = [];
            this.responseFacets = null;
        });
        this.queryBuilder.updated
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((query) => this.queryBuilder.execute(query));
        this.queryBuilder.executed
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((resultSetPaging) => {
            this.onDataLoaded(resultSetPaging);
            this.searchService.dataLoaded.next(resultSetPaging);
        });
    }
    onDataLoaded(data) {
        const context = data.list.context;
        if (context) {
            this.parseFacets(context);
        }
        else {
            this.responseFacets = null;
        }
    }
    parseFacets(context) {
        this.parseFacetFields(context);
        this.parseFacetIntervals(context);
        this.parseFacetQueries(context);
    }
    parseFacetItems(context, configFacetFields, itemType) {
        configFacetFields.forEach((field) => {
            const responseField = this.findFacet(context, itemType, field.label);
            const responseBuckets = this.getResponseBuckets(responseField, field)
                .filter(this.getFilterByMinCount(field.mincount));
            const alreadyExistingField = this.findResponseFacet(itemType, field.label);
            if (alreadyExistingField) {
                const alreadyExistingBuckets = alreadyExistingField.buckets && alreadyExistingField.buckets.items || [];
                this.updateExistingBuckets(responseField, responseBuckets, alreadyExistingField, alreadyExistingBuckets);
            }
            else if (responseField) {
                if (responseBuckets.length > 0) {
                    const bucketList = new SearchFilterList(responseBuckets, field.pageSize);
                    bucketList.filter = this.getBucketFilterFunction(bucketList);
                    if (!this.responseFacets) {
                        this.responseFacets = [];
                    }
                    this.responseFacets.push(Object.assign(Object.assign({}, field), { type: responseField.type || itemType, label: field.label, pageSize: field.pageSize | this.DEFAULT_PAGE_SIZE, currentPageSize: field.pageSize | this.DEFAULT_PAGE_SIZE, buckets: bucketList }));
                }
            }
        });
    }
    parseFacetFields(context) {
        const configFacetFields = this.queryBuilder.config.facetFields && this.queryBuilder.config.facetFields.fields || [];
        this.parseFacetItems(context, configFacetFields, 'field');
    }
    parseFacetIntervals(context) {
        const configFacetIntervals = this.queryBuilder.config.facetIntervals && this.queryBuilder.config.facetIntervals.intervals || [];
        this.parseFacetItems(context, configFacetIntervals, 'interval');
    }
    parseFacetQueries(context) {
        var _a;
        const facetQuerySetting = ((_a = this.queryBuilder.config.facetQueries) === null || _a === void 0 ? void 0 : _a.settings) || {};
        const configFacetQueries = this.queryBuilder.config.facetQueries && this.queryBuilder.config.facetQueries.queries || [];
        const configGroups = configFacetQueries.reduce((acc, query) => {
            const group = this.queryBuilder.getQueryGroup(query);
            if (acc[group]) {
                acc[group].push(query);
            }
            else {
                acc[group] = [query];
            }
            return acc;
        }, []);
        const mincount = this.queryBuilder.config.facetQueries && this.queryBuilder.config.facetQueries.mincount;
        const mincountFilter = this.getFilterByMinCount(mincount);
        Object.keys(configGroups).forEach((group) => {
            const responseField = this.findFacet(context, 'query', group);
            const responseBuckets = this.getResponseQueryBuckets(responseField, configGroups[group])
                .filter(mincountFilter);
            const alreadyExistingField = this.findResponseFacet('query', group);
            if (alreadyExistingField) {
                const alreadyExistingBuckets = alreadyExistingField.buckets && alreadyExistingField.buckets.items || [];
                this.updateExistingBuckets(responseField, responseBuckets, alreadyExistingField, alreadyExistingBuckets);
            }
            else if (responseField) {
                if (responseBuckets.length > 0) {
                    const bucketList = new SearchFilterList(responseBuckets, this.facetQueriesPageSize);
                    bucketList.filter = this.getBucketFilterFunction(bucketList);
                    if (!this.responseFacets) {
                        this.responseFacets = [];
                    }
                    this.responseFacets.push({
                        field: group,
                        type: responseField.type || 'query',
                        label: group,
                        pageSize: this.DEFAULT_PAGE_SIZE,
                        currentPageSize: this.DEFAULT_PAGE_SIZE,
                        buckets: bucketList,
                        settings: facetQuerySetting
                    });
                }
            }
        });
    }
    getResponseBuckets(responseField, configField) {
        return ((responseField && responseField.buckets) || []).map((respBucket) => {
            respBucket['count'] = this.getCountValue(respBucket);
            respBucket.filterQuery = respBucket.filterQuery || this.getCorrespondingFilterQuery(configField, respBucket.label);
            return Object.assign(Object.assign({}, respBucket), { checked: false, display: respBucket.display, label: respBucket.label });
        });
    }
    getResponseQueryBuckets(responseField, configGroup) {
        return (configGroup || []).map((query) => {
            const respBucket = ((responseField && responseField.buckets) || [])
                .find((bucket) => bucket.label === query.label) || {};
            respBucket['count'] = this.getCountValue(respBucket);
            return Object.assign(Object.assign({}, respBucket), { checked: false, display: respBucket.display, label: respBucket.label });
        });
    }
    getCountValue(bucket) {
        var _a, _b;
        return (!!bucket && !!bucket.metrics && ((_b = (_a = bucket.metrics[0]) === null || _a === void 0 ? void 0 : _a.value) === null || _b === void 0 ? void 0 : _b.count)) || 0;
    }
    getBucketCountDisplay(bucket) {
        return bucket.count === null ? '' : `(${bucket.count})`;
    }
    getFilterByMinCount(mincountInput) {
        return (bucket) => {
            let mincount = mincountInput;
            if (mincount === undefined) {
                mincount = 1;
            }
            return bucket.count >= mincount;
        };
    }
    getCorrespondingFilterQuery(configFacetItem, bucketLabel) {
        let filterQuery = null;
        if (configFacetItem.field && bucketLabel) {
            if (configFacetItem.sets) {
                const configSet = configFacetItem.sets.find((set) => bucketLabel === set.label);
                if (configSet) {
                    filterQuery = this.buildIntervalQuery(configFacetItem.field, configSet);
                }
            }
            else {
                filterQuery = `${configFacetItem.field}:"${bucketLabel}"`;
            }
        }
        return filterQuery;
    }
    buildIntervalQuery(fieldName, interval) {
        const start = interval.start;
        const end = interval.end;
        const startLimit = (interval.startInclusive === undefined || interval.startInclusive === true) ? '[' : '<';
        const endLimit = (interval.endInclusive === undefined || interval.endInclusive === true) ? ']' : '>';
        return `${fieldName}:${startLimit}"${start}" TO "${end}"${endLimit}`;
    }
    findFacet(context, itemType, fieldLabel) {
        return (context.facets || []).find((response) => response.type === itemType && response.label === fieldLabel) || {};
    }
    findResponseFacet(itemType, fieldLabel) {
        return (this.responseFacets || []).find((response) => response.type === itemType && response.label === fieldLabel);
    }
    updateExistingBuckets(responseField, responseBuckets, alreadyExistingField, alreadyExistingBuckets) {
        const bucketsToDelete = [];
        alreadyExistingBuckets
            .map((bucket) => {
            const responseBucket = ((responseField && responseField.buckets) || []).find((respBucket) => respBucket.label === bucket.label);
            if (!responseBucket) {
                bucketsToDelete.push(bucket);
            }
            bucket.count = this.getCountValue(responseBucket);
            return bucket;
        });
        const hasSelection = this.selectedBuckets
            .find((selBuckets) => alreadyExistingField.label === selBuckets.field.label && alreadyExistingField.type === selBuckets.field.type);
        if (!hasSelection && bucketsToDelete.length) {
            bucketsToDelete.forEach((bucket) => {
                alreadyExistingField.buckets.deleteItem(bucket);
            });
        }
        responseBuckets.forEach((respBucket) => {
            const existingBucket = alreadyExistingBuckets.find((oldBucket) => oldBucket.label === respBucket.label);
            if (!existingBucket) {
                alreadyExistingField.buckets.addItem(respBucket);
            }
        });
    }
    getBucketFilterFunction(bucketList) {
        return (bucket) => {
            if (bucket && bucketList.filterText) {
                const pattern = (bucketList.filterText || '').toLowerCase();
                const label = (this.translationService.instant(bucket.display) || this.translationService.instant(bucket.label)).toLowerCase();
                return this.queryBuilder.config.filterWithContains ? label.indexOf(pattern) !== -1 : label.startsWith(pattern);
            }
            return true;
        };
    }
    unselectFacetBucket(field, bucket) {
        if (bucket) {
            bucket.checked = false;
            this.queryBuilder.removeUserFacetBucket(field, bucket);
            this.updateSelectedBuckets();
            this.queryBuilder.update();
        }
    }
    updateSelectedBuckets() {
        if (this.responseFacets) {
            this.selectedBuckets = [];
            for (const field of this.responseFacets) {
                if (field.buckets) {
                    this.selectedBuckets.push(...this.queryBuilder.getUserFacetBuckets(field.field)
                        .filter((bucket) => bucket.checked)
                        .map((bucket) => {
                        return { field, bucket };
                    }));
                }
            }
        }
        else {
            this.selectedBuckets = [];
        }
    }
    ngOnDestroy() {
        this.onDestroy$.next();
        this.onDestroy$.complete();
    }
    resetAllSelectedBuckets() {
        this.responseFacets.forEach((field) => {
            if (field && field.buckets) {
                for (const bucket of field.buckets.items) {
                    bucket.checked = false;
                    this.queryBuilder.removeUserFacetBucket(field, bucket);
                }
                this.updateSelectedBuckets();
            }
        });
        this.queryBuilder.update();
    }
    resetQueryFragments() {
        this.queryBuilder.queryFragments = {};
        this.queryBuilder.resetToDefaults();
    }
    reset() {
        this.responseFacets = [];
        this.selectedBuckets = [];
        this.queryBuilder.resetToDefaults();
        this.queryBuilder.update();
    }
}
SearchFacetFiltersService.ɵfac = function SearchFacetFiltersService_Factory(t) { return new (t || SearchFacetFiltersService)(ɵngcc0.ɵɵinject(SEARCH_QUERY_SERVICE_TOKEN), ɵngcc0.ɵɵinject(ɵngcc1.SearchService), ɵngcc0.ɵɵinject(ɵngcc1.TranslationService)); };
SearchFacetFiltersService.ɵprov = i0.ɵɵdefineInjectable({ factory: function SearchFacetFiltersService_Factory() { return new SearchFacetFiltersService(i0.ɵɵinject(i1.SEARCH_QUERY_SERVICE_TOKEN), i0.ɵɵinject(i2.SearchService), i0.ɵɵinject(i2.TranslationService)); }, token: SearchFacetFiltersService, providedIn: "root" });
SearchFacetFiltersService.ctorParameters = () => [
    { type: SearchQueryBuilderService, decorators: [{ type: Inject, args: [SEARCH_QUERY_SERVICE_TOKEN,] }] },
    { type: SearchService },
    { type: TranslationService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(SearchFacetFiltersService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc2.SearchQueryBuilderService, decorators: [{
                type: Inject,
                args: [SEARCH_QUERY_SERVICE_TOKEN]
            }] }, { type: ɵngcc1.SearchService }, { type: ɵngcc1.TranslationService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWZhY2V0LWZpbHRlcnMuc2VydmljZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL2NvbnRlbnQtc2VydmljZXMvc3JjL2xpYi9zZWFyY2gvc2VydmljZXMvc2VhcmNoLWZhY2V0LWZpbHRlcnMuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFpQkEsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFFOUQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUMzRSxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUMzRSxPQUFPLEVBQUUsYUFBYSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDdkUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3RFO0FBQXFDO0FBRXZCOzs7O0FBUWQsTUFBTSxPQUFPLHlCQUF5QjtBQUFHLElBZXJDLFlBQXVELFlBQXVDLEVBQzFFLGFBQTRCLEVBQzVCLGtCQUFzQztBQUM5RCxRQUgyRCxpQkFBWSxHQUFaLFlBQVksQ0FBMkI7QUFBQyxRQUMzRSxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtBQUFDLFFBQzdCLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7QUFBQyxRQVgzRCxtQkFBYyxHQUFpQixJQUFJLENBQUM7QUFDeEMsUUFFSSxvQkFBZSxHQUFxQixFQUFFLENBQUM7QUFDM0MsUUFDWSxzQkFBaUIsR0FBRyxDQUFDLENBQUM7QUFDbEMsUUFBcUIseUJBQW9CLEdBQUcs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UUFBUSxJQUFJLENBQUMsWUFBWSxDQUFDLGVBQWUsRUFBRSxDQUFDO0FBQzVDLElBQUksQ0FBQztBQUNMLElBQ0ksS0FBSztBQUNULFFBQVEsSUFBSSxDQUFDLGNBQWMsR0FBRyxFQUFFLENBQUM7QUFDakMsUUFBUSxJQUFJLENBQUMsZUFBZSxHQUFHLEVBQUUsQ0FBQztBQUNsQyxRQUFRLElBQUksQ0FBQyxZQUFZLENBQUMsZUFBZSxFQUFFLENBQUM7QUFDNUMsUUFBUSxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQ25DLElBQUksQ0FBQztBQUNMO2dRQUFDO0FBQ0Qsa1VBOVVLO0FBQUM7RUFITCxVQUFVLFNBQUMsa0JBQ1IsVUFBVSxFQUFFLE1BQU0sY0FDckIsdkVBQ3dELFlBZmhELHlCQUF5Qix1QkE4QmpCLE1BQU0sU0FBQywwQkFBMEI7QUFBUyxZQTdCbEQsYUFBYTtBQUFJLFlBQUYsa0JBQWtCO0FBQUc7Ozs7Ozs7Ozt1R0FBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZhY2V0RmllbGQgfSBmcm9tICcuLi9tb2RlbHMvZmFjZXQtZmllbGQuaW50ZXJmYWNlJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFNFQVJDSF9RVUVSWV9TRVJWSUNFX1RPS0VOIH0gZnJvbSAnLi4vc2VhcmNoLXF1ZXJ5LXNlcnZpY2UudG9rZW4nO1xuaW1wb3J0IHsgU2VhcmNoUXVlcnlCdWlsZGVyU2VydmljZSB9IGZyb20gJy4vc2VhcmNoLXF1ZXJ5LWJ1aWxkZXIuc2VydmljZSc7XG5pbXBvcnQgeyBTZWFyY2hTZXJ2aWNlLCBUcmFuc2xhdGlvblNlcnZpY2UgfSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgR2VuZXJpY0J1Y2tldCwgR2VuZXJpY0ZhY2V0UmVzcG9uc2UsIFJlc3VsdFNldENvbnRleHQsIFJlc3VsdFNldFBhZ2luZyB9IGZyb20gJ0BhbGZyZXNjby9qcy1hcGknO1xuaW1wb3J0IHsgU2VhcmNoRmlsdGVyTGlzdCB9IGZyb20gJy4uL21vZGVscy9zZWFyY2gtZmlsdGVyLWxpc3QubW9kZWwnO1xuaW1wb3J0IHsgRmFjZXRGaWVsZEJ1Y2tldCB9IGZyb20gJy4uL21vZGVscy9mYWNldC1maWVsZC1idWNrZXQuaW50ZXJmYWNlJztcblxuZXhwb3J0IGludGVyZmFjZSBTZWxlY3RlZEJ1Y2tldCB7XG4gICAgZmllbGQ6IEZhY2V0RmllbGQ7XG4gICAgYnVja2V0OiBGYWNldEZpZWxkQnVja2V0O1xufVxuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFNlYXJjaEZhY2V0RmlsdGVyc1NlcnZpY2UgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuXG4gICAgLyoqIEFsbCBmYWNldCBmaWVsZCBpdGVtcyB0byBiZSBkaXNwbGF5ZWQgaW4gdGhlIGNvbXBvbmVudC4gVGhlc2UgYXJlIHVwZGF0ZWQgYWNjb3JkaW5nIHRvIHRoZSByZXNwb25zZS5cbiAgICAgKiAgV2hlbiBhIG5ldyBzZWFyY2ggaXMgcGVyZm9ybWVkLCB0aGUgYWxyZWFkeSBleGlzdGluZyBpdGVtcyBhcmUgdXBkYXRlZCB3aXRoIHRoZSBuZXcgYnVja2V0IGNvdW50IHZhbHVlcyBhbmRcbiAgICAgKiAgdGhlIG5ld2x5IHJlY2VpdmVkIGl0ZW1zIGFyZSBhZGRlZCB0byB0aGUgcmVzcG9uc2VGYWNldHMuXG4gICAgICovXG4gICAgcmVzcG9uc2VGYWNldHM6IEZhY2V0RmllbGRbXSA9IG51bGw7XG5cbiAgICAvKiogc2hvd3MgdGhlIGZhY2V0IGNoaXBzICovXG4gICAgc2VsZWN0ZWRCdWNrZXRzOiBTZWxlY3RlZEJ1Y2tldFtdID0gW107XG5cbiAgICBwcml2YXRlIERFRkFVTFRfUEFHRV9TSVpFID0gNTtcbiAgICBwcml2YXRlIHJlYWRvbmx5IGZhY2V0UXVlcmllc1BhZ2VTaXplID0gdGhpcy5ERUZBVUxUX1BBR0VfU0laRTtcbiAgICBwcml2YXRlIHJlYWRvbmx5IG9uRGVzdHJveSQgPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xuXG4gICAgY29uc3RydWN0b3IoQEluamVjdChTRUFSQ0hfUVVFUllfU0VSVklDRV9UT0tFTikgcHVibGljIHF1ZXJ5QnVpbGRlcjogU2VhcmNoUXVlcnlCdWlsZGVyU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIHNlYXJjaFNlcnZpY2U6IFNlYXJjaFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB0cmFuc2xhdGlvblNlcnZpY2U6IFRyYW5zbGF0aW9uU2VydmljZSkge1xuICAgICAgICBpZiAocXVlcnlCdWlsZGVyLmNvbmZpZyAmJiBxdWVyeUJ1aWxkZXIuY29uZmlnLmZhY2V0UXVlcmllcykge1xuICAgICAgICAgICAgdGhpcy5mYWNldFF1ZXJpZXNQYWdlU2l6ZSA9IHF1ZXJ5QnVpbGRlci5jb25maWcuZmFjZXRRdWVyaWVzLnBhZ2VTaXplIHx8IHRoaXMuREVGQVVMVF9QQUdFX1NJWkU7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci5jb25maWdVcGRhdGVkXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRCdWNrZXRzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNwb25zZUZhY2V0cyA9IG51bGw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci51cGRhdGVkXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHF1ZXJ5KSA9PiB0aGlzLnF1ZXJ5QnVpbGRlci5leGVjdXRlKHF1ZXJ5KSk7XG5cbiAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXIuZXhlY3V0ZWRcbiAgICAgICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgocmVzdWx0U2V0UGFnaW5nOiBSZXN1bHRTZXRQYWdpbmcpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uRGF0YUxvYWRlZChyZXN1bHRTZXRQYWdpbmcpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoU2VydmljZS5kYXRhTG9hZGVkLm5leHQocmVzdWx0U2V0UGFnaW5nKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIG9uRGF0YUxvYWRlZChkYXRhOiBhbnkpIHtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IGRhdGEubGlzdC5jb250ZXh0O1xuXG4gICAgICAgIGlmIChjb250ZXh0KSB7XG4gICAgICAgICAgICB0aGlzLnBhcnNlRmFjZXRzKGNvbnRleHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZXNwb25zZUZhY2V0cyA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHBhcnNlRmFjZXRzKGNvbnRleHQ6IFJlc3VsdFNldENvbnRleHQpIHtcbiAgICAgICAgdGhpcy5wYXJzZUZhY2V0RmllbGRzKGNvbnRleHQpO1xuICAgICAgICB0aGlzLnBhcnNlRmFjZXRJbnRlcnZhbHMoY29udGV4dCk7XG4gICAgICAgIHRoaXMucGFyc2VGYWNldFF1ZXJpZXMoY29udGV4dCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBwYXJzZUZhY2V0SXRlbXMoY29udGV4dDogUmVzdWx0U2V0Q29udGV4dCwgY29uZmlnRmFjZXRGaWVsZHM6IEZhY2V0RmllbGRbXSwgaXRlbVR5cGU6IHN0cmluZykge1xuICAgICAgICBjb25maWdGYWNldEZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VGaWVsZCA9IHRoaXMuZmluZEZhY2V0KGNvbnRleHQsIGl0ZW1UeXBlLCBmaWVsZC5sYWJlbCk7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZUJ1Y2tldHMgPSB0aGlzLmdldFJlc3BvbnNlQnVja2V0cyhyZXNwb25zZUZpZWxkLCBmaWVsZClcbiAgICAgICAgICAgICAgICAuZmlsdGVyKHRoaXMuZ2V0RmlsdGVyQnlNaW5Db3VudChmaWVsZC5taW5jb3VudCkpO1xuICAgICAgICAgICAgY29uc3QgYWxyZWFkeUV4aXN0aW5nRmllbGQgPSB0aGlzLmZpbmRSZXNwb25zZUZhY2V0KGl0ZW1UeXBlLCBmaWVsZC5sYWJlbCk7XG5cbiAgICAgICAgICAgIGlmIChhbHJlYWR5RXhpc3RpbmdGaWVsZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFscmVhZHlFeGlzdGluZ0J1Y2tldHMgPSBhbHJlYWR5RXhpc3RpbmdGaWVsZC5idWNrZXRzICYmIGFscmVhZHlFeGlzdGluZ0ZpZWxkLmJ1Y2tldHMuaXRlbXMgfHwgW107XG5cbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4aXN0aW5nQnVja2V0cyhyZXNwb25zZUZpZWxkLCByZXNwb25zZUJ1Y2tldHMsIGFscmVhZHlFeGlzdGluZ0ZpZWxkLCBhbHJlYWR5RXhpc3RpbmdCdWNrZXRzKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2VGaWVsZCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZUJ1Y2tldHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBidWNrZXRMaXN0ID0gbmV3IFNlYXJjaEZpbHRlckxpc3Q8RmFjZXRGaWVsZEJ1Y2tldD4ocmVzcG9uc2VCdWNrZXRzLCBmaWVsZC5wYWdlU2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgIGJ1Y2tldExpc3QuZmlsdGVyID0gdGhpcy5nZXRCdWNrZXRGaWx0ZXJGdW5jdGlvbihidWNrZXRMaXN0KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMucmVzcG9uc2VGYWNldHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzcG9uc2VGYWNldHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3BvbnNlRmFjZXRzLnB1c2goPEZhY2V0RmllbGQ+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLmZpZWxkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogcmVzcG9uc2VGaWVsZC50eXBlIHx8IGl0ZW1UeXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGZpZWxkLmxhYmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVNpemU6IGZpZWxkLnBhZ2VTaXplIHwgdGhpcy5ERUZBVUxUX1BBR0VfU0laRSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlU2l6ZTogZmllbGQucGFnZVNpemUgfCB0aGlzLkRFRkFVTFRfUEFHRV9TSVpFLFxuICAgICAgICAgICAgICAgICAgICAgICAgYnVja2V0czogYnVja2V0TGlzdFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgcGFyc2VGYWNldEZpZWxkcyhjb250ZXh0OiBSZXN1bHRTZXRDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IGNvbmZpZ0ZhY2V0RmllbGRzID0gdGhpcy5xdWVyeUJ1aWxkZXIuY29uZmlnLmZhY2V0RmllbGRzICYmIHRoaXMucXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldEZpZWxkcy5maWVsZHMgfHwgW107XG4gICAgICAgIHRoaXMucGFyc2VGYWNldEl0ZW1zKGNvbnRleHQsIGNvbmZpZ0ZhY2V0RmllbGRzLCAnZmllbGQnKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHBhcnNlRmFjZXRJbnRlcnZhbHMoY29udGV4dDogUmVzdWx0U2V0Q29udGV4dCkge1xuICAgICAgICBjb25zdCBjb25maWdGYWNldEludGVydmFscyA9IHRoaXMucXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldEludGVydmFscyAmJiB0aGlzLnF1ZXJ5QnVpbGRlci5jb25maWcuZmFjZXRJbnRlcnZhbHMuaW50ZXJ2YWxzIHx8IFtdO1xuICAgICAgICB0aGlzLnBhcnNlRmFjZXRJdGVtcyhjb250ZXh0LCBjb25maWdGYWNldEludGVydmFscywgJ2ludGVydmFsJyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBwYXJzZUZhY2V0UXVlcmllcyhjb250ZXh0OiBSZXN1bHRTZXRDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IGZhY2V0UXVlcnlTZXR0aW5nID0gdGhpcy5xdWVyeUJ1aWxkZXIuY29uZmlnLmZhY2V0UXVlcmllcz8uc2V0dGluZ3MgfHwge307XG4gICAgICAgIGNvbnN0IGNvbmZpZ0ZhY2V0UXVlcmllcyA9IHRoaXMucXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldFF1ZXJpZXMgJiYgdGhpcy5xdWVyeUJ1aWxkZXIuY29uZmlnLmZhY2V0UXVlcmllcy5xdWVyaWVzIHx8IFtdO1xuICAgICAgICBjb25zdCBjb25maWdHcm91cHMgPSBjb25maWdGYWNldFF1ZXJpZXMucmVkdWNlKChhY2MsIHF1ZXJ5KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBncm91cCA9IHRoaXMucXVlcnlCdWlsZGVyLmdldFF1ZXJ5R3JvdXAocXVlcnkpO1xuICAgICAgICAgICAgaWYgKGFjY1tncm91cF0pIHtcbiAgICAgICAgICAgICAgICBhY2NbZ3JvdXBdLnB1c2gocXVlcnkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhY2NbZ3JvdXBdID0gW3F1ZXJ5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIFtdKTtcblxuICAgICAgICBjb25zdCBtaW5jb3VudCA9IHRoaXMucXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldFF1ZXJpZXMgJiYgdGhpcy5xdWVyeUJ1aWxkZXIuY29uZmlnLmZhY2V0UXVlcmllcy5taW5jb3VudDtcbiAgICAgICAgY29uc3QgbWluY291bnRGaWx0ZXIgPSB0aGlzLmdldEZpbHRlckJ5TWluQ291bnQobWluY291bnQpO1xuXG4gICAgICAgIE9iamVjdC5rZXlzKGNvbmZpZ0dyb3VwcykuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlRmllbGQgPSB0aGlzLmZpbmRGYWNldChjb250ZXh0LCAncXVlcnknLCBncm91cCk7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZUJ1Y2tldHMgPSB0aGlzLmdldFJlc3BvbnNlUXVlcnlCdWNrZXRzKHJlc3BvbnNlRmllbGQsIGNvbmZpZ0dyb3Vwc1tncm91cF0pXG4gICAgICAgICAgICAgICAgLmZpbHRlcihtaW5jb3VudEZpbHRlcik7XG4gICAgICAgICAgICBjb25zdCBhbHJlYWR5RXhpc3RpbmdGaWVsZCA9IHRoaXMuZmluZFJlc3BvbnNlRmFjZXQoJ3F1ZXJ5JywgZ3JvdXApO1xuXG4gICAgICAgICAgICBpZiAoYWxyZWFkeUV4aXN0aW5nRmllbGQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhbHJlYWR5RXhpc3RpbmdCdWNrZXRzID0gYWxyZWFkeUV4aXN0aW5nRmllbGQuYnVja2V0cyAmJiBhbHJlYWR5RXhpc3RpbmdGaWVsZC5idWNrZXRzLml0ZW1zIHx8IFtdO1xuXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVFeGlzdGluZ0J1Y2tldHMocmVzcG9uc2VGaWVsZCwgcmVzcG9uc2VCdWNrZXRzLCBhbHJlYWR5RXhpc3RpbmdGaWVsZCwgYWxyZWFkeUV4aXN0aW5nQnVja2V0cyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlRmllbGQpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VCdWNrZXRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYnVja2V0TGlzdCA9IG5ldyBTZWFyY2hGaWx0ZXJMaXN0PEZhY2V0RmllbGRCdWNrZXQ+KHJlc3BvbnNlQnVja2V0cywgdGhpcy5mYWNldFF1ZXJpZXNQYWdlU2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgIGJ1Y2tldExpc3QuZmlsdGVyID0gdGhpcy5nZXRCdWNrZXRGaWx0ZXJGdW5jdGlvbihidWNrZXRMaXN0KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMucmVzcG9uc2VGYWNldHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzcG9uc2VGYWNldHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3BvbnNlRmFjZXRzLnB1c2goPEZhY2V0RmllbGQ+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiBncm91cCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHJlc3BvbnNlRmllbGQudHlwZSB8fCAncXVlcnknLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGdyb3VwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVNpemU6IHRoaXMuREVGQVVMVF9QQUdFX1NJWkUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50UGFnZVNpemU6IHRoaXMuREVGQVVMVF9QQUdFX1NJWkUsXG4gICAgICAgICAgICAgICAgICAgICAgICBidWNrZXRzOiBidWNrZXRMaXN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M6IGZhY2V0UXVlcnlTZXR0aW5nXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFJlc3BvbnNlQnVja2V0cyhyZXNwb25zZUZpZWxkOiBHZW5lcmljRmFjZXRSZXNwb25zZSwgY29uZmlnRmllbGQ6IEZhY2V0RmllbGQpOiBGYWNldEZpZWxkQnVja2V0W10ge1xuICAgICAgICByZXR1cm4gKChyZXNwb25zZUZpZWxkICYmIHJlc3BvbnNlRmllbGQuYnVja2V0cykgfHwgW10pLm1hcCgocmVzcEJ1Y2tldCkgPT4ge1xuXG4gICAgICAgICAgICByZXNwQnVja2V0Wydjb3VudCddID0gdGhpcy5nZXRDb3VudFZhbHVlKHJlc3BCdWNrZXQpO1xuICAgICAgICAgICAgcmVzcEJ1Y2tldC5maWx0ZXJRdWVyeSA9IHJlc3BCdWNrZXQuZmlsdGVyUXVlcnkgfHwgdGhpcy5nZXRDb3JyZXNwb25kaW5nRmlsdGVyUXVlcnkoY29uZmlnRmllbGQsIHJlc3BCdWNrZXQubGFiZWwpO1xuICAgICAgICAgICAgcmV0dXJuIDxGYWNldEZpZWxkQnVja2V0PiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzcEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBjaGVja2VkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiByZXNwQnVja2V0LmRpc3BsYXksXG4gICAgICAgICAgICAgICAgbGFiZWw6IHJlc3BCdWNrZXQubGFiZWxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UmVzcG9uc2VRdWVyeUJ1Y2tldHMocmVzcG9uc2VGaWVsZDogR2VuZXJpY0ZhY2V0UmVzcG9uc2UsIGNvbmZpZ0dyb3VwOiBhbnkpOiBGYWNldEZpZWxkQnVja2V0W10ge1xuICAgICAgICByZXR1cm4gKGNvbmZpZ0dyb3VwIHx8IFtdKS5tYXAoKHF1ZXJ5KSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXNwQnVja2V0ID0gKChyZXNwb25zZUZpZWxkICYmIHJlc3BvbnNlRmllbGQuYnVja2V0cykgfHwgW10pXG4gICAgICAgICAgICAgICAgLmZpbmQoKGJ1Y2tldCkgPT4gYnVja2V0LmxhYmVsID09PSBxdWVyeS5sYWJlbCkgfHwge307XG5cbiAgICAgICAgICAgIHJlc3BCdWNrZXRbJ2NvdW50J10gPSB0aGlzLmdldENvdW50VmFsdWUocmVzcEJ1Y2tldCk7XG4gICAgICAgICAgICByZXR1cm4gPEZhY2V0RmllbGRCdWNrZXQ+IHtcbiAgICAgICAgICAgICAgICAuLi5yZXNwQnVja2V0LFxuICAgICAgICAgICAgICAgIGNoZWNrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHJlc3BCdWNrZXQuZGlzcGxheSxcbiAgICAgICAgICAgICAgICBsYWJlbDogcmVzcEJ1Y2tldC5sYWJlbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRDb3VudFZhbHVlKGJ1Y2tldDogR2VuZXJpY0J1Y2tldCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiAoISFidWNrZXQgJiYgISFidWNrZXQubWV0cmljcyAmJiBidWNrZXQubWV0cmljc1swXT8udmFsdWU/LmNvdW50KSB8fCAwO1xuICAgIH1cblxuICAgIGdldEJ1Y2tldENvdW50RGlzcGxheShidWNrZXQ6IEZhY2V0RmllbGRCdWNrZXQpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gYnVja2V0LmNvdW50ID09PSBudWxsID8gJycgOiBgKCR7YnVja2V0LmNvdW50fSlgO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0RmlsdGVyQnlNaW5Db3VudChtaW5jb3VudElucHV0OiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIChidWNrZXQpID0+IHtcbiAgICAgICAgICAgIGxldCBtaW5jb3VudCA9IG1pbmNvdW50SW5wdXQ7XG4gICAgICAgICAgICBpZiAobWluY291bnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIG1pbmNvdW50ID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBidWNrZXQuY291bnQgPj0gbWluY291bnQ7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRDb3JyZXNwb25kaW5nRmlsdGVyUXVlcnkoY29uZmlnRmFjZXRJdGVtOiBGYWNldEZpZWxkLCBidWNrZXRMYWJlbDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IGZpbHRlclF1ZXJ5ID0gbnVsbDtcblxuICAgICAgICBpZiAoY29uZmlnRmFjZXRJdGVtLmZpZWxkICYmIGJ1Y2tldExhYmVsKSB7XG5cbiAgICAgICAgICAgIGlmIChjb25maWdGYWNldEl0ZW0uc2V0cykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpZ1NldCA9IGNvbmZpZ0ZhY2V0SXRlbS5zZXRzLmZpbmQoKHNldCkgPT4gYnVja2V0TGFiZWwgPT09IHNldC5sYWJlbCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnU2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclF1ZXJ5ID0gdGhpcy5idWlsZEludGVydmFsUXVlcnkoY29uZmlnRmFjZXRJdGVtLmZpZWxkLCBjb25maWdTZXQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJRdWVyeSA9IGAke2NvbmZpZ0ZhY2V0SXRlbS5maWVsZH06XCIke2J1Y2tldExhYmVsfVwiYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmaWx0ZXJRdWVyeTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGJ1aWxkSW50ZXJ2YWxRdWVyeShmaWVsZE5hbWU6IHN0cmluZywgaW50ZXJ2YWw6IGFueSk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gaW50ZXJ2YWwuc3RhcnQ7XG4gICAgICAgIGNvbnN0IGVuZCA9IGludGVydmFsLmVuZDtcbiAgICAgICAgY29uc3Qgc3RhcnRMaW1pdCA9IChpbnRlcnZhbC5zdGFydEluY2x1c2l2ZSA9PT0gdW5kZWZpbmVkIHx8IGludGVydmFsLnN0YXJ0SW5jbHVzaXZlID09PSB0cnVlKSA/ICdbJyA6ICc8JztcbiAgICAgICAgY29uc3QgZW5kTGltaXQgPSAoaW50ZXJ2YWwuZW5kSW5jbHVzaXZlID09PSB1bmRlZmluZWQgfHwgaW50ZXJ2YWwuZW5kSW5jbHVzaXZlID09PSB0cnVlKSA/ICddJyA6ICc+JztcblxuICAgICAgICByZXR1cm4gYCR7ZmllbGROYW1lfToke3N0YXJ0TGltaXR9XCIke3N0YXJ0fVwiIFRPIFwiJHtlbmR9XCIke2VuZExpbWl0fWA7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaW5kRmFjZXQoY29udGV4dDogUmVzdWx0U2V0Q29udGV4dCwgaXRlbVR5cGU6IHN0cmluZywgZmllbGRMYWJlbDogc3RyaW5nKTogR2VuZXJpY0ZhY2V0UmVzcG9uc2Uge1xuICAgICAgICByZXR1cm4gKGNvbnRleHQuZmFjZXRzIHx8IFtdKS5maW5kKChyZXNwb25zZSkgPT4gcmVzcG9uc2UudHlwZSA9PT0gaXRlbVR5cGUgJiYgcmVzcG9uc2UubGFiZWwgPT09IGZpZWxkTGFiZWwpIHx8IHt9O1xuICAgIH1cblxuICAgIHByaXZhdGUgZmluZFJlc3BvbnNlRmFjZXQoaXRlbVR5cGU6IHN0cmluZywgZmllbGRMYWJlbDogc3RyaW5nKTogRmFjZXRGaWVsZCB7XG4gICAgICAgIHJldHVybiAodGhpcy5yZXNwb25zZUZhY2V0cyB8fCBbXSkuZmluZCgocmVzcG9uc2UpID0+IHJlc3BvbnNlLnR5cGUgPT09IGl0ZW1UeXBlICYmIHJlc3BvbnNlLmxhYmVsID09PSBmaWVsZExhYmVsKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHVwZGF0ZUV4aXN0aW5nQnVja2V0cyhyZXNwb25zZUZpZWxkLCByZXNwb25zZUJ1Y2tldHMsIGFscmVhZHlFeGlzdGluZ0ZpZWxkLCBhbHJlYWR5RXhpc3RpbmdCdWNrZXRzKSB7XG4gICAgICAgIGNvbnN0IGJ1Y2tldHNUb0RlbGV0ZSA9IFtdO1xuXG4gICAgICAgIGFscmVhZHlFeGlzdGluZ0J1Y2tldHNcbiAgICAgICAgICAgIC5tYXAoKGJ1Y2tldCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlQnVja2V0ID0gKChyZXNwb25zZUZpZWxkICYmIHJlc3BvbnNlRmllbGQuYnVja2V0cykgfHwgW10pLmZpbmQoKHJlc3BCdWNrZXQpID0+IHJlc3BCdWNrZXQubGFiZWwgPT09IGJ1Y2tldC5sYWJlbCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlQnVja2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1Y2tldHNUb0RlbGV0ZS5wdXNoKGJ1Y2tldCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJ1Y2tldC5jb3VudCA9IHRoaXMuZ2V0Q291bnRWYWx1ZShyZXNwb25zZUJ1Y2tldCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJ1Y2tldDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGhhc1NlbGVjdGlvbiA9IHRoaXMuc2VsZWN0ZWRCdWNrZXRzXG4gICAgICAgICAgICAuZmluZCgoc2VsQnVja2V0cykgPT4gYWxyZWFkeUV4aXN0aW5nRmllbGQubGFiZWwgPT09IHNlbEJ1Y2tldHMuZmllbGQubGFiZWwgJiYgYWxyZWFkeUV4aXN0aW5nRmllbGQudHlwZSA9PT0gc2VsQnVja2V0cy5maWVsZC50eXBlKTtcblxuICAgICAgICBpZiAoIWhhc1NlbGVjdGlvbiAmJiBidWNrZXRzVG9EZWxldGUubGVuZ3RoKSB7XG4gICAgICAgICAgICBidWNrZXRzVG9EZWxldGUuZm9yRWFjaCgoYnVja2V0KSA9PiB7XG4gICAgICAgICAgICAgICAgYWxyZWFkeUV4aXN0aW5nRmllbGQuYnVja2V0cy5kZWxldGVJdGVtKGJ1Y2tldCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlc3BvbnNlQnVja2V0cy5mb3JFYWNoKChyZXNwQnVja2V0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0J1Y2tldCA9IGFscmVhZHlFeGlzdGluZ0J1Y2tldHMuZmluZCgob2xkQnVja2V0KSA9PiBvbGRCdWNrZXQubGFiZWwgPT09IHJlc3BCdWNrZXQubGFiZWwpO1xuXG4gICAgICAgICAgICBpZiAoIWV4aXN0aW5nQnVja2V0KSB7XG4gICAgICAgICAgICAgICAgYWxyZWFkeUV4aXN0aW5nRmllbGQuYnVja2V0cy5hZGRJdGVtKHJlc3BCdWNrZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEJ1Y2tldEZpbHRlckZ1bmN0aW9uKGJ1Y2tldExpc3QpIHtcbiAgICAgICAgcmV0dXJuIChidWNrZXQ6IEZhY2V0RmllbGRCdWNrZXQpOiBib29sZWFuID0+IHtcbiAgICAgICAgICAgIGlmIChidWNrZXQgJiYgYnVja2V0TGlzdC5maWx0ZXJUZXh0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGF0dGVybiA9IChidWNrZXRMaXN0LmZpbHRlclRleHQgfHwgJycpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbGFiZWwgPSAodGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudChidWNrZXQuZGlzcGxheSkgfHwgdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudChidWNrZXQubGFiZWwpKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnF1ZXJ5QnVpbGRlci5jb25maWcuZmlsdGVyV2l0aENvbnRhaW5zID8gbGFiZWwuaW5kZXhPZihwYXR0ZXJuKSAhPT0gLTEgOiBsYWJlbC5zdGFydHNXaXRoKHBhdHRlcm4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgdW5zZWxlY3RGYWNldEJ1Y2tldChmaWVsZDogRmFjZXRGaWVsZCwgYnVja2V0OiBGYWNldEZpZWxkQnVja2V0KSB7XG4gICAgICAgIGlmIChidWNrZXQpIHtcbiAgICAgICAgICAgIGJ1Y2tldC5jaGVja2VkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci5yZW1vdmVVc2VyRmFjZXRCdWNrZXQoZmllbGQsIGJ1Y2tldCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkQnVja2V0cygpO1xuICAgICAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXIudXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiB1cGRhdGUgYWRmLXNlYXJjaC1jaGlwLWxpc3QgY29tcG9uZW50IHZpZXcgKi9cbiAgICB1cGRhdGVTZWxlY3RlZEJ1Y2tldHMoKSB7XG4gICAgICAgIGlmICh0aGlzLnJlc3BvbnNlRmFjZXRzKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkQnVja2V0cyA9IFtdO1xuICAgICAgICAgICAgZm9yIChjb25zdCBmaWVsZCBvZiB0aGlzLnJlc3BvbnNlRmFjZXRzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkLmJ1Y2tldHMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEJ1Y2tldHMucHVzaChcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnRoaXMucXVlcnlCdWlsZGVyLmdldFVzZXJGYWNldEJ1Y2tldHMoZmllbGQuZmllbGQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigoYnVja2V0KSA9PiBidWNrZXQuY2hlY2tlZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKChidWNrZXQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtmaWVsZCwgYnVja2V0fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRCdWNrZXRzID0gW107XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLm5leHQoKTtcbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLmNvbXBsZXRlKCk7XG4gICAgfVxuXG4gICAgcmVzZXRBbGxTZWxlY3RlZEJ1Y2tldHMoKSB7XG4gICAgICAgIHRoaXMucmVzcG9uc2VGYWNldHMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgICAgICAgIGlmIChmaWVsZCAmJiBmaWVsZC5idWNrZXRzKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBidWNrZXQgb2YgZmllbGQuYnVja2V0cy5pdGVtcykge1xuICAgICAgICAgICAgICAgICAgICBidWNrZXQuY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci5yZW1vdmVVc2VyRmFjZXRCdWNrZXQoZmllbGQsIGJ1Y2tldCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRCdWNrZXRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci51cGRhdGUoKTtcbiAgICB9XG5cbiAgICByZXNldFF1ZXJ5RnJhZ21lbnRzKCkge1xuICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci5xdWVyeUZyYWdtZW50cyA9IHt9O1xuICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci5yZXNldFRvRGVmYXVsdHMoKTtcbiAgICB9XG5cbiAgICByZXNldCgpIHtcbiAgICAgICAgdGhpcy5yZXNwb25zZUZhY2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnNlbGVjdGVkQnVja2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci5yZXNldFRvRGVmYXVsdHMoKTtcbiAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXIudXBkYXRlKCk7XG4gICAgfVxufVxuIl19