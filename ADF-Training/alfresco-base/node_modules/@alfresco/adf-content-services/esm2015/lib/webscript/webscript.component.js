/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { ObjectDataTableAdapter, AlfrescoApiService, LogService } from '@alfresco/adf-core';
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { WebscriptApi } from '@alfresco/js-api';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@alfresco/adf-core';
import * as ɵngcc2 from '@angular/common';
import * as ɵngcc3 from '@ngx-translate/core';

function WebscriptComponent_div_0_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 4);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "json");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 1, ctx_r1.data));
} }
function WebscriptComponent_div_0_div_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 5);
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("innerHTML", ctx_r2.data, ɵngcc0.ɵɵsanitizeHtml);
} }
function WebscriptComponent_div_0_div_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 6);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ctx_r3.data);
} }
const _c0 = function (a0, a1) { return { data: a0, contentType: a1 }; };
function WebscriptComponent_div_0_div_4_div_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 9);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1("", ɵngcc0.ɵɵpipeBind2(2, 1, "WEBSCRIPT.ERROR", ɵngcc0.ɵɵpureFunction2(4, _c0, ctx_r5.data, ctx_r5.contentType)), " ");
} }
function WebscriptComponent_div_0_div_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵelement(1, "adf-datatable", 7);
    ɵngcc0.ɵɵelementStart(2, "div");
    ɵngcc0.ɵɵtemplate(3, WebscriptComponent_div_0_div_4_div_3_Template, 3, 7, "div", 8);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r4 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("data", ctx_r4.data);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r4.showError);
} }
function WebscriptComponent_div_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵtemplate(1, WebscriptComponent_div_0_div_1_Template, 3, 3, "div", 1);
    ɵngcc0.ɵɵtemplate(2, WebscriptComponent_div_0_div_2_Template, 1, 1, "div", 2);
    ɵngcc0.ɵɵtemplate(3, WebscriptComponent_div_0_div_3_Template, 2, 1, "div", 3);
    ɵngcc0.ɵɵtemplate(4, WebscriptComponent_div_0_div_4_Template, 4, 2, "div", 0);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.contentType === "JSON");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.contentType === "HTML");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.contentType === "TEXT");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.isDataTableContent());
} }
export class WebscriptComponent {
    constructor(apiService, logService) {
        this.apiService = apiService;
        this.logService = logService;
        this.showData = true;
        this.contextRoot = 'alfresco';
        this.servicePath = 'service';
        this.contentType = 'TEXT';
        this.success = new EventEmitter();
        this.data = undefined;
        this.showError = false;
    }
    get webscriptApi() {
        var _a;
        this._webscriptApi = (_a = this._webscriptApi) !== null && _a !== void 0 ? _a : new WebscriptApi(this.apiService.getInstance());
        return this._webscriptApi;
    }
    ngOnChanges() {
        if (this.showData) {
            this.clean();
        }
        return new Promise((resolve, reject) => {
            this.webscriptApi.executeWebScript('GET', this.scriptPath, this.scriptArgs, this.contextRoot, this.servicePath).then((webScriptData) => {
                this.data = webScriptData;
                if (this.showData) {
                    if (this.contentType === 'DATATABLE') {
                        this.data = this.showDataAsDataTable(webScriptData);
                    }
                }
                this.success.emit(this.data);
                resolve();
            }, (error) => {
                this.logService.log('Error' + error);
                reject();
            });
        });
    }
    showDataAsDataTable(data) {
        const datatableData = null;
        try {
            if (!data.schema) {
                data.schema = ObjectDataTableAdapter.generateSchema(data.data);
            }
            if (data.schema && data.schema.length > 0) {
                this.data = new ObjectDataTableAdapter(data.data, data.schema);
            }
        }
        catch (error) {
            this.logService.error('error during the cast as datatable');
        }
        return datatableData;
    }
    clean() {
        this.data = undefined;
    }
    isDataTableContent() {
        return this.contentType === 'DATATABLE';
    }
}
WebscriptComponent.ɵfac = function WebscriptComponent_Factory(t) { return new (t || WebscriptComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.AlfrescoApiService), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.LogService)); };
WebscriptComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: WebscriptComponent, selectors: [["adf-webscript-get"]], inputs: { showData: "showData", contextRoot: "contextRoot", servicePath: "servicePath", contentType: "contentType", scriptPath: "scriptPath", scriptArgs: "scriptArgs" }, outputs: { success: "success" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 1, vars: 1, consts: [[4, "ngIf"], ["id", "webscript-data-JSON", 4, "ngIf"], ["id", "webscript-data-HTML", 3, "innerHTML", 4, "ngIf"], ["id", "webscript-data-TEXT", 4, "ngIf"], ["id", "webscript-data-JSON"], ["id", "webscript-data-HTML", 3, "innerHTML"], ["id", "webscript-data-TEXT"], ["id", "webscript-datatable-wrapper", 3, "data"], ["id", "error", 4, "ngIf"], ["id", "error"]], template: function WebscriptComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, WebscriptComponent_div_0_Template, 5, 4, "div", 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", ctx.showData);
    } }, directives: [ɵngcc2.NgIf, ɵngcc1.DataTableComponent], pipes: [ɵngcc2.JsonPipe, ɵngcc3.TranslatePipe], encapsulation: 2 });
WebscriptComponent.ctorParameters = () => [
    { type: AlfrescoApiService },
    { type: LogService }
];
WebscriptComponent.propDecorators = {
    scriptPath: [{ type: Input }],
    scriptArgs: [{ type: Input }],
    showData: [{ type: Input }],
    contextRoot: [{ type: Input }],
    servicePath: [{ type: Input }],
    contentType: [{ type: Input }],
    success: [{ type: Output }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(WebscriptComponent, [{
        type: Component,
        args: [{
                selector: 'adf-webscript-get',
                template: "<div *ngIf=\"showData\">\n    <div *ngIf=\"contentType === 'JSON'\" id=\"webscript-data-JSON\">{{data | json}}</div>\n    <div *ngIf=\"contentType === 'HTML'\" id=\"webscript-data-HTML\" [innerHTML]=\"data\"></div>\n    <div *ngIf=\"contentType === 'TEXT'\" id=\"webscript-data-TEXT\">{{data}}</div>\n    <div *ngIf=\"isDataTableContent()\">\n        <adf-datatable id=\"webscript-datatable-wrapper\" [data]=\"data\"></adf-datatable>\n        <div>\n            <div *ngIf=\"showError\" id=\"error\">{{'WEBSCRIPT.ERROR' | translate: {\n                data: data,\n                contentType: contentType\n                }\n                }}\n            </div>\n        </div>\n    </div>\n</div>\n"
            }]
    }], function () { return [{ type: ɵngcc1.AlfrescoApiService }, { type: ɵngcc1.LogService }]; }, { showData: [{
            type: Input
        }], contextRoot: [{
            type: Input
        }], servicePath: [{
            type: Input
        }], contentType: [{
            type: Input
        }], success: [{
            type: Output
        }], scriptPath: [{
            type: Input
        }], scriptArgs: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2Vic2NyaXB0LmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL2NvbnRlbnQtc2VydmljZXMvc3JjL2xpYi93ZWJzY3JpcHQvd2Vic2NyaXB0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBRUgsT0FBTyxFQUFFLHNCQUFzQixFQUFFLGtCQUFrQixFQUFFLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzVGLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBYSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbEYsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGtCQUFrQixDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTBCaEQsTUFBTSxPQUFPLGtCQUFrQjtBQUFHLElBNEM5QixZQUFvQixVQUE4QixFQUM5QixVQUFzQjtBQUM5QyxRQUZ3QixlQUFVLEdBQVYsVUFBVSxDQUFvQjtBQUFDLFFBQy9CLGVBQVUsR0FBVixVQUFVLENBQVk7QUFBQyxRQTNCM0MsYUFBUSxHQUFZLElBQUksQ0FBQztBQUM3QixRQUdJLGdCQUFXLEdBQVcsVUFBVSxDQUFDO0FBQ3JDLFFBR0ksZ0JBQVcsR0FBVyxTQUFTLENBQUM7QUFDcEMsUUFLSSxnQkFBVyxHQUFXLE1BQU0sQ0FBQztBQUNqQyxRQU1JLFlBQU8sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0FBQ2pDLFFBQ0ksU0FBSSxHQUFRLFNBQVMsQ0FBQztBQUMxQixR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QkFBbUIsa0JBQzdCOzZuQkFBeUMsY0FDNUM7Ozs7bUlBQ0k7QUFBQztBQUE0QyxZQTVCakIsa0JBQWtCO0FBQUksWUFBRixVQUFVO0FBQUc7QUFBRztBQUN2RCx5QkFvQ1QsS0FBSztBQUNSLHlCQUdHLEtBQUs7QUFDUix1QkFHRyxLQUFLO0FBQ1IsMEJBR0csS0FBSztBQUNSLDBCQUdHLEtBQUs7QUFDUiwwQkFLRyxLQUFLO0FBQ1Isc0JBTUcsTUFBTTtBQUNWOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IE9iamVjdERhdGFUYWJsZUFkYXB0ZXIsIEFsZnJlc2NvQXBpU2VydmljZSwgTG9nU2VydmljZSB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBXZWJzY3JpcHRBcGkgfSBmcm9tICdAYWxmcmVzY28vanMtYXBpJztcblxuLyoqXG4gKiA8YWRmLXdlYnNjcmlwdC1nZXQgW3NjcmlwdFBhdGhdPVwic3RyaW5nXCJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIFtzY3JpcHRBcmdzXT1cIk9iamVjdFwiXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICBbY29udGV4dFJvb3RdPVwic3RyaW5nXCJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIFtzZXJ2aWNlUGF0aF09XCJzdHJpbmdcIlxuICogICAgICAgICAgICAgICAgICAgICAgICAgW2NvbnRlbnRUeXBlXT1cIkpTT058SFRNTHxEQVRBVEFCTEVcIlxuICogICAgICAgICAgICAgICAgICAgICAgICAgKHN1Y2Nlc3MpPVwiY3VzdG9tTWV0aG9kKCRldmVudCk+XG4gKiA8L2FkZi13ZWJzY3JpcHQtZ2V0PlxuICpcbiAqIFRoaXMgY29tcG9uZW50LCBwcm92aWRlIGEgZ2V0IHdlYnNjcmlwdCB2aWV3ZXJcbiAqXG4gKiBASW5wdXRQYXJhbSB7c3RyaW5nfSBzY3JpcHRQYXRoIHBhdGggdG8gV2ViIFNjcmlwdCAoYXMgZGVmaW5lZCBieSBXZWIgU2NyaXB0KVxuICogQElucHV0UGFyYW0ge09iamVjdH0gc2NyaXB0QXJncyBhcmd1bWVudHMgdG8gcGFzcyB0byBXZWIgU2NyaXB0XG4gKiBASW5wdXRQYXJhbSB7c3RyaW5nfSBjb250ZXh0Um9vdCBwYXRoIHdoZXJlIGFwcGxpY2F0aW9uIGlzIGRlcGxveWVkIGRlZmF1bHQgdmFsdWUgJ2FsZnJlc2NvJ1xuICogQElucHV0UGFyYW0ge3N0cmluZ30gc2VydmljZVBhdGggcGF0aCB3aGVyZSBXZWIgU2NyaXB0IHNlcnZpY2UgaXMgbWFwcGVkIGRlZmF1bHQgdmFsdWUgJ3NlcnZpY2UnXG4gKiBASW5wdXRQYXJhbSB7c3RyaW5nfSBjb250ZW50VHlwZSBKU09OIHwgSFRNTCB8IERBVEFUQUJMRSB8IFRFWFRcbiAqXG4gKiBAT3V0cHV0IC0gc3VjY2VzcyAtIFRoZSBldmVudCBpcyBlbWl0dGVkIHdoZW4gdGhlIGRhdGEgYXJlIHJlY2VpdmVkXG4gKlxuICovXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi13ZWJzY3JpcHQtZ2V0JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vd2Vic2NyaXB0LmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBXZWJzY3JpcHRDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xuXG4gICAgX3dlYnNjcmlwdEFwaTogV2Vic2NyaXB0QXBpO1xuICAgIGdldCB3ZWJzY3JpcHRBcGkoKTogV2Vic2NyaXB0QXBpIHtcbiAgICAgICAgdGhpcy5fd2Vic2NyaXB0QXBpID0gdGhpcy5fd2Vic2NyaXB0QXBpID8/IG5ldyBXZWJzY3JpcHRBcGkodGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5fd2Vic2NyaXB0QXBpO1xuICAgIH1cblxuICAgIC8qKiAocmVxdWlyZWQpIFBhdGggdG8gdGhlIHdlYnNjcmlwdCAoYXMgZGVmaW5lZCBieSB3ZWJzY3JpcHQpLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2NyaXB0UGF0aDogc3RyaW5nO1xuXG4gICAgLyoqIEFyZ3VtZW50cyB0byBwYXNzIHRvIHRoZSB3ZWJzY3JpcHQuICovXG4gICAgQElucHV0KClcbiAgICBzY3JpcHRBcmdzOiBhbnk7XG5cbiAgICAvKiogVG9nZ2xlcyB3aGV0aGVyIHRvIHNob3cgb3IgaGlkZSB0aGUgZGF0YS4gKi9cbiAgICBASW5wdXQoKVxuICAgIHNob3dEYXRhOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBQYXRoIHdoZXJlIHRoZSBhcHBsaWNhdGlvbiBpcyBkZXBsb3llZCAqL1xuICAgIEBJbnB1dCgpXG4gICAgY29udGV4dFJvb3Q6IHN0cmluZyA9ICdhbGZyZXNjbyc7XG5cbiAgICAvKiogUGF0aCB0aGF0IHRoZSB3ZWJzY3JpcHQgc2VydmljZSBpcyBtYXBwZWQgdG8uICovXG4gICAgQElucHV0KClcbiAgICBzZXJ2aWNlUGF0aDogc3RyaW5nID0gJ3NlcnZpY2UnO1xuXG4gICAgLyoqIENvbnRlbnQgdHlwZSB0byBpbnRlcnByZXQgdGhlIGRhdGEgcmVjZWl2ZWQgZnJvbSB0aGUgd2Vic2NyaXB0LlxuICAgICAqIENhbiBiZSBcIkpTT05cIiAsIFwiSFRNTFwiICwgXCJEQVRBVEFCTEVcIiBvciBcIlRFWFRcIlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgY29udGVudFR5cGU6IHN0cmluZyA9ICdURVhUJztcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIG9wZXJhdGlvbiBzdWNjZWVkcy4gWW91IGNhbiBnZXQgdGhlIHBsYWluIGRhdGEgZnJvbVxuICAgICAqIHRoZSB3ZWJzY3JpcHQgdGhyb3VnaCB0aGUgKipzdWNjZXNzKiogZXZlbnQgcGFyYW1ldGVyIGFuZCB1c2UgaXQgYXMgeW91XG4gICAgICogbmVlZCBpbiB5b3VyIGFwcGxpY2F0aW9uLlxuICAgICAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHN1Y2Nlc3MgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBkYXRhOiBhbnkgPSB1bmRlZmluZWQ7XG4gICAgc2hvd0Vycm9yOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFwaVNlcnZpY2U6IEFsZnJlc2NvQXBpU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UpIHtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcygpIHtcbiAgICAgICAgaWYgKHRoaXMuc2hvd0RhdGEpIHtcbiAgICAgICAgICAgIHRoaXMuY2xlYW4oKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLndlYnNjcmlwdEFwaS5leGVjdXRlV2ViU2NyaXB0KCdHRVQnLCB0aGlzLnNjcmlwdFBhdGgsIHRoaXMuc2NyaXB0QXJncywgdGhpcy5jb250ZXh0Um9vdCwgdGhpcy5zZXJ2aWNlUGF0aCkudGhlbigod2ViU2NyaXB0RGF0YSkgPT4ge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gd2ViU2NyaXB0RGF0YTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNob3dEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbnRlbnRUeXBlID09PSAnREFUQVRBQkxFJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5zaG93RGF0YUFzRGF0YVRhYmxlKHdlYlNjcmlwdERhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5zdWNjZXNzLmVtaXQodGhpcy5kYXRhKTtcblxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5sb2coJ0Vycm9yJyArIGVycm9yKTtcbiAgICAgICAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBzaG93IHRoZSBkYXRhIGluIGEgbmcyLWFsZnJlc2NvLWRhdGF0YWJsZVxuICAgICAqXG4gICAgICogQHBhcmFtIGRhdGFcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHRoZSBkYXRhIGFzIGRhdGF0YWJsZVxuICAgICAqL1xuICAgIHNob3dEYXRhQXNEYXRhVGFibGUoZGF0YTogYW55KSB7XG4gICAgICAgIGNvbnN0IGRhdGF0YWJsZURhdGE6IGFueSA9IG51bGw7XG4gICAgICAgIHRyeSB7XG5cbiAgICAgICAgICAgIGlmICghZGF0YS5zY2hlbWEpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnNjaGVtYSA9IE9iamVjdERhdGFUYWJsZUFkYXB0ZXIuZ2VuZXJhdGVTY2hlbWEoZGF0YS5kYXRhKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRhdGEuc2NoZW1hICYmIGRhdGEuc2NoZW1hLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSBuZXcgT2JqZWN0RGF0YVRhYmxlQWRhcHRlcihkYXRhLmRhdGEsIGRhdGEuc2NoZW1hKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKCdlcnJvciBkdXJpbmcgdGhlIGNhc3QgYXMgZGF0YXRhYmxlJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGF0YXRhYmxlRGF0YTtcbiAgICB9XG5cbiAgICBjbGVhbigpIHtcbiAgICAgICAgdGhpcy5kYXRhID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGlzRGF0YVRhYmxlQ29udGVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udGVudFR5cGUgPT09ICdEQVRBVEFCTEUnO1xuICAgIH1cbn1cbiJdfQ==