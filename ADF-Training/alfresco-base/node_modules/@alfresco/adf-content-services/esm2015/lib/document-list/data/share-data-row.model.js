/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { ObjectUtils } from '@alfresco/adf-core';
export class ShareDataRow {
    constructor(obj, contentService, permissionsStyle, thumbnailService, allowDropFiles) {
        this.obj = obj;
        this.contentService = contentService;
        this.permissionsStyle = permissionsStyle;
        this.thumbnailService = thumbnailService;
        this.allowDropFiles = allowDropFiles;
        this.cache = {};
        this.isSelected = false;
        this.cssClass = '';
        if (!obj) {
            throw new Error(ShareDataRow.ERR_OBJECT_NOT_FOUND);
        }
        this.isDropTarget = allowDropFiles !== undefined ? this.allowDropFiles && this.checkNodeTypeAndPermissions(obj) : this.checkNodeTypeAndPermissions(obj);
        if (permissionsStyle) {
            this.cssClass = this.getPermissionClass(obj);
        }
        this.id = this.getId();
    }
    get node() {
        return this.obj;
    }
    set node(value) {
        this.obj = value;
        this.cache = {};
    }
    checkNodeTypeAndPermissions(nodeEntry) {
        return this.isFolderAndHasPermissionToUpload(nodeEntry) || this.isFileAndHasParentFolderPermissionToUpload(nodeEntry);
    }
    getPermissionClass(nodeEntity) {
        let permissionsClasses = '';
        this.permissionsStyle.forEach((currentPermissionsStyle) => {
            if (this.applyPermissionStyleToFolder(nodeEntity.entry, currentPermissionsStyle) || this.applyPermissionStyleToFile(nodeEntity.entry, currentPermissionsStyle)) {
                if (this.contentService.hasAllowableOperations(nodeEntity.entry, currentPermissionsStyle.permission)) {
                    permissionsClasses += ` ${currentPermissionsStyle.css}`;
                }
            }
        });
        return permissionsClasses;
    }
    applyPermissionStyleToFile(node, currentPermissionsStyle) {
        return (currentPermissionsStyle.isFile && node.isFile);
    }
    applyPermissionStyleToFolder(node, currentPermissionsStyle) {
        return (currentPermissionsStyle.isFolder && node.isFolder);
    }
    isFolderAndHasPermissionToUpload(nodeEntry) {
        return this.isFolder(nodeEntry) && this.contentService.hasAllowableOperations(nodeEntry.entry, 'create');
    }
    isFileAndHasParentFolderPermissionToUpload(nodeEntry) {
        return this.isFile(nodeEntry) && this.contentService.hasAllowableOperations(nodeEntry.entry, 'update');
    }
    isFile(nodeEntry) {
        return nodeEntry.entry && nodeEntry.entry.isFile;
    }
    isFolder(nodeEntry) {
        return nodeEntry.entry && nodeEntry.entry.isFolder;
    }
    cacheValue(key, value) {
        this.cache[key] = value;
        return value;
    }
    getValue(key) {
        if (this.cache[key] !== undefined) {
            return this.cache[key];
        }
        return ObjectUtils.getValue(this.obj.entry, key);
    }
    imageErrorResolver() {
        if (this.obj.entry.content) {
            return this.thumbnailService.getMimeTypeIcon(this.obj.entry.content.mimeType);
        }
    }
    hasValue(key) {
        return this.getValue(key) !== undefined;
    }
    getId() {
        return this.obj.entry.id || undefined;
    }
}
ShareDataRow.ERR_OBJECT_NOT_FOUND = 'Object source not found';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhcmUtZGF0YS1yb3cubW9kZWwuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9jb250ZW50LXNlcnZpY2VzL3NyYy8iLCJzb3VyY2VzIjpbImxpYi9kb2N1bWVudC1saXN0L2RhdGEvc2hhcmUtZGF0YS1yb3cubW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7OztHQWVHO0FBRUgsT0FBTyxFQUFXLFdBQVcsRUFBb0MsTUFBTSxvQkFBb0IsQ0FBQztBQUk1RixNQUFNLE9BQU8sWUFBWTtJQW1CckIsWUFBb0IsR0FBYyxFQUNkLGNBQThCLEVBQzlCLGdCQUF3QyxFQUN4QyxnQkFBbUMsRUFDbkMsY0FBd0I7UUFKeEIsUUFBRyxHQUFILEdBQUcsQ0FBVztRQUNkLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQXdCO1FBQ3hDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBbUI7UUFDbkMsbUJBQWMsR0FBZCxjQUFjLENBQVU7UUFuQjVDLFVBQUssR0FBMkIsRUFBRSxDQUFDO1FBQ25DLGVBQVUsR0FBWSxLQUFLLENBQUM7UUFFNUIsYUFBUSxHQUFXLEVBQUUsQ0FBQztRQWlCbEIsSUFBSSxDQUFDLEdBQUcsRUFBRTtZQUNOLE1BQU0sSUFBSSxLQUFLLENBQUMsWUFBWSxDQUFDLG9CQUFvQixDQUFDLENBQUM7U0FDdEQ7UUFFRCxJQUFJLENBQUMsWUFBWSxHQUFHLGNBQWMsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLElBQUksSUFBSSxDQUFDLDJCQUEyQixDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsMkJBQTJCLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDeEosSUFBSSxnQkFBZ0IsRUFBRTtZQUNsQixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUks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LENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUVELGtCQUFrQjtRQUNkLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFO1lBQ3hCLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDakY7SUFDTCxDQUFDO0lBRUQsUUFBUSxDQUFDLEdBQVc7UUFDaEIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxLQUFLLFNBQVMsQ0FBQztJQUM1QyxDQUFDO0lBRUQsS0FBSztRQUNELE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxJQUFJLFNBQVMsQ0FBQztJQUMxQyxDQUFDOztBQXRHTSxpQ0FBb0IsR0FBVyx5QkFBeUIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IERhdGFSb3csIE9iamVjdFV0aWxzLCBUaHVtYm5haWxTZXJ2aWNlLCBDb250ZW50U2VydmljZSB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBNaW5pbWFsTm9kZSwgTm9kZUVudHJ5IH0gZnJvbSAnQGFsZnJlc2NvL2pzLWFwaSc7XG5pbXBvcnQgeyBQZXJtaXNzaW9uU3R5bGVNb2RlbCB9IGZyb20gJy4vLi4vbW9kZWxzL3Blcm1pc3Npb25zLXN0eWxlLm1vZGVsJztcblxuZXhwb3J0IGNsYXNzIFNoYXJlRGF0YVJvdyBpbXBsZW1lbnRzIERhdGFSb3cge1xuXG4gICAgc3RhdGljIEVSUl9PQkpFQ1RfTk9UX0ZPVU5EOiBzdHJpbmcgPSAnT2JqZWN0IHNvdXJjZSBub3QgZm91bmQnO1xuXG4gICAgY2FjaGU6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fTtcbiAgICBpc1NlbGVjdGVkOiBib29sZWFuID0gZmFsc2U7XG4gICAgaXNEcm9wVGFyZ2V0OiBib29sZWFuO1xuICAgIGNzc0NsYXNzOiBzdHJpbmcgPSAnJztcbiAgICBpZDogc3RyaW5nO1xuXG4gICAgZ2V0IG5vZGUoKTogTm9kZUVudHJ5IHtcbiAgICAgICAgcmV0dXJuIHRoaXMub2JqO1xuICAgIH1cblxuICAgIHNldCBub2RlKHZhbHVlOiBOb2RlRW50cnkpIHtcbiAgICAgICAgdGhpcy5vYmogPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5jYWNoZSA9IHt9O1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgb2JqOiBOb2RlRW50cnksXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBjb250ZW50U2VydmljZTogQ29udGVudFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBwZXJtaXNzaW9uc1N0eWxlOiBQZXJtaXNzaW9uU3R5bGVNb2RlbFtdLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgdGh1bWJuYWlsU2VydmljZT86IFRodW1ibmFpbFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhbGxvd0Ryb3BGaWxlcz86IGJvb2xlYW4pIHtcbiAgICAgICAgaWYgKCFvYmopIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihTaGFyZURhdGFSb3cuRVJSX09CSkVDVF9OT1RfRk9VTkQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pc0Ryb3BUYXJnZXQgPSBhbGxvd0Ryb3BGaWxlcyAhPT0gdW5kZWZpbmVkID8gdGhpcy5hbGxvd0Ryb3BGaWxlcyAmJiB0aGlzLmNoZWNrTm9kZVR5cGVBbmRQZXJtaXNzaW9ucyhvYmopIDogdGhpcy5jaGVja05vZGVUeXBlQW5kUGVybWlzc2lvbnMob2JqKTtcbiAgICAgICAgaWYgKHBlcm1pc3Npb25zU3R5bGUpIHtcbiAgICAgICAgICAgIHRoaXMuY3NzQ2xhc3MgPSB0aGlzLmdldFBlcm1pc3Npb25DbGFzcyhvYmopO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaWQgPSB0aGlzLmdldElkKCk7XG4gICAgfVxuXG4gICAgY2hlY2tOb2RlVHlwZUFuZFBlcm1pc3Npb25zKG5vZGVFbnRyeTogTm9kZUVudHJ5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzRm9sZGVyQW5kSGFzUGVybWlzc2lvblRvVXBsb2FkKG5vZGVFbnRyeSkgfHwgdGhpcy5pc0ZpbGVBbmRIYXNQYXJlbnRGb2xkZXJQZXJtaXNzaW9uVG9VcGxvYWQobm9kZUVudHJ5KTtcbiAgICB9XG5cbiAgICBnZXRQZXJtaXNzaW9uQ2xhc3Mobm9kZUVudGl0eTogTm9kZUVudHJ5KTogc3RyaW5nIHtcbiAgICAgICAgbGV0IHBlcm1pc3Npb25zQ2xhc3NlcyA9ICcnO1xuXG4gICAgICAgIHRoaXMucGVybWlzc2lvbnNTdHlsZS5mb3JFYWNoKChjdXJyZW50UGVybWlzc2lvbnNTdHlsZTogUGVybWlzc2lvblN0eWxlTW9kZWwpID0+IHtcblxuICAgICAgICAgICAgaWYgKHRoaXMuYXBwbHlQZXJtaXNzaW9uU3R5bGVUb0ZvbGRlcihub2RlRW50aXR5LmVudHJ5LCBjdXJyZW50UGVybWlzc2lvbnNTdHlsZSkgfHwgdGhpcy5hcHBseVBlcm1pc3Npb25TdHlsZVRvRmlsZShub2RlRW50aXR5LmVudHJ5LCBjdXJyZW50UGVybWlzc2lvbnNTdHlsZSkpIHtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbnRlbnRTZXJ2aWNlLmhhc0FsbG93YWJsZU9wZXJhdGlvbnMobm9kZUVudGl0eS5lbnRyeSwgY3VycmVudFBlcm1pc3Npb25zU3R5bGUucGVybWlzc2lvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnNDbGFzc2VzICs9IGAgJHtjdXJyZW50UGVybWlzc2lvbnNTdHlsZS5jc3N9YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHBlcm1pc3Npb25zQ2xhc3NlcztcbiAgICB9XG5cbiAgICBwcml2YXRlIGFwcGx5UGVybWlzc2lvblN0eWxlVG9GaWxlKG5vZGU6IE1pbmltYWxOb2RlLCBjdXJyZW50UGVybWlzc2lvbnNTdHlsZTogUGVybWlzc2lvblN0eWxlTW9kZWwpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIChjdXJyZW50UGVybWlzc2lvbnNTdHlsZS5pc0ZpbGUgJiYgbm9kZS5pc0ZpbGUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXBwbHlQZXJtaXNzaW9uU3R5bGVUb0ZvbGRlcihub2RlOiBNaW5pbWFsTm9kZSwgY3VycmVudFBlcm1pc3Npb25zU3R5bGU6IFBlcm1pc3Npb25TdHlsZU1vZGVsKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAoY3VycmVudFBlcm1pc3Npb25zU3R5bGUuaXNGb2xkZXIgJiYgbm9kZS5pc0ZvbGRlcik7XG4gICAgfVxuXG4gICAgaXNGb2xkZXJBbmRIYXNQZXJtaXNzaW9uVG9VcGxvYWQobm9kZUVudHJ5OiBOb2RlRW50cnkpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNGb2xkZXIobm9kZUVudHJ5KSAmJiB0aGlzLmNvbnRlbnRTZXJ2aWNlLmhhc0FsbG93YWJsZU9wZXJhdGlvbnMobm9kZUVudHJ5LmVudHJ5LCAnY3JlYXRlJyk7XG4gICAgfVxuXG4gICAgaXNGaWxlQW5kSGFzUGFyZW50Rm9sZGVyUGVybWlzc2lvblRvVXBsb2FkKG5vZGVFbnRyeTogTm9kZUVudHJ5KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzRmlsZShub2RlRW50cnkpICYmIHRoaXMuY29udGVudFNlcnZpY2UuaGFzQWxsb3dhYmxlT3BlcmF0aW9ucyhub2RlRW50cnkuZW50cnksICd1cGRhdGUnKTtcbiAgICB9XG5cbiAgICBpc0ZpbGUobm9kZUVudHJ5OiBOb2RlRW50cnkpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIG5vZGVFbnRyeS5lbnRyeSAmJiBub2RlRW50cnkuZW50cnkuaXNGaWxlO1xuICAgIH1cblxuICAgIGlzRm9sZGVyKG5vZGVFbnRyeTogTm9kZUVudHJ5KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBub2RlRW50cnkuZW50cnkgJiYgbm9kZUVudHJ5LmVudHJ5LmlzRm9sZGVyO1xuICAgIH1cblxuICAgIGNhY2hlVmFsdWUoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpOiBhbnkge1xuICAgICAgICB0aGlzLmNhY2hlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cblxuICAgIGdldFZhbHVlKGtleTogc3RyaW5nKTogYW55IHtcbiAgICAgICAgaWYgKHRoaXMuY2FjaGVba2V5XSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jYWNoZVtrZXldO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBPYmplY3RVdGlscy5nZXRWYWx1ZSh0aGlzLm9iai5lbnRyeSwga2V5KTtcbiAgICB9XG5cbiAgICBpbWFnZUVycm9yUmVzb2x2ZXIoKTogYW55IHtcbiAgICAgICAgaWYgKHRoaXMub2JqLmVudHJ5LmNvbnRlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRodW1ibmFpbFNlcnZpY2UuZ2V0TWltZVR5cGVJY29uKHRoaXMub2JqLmVudHJ5LmNvbnRlbnQubWltZVR5cGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaGFzVmFsdWUoa2V5OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoa2V5KSAhPT0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGdldElkKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLm9iai5lbnRyeS5pZCB8fCB1bmRlZmluZWQ7XG4gICAgfVxufVxuIl19