/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, EventEmitter, Input, Output, ViewChild, ViewEncapsulation, Inject } from '@angular/core';
import { HighlightDirective, UserPreferencesService, UserPreferenceValues, InfinitePaginationComponent, NodesApiService, SitesService, UploadService, AppConfigService, ShowHeaderMode } from '@alfresco/adf-core';
import { FormControl } from '@angular/forms';
import { Pagination, SiteEntry, SitePaging } from '@alfresco/js-api';
import { DocumentListComponent } from '../document-list/components/document-list.component';
import { debounceTime, takeUntil } from 'rxjs/operators';
import { CustomResourcesService } from '../document-list/services/custom-resources.service';
import { Subject } from 'rxjs';
import { SEARCH_QUERY_SERVICE_TOKEN } from '../search/search-query-service.token';
import { SearchQueryBuilderService } from '../search/services/search-query-builder.service';
import { ContentNodeSelectorPanelService } from './content-node-selector-panel.service';
export const defaultValidation = () => true;
export class ContentNodeSelectorPanelComponent {
    constructor(customResourcesService, queryBuilderService, userPreferencesService, nodesApiService, uploadService, sitesService, appConfigService, contentNodeSelectorPanelService) {
        this.customResourcesService = customResourcesService;
        this.queryBuilderService = queryBuilderService;
        this.userPreferencesService = userPreferencesService;
        this.nodesApiService = nodesApiService;
        this.uploadService = uploadService;
        this.sitesService = sitesService;
        this.appConfigService = appConfigService;
        this.contentNodeSelectorPanelService = contentNodeSelectorPanelService;
        this.DEFAULT_PAGINATION = new Pagination({
            maxItems: 25,
            skipCount: 0
        });
        this.showSiteList = true;
        this.showSearchField = true;
        this.showCounter = false;
        this.restrictRootToCurrentFolderId = false;
        this.currentFolderId = null;
        this.dropdownHideMyFiles = false;
        this.dropdownSiteList = null;
        this._rowFilter = defaultValidation;
        this._excludeSiteContent = [];
        this.imageResolver = null;
        this.pageSize = this.DEFAULT_PAGINATION.maxItems;
        this.selectionMode = 'single';
        this.isSelectionValid = defaultValidation;
        this.select = new EventEmitter();
        this.navigationChange = new EventEmitter();
        this.siteChange = new EventEmitter();
        this.showingSearch = new EventEmitter();
        this.currentFolder = new EventEmitter();
        this.folderLoaded = new EventEmitter();
        this.nodePaging = null;
        this.searchTerm = '';
        this.showingSearchResults = false;
        this.loadingSearchResults = false;
        this.inDialog = false;
        this._chosenNode = null;
        this.selectionWithoutValidation = null;
        this.folderIdToShow = null;
        this.breadcrumbFolderTitle = null;
        this.startSiteGuid = null;
        this.hasValidQuery = false;
        this.showHeader = ShowHeaderMode.Never;
        this.infiniteScroll = false;
        this.debounceSearch = 200;
        this.searchInput = new FormControl();
        this.preselectedNodes = [];
        this.currentUploadBatch = [];
        this.searchPanelExpanded = false;
        this.onDestroy$ = new Subject();
    }
    set rowFilter(rowFilter) {
        this.createRowFilter(rowFilter);
    }
    get rowFilter() {
        return this._rowFilter;
    }
    set excludeSiteContent(excludeSiteContent) {
        this._excludeSiteContent = excludeSiteContent;
        this.createRowFilter(this._rowFilter);
    }
    get excludeSiteContent() {
        return this._excludeSiteContent;
    }
    set showSearch(value) {
        if (value !== undefined && value !== null) {
            this.showSearchField = value;
        }
    }
    get showSearch() {
        return this.showSearchField;
    }
    set showDropdownSiteList(value) {
        if (value !== undefined && value !== null) {
            this.showSiteList = value;
        }
    }
    get showDropdownSiteList() {
        return this.showSiteList;
    }
    set showFilesInResult(value) {
        if (value !== undefined && value !== null) {
            const showFilesQuery = `TYPE:'cm:folder'${value ? " OR TYPE:'cm:content'" : ''}`;
            this.queryBuilderService.addFilterQuery(showFilesQuery);
        }
    }
    set showNodeCounter(value) {
        this.showCounter = value !== null && value !== void 0 ? value : false;
    }
    get showNodeCounter() {
        return this.showCounter;
    }
    set chosenNode(value) {
        this._chosenNode = value;
        this.select.next(value);
    }
    get chosenNode() {
        return this._chosenNode;
    }
    getSelectedCount() {
        var _a;
        return ((_a = this.chosenNode) === null || _a === void 0 ? void 0 : _a.length) || 0;
    }
    ngOnInit() {
        this.searchInput.valueChanges
            .pipe(debounceTime(this.debounceSearch), takeUntil(this.onDestroy$))
            .subscribe((searchValue) => {
            this.searchTerm = searchValue;
            this.queryBuilderService.userQuery = searchValue.length > 0 ? `${searchValue}*` : searchValue;
            this.queryBuilderService.update();
        });
        this.queryBuilderService.updated
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((queryBody) => {
            if (queryBody) {
                this.hasValidQuery = true;
                this.prepareDialogForNewSearch(queryBody);
                this.queryBuilderService.execute(queryBody);
            }
            else {
                this.hasValidQuery = false;
                this.resetFolderToShow();
                this.clearSearch();
            }
        });
        this.queryBuilderService.executed
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((results) => {
            if (this.hasValidQuery) {
                this.showSearchResults(results);
            }
        });
        this.userPreferencesService
            .select(UserPreferenceValues.PaginationSize)
            .pipe(takeUntil(this.onDestroy$))
            .subscribe(pagSize => this.pageSize = pagSize);
        this.target = this.documentList;
        this.folderIdToShow = this.currentFolderId;
        if (this.currentFolderId) {
            if (this.restrictRootToCurrentFolderId) {
                this.breadcrumbRootId = this.currentFolderId;
                this.siteId = this.currentFolderId;
            }
            else {
                this.getStartSite();
            }
        }
        this.breadcrumbTransform = this.breadcrumbTransform ? this.breadcrumbTransform : null;
        this.isSelectionValid = this.isSelectionValid ? this.isSelectionValid : defaultValidation;
        this.onFileUploadEvent();
        this.onFileUploadDeletedEvent();
        this.resetPagination();
        this.setSearchScopeToNodes();
        this.documentList.$folderNode
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((currentNode) => {
            this.currentFolder.emit(currentNode);
        });
        this.sorting = this.appConfigService.get('adf-content-node-selector.sorting', ['createdAt', 'desc']);
    }
    ngOnDestroy() {
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
    toggleSearchPanel() {
        this.searchPanelExpanded = !this.searchPanelExpanded;
    }
    hasCustomModels() {
        var _a, _b;
        return ((_b = (_a = this.contentNodeSelectorPanelService) === null || _a === void 0 ? void 0 : _a.customModels) === null || _b === void 0 ? void 0 : _b.length) > 0;
    }
    onFileUploadEvent() {
        this.uploadService.fileUploadComplete
            .pipe(debounceTime(500), takeUntil(this.onDestroy$))
            .subscribe((fileUploadEvent) => {
            this.currentUploadBatch.push(fileUploadEvent.data);
            if (!this.uploadService.isUploading()) {
                this.preselectedNodes = this.getPreselectNodesBasedOnSelectionMode();
                this.currentUploadBatch = [];
                this.documentList.reloadWithoutResettingSelection();
            }
        });
    }
    onFileUploadDeletedEvent() {
        this.uploadService.fileUploadDeleted
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((deletedFileEvent) => {
            this.documentList.unselectRowFromNodeId(deletedFileEvent.file.data.entry.id);
            this.documentList.reloadWithoutResettingSelection();
        });
    }
    getStartSite() {
        this.nodesApiService.getNode(this.currentFolderId).subscribe((startNodeEntry) => {
            this.startSiteGuid = this.sitesService.getSiteNameFromNodePath(startNodeEntry);
            if (this.startSiteGuid) {
                this.sitesService.getSite(this.startSiteGuid).subscribe((startSiteEntry) => {
                    if (startSiteEntry instanceof SiteEntry) {
                        this.siteChange.emit(startSiteEntry.entry.title);
                    }
                });
            }
        });
    }
    createRowFilter(filter) {
        if (!filter) {
            filter = () => true;
        }
        this._rowFilter = (value, index, array) => {
            return filter(value, index, array) &&
                !this.isExcludedSiteContent(value);
        };
    }
    isExcludedSiteContent(row) {
        const entry = row.node.entry;
        if (this._excludeSiteContent && this._excludeSiteContent.length &&
            entry &&
            entry.properties &&
            entry.properties['st:componentId']) {
            const excludedItem = this._excludeSiteContent.find((id) => entry.properties['st:componentId'] === id);
            return !!excludedItem;
        }
        return false;
    }
    siteChanged(chosenSite) {
        this.siteId = chosenSite.entry.guid;
        this.setTitleIfCustomSite(chosenSite);
        this.siteChange.emit(chosenSite.entry.title);
        this.queryBuilderService.update();
    }
    get breadcrumbFolderNode() {
        var _a;
        let folderNode;
        if (this.showingSearchResults && ((_a = this.selectionWithoutValidation) === null || _a === void 0 ? void 0 : _a.length)) {
            folderNode = this.selectionWithoutValidation[0];
        }
        else {
            folderNode = this.documentList.folderNode;
        }
        return folderNode;
    }
    prepareDialogForNewSearch(queryBody) {
        this.target = queryBody ? null : this.documentList;
        if (this.target) {
            this.infinitePaginationComponent.reset();
        }
        this.folderIdToShow = null;
        this.preselectedNodes = [];
        this.loadingSearchResults = true;
        this.addCorrespondingNodeIdsQuery();
        this.resetChosenNode();
    }
    clear() {
        this.searchTerm = '';
        this.queryBuilderService.userQuery = '';
        this.queryBuilderService.update();
    }
    resetFolderToShow() {
        this.folderIdToShow = this.siteId || this.currentFolderId;
    }
    clearSearch() {
        this.searchTerm = '';
        this.nodePaging = null;
        this.resetPagination();
        this.resetChosenNode();
        this.showingSearchResults = false;
        this.showingSearch.emit(this.showingSearchResults);
    }
    addCorrespondingNodeIdsQuery() {
        let extraParentFiltering = '';
        if (this.customResourcesService.hasCorrespondingNodeIds(this.siteId)) {
            this.customResourcesService.getCorrespondingNodeIds(this.siteId)
                .subscribe((nodeIds) => {
                if (nodeIds && nodeIds.length) {
                    nodeIds
                        .filter((id) => id !== this.siteId)
                        .forEach((extraId) => {
                        extraParentFiltering += ` OR ANCESTOR:'workspace://SpacesStore/${extraId}'`;
                    });
                }
                const parentFiltering = this.siteId ? `ANCESTOR:'workspace://SpacesStore/${this.siteId}'${extraParentFiltering}` : '';
                this.queryBuilderService.addFilterQuery(parentFiltering);
            });
        }
        else {
            const parentFiltering = this.siteId ? `ANCESTOR:'workspace://SpacesStore/${this.siteId}'` : '';
            this.queryBuilderService.addFilterQuery(parentFiltering);
        }
    }
    setSearchScopeToNodes() {
        const scope = {
            locations: 'nodes'
        };
        this.queryBuilderService.setScope(scope);
    }
    showSearchResults(results) {
        this.showingSearchResults = true;
        this.loadingSearchResults = false;
        this.showingSearch.emit(this.showingSearchResults);
        this.nodePaging = results;
    }
    onFolderChange($event) {
        this.folderIdToShow = $event.value.id;
        this.showingSearchResults = false;
        this.infiniteScroll = false;
        this.breadcrumbFolderTitle = null;
        this.preselectedNodes = [];
        this.clearSearch();
        this.navigationChange.emit($event);
    }
    onFolderLoaded(nodePaging) {
        this.updatePaginationAfterRowFilter(nodePaging);
        if (!this.showingSearchResults) {
            this.attemptNodeSelection(this.documentList.folderNode);
        }
        this.folderLoaded.emit();
    }
    updatePaginationAfterRowFilter(nodePaging) {
        if (this.documentList.data.getRows().length < nodePaging.list.pagination.maxItems) {
            nodePaging.list.pagination.hasMoreItems = false;
        }
    }
    showBreadcrumbs() {
        return !this.showingSearchResults || this.chosenNode;
    }
    getNextPageOfSearch(pagination) {
        this.infiniteScroll = true;
        this.queryBuilderService.paging.maxItems = pagination.maxItems;
        this.queryBuilderService.paging.skipCount = pagination.skipCount;
        if (this.searchTerm.length > 0) {
            this.queryBuilderService.update();
        }
    }
    attemptNodeSelection(entry) {
        if (entry && this.isSelectionValid(entry)) {
            this.chosenNode = [entry];
        }
    }
    resetChosenNode() {
        this.chosenNode = null;
    }
    onCurrentSelection(nodesEntries) {
        const validNodesEntity = nodesEntries.filter((node) => this.isSelectionValid(node.entry));
        this.chosenNode = validNodesEntity.map((node) => node.entry);
        this.selectionWithoutValidation = nodesEntries.map(node => node.entry);
    }
    setTitleIfCustomSite(site) {
        if (this.customResourcesService.isCustomSource(site.entry.guid)) {
            this.breadcrumbFolderTitle = site.entry.title;
            if (this.documentList.folderNode.path.elements) {
                this.breadcrumbFolderNode.name = site.entry.title;
                this.documentList.folderNode.path.elements = null;
            }
        }
        else {
            this.breadcrumbFolderTitle = null;
        }
    }
    hasPreselectNodes() {
        var _a;
        return ((_a = this.preselectedNodes) === null || _a === void 0 ? void 0 : _a.length) > 0;
    }
    isSingleSelectionMode() {
        return this.selectionMode === 'single';
    }
    getPreselectNodesBasedOnSelectionMode() {
        var _a;
        let selectedNodes = [];
        if ((_a = this.currentUploadBatch) === null || _a === void 0 ? void 0 : _a.length) {
            if (this.isSingleSelectionMode()) {
                selectedNodes = [this.currentUploadBatch[this.currentUploadBatch.length - 1]];
            }
            else {
                selectedNodes = this.currentUploadBatch;
            }
        }
        return selectedNodes;
    }
    resetPagination() {
        this.queryBuilderService.paging = {
            maxItems: this.pageSize,
            skipCount: this.DEFAULT_PAGINATION.skipCount
        };
    }
}
ContentNodeSelectorPanelComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-content-node-selector-panel',
                template: "<div class=\"adf-content-node-selector-content\">\n    <mat-form-field floatPlaceholder=\"never\" class=\"adf-content-node-selector-content-input\" *ngIf=\"showSearch\">\n        <input matInput\n            id=\"searchInput\"\n            [formControl]=\"searchInput\"\n            type=\"text\"\n            placeholder=\"{{'NODE_SELECTOR.SEARCH' | translate}}\"\n            [value]=\"searchTerm\"\n            data-automation-id=\"content-node-selector-search-input\">\n\n        <mat-icon *ngIf=\"searchTerm.length > 0\"\n            matSuffix (click)=\"clear()\"\n            class=\"adf-content-node-selector-content-input-icon\"\n            data-automation-id=\"content-node-selector-search-clear\">clear\n        </mat-icon>\n\n        <mat-icon *ngIf=\"searchTerm.length === 0\"\n            matSuffix\n            class=\"adf-content-node-selector-content-input-icon\"\n            data-automation-id=\"content-node-selector-search-icon\">search\n        </mat-icon>\n\n    </mat-form-field>\n    <adf-sites-dropdown\n        *ngIf=\"showDropdownSiteList\"\n        class=\"full-width\"\n        (change)=\"siteChanged($event)\"\n        [placeholder]=\"'NODE_SELECTOR.SELECT_LOCATION'\"\n        [hideMyFiles]=\"dropdownHideMyFiles\"\n        [siteList]=\"dropdownSiteList\"\n        [value]=\"startSiteGuid\"\n        data-automation-id=\"content-node-selector-sites-combo\">\n    </adf-sites-dropdown>\n    <button *ngIf=\"hasCustomModels()\"\n        data-automation-id=\"adf-toggle-search-panel-button\"\n        mat-icon-button\n        (click)=\"toggleSearchPanel()\">\n        <mat-icon>filter_list</mat-icon>\n        {{ 'SEARCH.SEARCH_HEADER.TITLE' | translate }}\n    </button>\n    <div class=\"adf-content-node-selector-search-panel-container\">\n        <adf-search-panel *ngIf=\"searchPanelExpanded\">\n        </adf-search-panel>\n        <div class=\"adf-content-node-selector-document-list-container\">\n    <adf-toolbar>\n        <adf-toolbar-title>\n            <ng-container *ngIf=\"!showBreadcrumbs()\">\n                <span role=\"heading\" aria-level=\"3\" class=\"adf-search-results-label\">{{ 'NODE_SELECTOR.SEARCH_RESULTS' | translate }}</span>\n            </ng-container>\n            <adf-dropdown-breadcrumb *ngIf=\"showBreadcrumbs()\"\n                class=\"adf-content-node-selector-content-breadcrumb\"\n                (navigate)=\"clearSearch()\"\n                [target]=\"documentList\"\n                [rootId]=\"breadcrumbRootId\"\n                [transform]=\"breadcrumbTransform\"\n                [folderNode]=\"breadcrumbFolderNode\"\n                [root]=\"breadcrumbFolderTitle\"\n                data-automation-id=\"content-node-selector-content-breadcrumb\">\n            </adf-dropdown-breadcrumb>\n            <ng-container *ngIf=\"showNodeCounter\" [adf-node-counter]=\"getSelectedCount()\"></ng-container>\n        </adf-toolbar-title>\n    </adf-toolbar>\n\n    <div\n        class=\"adf-content-node-selector-content-list\"\n        [class.adf-content-node-selector-content-list-searchLayout]=\"showingSearchResults\"\n        data-automation-id=\"content-node-selector-content-list\">\n        <adf-document-list\n            #documentList\n            [adf-highlight]=\"searchTerm\"\n            adf-highlight-selector=\".adf-name-location-cell-name\"\n            [showHeader]=\"showHeader\"\n            [node]=\"nodePaging\"\n            [preselectNodes]=\"preselectedNodes\"\n            [maxItems]=\"pageSize\"\n            [rowFilter]=\"_rowFilter\"\n            [imageResolver]=\"imageResolver\"\n            [currentFolderId]=\"folderIdToShow\"\n            [selectionMode]=\"selectionMode\"\n            [contextMenuActions]=\"false\"\n            [contentActions]=\"false\"\n            [allowDropFiles]=\"false\"\n            [sorting]=\"sorting\"\n            sortingMode=\"server\"\n            [where]=\"where\"\n            (folderChange)=\"onFolderChange($event)\"\n            (ready)=\"onFolderLoaded($event)\"\n            (nodeSelected)=\"onCurrentSelection($event)\"\n            data-automation-id=\"content-node-selector-document-list\">\n\n            <adf-custom-empty-content-template>\n                <div>{{ 'NODE_SELECTOR.NO_RESULTS' | translate }}</div>\n            </adf-custom-empty-content-template>\n\n            <data-columns>\n                <data-column key=\"$thumbnail\" type=\"image\"></data-column>\n                <data-column key=\"name\" type=\"text\" title=\"ADF-DOCUMENT-LIST.LAYOUT.NAME\" class=\"adf-full-width adf-ellipsis-cell\">\n                    <ng-template let-context>\n                        <adf-name-location-cell [row]=\"context.row\"></adf-name-location-cell>\n                    </ng-template>\n                </data-column>\n                <data-column key=\"modifiedAt\" type=\"date\" title=\"ADF-DOCUMENT-LIST.LAYOUT.MODIFIED_ON\" format=\"timeAgo\" class=\"adf-content-selector-modified-cell\"></data-column>\n                <data-column key=\"createdByUser.displayName\" type=\"text\" title=\"ADF-DOCUMENT-LIST.LAYOUT.CREATED_BY\" class=\"adf-content-selector-modifier-cell\"></data-column>\n                <data-column key=\"visibility\" type=\"text\" title=\"ADF-DOCUMENT-LIST.LAYOUT.STATUS\" class=\"adf-content-selector-visibility-cell\"></data-column>\n            </data-columns>\n\n        </adf-document-list>\n\n        <adf-infinite-pagination\n            [target]=\"target\"\n            [loading]=\"loadingSearchResults\"\n            (loadMore)=\"getNextPageOfSearch($event)\"\n            data-automation-id=\"content-node-selector-search-pagination\">\n            {{ 'ADF-DOCUMENT-LIST.LAYOUT.LOAD_MORE' | translate }}\n        </adf-infinite-pagination>\n    </div>\n        </div>\n    </div>\n</div>\n",
                encapsulation: ViewEncapsulation.None,
                host: { 'class': 'adf-content-node-selector-panel' },
                providers: [{
                        provide: SEARCH_QUERY_SERVICE_TOKEN,
                        useClass: SearchQueryBuilderService
                    }],
                styles: [".adf-search-results-label{color:var(--theme-text-bold-color);flex:1;font-size:14px;font-stretch:normal;font-style:normal;font-weight:600;letter-spacing:-.2px;line-height:1.43}.adf-toolbar .mat-toolbar{border-bottom-width:0;font-size:14px;max-height:48px}.adf-toolbar .mat-toolbar.mat-toolbar-single-row{height:auto}.adf-content-node-selector-search-panel-container{display:flex}.adf-content-node-selector-document-list-container{width:100%}.adf-content-node-selector-content{padding-top:0}.adf-content-node-selector-content-input{width:100%}.adf-content-node-selector-content-input-icon{color:var(--adf-node-selector-icon-color);cursor:pointer}.adf-content-node-selector-content-input-icon:hover{color:var(--theme-fg-base-color)}.adf-content-node-selector-content .mat-form-field-underline .mat-form-field-ripple{height:1px;transition:none}.adf-content-node-selector-content .adf-site-dropdown-container .mat-form-field{display:block;margin-bottom:15px}.adf-content-node-selector-content .adf-site-dropdown-list-element{margin-bottom:0;width:100%}.adf-content-node-selector-content .adf-site-dropdown-list-element .mat-select-trigger{font-size:14px}.adf-content-node-selector-content-breadcrumb .adf-dropdown-breadcrumb-trigger{outline:none}.adf-content-node-selector-content-breadcrumb .adf-dropdown-breadcrumb-trigger .mat-icon{color:var(--adf-node-selector-base-color)}.adf-content-node-selector-content-breadcrumb .adf-dropdown-breadcrumb-trigger .mat-icon:hover{color:var(--adf-node-selector-base-bold-color)}.adf-content-node-selector-content-breadcrumb .adf-dropdown-breadcrumb-trigger:focus .mat-icon{color:var(--theme-primary-color)}.adf-content-node-selector-content-breadcrumb .adf-dropdown-breadcrumb-item-chevron{color:var(--adf-node-selector-base-color)}.adf-content-node-selector-content-list{border:1px solid var(--theme-border-color);border-top:0;height:300px;overflow:auto}.adf-content-node-selector-content-list .adf-highlight{color:var(--theme-primary-color)}.adf-content-node-selector-content-list .adf-datatable-list{border:none}.adf-content-node-selector-content-list .adf-datatable-list .adf-datatable-selected{height:100%;width:100%}.adf-content-node-selector-content-list .adf-datatable-list .adf-datatable-selected>svg{fill:#00bcd4!important}.adf-content-node-selector-content-list .adf-datatable-list .adf-no-content-container{border:none!important;text-align:center}.adf-content-node-selector-content-list .adf-datatable-list .adf-datatable-cell--image{max-width:35px;min-width:35px;width:35px}.adf-content-node-selector-content-list .adf-datatable-list .adf-datatable-cell:nth-child(2){flex:1 0 95px}.adf-content-node-selector-content-list .adf-datatable-list .adf-datatable-cell .adf-name-location-cell-location{display:none}.adf-content-node-selector-content-list .adf-datatable-list .adf-datatable-cell.adf-content-selector-visibility-cell{flex:0 1 auto;min-width:1px}.adf-content-node-selector-content-list .adf-datatable-list .adf-datatable-cell.adf-content-selector-visibility-cell .adf-datatable-cell-value{padding:0}.adf-content-node-selector-content-list .adf-datatable-list .adf-datatable-body .adf-datatable-row{min-height:40px}@media screen and (-ms-high-contrast:active),screen and (-ms-high-contrast:none){.adf-content-node-selector-content-list .adf-datatable-list .adf-datatable-body .adf-datatable-row{padding-top:15px}}.adf-content-node-selector-content-list .adf-datatable-list .adf-datatable-body .adf-datatable-row:first-child .adf-datatable-cell{border-top:none}.adf-content-node-selector-content-list .adf-datatable-list .adf-datatable-body .adf-datatable-row:last-child .adf-datatable-cell{border-bottom:none}.adf-content-node-selector-content-list-searchLayout .adf-datatable-list .adf-datatable-row{min-height:65px!important}.adf-content-node-selector-content-list-searchLayout .adf-datatable-list .adf-datatable-row .adf-datatable-cell .adf-name-location-cell-location{display:block;padding:0 10px}.adf-content-node-selector-content-list-searchLayout .adf-datatable-list .adf-datatable-row .adf-datatable-cell .adf-name-location-cell-name{padding:5px 10px 2px}.adf-content-node-selector-content-list-searchLayout .adf-datatable-list .adf-datatable-row .adf-datatable-cell.adf-content-selector-modified-cell,.adf-content-node-selector-content-list-searchLayout .adf-datatable-list .adf-datatable-row .adf-datatable-cell.adf-content-selector-modifier-cell,.adf-content-node-selector-content-list-searchLayout .adf-datatable-list .adf-datatable-row .adf-datatable-cell.adf-content-selector-visibility-cell{display:none}"]
            },] }
];
ContentNodeSelectorPanelComponent.ctorParameters = () => [
    { type: CustomResourcesService },
    { type: SearchQueryBuilderService, decorators: [{ type: Inject, args: [SEARCH_QUERY_SERVICE_TOKEN,] }] },
    { type: UserPreferencesService },
    { type: NodesApiService },
    { type: UploadService },
    { type: SitesService },
    { type: AppConfigService },
    { type: ContentNodeSelectorPanelService }
];
ContentNodeSelectorPanelComponent.propDecorators = {
    restrictRootToCurrentFolderId: [{ type: Input }],
    currentFolderId: [{ type: Input }],
    dropdownHideMyFiles: [{ type: Input }],
    dropdownSiteList: [{ type: Input }],
    where: [{ type: Input }],
    rowFilter: [{ type: Input }],
    excludeSiteContent: [{ type: Input }],
    imageResolver: [{ type: Input }],
    pageSize: [{ type: Input }],
    selectionMode: [{ type: Input }],
    isSelectionValid: [{ type: Input }],
    breadcrumbTransform: [{ type: Input }],
    showSearch: [{ type: Input }],
    showDropdownSiteList: [{ type: Input }],
    showFilesInResult: [{ type: Input }],
    showNodeCounter: [{ type: Input }],
    select: [{ type: Output }],
    navigationChange: [{ type: Output }],
    siteChange: [{ type: Output }],
    showingSearch: [{ type: Output }],
    currentFolder: [{ type: Output }],
    folderLoaded: [{ type: Output }],
    documentList: [{ type: ViewChild, args: ['documentList', { static: true },] }],
    highlighter: [{ type: ViewChild, args: [HighlightDirective, { static: true },] }],
    infinitePaginationComponent: [{ type: ViewChild, args: [InfinitePaginationComponent, { static: true },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGVudC1ub2RlLXNlbGVjdG9yLXBhbmVsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL2NvbnRlbnQtc2VydmljZXMvc3JjLyIsInNvdXJjZXMiOlsibGliL2NvbnRlbnQtbm9kZS1zZWxlY3Rvci9jb250ZW50LW5vZGUtc2VsZWN0b3ItcGFuZWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQUVILE9BQU8sRUFDSCxTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFFTCxNQUFNLEVBQ04sU0FBUyxFQUNULGlCQUFpQixFQUVqQixNQUFNLEVBQ1QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUNILGtCQUFrQixFQUNsQixzQkFBc0IsRUFDdEIsb0JBQW9CLEVBQ3BCLDJCQUEyQixFQUMzQixlQUFlLEVBQ2YsWUFBWSxFQUNaLGFBQWEsRUFHYixnQkFBZ0IsRUFFaEIsY0FBYyxFQUNqQixNQUFNLG9CQUFvQixDQUFDO0FBQzVCLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQW9CLFVBQVUsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFzQyxNQUFNLGtCQUFrQixDQUFDO0FBQzNILE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHFEQUFxRCxDQUFDO0FBRzVGLE9BQU8sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sb0RBQW9ELENBQUM7QUFFNUYsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUNsRixPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxpREFB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QUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTO1NBQy9DLENBQUM7SUFDTixDQUFDOzs7WUF4bUJKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsaUNBQWlDO2dCQUMzQywrcExBQTJEO2dCQUUzRCxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTtnQkFDckMsSUFBSSxFQUFFLEVBQUUsT0FBTyxFQUFFLGlDQUFpQyxFQUFFO2dCQUNwRCxTQUFTLEVBQUUsQ0FBQzt3QkFDUixPQUFPLEVBQUUsMEJBQTBCO3dCQUNuQyxRQUFRLEVBQUUseUJBQXlCO3FCQUN0QyxDQUFDOzthQUNMOzs7WUFyQlEsc0JBQXNCO1lBSXRCLHlCQUF5Qix1QkFpT2pCLE1BQU0sU0FBQywwQkFBMEI7WUF2UDlDLHNCQUFzQjtZQUd0QixlQUFlO1lBRWYsYUFBYTtZQURiLFlBQVk7WUFJWixnQkFBZ0I7WUFlWCwrQkFBK0I7Ozs0Q0E2Qm5DLEtBQUs7OEJBSUwsS0FBSztrQ0FPTCxLQUFLOytCQU9MLEtBQUs7b0JBU0wsS0FBSzt3QkFRTCxLQUFLO2lDQWNMLEtBQUs7NEJBZUwsS0FBSzt1QkFJTCxLQUFLOzRCQUlMLEtBQUs7K0JBTUwsS0FBSztrQ0FRTCxLQUFLO3lCQUlMLEtBQUs7bUNBWUwsS0FBSztnQ0FZTCxLQUFLOzhCQVNMLEtBQUs7cUJBVUwsTUFBTTsrQkFJTixNQUFNO3lCQUlOLE1BQU07NEJBSU4sTUFBTTs0QkFJTixNQUFNOzJCQUlOLE1BQU07MkJBR04sU0FBUyxTQUFDLGNBQWMsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7MEJBRzFDLFNBQVMsU0FBQyxrQkFBa0IsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7MENBa0I5QyxTQUFTLFNBQUMsMkJBQTJCLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHtcbiAgICBDb21wb25lbnQsXG4gICAgRXZlbnRFbWl0dGVyLFxuICAgIElucHV0LFxuICAgIE9uSW5pdCxcbiAgICBPdXRwdXQsXG4gICAgVmlld0NoaWxkLFxuICAgIFZpZXdFbmNhcHN1bGF0aW9uLFxuICAgIE9uRGVzdHJveSxcbiAgICBJbmplY3Rcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICAgIEhpZ2hsaWdodERpcmVjdGl2ZSxcbiAgICBVc2VyUHJlZmVyZW5jZXNTZXJ2aWNlLFxuICAgIFVzZXJQcmVmZXJlbmNlVmFsdWVzLFxuICAgIEluZmluaXRlUGFnaW5hdGlvbkNvbXBvbmVudCwgUGFnaW5hdGVkQ29tcG9uZW50LFxuICAgIE5vZGVzQXBpU2VydmljZSxcbiAgICBTaXRlc1NlcnZpY2UsXG4gICAgVXBsb2FkU2VydmljZSxcbiAgICBGaWxlVXBsb2FkQ29tcGxldGVFdmVudCxcbiAgICBGaWxlVXBsb2FkRGVsZXRlRXZlbnQsXG4gICAgQXBwQ29uZmlnU2VydmljZSxcbiAgICBEYXRhU29ydGluZyxcbiAgICBTaG93SGVhZGVyTW9kZVxufSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgRm9ybUNvbnRyb2wgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBOb2RlLCBOb2RlUGFnaW5nLCBQYWdpbmF0aW9uLCBTaXRlRW50cnksIFNpdGVQYWdpbmcsIE5vZGVFbnRyeSwgUXVlcnlCb2R5LCBSZXF1ZXN0U2NvcGUgfSBmcm9tICdAYWxmcmVzY28vanMtYXBpJztcbmltcG9ydCB7IERvY3VtZW50TGlzdENvbXBvbmVudCB9IGZyb20gJy4uL2RvY3VtZW50LWxpc3QvY29tcG9uZW50cy9kb2N1bWVudC1saXN0LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBSb3dGaWx0ZXIgfSBmcm9tICcuLi9kb2N1bWVudC1saXN0L2RhdGEvcm93LWZpbHRlci5tb2RlbCc7XG5pbXBvcnQgeyBJbWFnZVJlc29sdmVyIH0gZnJvbSAnLi4vZG9jdW1lbnQtbGlzdC9kYXRhL2ltYWdlLXJlc29sdmVyLm1vZGVsJztcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQ3VzdG9tUmVzb3VyY2VzU2VydmljZSB9IGZyb20gJy4uL2RvY3VtZW50LWxpc3Qvc2VydmljZXMvY3VzdG9tLXJlc291cmNlcy5zZXJ2aWNlJztcbmltcG9ydCB7IE5vZGVFbnRyeUV2ZW50LCBTaGFyZURhdGFSb3cgfSBmcm9tICcuLi9kb2N1bWVudC1saXN0JztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFNFQVJDSF9RVUVSWV9TRVJWSUNFX1RPS0VOIH0gZnJvbSAnLi4vc2VhcmNoL3NlYXJjaC1xdWVyeS1zZXJ2aWNlLnRva2VuJztcbmltcG9ydCB7IFNlYXJjaFF1ZXJ5QnVpbGRlclNlcnZpY2UgfSBmcm9tICcuLi9zZWFyY2gvc2VydmljZXMvc2VhcmNoLXF1ZXJ5LWJ1aWxkZXIuc2VydmljZSc7XG5pbXBvcnQgeyBDb250ZW50Tm9kZVNlbGVjdG9yUGFuZWxTZXJ2aWNlIH0gZnJvbSAnLi9jb250ZW50LW5vZGUtc2VsZWN0b3ItcGFuZWwuc2VydmljZSc7XG5cbmV4cG9ydCB0eXBlIFZhbGlkYXRpb25GdW5jdGlvbiA9IChlbnRyeTogTm9kZSkgPT4gYm9vbGVhbjtcblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRWYWxpZGF0aW9uID0gKCkgPT4gdHJ1ZTtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhZGYtY29udGVudC1ub2RlLXNlbGVjdG9yLXBhbmVsJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vY29udGVudC1ub2RlLXNlbGVjdG9yLXBhbmVsLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9jb250ZW50LW5vZGUtc2VsZWN0b3ItcGFuZWwuY29tcG9uZW50LnNjc3MnXSxcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICAgIGhvc3Q6IHsgJ2NsYXNzJzogJ2FkZi1jb250ZW50LW5vZGUtc2VsZWN0b3ItcGFuZWwnIH0sXG4gICAgcHJvdmlkZXJzOiBbe1xuICAgICAgICBwcm92aWRlOiBTRUFSQ0hfUVVFUllfU0VSVklDRV9UT0tFTixcbiAgICAgICAgdXNlQ2xhc3M6IFNlYXJjaFF1ZXJ5QnVpbGRlclNlcnZpY2VcbiAgICB9XVxufSlcbmV4cG9ydCBjbGFzcyBDb250ZW50Tm9kZVNlbGVjdG9yUGFuZWxDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG5cbiAgICBERUZBVUxUX1BBR0lOQVRJT046IFBhZ2luYXRpb24gPSBuZXcgUGFnaW5hdGlvbih7XG4gICAgICAgIG1heEl0ZW1zOiAyNSxcbiAgICAgICAgc2tpcENvdW50OiAwXG4gICAgfSk7XG5cbiAgICBwcml2YXRlIHNob3dTaXRlTGlzdCA9IHRydWU7XG4gICAgcHJpdmF0ZSBzaG93U2VhcmNoRmllbGQgPSB0cnVlO1xuICAgIHByaXZhdGUgc2hvd0NvdW50ZXIgPSBmYWxzZTtcblxuICAgIC8qKiBJZiB0cnVlIHdpbGwgcmVzdHJpY3QgdGhlIHNlYXJjaCBhbmQgYnJlYWRjcnVtYnMgdG8gdGhlIGN1cnJlbnRGb2xkZXJJZCAqL1xuICAgIEBJbnB1dCgpXG4gICAgcmVzdHJpY3RSb290VG9DdXJyZW50Rm9sZGVySWQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIC8qKiBOb2RlIElEIG9mIHRoZSBmb2xkZXIgY3VycmVudGx5IGxpc3RlZC4gKi9cbiAgICBASW5wdXQoKVxuICAgIGN1cnJlbnRGb2xkZXJJZDogc3RyaW5nID0gbnVsbDtcblxuICAgIC8qKiBIaWRlIHRoZSBcIk15IEZpbGVzXCIgb3B0aW9uIGFkZGVkIHRvIHRoZSBzaXRlIGxpc3QgYnkgZGVmYXVsdC5cbiAgICAgKiBTZWUgdGhlIFtTaXRlcyBEcm9wZG93biBjb21wb25lbnRdKHNpdGVzLWRyb3Bkb3duLmNvbXBvbmVudC5tZClcbiAgICAgKiBmb3IgbW9yZSBpbmZvcm1hdGlvbi5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIGRyb3Bkb3duSGlkZU15RmlsZXM6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIC8qKiBDdXN0b20gc2l0ZSBmb3Igc2l0ZSBkcm9wZG93bi4gVGhpcyBpcyB0aGUgc2FtZSBhcyB0aGUgYHNpdGVMaXN0YC5cbiAgICAgKiBwcm9wZXJ0eSBvZiB0aGUgU2l0ZXMgRHJvcGRvd24gY29tcG9uZW50IChzZWUgaXRzIGRvYyBwYWdlXG4gICAgICogZm9yIG1vcmUgaW5mb3JtYXRpb24pLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgZHJvcGRvd25TaXRlTGlzdDogU2l0ZVBhZ2luZyA9IG51bGw7XG5cbiAgICBfcm93RmlsdGVyOiBSb3dGaWx0ZXIgPSBkZWZhdWx0VmFsaWRhdGlvbjtcblxuICAgIC8qKiBDdXN0b20gKndoZXJlKiBmaWx0ZXIgZnVuY3Rpb24uIFNlZSB0aGVcbiAgICAgKiBEb2N1bWVudCBMaXN0IGNvbXBvbmVudFxuICAgICAqIGZvciBtb3JlIGluZm9ybWF0aW9uLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgd2hlcmU6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIEN1c3RvbSByb3cgZmlsdGVyIGZ1bmN0aW9uLiBTZWUgdGhlXG4gICAgICogW1JvdyBGaWx0ZXIgTW9kZWxdKHJvdy1maWx0ZXIubW9kZWwubWQpIHBhZ2VcbiAgICAgKiBmb3IgbW9yZSBpbmZvcm1hdGlvbi5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHNldCByb3dGaWx0ZXIocm93RmlsdGVyOiBSb3dGaWx0ZXIpIHtcbiAgICAgICAgdGhpcy5jcmVhdGVSb3dGaWx0ZXIocm93RmlsdGVyKTtcbiAgICB9XG5cbiAgICBnZXQgcm93RmlsdGVyKCk6IFJvd0ZpbHRlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yb3dGaWx0ZXI7XG4gICAgfVxuXG4gICAgX2V4Y2x1ZGVTaXRlQ29udGVudDogc3RyaW5nW10gPSBbXTtcblxuICAgIC8qKiBDdXN0b20gbGlzdCBvZiBzaXRlIGNvbnRlbnQgY29tcG9uZW50SWRzLlxuICAgICAqIFVzZWQgdG8gZmlsdGVyIG91dCB0aGUgY29ycmVzcG9uZGluZyBpdGVtcyBmcm9tIHRoZSBkaXNwbGF5ZWQgbm9kZXNcbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHNldCBleGNsdWRlU2l0ZUNvbnRlbnQoZXhjbHVkZVNpdGVDb250ZW50OiBzdHJpbmdbXSkge1xuICAgICAgICB0aGlzLl9leGNsdWRlU2l0ZUNvbnRlbnQgPSBleGNsdWRlU2l0ZUNvbnRlbnQ7XG4gICAgICAgIHRoaXMuY3JlYXRlUm93RmlsdGVyKHRoaXMuX3Jvd0ZpbHRlcik7XG4gICAgfVxuXG4gICAgZ2V0IGV4Y2x1ZGVTaXRlQ29udGVudCgpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9leGNsdWRlU2l0ZUNvbnRlbnQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3VzdG9tIGltYWdlIHJlc29sdmVyIGZ1bmN0aW9uLiBTZWUgdGhlXG4gICAgICogW0ltYWdlIFJlc29sdmVyIE1vZGVsXShpbWFnZS1yZXNvbHZlci5tb2RlbC5tZCkgcGFnZVxuICAgICAqIGZvciBtb3JlIGluZm9ybWF0aW9uLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgaW1hZ2VSZXNvbHZlcjogSW1hZ2VSZXNvbHZlciA9IG51bGw7XG5cbiAgICAvKiogTnVtYmVyIG9mIGl0ZW1zIHNob3duIHBlciBwYWdlIGluIHRoZSBsaXN0LiAqL1xuICAgIEBJbnB1dCgpXG4gICAgcGFnZVNpemU6IG51bWJlciA9IHRoaXMuREVGQVVMVF9QQUdJTkFUSU9OLm1heEl0ZW1zO1xuXG4gICAgLyoqIERlZmluZSB0aGUgc2VsZWN0aW9uIG1vZGUgZm9yIGRvY3VtZW50IGxpc3QuIFRoZSBhbGxvd2VkIHZhbHVlcyBhcmUgc2luZ2xlIG9yIG11bHRpcGxlICovXG4gICAgQElucHV0KClcbiAgICBzZWxlY3Rpb25Nb2RlOiAnc2luZ2xlJyB8ICdtdWx0aXBsZScgPSAnc2luZ2xlJztcblxuICAgIC8qKiBGdW5jdGlvbiB1c2VkIHRvIGRlY2lkZSBpZiB0aGUgc2VsZWN0ZWQgbm9kZSBoYXMgcGVybWlzc2lvbiB0byBiZSBzZWxlY3RlZC5cbiAgICAgKiBEZWZhdWx0IHZhbHVlIGlzIGEgZnVuY3Rpb24gdGhhdCBhbHdheXMgcmV0dXJucyB0cnVlLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgaXNTZWxlY3Rpb25WYWxpZDogVmFsaWRhdGlvbkZ1bmN0aW9uID0gZGVmYXVsdFZhbGlkYXRpb247XG5cbiAgICAvKiogVHJhbnNmb3JtYXRpb24gdG8gYmUgcGVyZm9ybWVkIG9uIHRoZSBjaG9zZW4vZm9sZGVyIG5vZGUgYmVmb3JlIGJ1aWxkaW5nIHRoZVxuICAgICAqIGJyZWFkY3J1bWIgVUkuIENhbiBiZSB1c2VmdWwgd2hlbiBjdXN0b20gZm9ybWF0dGluZyBpcyBuZWVkZWQgZm9yIHRoZSBicmVhZGNydW1iLlxuICAgICAqIFlvdSBjYW4gY2hhbmdlIHRoZSBwYXRoIGVsZW1lbnRzIGZyb20gdGhlIG5vZGUgdGhhdCBhcmUgdXNlZCB0byBidWlsZCB0aGVcbiAgICAgKiBicmVhZGNydW1iIHVzaW5nIHRoaXMgZnVuY3Rpb24uXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBicmVhZGNydW1iVHJhbnNmb3JtOiAobm9kZSkgPT4gYW55O1xuXG4gICAgLyoqIFRvZ2dsZSBzZWFyY2ggaW5wdXQgcmVuZGVyaW5nICovXG4gICAgQElucHV0KClcbiAgICBzZXQgc2hvd1NlYXJjaCh2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5zaG93U2VhcmNoRmllbGQgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBzaG93U2VhcmNoKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zaG93U2VhcmNoRmllbGQ7XG4gICAgfVxuXG4gICAgLyoqIFRvZ2dsZSBzaXRlcyBsaXN0IGRyb3Bkb3duIHJlbmRlcmluZyAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2V0IHNob3dEcm9wZG93blNpdGVMaXN0KHZhbHVlOiBib29sZWFuKSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dTaXRlTGlzdCA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IHNob3dEcm9wZG93blNpdGVMaXN0KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zaG93U2l0ZUxpc3Q7XG4gICAgfVxuXG4gICAgLyoqIFNob3dzIHRoZSBmaWxlcyBhbmQgZm9sZGVycyBpbiB0aGUgc2VhcmNoIHJlc3VsdCAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2V0IHNob3dGaWxlc0luUmVzdWx0KHZhbHVlOiBib29sZWFuKSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjb25zdCBzaG93RmlsZXNRdWVyeSA9IGBUWVBFOidjbTpmb2xkZXInJHt2YWx1ZSA/IFwiIE9SIFRZUEU6J2NtOmNvbnRlbnQnXCIgOiAnJ31gO1xuICAgICAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXJTZXJ2aWNlLmFkZEZpbHRlclF1ZXJ5KHNob3dGaWxlc1F1ZXJ5KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBTaG93cyB0aGUgbm9kZSBjb3VudGVyIGluIHRoZSBicmVhZGNydW1iICovXG4gICAgQElucHV0KClcbiAgICBzZXQgc2hvd05vZGVDb3VudGVyKHZhbHVlOiBib29sZWFuKSB7XG4gICAgICAgIHRoaXMuc2hvd0NvdW50ZXIgPSB2YWx1ZSA/PyBmYWxzZTtcbiAgICB9XG5cbiAgICBnZXQgc2hvd05vZGVDb3VudGVyKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zaG93Q291bnRlcjtcbiAgICB9XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSB1c2VyIGhhcyBjaG9zZW4gYW4gaXRlbS4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBzZWxlY3QgPSBuZXcgRXZlbnRFbWl0dGVyPE5vZGVbXT4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIG5hdmlnYXRpb24gY2hhbmdlcy4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBuYXZpZ2F0aW9uQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxOb2RlRW50cnlFdmVudD4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIHNlbGVjdCBzaXRlIGNoYW5nZXMuICovXG4gICAgQE91dHB1dCgpXG4gICAgc2l0ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBzZWFyY2ggaXMgcnVubmluZy4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBzaG93aW5nU2VhcmNoID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBjdXJyZW50IGZvbGRlciBsb2FkZWQuICovXG4gICAgQE91dHB1dCgpXG4gICAgY3VycmVudEZvbGRlciA9IG5ldyBFdmVudEVtaXR0ZXI8Tm9kZT4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gZm9sZGVyIGxvYWRlZC4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBmb2xkZXJMb2FkZWQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICBAVmlld0NoaWxkKCdkb2N1bWVudExpc3QnLCB7IHN0YXRpYzogdHJ1ZSB9KVxuICAgIGRvY3VtZW50TGlzdDogRG9jdW1lbnRMaXN0Q29tcG9uZW50O1xuXG4gICAgQFZpZXdDaGlsZChIaWdobGlnaHREaXJlY3RpdmUsIHsgc3RhdGljOiB0cnVlIH0pXG4gICAgaGlnaGxpZ2h0ZXI6IEhpZ2hsaWdodERpcmVjdGl2ZTtcblxuICAgIG5vZGVQYWdpbmc6IE5vZGVQYWdpbmcgfCBudWxsID0gbnVsbDtcbiAgICBzaXRlSWQ6IG51bGwgfCBzdHJpbmc7XG4gICAgYnJlYWRjcnVtYlJvb3RJZDogbnVsbCB8IHN0cmluZztcbiAgICBzZWFyY2hUZXJtOiBzdHJpbmcgPSAnJztcbiAgICBzaG93aW5nU2VhcmNoUmVzdWx0czogYm9vbGVhbiA9IGZhbHNlO1xuICAgIGxvYWRpbmdTZWFyY2hSZXN1bHRzOiBib29sZWFuID0gZmFsc2U7XG4gICAgaW5EaWFsb2c6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBfY2hvc2VuTm9kZTogTm9kZVtdID0gbnVsbDtcbiAgICBzZWxlY3Rpb25XaXRob3V0VmFsaWRhdGlvbjogTm9kZVtdID0gbnVsbDtcbiAgICBmb2xkZXJJZFRvU2hvdzogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gICAgYnJlYWRjcnVtYkZvbGRlclRpdGxlOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgICBzdGFydFNpdGVHdWlkOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgICBoYXNWYWxpZFF1ZXJ5OiBib29sZWFuID0gZmFsc2U7XG4gICAgc2hvd0hlYWRlciA9IFNob3dIZWFkZXJNb2RlLk5ldmVyO1xuXG4gICAgQFZpZXdDaGlsZChJbmZpbml0ZVBhZ2luYXRpb25Db21wb25lbnQsIHsgc3RhdGljOiB0cnVlIH0pXG4gICAgaW5maW5pdGVQYWdpbmF0aW9uQ29tcG9uZW50OiBJbmZpbml0ZVBhZ2luYXRpb25Db21wb25lbnQ7XG5cbiAgICBpbmZpbml0ZVNjcm9sbDogYm9vbGVhbiA9IGZhbHNlO1xuICAgIGRlYm91bmNlU2VhcmNoOiBudW1iZXIgPSAyMDA7XG4gICAgc2VhcmNoSW5wdXQ6IEZvcm1Db250cm9sID0gbmV3IEZvcm1Db250cm9sKCk7XG5cbiAgICB0YXJnZXQ6IFBhZ2luYXRlZENvbXBvbmVudDtcbiAgICBwcmVzZWxlY3RlZE5vZGVzOiBOb2RlRW50cnlbXSA9IFtdO1xuICAgIGN1cnJlbnRVcGxvYWRCYXRjaDogTm9kZUVudHJ5W10gPSBbXTtcblxuICAgIHNvcnRpbmc6IHN0cmluZ1tdIHwgRGF0YVNvcnRpbmc7XG5cbiAgICBzZWFyY2hQYW5lbEV4cGFuZGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBwcml2YXRlIG9uRGVzdHJveSQgPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBjdXN0b21SZXNvdXJjZXNTZXJ2aWNlOiBDdXN0b21SZXNvdXJjZXNTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIEBJbmplY3QoU0VBUkNIX1FVRVJZX1NFUlZJQ0VfVE9LRU4pIHB1YmxpYyBxdWVyeUJ1aWxkZXJTZXJ2aWNlOiBTZWFyY2hRdWVyeUJ1aWxkZXJTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgdXNlclByZWZlcmVuY2VzU2VydmljZTogVXNlclByZWZlcmVuY2VzU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIG5vZGVzQXBpU2VydmljZTogTm9kZXNBcGlTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgdXBsb2FkU2VydmljZTogVXBsb2FkU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIHNpdGVzU2VydmljZTogU2l0ZXNTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYXBwQ29uZmlnU2VydmljZTogQXBwQ29uZmlnU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGNvbnRlbnROb2RlU2VsZWN0b3JQYW5lbFNlcnZpY2U6IENvbnRlbnROb2RlU2VsZWN0b3JQYW5lbFNlcnZpY2UpIHtcbiAgICB9XG5cbiAgICBzZXQgY2hvc2VuTm9kZSh2YWx1ZTogTm9kZVtdKSB7XG4gICAgICAgIHRoaXMuX2Nob3Nlbk5vZGUgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5zZWxlY3QubmV4dCh2YWx1ZSk7XG4gICAgfVxuXG4gICAgZ2V0IGNob3Nlbk5vZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jaG9zZW5Ob2RlO1xuICAgIH1cblxuICAgIGdldFNlbGVjdGVkQ291bnQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hvc2VuTm9kZT8ubGVuZ3RoIHx8IDA7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuc2VhcmNoSW5wdXQudmFsdWVDaGFuZ2VzXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBkZWJvdW5jZVRpbWUodGhpcy5kZWJvdW5jZVNlYXJjaCksXG4gICAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMub25EZXN0cm95JClcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHNlYXJjaFZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaFRlcm0gPSBzZWFyY2hWYWx1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlclNlcnZpY2UudXNlclF1ZXJ5ID0gc2VhcmNoVmFsdWUubGVuZ3RoID4gMCA/IGAke3NlYXJjaFZhbHVlfSpgIDogc2VhcmNoVmFsdWUgO1xuICAgICAgICAgICAgICAgIHRoaXMucXVlcnlCdWlsZGVyU2VydmljZS51cGRhdGUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMucXVlcnlCdWlsZGVyU2VydmljZS51cGRhdGVkXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHF1ZXJ5Qm9keTogUXVlcnlCb2R5KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHF1ZXJ5Qm9keSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhc1ZhbGlkUXVlcnkgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByZXBhcmVEaWFsb2dGb3JOZXdTZWFyY2gocXVlcnlCb2R5KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXJTZXJ2aWNlLmV4ZWN1dGUocXVlcnlCb2R5KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhc1ZhbGlkUXVlcnkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNldEZvbGRlclRvU2hvdygpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU2VhcmNoKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXJTZXJ2aWNlLmV4ZWN1dGVkXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHJlc3VsdHM6IE5vZGVQYWdpbmcpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNWYWxpZFF1ZXJ5KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1NlYXJjaFJlc3VsdHMocmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy51c2VyUHJlZmVyZW5jZXNTZXJ2aWNlXG4gICAgICAgICAgICAuc2VsZWN0KFVzZXJQcmVmZXJlbmNlVmFsdWVzLlBhZ2luYXRpb25TaXplKVxuICAgICAgICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMub25EZXN0cm95JCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKHBhZ1NpemUgPT4gdGhpcy5wYWdlU2l6ZSA9IHBhZ1NpemUpO1xuXG4gICAgICAgIHRoaXMudGFyZ2V0ID0gdGhpcy5kb2N1bWVudExpc3Q7XG4gICAgICAgIHRoaXMuZm9sZGVySWRUb1Nob3cgPSB0aGlzLmN1cnJlbnRGb2xkZXJJZDtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEZvbGRlcklkKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5yZXN0cmljdFJvb3RUb0N1cnJlbnRGb2xkZXJJZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYnJlYWRjcnVtYlJvb3RJZCA9IHRoaXMuY3VycmVudEZvbGRlcklkO1xuICAgICAgICAgICAgICAgIHRoaXMuc2l0ZUlkID0gdGhpcy5jdXJyZW50Rm9sZGVySWQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2V0U3RhcnRTaXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmJyZWFkY3J1bWJUcmFuc2Zvcm0gPSB0aGlzLmJyZWFkY3J1bWJUcmFuc2Zvcm0gPyB0aGlzLmJyZWFkY3J1bWJUcmFuc2Zvcm0gOiBudWxsO1xuICAgICAgICB0aGlzLmlzU2VsZWN0aW9uVmFsaWQgPSB0aGlzLmlzU2VsZWN0aW9uVmFsaWQgPyB0aGlzLmlzU2VsZWN0aW9uVmFsaWQgOiBkZWZhdWx0VmFsaWRhdGlvbjtcbiAgICAgICAgdGhpcy5vbkZpbGVVcGxvYWRFdmVudCgpO1xuICAgICAgICB0aGlzLm9uRmlsZVVwbG9hZERlbGV0ZWRFdmVudCgpO1xuICAgICAgICB0aGlzLnJlc2V0UGFnaW5hdGlvbigpO1xuICAgICAgICB0aGlzLnNldFNlYXJjaFNjb3BlVG9Ob2RlcygpO1xuXG4gICAgICAgIHRoaXMuZG9jdW1lbnRMaXN0LiRmb2xkZXJOb2RlXG4gICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpKVxuICAgICAgICAuc3Vic2NyaWJlKChjdXJyZW50Tm9kZTogTm9kZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50Rm9sZGVyLmVtaXQoY3VycmVudE5vZGUpO1xuICAgIH0pO1xuXG4gICAgICAgIHRoaXMuc29ydGluZyA9IHRoaXMuYXBwQ29uZmlnU2VydmljZS5nZXQoJ2FkZi1jb250ZW50LW5vZGUtc2VsZWN0b3Iuc29ydGluZycsIFsnY3JlYXRlZEF0JywgJ2Rlc2MnXSk7XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMub25EZXN0cm95JC5uZXh0KHRydWUpO1xuICAgICAgICB0aGlzLm9uRGVzdHJveSQuY29tcGxldGUoKTtcbiAgICB9XG5cbiAgICB0b2dnbGVTZWFyY2hQYW5lbCgpIHtcbiAgICAgICAgdGhpcy5zZWFyY2hQYW5lbEV4cGFuZGVkID0gIXRoaXMuc2VhcmNoUGFuZWxFeHBhbmRlZDtcbiAgICB9XG5cbiAgICBoYXNDdXN0b21Nb2RlbHMoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnRlbnROb2RlU2VsZWN0b3JQYW5lbFNlcnZpY2U/LmN1c3RvbU1vZGVscz8ubGVuZ3RoID4gMDtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uRmlsZVVwbG9hZEV2ZW50KCkge1xuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UuZmlsZVVwbG9hZENvbXBsZXRlXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBkZWJvdW5jZVRpbWUoNTAwKSxcbiAgICAgICAgICAgICAgICB0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgoZmlsZVVwbG9hZEV2ZW50OiBGaWxlVXBsb2FkQ29tcGxldGVFdmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFVwbG9hZEJhdGNoLnB1c2goZmlsZVVwbG9hZEV2ZW50LmRhdGEpO1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy51cGxvYWRTZXJ2aWNlLmlzVXBsb2FkaW5nKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmVzZWxlY3RlZE5vZGVzID0gdGhpcy5nZXRQcmVzZWxlY3ROb2Rlc0Jhc2VkT25TZWxlY3Rpb25Nb2RlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFVwbG9hZEJhdGNoID0gW107XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRMaXN0LnJlbG9hZFdpdGhvdXRSZXNldHRpbmdTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uRmlsZVVwbG9hZERlbGV0ZWRFdmVudCgpIHtcbiAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLmZpbGVVcGxvYWREZWxldGVkXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKGRlbGV0ZWRGaWxlRXZlbnQ6IEZpbGVVcGxvYWREZWxldGVFdmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRMaXN0LnVuc2VsZWN0Um93RnJvbU5vZGVJZChkZWxldGVkRmlsZUV2ZW50LmZpbGUuZGF0YS5lbnRyeS5pZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5kb2N1bWVudExpc3QucmVsb2FkV2l0aG91dFJlc2V0dGluZ1NlbGVjdGlvbigpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRTdGFydFNpdGUoKSB7XG4gICAgICAgIHRoaXMubm9kZXNBcGlTZXJ2aWNlLmdldE5vZGUodGhpcy5jdXJyZW50Rm9sZGVySWQpLnN1YnNjcmliZSgoc3RhcnROb2RlRW50cnkpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRTaXRlR3VpZCA9IHRoaXMuc2l0ZXNTZXJ2aWNlLmdldFNpdGVOYW1lRnJvbU5vZGVQYXRoKHN0YXJ0Tm9kZUVudHJ5KTtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXJ0U2l0ZUd1aWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNpdGVzU2VydmljZS5nZXRTaXRlKHRoaXMuc3RhcnRTaXRlR3VpZCkuc3Vic2NyaWJlKChzdGFydFNpdGVFbnRyeSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhcnRTaXRlRW50cnkgaW5zdGFuY2VvZiBTaXRlRW50cnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2l0ZUNoYW5nZS5lbWl0KHN0YXJ0U2l0ZUVudHJ5LmVudHJ5LnRpdGxlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNyZWF0ZVJvd0ZpbHRlcihmaWx0ZXI/OiBSb3dGaWx0ZXIpIHtcbiAgICAgICAgaWYgKCFmaWx0ZXIpIHtcbiAgICAgICAgICAgIGZpbHRlciA9ICgpID0+IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcm93RmlsdGVyID0gKHZhbHVlOiBTaGFyZURhdGFSb3csIGluZGV4OiBudW1iZXIsIGFycmF5OiBTaGFyZURhdGFSb3dbXSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGZpbHRlcih2YWx1ZSwgaW5kZXgsIGFycmF5KSAmJlxuICAgICAgICAgICAgICAgICF0aGlzLmlzRXhjbHVkZWRTaXRlQ29udGVudCh2YWx1ZSk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0V4Y2x1ZGVkU2l0ZUNvbnRlbnQocm93OiBTaGFyZURhdGFSb3cpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgZW50cnkgPSByb3cubm9kZS5lbnRyeTtcbiAgICAgICAgaWYgKHRoaXMuX2V4Y2x1ZGVTaXRlQ29udGVudCAmJiB0aGlzLl9leGNsdWRlU2l0ZUNvbnRlbnQubGVuZ3RoICYmXG4gICAgICAgICAgICBlbnRyeSAmJlxuICAgICAgICAgICAgZW50cnkucHJvcGVydGllcyAmJlxuICAgICAgICAgICAgZW50cnkucHJvcGVydGllc1snc3Q6Y29tcG9uZW50SWQnXSkge1xuICAgICAgICAgICAgY29uc3QgZXhjbHVkZWRJdGVtID0gdGhpcy5fZXhjbHVkZVNpdGVDb250ZW50LmZpbmQoXG4gICAgICAgICAgICAgICAgKGlkOiBzdHJpbmcpID0+IGVudHJ5LnByb3BlcnRpZXNbJ3N0OmNvbXBvbmVudElkJ10gPT09IGlkXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuICEhZXhjbHVkZWRJdGVtO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBzaXRlIGF0dHJpYnV0ZSBhbmQgc3RhcnRzIGEgbmV3IHNlYXJjaFxuICAgICAqXG4gICAgICogQHBhcmFtIGNob3NlblNpdGUgU2l0ZUVudHJ5IHRvIHNlYXJjaCB3aXRoaW5cbiAgICAgKi9cbiAgICBzaXRlQ2hhbmdlZChjaG9zZW5TaXRlOiBTaXRlRW50cnkpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zaXRlSWQgPSBjaG9zZW5TaXRlLmVudHJ5Lmd1aWQ7XG4gICAgICAgIHRoaXMuc2V0VGl0bGVJZkN1c3RvbVNpdGUoY2hvc2VuU2l0ZSk7XG4gICAgICAgIHRoaXMuc2l0ZUNoYW5nZS5lbWl0KGNob3NlblNpdGUuZW50cnkudGl0bGUpO1xuICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlclNlcnZpY2UudXBkYXRlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgYWN0dWFsbHkgc2VsZWN0ZWR8ZW50ZXJlZCBmb2xkZXIgbm9kZSBvciBudWxsIGluIGNhc2Ugb2Ygc2VhcmNoaW5nIGZvciB0aGUgYnJlYWRjcnVtYlxuICAgICAqL1xuICAgIGdldCBicmVhZGNydW1iRm9sZGVyTm9kZSgpOiBOb2RlIHwgbnVsbCB7XG4gICAgICAgIGxldCBmb2xkZXJOb2RlOiBOb2RlO1xuXG4gICAgICAgIGlmICh0aGlzLnNob3dpbmdTZWFyY2hSZXN1bHRzICYmIHRoaXMuc2VsZWN0aW9uV2l0aG91dFZhbGlkYXRpb24/Lmxlbmd0aCkge1xuICAgICAgICAgICAgZm9sZGVyTm9kZSA9IHRoaXMuc2VsZWN0aW9uV2l0aG91dFZhbGlkYXRpb25bMF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb2xkZXJOb2RlID0gdGhpcy5kb2N1bWVudExpc3QuZm9sZGVyTm9kZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmb2xkZXJOb2RlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFByZXBhcmVzIHRoZSBkaWFsb2cgZm9yIGEgbmV3IHNlYXJjaFxuICAgICAqL1xuICAgIHByZXBhcmVEaWFsb2dGb3JOZXdTZWFyY2gocXVlcnlCb2R5OiBRdWVyeUJvZHkpOiB2b2lkIHtcbiAgICAgICAgdGhpcy50YXJnZXQgPSBxdWVyeUJvZHkgPyBudWxsIDogdGhpcy5kb2N1bWVudExpc3Q7XG4gICAgICAgIGlmICh0aGlzLnRhcmdldCkge1xuICAgICAgICAgICAgdGhpcy5pbmZpbml0ZVBhZ2luYXRpb25Db21wb25lbnQucmVzZXQoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZvbGRlcklkVG9TaG93ID0gbnVsbDtcbiAgICAgICAgdGhpcy5wcmVzZWxlY3RlZE5vZGVzID0gW107XG4gICAgICAgIHRoaXMubG9hZGluZ1NlYXJjaFJlc3VsdHMgPSB0cnVlO1xuICAgICAgICB0aGlzLmFkZENvcnJlc3BvbmRpbmdOb2RlSWRzUXVlcnkoKTtcbiAgICAgICAgdGhpcy5yZXNldENob3Nlbk5vZGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbGVhciB0aGUgc2VhcmNoIGlucHV0IGFuZCByZXNldCB0byBsYXN0IGZvbGRlciBub2RlIGluIHdoaWNoIHNlYXJjaCB3YXMgcGVyZm9ybWVkXG4gICAgICovXG4gICAgY2xlYXIoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2VhcmNoVGVybSA9ICcnO1xuICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlclNlcnZpY2UudXNlclF1ZXJ5ID0gJyc7XG4gICAgICAgIHRoaXMucXVlcnlCdWlsZGVyU2VydmljZS51cGRhdGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXNldHMgdGhlIGZvbGRlciB0byBiZSBzaG93biB3aXRoIHRoZSBzaXRlIHNlbGVjdGlvbiBvciB0aGUgaW5pdGlhbCBsYW5kaW5nIGZvbGRlclxuICAgICAqL1xuICAgIHJlc2V0Rm9sZGVyVG9TaG93KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmZvbGRlcklkVG9TaG93ID0gdGhpcy5zaXRlSWQgfHwgdGhpcy5jdXJyZW50Rm9sZGVySWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xlYXIgdGhlIHNlYXJjaCBpbnB1dCBhbmQgc2VhcmNoIHJlbGF0ZWQgZGF0YVxuICAgICAqL1xuICAgIGNsZWFyU2VhcmNoKCkge1xuICAgICAgICB0aGlzLnNlYXJjaFRlcm0gPSAnJztcbiAgICAgICAgdGhpcy5ub2RlUGFnaW5nID0gbnVsbDtcbiAgICAgICAgdGhpcy5yZXNldFBhZ2luYXRpb24oKTtcbiAgICAgICAgdGhpcy5yZXNldENob3Nlbk5vZGUoKTtcbiAgICAgICAgdGhpcy5zaG93aW5nU2VhcmNoUmVzdWx0cyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNob3dpbmdTZWFyY2guZW1pdCh0aGlzLnNob3dpbmdTZWFyY2hSZXN1bHRzKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFkZENvcnJlc3BvbmRpbmdOb2RlSWRzUXVlcnkoKSB7XG4gICAgICAgIGxldCBleHRyYVBhcmVudEZpbHRlcmluZyA9ICcnO1xuXG4gICAgICAgIGlmICh0aGlzLmN1c3RvbVJlc291cmNlc1NlcnZpY2UuaGFzQ29ycmVzcG9uZGluZ05vZGVJZHModGhpcy5zaXRlSWQpKSB7XG4gICAgICAgICAgICB0aGlzLmN1c3RvbVJlc291cmNlc1NlcnZpY2UuZ2V0Q29ycmVzcG9uZGluZ05vZGVJZHModGhpcy5zaXRlSWQpXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZSgobm9kZUlkcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZUlkcyAmJiBub2RlSWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZUlkc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKGlkKSA9PiBpZCAhPT0gdGhpcy5zaXRlSWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goKGV4dHJhSWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFQYXJlbnRGaWx0ZXJpbmcgKz0gYCBPUiBBTkNFU1RPUjond29ya3NwYWNlOi8vU3BhY2VzU3RvcmUvJHtleHRyYUlkfSdgO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudEZpbHRlcmluZyA9IHRoaXMuc2l0ZUlkID8gYEFOQ0VTVE9SOid3b3Jrc3BhY2U6Ly9TcGFjZXNTdG9yZS8ke3RoaXMuc2l0ZUlkfScke2V4dHJhUGFyZW50RmlsdGVyaW5nfWAgOiAnJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXJTZXJ2aWNlLmFkZEZpbHRlclF1ZXJ5KHBhcmVudEZpbHRlcmluZyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBwYXJlbnRGaWx0ZXJpbmcgPSB0aGlzLnNpdGVJZCA/IGBBTkNFU1RPUjond29ya3NwYWNlOi8vU3BhY2VzU3RvcmUvJHt0aGlzLnNpdGVJZH0nYCA6ICcnO1xuICAgICAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXJTZXJ2aWNlLmFkZEZpbHRlclF1ZXJ5KHBhcmVudEZpbHRlcmluZyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHNldFNlYXJjaFNjb3BlVG9Ob2RlcygpIHtcbiAgICAgICAgY29uc3Qgc2NvcGU6IFJlcXVlc3RTY29wZSA9IHtcbiAgICAgICAgICAgIGxvY2F0aW9uczogJ25vZGVzJ1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlclNlcnZpY2Uuc2V0U2NvcGUoc2NvcGUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNob3cgdGhlIHJlc3VsdHMgb2YgdGhlIHNlYXJjaFxuICAgICAqXG4gICAgICogQHBhcmFtIHJlc3VsdHMgU2VhcmNoIHJlc3VsdHNcbiAgICAgKi9cbiAgICBwcml2YXRlIHNob3dTZWFyY2hSZXN1bHRzKHJlc3VsdHM6IE5vZGVQYWdpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zaG93aW5nU2VhcmNoUmVzdWx0cyA9IHRydWU7XG4gICAgICAgIHRoaXMubG9hZGluZ1NlYXJjaFJlc3VsdHMgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zaG93aW5nU2VhcmNoLmVtaXQodGhpcy5zaG93aW5nU2VhcmNoUmVzdWx0cyk7XG5cbiAgICAgICAgdGhpcy5ub2RlUGFnaW5nID0gcmVzdWx0cztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHNob3dpbmdTZWFyY2hSZXN1bHRzIHN0YXRlIHRvIGJlIGFibGUgdG8gZGlmZmVyZW50aWF0ZSBiZXR3ZWVuIHNlYXJjaCByZXN1bHRzIG9yIGZvbGRlciByZXN1bHRzXG4gICAgICovXG4gICAgb25Gb2xkZXJDaGFuZ2UoJGV2ZW50OiBOb2RlRW50cnlFdmVudCk6IHZvaWQge1xuICAgICAgICB0aGlzLmZvbGRlcklkVG9TaG93ID0gJGV2ZW50LnZhbHVlLmlkO1xuICAgICAgICB0aGlzLnNob3dpbmdTZWFyY2hSZXN1bHRzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaW5maW5pdGVTY3JvbGwgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5icmVhZGNydW1iRm9sZGVyVGl0bGUgPSBudWxsO1xuICAgICAgICB0aGlzLnByZXNlbGVjdGVkTm9kZXMgPSBbXTtcbiAgICAgICAgdGhpcy5jbGVhclNlYXJjaCgpO1xuICAgICAgICB0aGlzLm5hdmlnYXRpb25DaGFuZ2UuZW1pdCgkZXZlbnQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEF0dGVtcHRzIHRvIHNldCB0aGUgY3VycmVudGx5IGxvYWRlZCBub2RlXG4gICAgICovXG4gICAgb25Gb2xkZXJMb2FkZWQobm9kZVBhZ2luZzogTm9kZVBhZ2luZyk6IHZvaWQge1xuICAgICAgICB0aGlzLnVwZGF0ZVBhZ2luYXRpb25BZnRlclJvd0ZpbHRlcihub2RlUGFnaW5nKTtcbiAgICAgICAgaWYgKCF0aGlzLnNob3dpbmdTZWFyY2hSZXN1bHRzKSB7XG4gICAgICAgICAgICB0aGlzLmF0dGVtcHROb2RlU2VsZWN0aW9uKHRoaXMuZG9jdW1lbnRMaXN0LmZvbGRlck5vZGUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZm9sZGVyTG9hZGVkLmVtaXQoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHBhZ2luYXRpb24uaGFzTW9yZUl0ZW1zIHRvIGZhbHNlIGFmdGVyIGZpbHRlcmluZyBvbmx5IGZvbGRlcnMgZHVyaW5nICdDT1BZJyBhbmQgJ01PVkUnIGFjdGlvblxuICAgICAqL1xuICAgIHVwZGF0ZVBhZ2luYXRpb25BZnRlclJvd0ZpbHRlcihub2RlUGFnaW5nOiBOb2RlUGFnaW5nKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmRvY3VtZW50TGlzdC5kYXRhLmdldFJvd3MoKS5sZW5ndGggPCBub2RlUGFnaW5nLmxpc3QucGFnaW5hdGlvbi5tYXhJdGVtcykge1xuICAgICAgICAgICAgbm9kZVBhZ2luZy5saXN0LnBhZ2luYXRpb24uaGFzTW9yZUl0ZW1zID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgYnJlYWRjcnVtYiBoYXMgdG8gYmUgc2hvd24gb3Igbm90XG4gICAgICovXG4gICAgc2hvd0JyZWFkY3J1bWJzKCkge1xuICAgICAgICByZXR1cm4gIXRoaXMuc2hvd2luZ1NlYXJjaFJlc3VsdHMgfHwgdGhpcy5jaG9zZW5Ob2RlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExvYWRzIHRoZSBuZXh0IGJhdGNoIG9mIHNlYXJjaCByZXN1bHRzXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGFnaW5hdGlvbiBQYWdpbmF0aW9uIG9iamVjdFxuICAgICAqL1xuICAgIGdldE5leHRQYWdlT2ZTZWFyY2gocGFnaW5hdGlvbjogUGFnaW5hdGlvbik6IHZvaWQge1xuICAgICAgICB0aGlzLmluZmluaXRlU2Nyb2xsID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXJTZXJ2aWNlLnBhZ2luZy5tYXhJdGVtcyA9IHBhZ2luYXRpb24ubWF4SXRlbXM7XG4gICAgICAgIHRoaXMucXVlcnlCdWlsZGVyU2VydmljZS5wYWdpbmcuc2tpcENvdW50ID0gcGFnaW5hdGlvbi5za2lwQ291bnQ7XG5cbiAgICAgICAgaWYgKHRoaXMuc2VhcmNoVGVybS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlclNlcnZpY2UudXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWxlY3RzIG5vZGUgYXMgY2hvc2VuIGlmIGl0IGhhcyB0aGUgcmlnaHQgcGVybWlzc2lvbiwgY2xlYXJzIHRoZSBzZWxlY3Rpb24gb3RoZXJ3aXNlXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZW50cnlcbiAgICAgKi9cbiAgICBwcml2YXRlIGF0dGVtcHROb2RlU2VsZWN0aW9uKGVudHJ5OiBOb2RlKTogdm9pZCB7XG4gICAgICAgIGlmIChlbnRyeSAmJiB0aGlzLmlzU2VsZWN0aW9uVmFsaWQoZW50cnkpKSB7XG4gICAgICAgICAgICB0aGlzLmNob3Nlbk5vZGUgPSBbZW50cnldO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xlYXJzIHRoZSBjaG9zZW4gbm9kZVxuICAgICAqL1xuICAgIHJlc2V0Q2hvc2VuTm9kZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jaG9zZW5Ob2RlID0gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJdCBmaWx0ZXJzIGFuZCBlbWl0IHRoZSBzZWxlY3Rpb24gY29taW5nIGZyb20gdGhlIGRvY3VtZW50IGxpc3RcbiAgICAgKlxuICAgICAqIEBwYXJhbSBub2Rlc0VudHJpZXNcbiAgICAgKi9cbiAgICBvbkN1cnJlbnRTZWxlY3Rpb24obm9kZXNFbnRyaWVzOiBOb2RlRW50cnlbXSk6IHZvaWQge1xuICAgICAgICBjb25zdCB2YWxpZE5vZGVzRW50aXR5ID0gbm9kZXNFbnRyaWVzLmZpbHRlcigobm9kZSkgPT4gdGhpcy5pc1NlbGVjdGlvblZhbGlkKG5vZGUuZW50cnkpKTtcbiAgICAgICAgdGhpcy5jaG9zZW5Ob2RlID0gdmFsaWROb2Rlc0VudGl0eS5tYXAoKG5vZGUpID0+IG5vZGUuZW50cnkpO1xuICAgICAgICB0aGlzLnNlbGVjdGlvbldpdGhvdXRWYWxpZGF0aW9uID0gbm9kZXNFbnRyaWVzLm1hcChub2RlID0+IG5vZGUuZW50cnkpO1xuICAgIH1cblxuICAgIHNldFRpdGxlSWZDdXN0b21TaXRlKHNpdGU6IFNpdGVFbnRyeSkge1xuICAgICAgICBpZiAodGhpcy5jdXN0b21SZXNvdXJjZXNTZXJ2aWNlLmlzQ3VzdG9tU291cmNlKHNpdGUuZW50cnkuZ3VpZCkpIHtcbiAgICAgICAgICAgIHRoaXMuYnJlYWRjcnVtYkZvbGRlclRpdGxlID0gc2l0ZS5lbnRyeS50aXRsZTtcbiAgICAgICAgICAgIGlmICh0aGlzLmRvY3VtZW50TGlzdC5mb2xkZXJOb2RlLnBhdGguZWxlbWVudHMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJyZWFkY3J1bWJGb2xkZXJOb2RlLm5hbWUgPSBzaXRlLmVudHJ5LnRpdGxlO1xuICAgICAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRMaXN0LmZvbGRlck5vZGUucGF0aC5lbGVtZW50cyA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmJyZWFkY3J1bWJGb2xkZXJUaXRsZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBoYXNQcmVzZWxlY3ROb2RlcygpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJlc2VsZWN0ZWROb2Rlcz8ubGVuZ3RoID4gMDtcbiAgICB9XG5cbiAgICBpc1NpbmdsZVNlbGVjdGlvbk1vZGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbk1vZGUgPT09ICdzaW5nbGUnO1xuICAgIH1cblxuICAgIGdldFByZXNlbGVjdE5vZGVzQmFzZWRPblNlbGVjdGlvbk1vZGUoKTogTm9kZUVudHJ5W10ge1xuICAgICAgICBsZXQgc2VsZWN0ZWROb2RlczogTm9kZUVudHJ5W10gPSBbXTtcblxuICAgICAgICBpZiAodGhpcy5jdXJyZW50VXBsb2FkQmF0Y2g/Lmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNTaW5nbGVTZWxlY3Rpb25Nb2RlKCkpIHtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZE5vZGVzID0gW3RoaXMuY3VycmVudFVwbG9hZEJhdGNoW3RoaXMuY3VycmVudFVwbG9hZEJhdGNoLmxlbmd0aCAtIDFdXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWROb2RlcyA9IHRoaXMuY3VycmVudFVwbG9hZEJhdGNoO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNlbGVjdGVkTm9kZXM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZXNldFBhZ2luYXRpb24oKTogdm9pZCB7XG4gICAgICAgIHRoaXMucXVlcnlCdWlsZGVyU2VydmljZS5wYWdpbmcgPSB7XG4gICAgICAgICAgICBtYXhJdGVtczogdGhpcy5wYWdlU2l6ZSxcbiAgICAgICAgICAgIHNraXBDb3VudDogdGhpcy5ERUZBVUxUX1BBR0lOQVRJT04uc2tpcENvdW50XG4gICAgICAgIH07XG4gICAgfVxufVxuIl19