/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, Input, ViewEncapsulation } from '@angular/core';
import { Node } from '@alfresco/js-api';
import { Subject, of, zip } from 'rxjs';
import { NodesApiService, LogService, CardViewUpdateService, AlfrescoApiService, TranslationService, AppConfigService } from '@alfresco/adf-core';
import { ContentMetadataService } from '../../services/content-metadata.service';
import { takeUntil, debounceTime, catchError, map } from 'rxjs/operators';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../../services/content-metadata.service';
import * as ɵngcc2 from '@alfresco/adf-core';
import * as ɵngcc3 from '@angular/material/expansion';
import * as ɵngcc4 from '@angular/common';
import * as ɵngcc5 from '@angular/material/progress-bar';
import * as ɵngcc6 from '@angular/material/button';
import * as ɵngcc7 from '@ngx-translate/core';

function ContentMetadataComponent_mat_expansion_panel_2_Template(rf, ctx) { if (rf & 1) {
    const _r4 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "mat-expansion-panel", 5);
    ɵngcc0.ɵɵelementStart(1, "mat-expansion-panel-header");
    ɵngcc0.ɵɵelementStart(2, "mat-panel-title", 6);
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "adf-card-view", 7);
    ɵngcc0.ɵɵlistener("keydown", function ContentMetadataComponent_mat_expansion_panel_2_Template_adf_card_view_keydown_5_listener($event) { ɵngcc0.ɵɵrestoreView(_r4); const ctx_r3 = ɵngcc0.ɵɵnextContext(); return ctx_r3.keyDown($event); });
    ɵngcc0.ɵɵpipe(6, "async");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("expanded", ctx_r0.canExpandProperties());
    ɵngcc0.ɵɵattribute("data-automation-id", "adf-metadata-group-properties");
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(4, 9, "CORE.METADATA.BASIC.HEADER"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("properties", ɵngcc0.ɵɵpipeBind1(6, 11, ctx_r0.basicProperties$))("editable", ctx_r0.editable)("displayEmpty", ctx_r0.displayEmpty)("copyToClipboardAction", ctx_r0.copyToClipboardAction)("useChipsForMultiValueProperty", ctx_r0.useChipsForMultiValueProperty)("multiValueSeparator", ctx_r0.multiValueSeparator);
} }
function ContentMetadataComponent_ng_container_3_ng_container_1_div_1_mat_expansion_panel_1_Template(rf, ctx) { if (rf & 1) {
    const _r14 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "mat-expansion-panel", 5);
    ɵngcc0.ɵɵelementStart(1, "mat-expansion-panel-header");
    ɵngcc0.ɵɵelementStart(2, "mat-panel-title");
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "adf-card-view", 7);
    ɵngcc0.ɵɵlistener("keydown", function ContentMetadataComponent_ng_container_3_ng_container_1_div_1_mat_expansion_panel_1_Template_adf_card_view_keydown_5_listener($event) { ɵngcc0.ɵɵrestoreView(_r14); const ctx_r13 = ɵngcc0.ɵɵnextContext(4); return ctx_r13.keyDown($event); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r15 = ɵngcc0.ɵɵnextContext();
    const group_r10 = ctx_r15.$implicit;
    const first_r11 = ctx_r15.first;
    const ctx_r12 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵproperty("expanded", ctx_r12.canExpandTheCard(group_r10) || !ctx_r12.displayDefaultProperties && first_r11);
    ɵngcc0.ɵɵattribute("data-automation-id", "adf-metadata-group-" + group_r10.title);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(4, 9, group_r10.title), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("properties", group_r10.properties)("editable", ctx_r12.editable)("displayEmpty", ctx_r12.displayEmpty)("copyToClipboardAction", ctx_r12.copyToClipboardAction)("useChipsForMultiValueProperty", ctx_r12.useChipsForMultiValueProperty)("multiValueSeparator", ctx_r12.multiValueSeparator);
} }
function ContentMetadataComponent_ng_container_3_ng_container_1_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 11);
    ɵngcc0.ɵɵtemplate(1, ContentMetadataComponent_ng_container_3_ng_container_1_div_1_mat_expansion_panel_1_Template, 6, 11, "mat-expansion-panel", 2);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const group_r10 = ctx.$implicit;
    const ctx_r9 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r9.showGroup(group_r10) || ctx_r9.editable);
} }
function ContentMetadataComponent_ng_container_3_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, ContentMetadataComponent_ng_container_3_ng_container_1_div_1_Template, 2, 1, "div", 10);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const groupedProperties_r8 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", groupedProperties_r8);
} }
function ContentMetadataComponent_ng_container_3_ng_template_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "mat-progress-bar", 12);
} }
function ContentMetadataComponent_ng_container_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, ContentMetadataComponent_ng_container_3_ng_container_1_Template, 2, 1, "ng-container", 8);
    ɵngcc0.ɵɵpipe(2, "async");
    ɵngcc0.ɵɵtemplate(3, ContentMetadataComponent_ng_container_3_ng_template_3_Template, 1, 0, "ng-template", null, 9, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const _r6 = ɵngcc0.ɵɵreference(4);
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ɵngcc0.ɵɵpipeBind1(2, 2, ctx_r1.groupedProperties$))("ngIfElse", _r6);
} }
function ContentMetadataComponent_div_4_Template(rf, ctx) { if (rf & 1) {
    const _r17 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 13);
    ɵngcc0.ɵɵelementStart(1, "button", 14);
    ɵngcc0.ɵɵlistener("click", function ContentMetadataComponent_div_4_Template_button_click_1_listener() { ɵngcc0.ɵɵrestoreView(_r17); const ctx_r16 = ɵngcc0.ɵɵnextContext(); return ctx_r16.cancelChanges(); });
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "button", 15);
    ɵngcc0.ɵɵlistener("click", function ContentMetadataComponent_div_4_Template_button_click_4_listener() { ɵngcc0.ɵɵrestoreView(_r17); const ctx_r18 = ɵngcc0.ɵɵnextContext(); return ctx_r18.saveChanges(); });
    ɵngcc0.ɵɵtext(5);
    ɵngcc0.ɵɵpipe(6, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("disabled", !ctx_r2.hasMetadataChanged);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 4, "CORE.METADATA.ACTIONS.CANCEL"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("disabled", !ctx_r2.hasMetadataChanged);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(6, 6, "CORE.METADATA.ACTIONS.SAVE"), " ");
} }
export class ContentMetadataComponent {
    constructor(contentMetadataService, cardViewUpdateService, nodesApiService, logService, alfrescoApiService, translationService, appConfig) {
        this.contentMetadataService = contentMetadataService;
        this.cardViewUpdateService = cardViewUpdateService;
        this.nodesApiService = nodesApiService;
        this.logService = logService;
        this.alfrescoApiService = alfrescoApiService;
        this.translationService = translationService;
        this.appConfig = appConfig;
        this.onDestroy$ = new Subject();
        this.editable = false;
        this.displayEmpty = false;
        this.expanded = false;
        this.multi = false;
        this.displayDefaultProperties = true;
        this.displayAspect = null;
        this.copyToClipboardAction = true;
        this.useChipsForMultiValueProperty = true;
        this.changedProperties = {};
        this.hasMetadataChanged = false;
        this.copyToClipboardAction = this.appConfig.get('content-metadata.copy-to-clipboard-action');
        this.multiValueSeparator = this.appConfig.get('content-metadata.multi-value-pipe-separator') || ContentMetadataComponent.DEFAULT_SEPARATOR;
        this.useChipsForMultiValueProperty = this.appConfig.get('content-metadata.multi-value-chips');
    }
    ngOnInit() {
        this.cardViewUpdateService.itemUpdated$
            .pipe(debounceTime(500), takeUntil(this.onDestroy$))
            .subscribe((updatedNode) => {
            this.hasMetadataChanged = true;
            this.targetProperty = updatedNode.target;
            this.updateChanges(updatedNode.changed);
        });
        this.cardViewUpdateService.updatedAspect$.pipe(debounceTime(500), takeUntil(this.onDestroy$))
            .subscribe((node) => this.loadProperties(node));
        this.loadProperties(this.node);
    }
    handleUpdateError(error) {
        this.logService.error(error);
        let statusCode = 0;
        try {
            statusCode = JSON.parse(error.message).error.statusCode;
        }
        catch (_a) {
        }
        let message = `METADATA.ERRORS.${statusCode}`;
        if (this.translationService.instant(message) === message) {
            message = 'METADATA.ERRORS.GENERIC';
        }
        this.contentMetadataService.error.next({
            statusCode,
            message
        });
    }
    ngOnChanges(changes) {
        if (changes.node && !changes.node.firstChange) {
            this.loadProperties(changes.node.currentValue);
        }
    }
    loadProperties(node) {
        if (node) {
            this.basicProperties$ = this.getProperties(node);
            this.groupedProperties$ = this.contentMetadataService.getGroupedProperties(node, this.preset);
        }
    }
    getProperties(node) {
        const properties$ = this.contentMetadataService.getBasicProperties(node);
        const contentTypeProperty$ = this.contentMetadataService.getContentTypeProperty(node);
        return zip(properties$, contentTypeProperty$)
            .pipe(map(([properties, contentTypeProperty]) => {
            const filteredProperties = contentTypeProperty.filter((property) => properties.findIndex((baseProperty) => baseProperty.key === property.key) === -1);
            return [...properties, ...filteredProperties];
        }));
    }
    updateChanges(updatedNodeChanges) {
        Object.keys(updatedNodeChanges).map((propertyGroup) => {
            if (typeof updatedNodeChanges[propertyGroup] === 'object') {
                this.changedProperties[propertyGroup] = Object.assign(Object.assign({}, this.changedProperties[propertyGroup]), updatedNodeChanges[propertyGroup]);
            }
            else {
                this.changedProperties[propertyGroup] = updatedNodeChanges[propertyGroup];
            }
        });
    }
    saveChanges() {
        if (this.hasContentTypeChanged(this.changedProperties)) {
            this.contentMetadataService.openConfirmDialog(this.changedProperties).subscribe(() => {
                this.updateNode();
            });
        }
        else {
            this.updateNode();
        }
    }
    updateNode() {
        this.nodesApiService.updateNode(this.node.id, this.changedProperties).pipe(catchError((err) => {
            this.cardViewUpdateService.updateElement(this.targetProperty);
            this.handleUpdateError(err);
            return of(null);
        }))
            .subscribe((updatedNode) => {
            if (updatedNode) {
                if (this.hasContentTypeChanged(this.changedProperties)) {
                    this.cardViewUpdateService.updateNodeAspect(this.node);
                }
                this.revertChanges();
                Object.assign(this.node, updatedNode);
                this.alfrescoApiService.nodeUpdated.next(this.node);
            }
        });
    }
    hasContentTypeChanged(changedProperties) {
        return !!(changedProperties === null || changedProperties === void 0 ? void 0 : changedProperties.nodeType);
    }
    revertChanges() {
        this.changedProperties = {};
        this.hasMetadataChanged = false;
    }
    cancelChanges() {
        this.revertChanges();
        this.loadProperties(this.node);
    }
    showGroup(group) {
        const properties = group.properties.filter((property) => {
            return !this.isEmpty(property.displayValue);
        });
        return properties.length > 0;
    }
    ngOnDestroy() {
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
    canExpandTheCard(group) {
        return group.title === this.displayAspect;
    }
    canExpandProperties() {
        return !this.expanded || this.displayAspect === 'Properties';
    }
    keyDown(event) {
        if (event.keyCode === 37 || event.keyCode === 39) {
            event.stopPropagation();
        }
    }
    isEmpty(value) {
        return value === undefined || value === null || value === '';
    }
}
ContentMetadataComponent.ɵfac = function ContentMetadataComponent_Factory(t) { return new (t || ContentMetadataComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ContentMetadataService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.CardViewUpdateService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.NodesApiService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LogService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.AlfrescoApiService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.TranslationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.AppConfigService)); };
ContentMetadataComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ContentMetadataComponent, selectors: [["adf-content-metadata"]], hostAttrs: [1, "adf-content-metadata"], inputs: { editable: "editable", displayEmpty: "displayEmpty", expanded: "expanded", multi: "multi", displayDefaultProperties: "displayDefaultProperties", displayAspect: "displayAspect", copyToClipboardAction: "copyToClipboardAction", useChipsForMultiValueProperty: "useChipsForMultiValueProperty", node: "node", preset: "preset" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 5, vars: 4, consts: [[1, "adf-metadata-properties"], ["displayMode", "flat", 3, "multi"], [3, "expanded", 4, "ngIf"], [4, "ngIf"], ["class", "adf-metadata-action-buttons", 4, "ngIf"], [3, "expanded"], ["role", "heading"], [3, "properties", "editable", "displayEmpty", "copyToClipboardAction", "useChipsForMultiValueProperty", "multiValueSeparator", "keydown"], [4, "ngIf", "ngIfElse"], ["loading", ""], ["class", "adf-metadata-grouped-properties-container", 4, "ngFor", "ngForOf"], [1, "adf-metadata-grouped-properties-container"], ["mode", "indeterminate"], [1, "adf-metadata-action-buttons"], ["mat-button", "", "data-automation-id", "reset-metadata", 3, "disabled", "click"], ["mat-raised-button", "", "color", "primary", "data-automation-id", "save-metadata", 3, "disabled", "click"]], template: function ContentMetadataComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "mat-accordion", 1);
        ɵngcc0.ɵɵtemplate(2, ContentMetadataComponent_mat_expansion_panel_2_Template, 7, 13, "mat-expansion-panel", 2);
        ɵngcc0.ɵɵtemplate(3, ContentMetadataComponent_ng_container_3_Template, 5, 4, "ng-container", 3);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(4, ContentMetadataComponent_div_4_Template, 7, 8, "div", 4);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("multi", ctx.multi);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.displayDefaultProperties);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.expanded);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.editable);
    } }, directives: [ɵngcc3.MatAccordion, ɵngcc4.NgIf, ɵngcc3.MatExpansionPanel, ɵngcc3.MatExpansionPanelHeader, ɵngcc3.MatExpansionPanelTitle, ɵngcc2.CardViewComponent, ɵngcc4.NgForOf, ɵngcc5.MatProgressBar, ɵngcc6.MatButton], pipes: [ɵngcc7.TranslatePipe, ɵngcc4.AsyncPipe], styles: [".adf-metadata-properties .mat-expansion-panel-header.mat-expanded:focus,.adf-metadata-properties .mat-expansion-panel-header.mat-expanded:hover{background:var(--theme-bg-hover-color)}.adf-metadata-properties mat-expansion-panel-header{height:64px}.adf-metadata-properties .mat-expansion-panel:not([class*=mat-elevation-z]){box-shadow:none}.adf-metadata-action-buttons{display:flex;justify-content:space-evenly;margin:10px}"], encapsulation: 2 });
ContentMetadataComponent.DEFAULT_SEPARATOR = ', ';
ContentMetadataComponent.ctorParameters = () => [
    { type: ContentMetadataService },
    { type: CardViewUpdateService },
    { type: NodesApiService },
    { type: LogService },
    { type: AlfrescoApiService },
    { type: TranslationService },
    { type: AppConfigService }
];
ContentMetadataComponent.propDecorators = {
    node: [{ type: Input }],
    editable: [{ type: Input }],
    displayEmpty: [{ type: Input }],
    expanded: [{ type: Input }],
    multi: [{ type: Input }],
    preset: [{ type: Input }],
    displayDefaultProperties: [{ type: Input }],
    displayAspect: [{ type: Input }],
    copyToClipboardAction: [{ type: Input }],
    useChipsForMultiValueProperty: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ContentMetadataComponent, [{
        type: Component,
        args: [{
                selector: 'adf-content-metadata',
                template: "<div class=\"adf-metadata-properties\">\n    <mat-accordion displayMode=\"flat\"\n                   [multi]=\"multi\">\n        <mat-expansion-panel *ngIf=\"displayDefaultProperties\"\n                             [expanded]=\"canExpandProperties()\"\n                             [attr.data-automation-id]=\"'adf-metadata-group-properties'\">\n            <mat-expansion-panel-header>\n                <mat-panel-title role=\"heading\">\n                    {{ 'CORE.METADATA.BASIC.HEADER' | translate }}\n                </mat-panel-title>\n            </mat-expansion-panel-header>\n            <adf-card-view\n                (keydown)=\"keyDown($event)\"\n                [properties]=\"basicProperties$ | async\"\n                [editable]=\"editable\"\n                [displayEmpty]=\"displayEmpty\"\n                [copyToClipboardAction]=\"copyToClipboardAction\"\n                [useChipsForMultiValueProperty]=\"useChipsForMultiValueProperty\"\n                [multiValueSeparator]=\"multiValueSeparator\">\n            </adf-card-view>\n        </mat-expansion-panel>\n\n        <ng-container *ngIf=\"expanded\">\n            <ng-container *ngIf=\"groupedProperties$ | async; else loading; let groupedProperties\">\n                <div *ngFor=\"let group of groupedProperties; let first = first;\"\n                     class=\"adf-metadata-grouped-properties-container\">\n                    <mat-expansion-panel *ngIf=\"showGroup(group) || editable\"\n                                         [attr.data-automation-id]=\"'adf-metadata-group-' + group.title\"\n                                         [expanded]=\"canExpandTheCard(group) || !displayDefaultProperties && first\">\n                        <mat-expansion-panel-header>\n                            <mat-panel-title>\n                                {{ group.title | translate }}\n                            </mat-panel-title>\n                        </mat-expansion-panel-header>\n\n                        <adf-card-view\n                            (keydown)=\"keyDown($event)\"\n                            [properties]=\"group.properties\"\n                            [editable]=\"editable\"\n                            [displayEmpty]=\"displayEmpty\"\n                            [copyToClipboardAction]=\"copyToClipboardAction\"\n                            [useChipsForMultiValueProperty]=\"useChipsForMultiValueProperty\"\n                            [multiValueSeparator]=\"multiValueSeparator\">\n                        </adf-card-view>\n                    </mat-expansion-panel>\n\n                </div>\n            </ng-container>\n            <ng-template #loading>\n                <mat-progress-bar mode=\"indeterminate\"></mat-progress-bar>\n            </ng-template>\n        </ng-container>\n    </mat-accordion>\n\n    <div class=\"adf-metadata-action-buttons\"\n         *ngIf=\"editable\">\n        <button mat-button\n                (click)=\"cancelChanges()\"\n                data-automation-id=\"reset-metadata\"\n                [disabled]=\"!hasMetadataChanged\">\n                {{ 'CORE.METADATA.ACTIONS.CANCEL' | translate }}\n        </button>\n        <button mat-raised-button\n                (click)=\"saveChanges()\"\n                color=\"primary\"\n                data-automation-id=\"save-metadata\"\n                [disabled]=\"!hasMetadataChanged\">\n                {{ 'CORE.METADATA.ACTIONS.SAVE' | translate }}\n            </button>\n    </div>\n\n</div>\n",
                host: { 'class': 'adf-content-metadata' },
                encapsulation: ViewEncapsulation.None,
                styles: [".adf-metadata-properties .mat-expansion-panel-header.mat-expanded:focus,.adf-metadata-properties .mat-expansion-panel-header.mat-expanded:hover{background:var(--theme-bg-hover-color)}.adf-metadata-properties mat-expansion-panel-header{height:64px}.adf-metadata-properties .mat-expansion-panel:not([class*=mat-elevation-z]){box-shadow:none}.adf-metadata-action-buttons{display:flex;justify-content:space-evenly;margin:10px}"]
            }]
    }], function () { return [{ type: ɵngcc1.ContentMetadataService }, { type: ɵngcc2.CardViewUpdateService }, { type: ɵngcc2.NodesApiService }, { type: ɵngcc2.LogService }, { type: ɵngcc2.AlfrescoApiService }, { type: ɵngcc2.TranslationService }, { type: ɵngcc2.AppConfigService }]; }, { editable: [{
            type: Input
        }], displayEmpty: [{
            type: Input
        }], expanded: [{
            type: Input
        }], multi: [{
            type: Input
        }], displayDefaultProperties: [{
            type: Input
        }], displayAspect: [{
            type: Input
        }], copyToClipboardAction: [{
            type: Input
        }], useChipsForMultiValueProperty: [{
            type: Input
        }], node: [{
            type: Input
        }], preset: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGVudC1tZXRhZGF0YS5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9jb250ZW50LXNlcnZpY2VzL3NyYy9saWIvY29udGVudC1tZXRhZGF0YS9jb21wb25lbnRzL2NvbnRlbnQtbWV0YWRhdGEvY29udGVudC1tZXRhZGF0YS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUVILE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUErQyxpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNqSCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDeEMsT0FBTyxFQUFjLE9BQU8sRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3BELE9BQU8sRUFFSCxlQUFlLEVBQ2YsVUFBVSxFQUNWLHFCQUFxQixFQUNyQixrQkFBa0IsRUFDbEIsa0JBQWtCLEVBQ2xCLGdCQUFnQixFQUduQixNQUFNLG9CQUFvQixDQUFDO0FBQzVCLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBRWpGLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBUzFFLE1BQU0sT0FBTyx3QkFBd0I7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QUFDUixxQkFHRyxLQUFLO0FBQ1IsdUNBR0csS0FBSztBQUNSLDRCQUdHLEtBQUs7QUFDUixvQ0FHRyxLQUFLO0FBQ1IsNENBR0csS0FBSztBQUNUOzs7Ozsrc0ZBbkRtRCxrQkFFaEQsSUFBSSxFQUFFLEVBQUUsT0FBTyxFQUFFLHNCQUFzQixFQUFFLGtCQUN6QyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSSxrZEFDeEM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBK0NFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgT25Jbml0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTm9kZSB9IGZyb20gJ0BhbGZyZXNjby9qcy1hcGknO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgb2YsIHppcCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcbiAgICBDYXJkVmlld0l0ZW0sXG4gICAgTm9kZXNBcGlTZXJ2aWNlLFxuICAgIExvZ1NlcnZpY2UsXG4gICAgQ2FyZFZpZXdVcGRhdGVTZXJ2aWNlLFxuICAgIEFsZnJlc2NvQXBpU2VydmljZSxcbiAgICBUcmFuc2xhdGlvblNlcnZpY2UsXG4gICAgQXBwQ29uZmlnU2VydmljZSxcbiAgICBDYXJkVmlld0Jhc2VJdGVtTW9kZWwsXG4gICAgVXBkYXRlTm90aWZpY2F0aW9uXG59IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBDb250ZW50TWV0YWRhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvY29udGVudC1tZXRhZGF0YS5zZXJ2aWNlJztcbmltcG9ydCB7IENhcmRWaWV3R3JvdXAsIFByZXNldENvbmZpZyB9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvY29udGVudC1tZXRhZGF0YS5pbnRlcmZhY2VzJztcbmltcG9ydCB7IHRha2VVbnRpbCwgZGVib3VuY2VUaW1lLCBjYXRjaEVycm9yLCBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLWNvbnRlbnQtbWV0YWRhdGEnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9jb250ZW50LW1ldGFkYXRhLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9jb250ZW50LW1ldGFkYXRhLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgaG9zdDogeyAnY2xhc3MnOiAnYWRmLWNvbnRlbnQtbWV0YWRhdGEnIH0sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBDb250ZW50TWV0YWRhdGFDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMsIE9uSW5pdCwgT25EZXN0cm95IHtcblxuICAgIHN0YXRpYyBERUZBVUxUX1NFUEFSQVRPUiA9ICcsICc7XG5cbiAgICBwcm90ZWN0ZWQgb25EZXN0cm95JCA9IG5ldyBTdWJqZWN0PGJvb2xlYW4+KCk7XG5cbiAgICAvKiogKHJlcXVpcmVkKSBUaGUgbm9kZSBlbnRpdHkgdG8gZmV0Y2ggbWV0YWRhdGEgYWJvdXQgKi9cbiAgICBASW5wdXQoKVxuICAgIG5vZGU6IE5vZGU7XG5cbiAgICAvKiogVG9nZ2xlcyB3aGV0aGVyIHRoZSBlZGl0IGJ1dHRvbiBzaG91bGQgYmUgc2hvd24gKi9cbiAgICBASW5wdXQoKVxuICAgIGVkaXRhYmxlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKiogVG9nZ2xlcyB3aGV0aGVyIHRvIGRpc3BsYXkgZW1wdHkgdmFsdWVzIGluIHRoZSBjYXJkIHZpZXcgKi9cbiAgICBASW5wdXQoKVxuICAgIGRpc3BsYXlFbXB0eTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqIFRvZ2dsZXMgYmV0d2VlbiBleHBhbmRlZCAoaWUsIGZ1bGwgaW5mb3JtYXRpb24pIGFuZCBjb2xsYXBzZWRcbiAgICAgKiAoaWUsIHJlZHVjZWQgaW5mb3JtYXRpb24pIGluIHRoZSBkaXNwbGF5XG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBleHBhbmRlZDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqIFRoZSBtdWx0aSBwYXJhbWV0ZXIgb2YgdGhlIHVuZGVybHlpbmcgbWF0ZXJpYWwgZXhwYW5zaW9uIHBhbmVsLCBzZXQgdG8gdHJ1ZSB0byBhbGxvdyBtdWx0aSBhY2NvcmRpb24gdG8gYmUgZXhwYW5kZWQgYXQgdGhlIHNhbWUgdGltZSAqL1xuICAgIEBJbnB1dCgpXG4gICAgbXVsdGkgPSBmYWxzZTtcblxuICAgIC8qKiBOYW1lIG9yIGNvbmZpZ3VyYXRpb24gb2YgdGhlIG1ldGFkYXRhIHByZXNldCwgd2hpY2ggZGVmaW5lcyBhc3BlY3RzIGFuZCB0aGVpciBwcm9wZXJ0aWVzICovXG4gICAgQElucHV0KClcbiAgICBwcmVzZXQ6IHN0cmluZyB8IFByZXNldENvbmZpZztcblxuICAgIC8qKiBUb2dnbGVzIHdoZXRoZXIgdGhlIG1ldGFkYXRhIHByb3BlcnRpZXMgc2hvdWxkIGJlIHNob3duICovXG4gICAgQElucHV0KClcbiAgICBkaXNwbGF5RGVmYXVsdFByb3BlcnRpZXM6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIChvcHRpb25hbCkgc2hvd3MgdGhlIGdpdmVuIGFzcGVjdCBpbiB0aGUgZXhwYW5kZWQgIGNhcmQgKi9cbiAgICBASW5wdXQoKVxuICAgIGRpc3BsYXlBc3BlY3Q6IHN0cmluZyA9IG51bGw7XG5cbiAgICAvKiogVG9nZ2xlcyB3aGV0aGVyIG9yIG5vdCB0byBlbmFibGUgY29weSB0byBjbGlwYm9hcmQgYWN0aW9uLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgY29weVRvQ2xpcGJvYXJkQWN0aW9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBUb2dnbGVzIHdoZXRoZXIgb3Igbm90IHRvIGVuYWJsZSBjaGlwcyBmb3IgbXVsdGl2YWx1ZWQgcHJvcGVydGllcy4gKi9cbiAgICBASW5wdXQoKVxuICAgIHVzZUNoaXBzRm9yTXVsdGlWYWx1ZVByb3BlcnR5OiBib29sZWFuID0gdHJ1ZTtcblxuICAgIG11bHRpVmFsdWVTZXBhcmF0b3I6IHN0cmluZztcbiAgICBiYXNpY1Byb3BlcnRpZXMkOiBPYnNlcnZhYmxlPENhcmRWaWV3SXRlbVtdPjtcbiAgICBncm91cGVkUHJvcGVydGllcyQ6IE9ic2VydmFibGU8Q2FyZFZpZXdHcm91cFtdPjtcblxuICAgIGNoYW5nZWRQcm9wZXJ0aWVzID0ge307XG4gICAgaGFzTWV0YWRhdGFDaGFuZ2VkID0gZmFsc2U7XG4gICAgcHJpdmF0ZSB0YXJnZXRQcm9wZXJ0eTogQ2FyZFZpZXdCYXNlSXRlbU1vZGVsO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgY29udGVudE1ldGFkYXRhU2VydmljZTogQ29udGVudE1ldGFkYXRhU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBjYXJkVmlld1VwZGF0ZVNlcnZpY2U6IENhcmRWaWV3VXBkYXRlU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBub2Rlc0FwaVNlcnZpY2U6IE5vZGVzQXBpU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBsb2dTZXJ2aWNlOiBMb2dTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGFsZnJlc2NvQXBpU2VydmljZTogQWxmcmVzY29BcGlTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHRyYW5zbGF0aW9uU2VydmljZTogVHJhbnNsYXRpb25TZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGFwcENvbmZpZzogQXBwQ29uZmlnU2VydmljZVxuICAgICkge1xuICAgICAgICB0aGlzLmNvcHlUb0NsaXBib2FyZEFjdGlvbiA9IHRoaXMuYXBwQ29uZmlnLmdldDxib29sZWFuPignY29udGVudC1tZXRhZGF0YS5jb3B5LXRvLWNsaXBib2FyZC1hY3Rpb24nKTtcbiAgICAgICAgdGhpcy5tdWx0aVZhbHVlU2VwYXJhdG9yID0gdGhpcy5hcHBDb25maWcuZ2V0PHN0cmluZz4oJ2NvbnRlbnQtbWV0YWRhdGEubXVsdGktdmFsdWUtcGlwZS1zZXBhcmF0b3InKSB8fCBDb250ZW50TWV0YWRhdGFDb21wb25lbnQuREVGQVVMVF9TRVBBUkFUT1I7XG4gICAgICAgIHRoaXMudXNlQ2hpcHNGb3JNdWx0aVZhbHVlUHJvcGVydHkgPSB0aGlzLmFwcENvbmZpZy5nZXQ8Ym9vbGVhbj4oJ2NvbnRlbnQtbWV0YWRhdGEubXVsdGktdmFsdWUtY2hpcHMnKTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5jYXJkVmlld1VwZGF0ZVNlcnZpY2UuaXRlbVVwZGF0ZWQkXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBkZWJvdW5jZVRpbWUoNTAwKSxcbiAgICAgICAgICAgICAgICB0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKHVwZGF0ZWROb2RlOiBVcGRhdGVOb3RpZmljYXRpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXNNZXRhZGF0YUNoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFByb3BlcnR5ID0gdXBkYXRlZE5vZGUudGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNoYW5nZXModXBkYXRlZE5vZGUuY2hhbmdlZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcblxuICAgICAgICB0aGlzLmNhcmRWaWV3VXBkYXRlU2VydmljZS51cGRhdGVkQXNwZWN0JC5waXBlKFxuICAgICAgICAgICAgZGVib3VuY2VUaW1lKDUwMCksXG4gICAgICAgICAgICB0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKG5vZGUpID0+IHRoaXMubG9hZFByb3BlcnRpZXMobm9kZSkpO1xuXG4gICAgICAgIHRoaXMubG9hZFByb3BlcnRpZXModGhpcy5ub2RlKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgaGFuZGxlVXBkYXRlRXJyb3IoZXJyb3I6IEVycm9yKSB7XG4gICAgICAgIHRoaXMubG9nU2VydmljZS5lcnJvcihlcnJvcik7XG5cbiAgICAgICAgbGV0IHN0YXR1c0NvZGUgPSAwO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzdGF0dXNDb2RlID0gSlNPTi5wYXJzZShlcnJvci5tZXNzYWdlKS5lcnJvci5zdGF0dXNDb2RlO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBtZXNzYWdlID0gYE1FVEFEQVRBLkVSUk9SUy4ke3N0YXR1c0NvZGV9YDtcblxuICAgICAgICBpZiAodGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudChtZXNzYWdlKSA9PT0gbWVzc2FnZSkge1xuICAgICAgICAgICAgbWVzc2FnZSA9ICdNRVRBREFUQS5FUlJPUlMuR0VORVJJQyc7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNvbnRlbnRNZXRhZGF0YVNlcnZpY2UuZXJyb3IubmV4dCh7XG4gICAgICAgICAgICBzdGF0dXNDb2RlLFxuICAgICAgICAgICAgbWVzc2FnZVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIGlmIChjaGFuZ2VzLm5vZGUgJiYgIWNoYW5nZXMubm9kZS5maXJzdENoYW5nZSkge1xuICAgICAgICAgICAgdGhpcy5sb2FkUHJvcGVydGllcyhjaGFuZ2VzLm5vZGUuY3VycmVudFZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgbG9hZFByb3BlcnRpZXMobm9kZTogTm9kZSkge1xuICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgdGhpcy5iYXNpY1Byb3BlcnRpZXMkID0gdGhpcy5nZXRQcm9wZXJ0aWVzKG5vZGUpO1xuICAgICAgICAgICAgdGhpcy5ncm91cGVkUHJvcGVydGllcyQgPSB0aGlzLmNvbnRlbnRNZXRhZGF0YVNlcnZpY2UuZ2V0R3JvdXBlZFByb3BlcnRpZXMobm9kZSwgdGhpcy5wcmVzZXQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRQcm9wZXJ0aWVzKG5vZGU6IE5vZGUpIHtcbiAgICAgICAgY29uc3QgcHJvcGVydGllcyQgPSB0aGlzLmNvbnRlbnRNZXRhZGF0YVNlcnZpY2UuZ2V0QmFzaWNQcm9wZXJ0aWVzKG5vZGUpO1xuICAgICAgICBjb25zdCBjb250ZW50VHlwZVByb3BlcnR5JCA9IHRoaXMuY29udGVudE1ldGFkYXRhU2VydmljZS5nZXRDb250ZW50VHlwZVByb3BlcnR5KG5vZGUpO1xuICAgICAgICByZXR1cm4gemlwKHByb3BlcnRpZXMkLCBjb250ZW50VHlwZVByb3BlcnR5JClcbiAgICAgICAgICAgIC5waXBlKG1hcCgoW3Byb3BlcnRpZXMsIGNvbnRlbnRUeXBlUHJvcGVydHldKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRQcm9wZXJ0aWVzID0gY29udGVudFR5cGVQcm9wZXJ0eS5maWx0ZXIoKHByb3BlcnR5KSA9PiBwcm9wZXJ0aWVzLmZpbmRJbmRleCgoYmFzZVByb3BlcnR5KSA9PiBiYXNlUHJvcGVydHkua2V5ID09PSBwcm9wZXJ0eS5rZXkpID09PSAtMSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsuLi5wcm9wZXJ0aWVzLCAuLi5maWx0ZXJlZFByb3BlcnRpZXNdO1xuICAgICAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIHVwZGF0ZUNoYW5nZXModXBkYXRlZE5vZGVDaGFuZ2VzKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKHVwZGF0ZWROb2RlQ2hhbmdlcykubWFwKChwcm9wZXJ0eUdyb3VwOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdXBkYXRlZE5vZGVDaGFuZ2VzW3Byb3BlcnR5R3JvdXBdID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlZFByb3BlcnRpZXNbcHJvcGVydHlHcm91cF0gPSB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnRoaXMuY2hhbmdlZFByb3BlcnRpZXNbcHJvcGVydHlHcm91cF0sXG4gICAgICAgICAgICAgICAgICAgIC4uLnVwZGF0ZWROb2RlQ2hhbmdlc1twcm9wZXJ0eUdyb3VwXVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlZFByb3BlcnRpZXNbcHJvcGVydHlHcm91cF0gPSB1cGRhdGVkTm9kZUNoYW5nZXNbcHJvcGVydHlHcm91cF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHNhdmVDaGFuZ2VzKCkge1xuICAgICAgICBpZiAodGhpcy5oYXNDb250ZW50VHlwZUNoYW5nZWQodGhpcy5jaGFuZ2VkUHJvcGVydGllcykpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGVudE1ldGFkYXRhU2VydmljZS5vcGVuQ29uZmlybURpYWxvZyh0aGlzLmNoYW5nZWRQcm9wZXJ0aWVzKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTm9kZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZU5vZGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlTm9kZSgpIHtcbiAgICAgICAgdGhpcy5ub2Rlc0FwaVNlcnZpY2UudXBkYXRlTm9kZSh0aGlzLm5vZGUuaWQsIHRoaXMuY2hhbmdlZFByb3BlcnRpZXMpLnBpcGUoXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNhcmRWaWV3VXBkYXRlU2VydmljZS51cGRhdGVFbGVtZW50KHRoaXMudGFyZ2V0UHJvcGVydHkpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlVXBkYXRlRXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YobnVsbCk7XG4gICAgICAgICAgICB9KSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHVwZGF0ZWROb2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHVwZGF0ZWROb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc0NvbnRlbnRUeXBlQ2hhbmdlZCh0aGlzLmNoYW5nZWRQcm9wZXJ0aWVzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXJkVmlld1VwZGF0ZVNlcnZpY2UudXBkYXRlTm9kZUFzcGVjdCh0aGlzLm5vZGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmV2ZXJ0Q2hhbmdlcygpO1xuICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMubm9kZSwgdXBkYXRlZE5vZGUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFsZnJlc2NvQXBpU2VydmljZS5ub2RlVXBkYXRlZC5uZXh0KHRoaXMubm9kZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYXNDb250ZW50VHlwZUNoYW5nZWQoY2hhbmdlZFByb3BlcnRpZXMpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICEhY2hhbmdlZFByb3BlcnRpZXM/Lm5vZGVUeXBlO1xuICAgIH1cblxuICAgIHJldmVydENoYW5nZXMoKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlZFByb3BlcnRpZXMgPSB7fTtcbiAgICAgICAgdGhpcy5oYXNNZXRhZGF0YUNoYW5nZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBjYW5jZWxDaGFuZ2VzKCkge1xuICAgICAgICB0aGlzLnJldmVydENoYW5nZXMoKTtcbiAgICAgICAgdGhpcy5sb2FkUHJvcGVydGllcyh0aGlzLm5vZGUpO1xuICAgIH1cblxuICAgIHNob3dHcm91cChncm91cDogQ2FyZFZpZXdHcm91cCk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCBwcm9wZXJ0aWVzID0gZ3JvdXAucHJvcGVydGllcy5maWx0ZXIoKHByb3BlcnR5KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gIXRoaXMuaXNFbXB0eShwcm9wZXJ0eS5kaXNwbGF5VmFsdWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gcHJvcGVydGllcy5sZW5ndGggPiAwO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLm9uRGVzdHJveSQubmV4dCh0cnVlKTtcbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLmNvbXBsZXRlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGNhbkV4cGFuZFRoZUNhcmQoZ3JvdXA6IENhcmRWaWV3R3JvdXApOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGdyb3VwLnRpdGxlID09PSB0aGlzLmRpc3BsYXlBc3BlY3Q7XG4gICAgfVxuXG4gICAgcHVibGljIGNhbkV4cGFuZFByb3BlcnRpZXMoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhdGhpcy5leHBhbmRlZCB8fCB0aGlzLmRpc3BsYXlBc3BlY3QgPT09ICdQcm9wZXJ0aWVzJztcbiAgICB9XG5cbiAgICBrZXlEb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAzNyB8fCBldmVudC5rZXlDb2RlID09PSAzOSkgeyAvLyBBcnJvd0xlZnQgJiYgQXJyb3dSaWdodFxuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGlzRW1wdHkodmFsdWU6IGFueSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gJyc7XG4gICAgfVxufVxuIl19