/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { getGroup, getProperty } from './property-group-reader';
export class AspectOrientedConfigService {
    constructor(config) {
        this.config = config;
    }
    isGroupAllowed(groupName) {
        if (this.isIncludeAllEnabled()) {
            return true;
        }
        const groupNames = Object.keys(this.config);
        return groupNames.indexOf(groupName) !== -1;
    }
    reorganiseByConfig(propertyGroups) {
        const aspects = this.config, aspectNames = Object.keys(aspects);
        return aspectNames
            .reduce((groupAccumulator, aspectName) => {
            const newGroup = this.getOrganisedPropertyGroup(propertyGroups, aspectName);
            return groupAccumulator.concat(newGroup);
        }, [])
            .filter((organisedPropertyGroup) => organisedPropertyGroup.properties.length > 0);
    }
    appendAllPreset(propertyGroups) {
        const groups = Object.keys(propertyGroups)
            .map((groupName) => {
            const propertyGroup = propertyGroups[groupName], properties = propertyGroup.properties;
            if (this.isAspectReadOnly(groupName)) {
                Object.keys(properties).map((propertyName) => this.setReadOnlyProperty(properties[propertyName]));
            }
            return Object.assign({}, propertyGroup, {
                properties: Object.keys(properties).map((propertyName) => {
                    if (this.isPropertyReadOnly(propertyName)) {
                        this.setReadOnlyProperty(properties[propertyName]);
                    }
                    return properties[propertyName];
                })
            });
        });
        return groups;
    }
    setReadOnlyProperty(property) {
        property.editable = false;
    }
    isPropertyReadOnly(propertyName) {
        const readOnlyAspects = this.config.readOnlyProperties;
        if (Array.isArray(readOnlyAspects)) {
            return readOnlyAspects.includes(propertyName);
        }
        else {
            return readOnlyAspects === propertyName;
        }
    }
    isAspectReadOnly(propertyGroupName) {
        const readOnlyAspects = this.config.readOnlyAspects;
        if (Array.isArray(readOnlyAspects)) {
            return readOnlyAspects.includes(propertyGroupName);
        }
        else {
            return readOnlyAspects === propertyGroupName;
        }
    }
    filterExcludedPreset(propertyGroups) {
        if (this.config.exclude) {
            return propertyGroups.filter((preset) => {
                return !this.config.exclude.includes(preset.name);
            });
        }
        return propertyGroups;
    }
    isIncludeAllEnabled() {
        return this.config.includeAll;
    }
    getOrganisedPropertyGroup(propertyGroups, aspectName) {
        const group = getGroup(propertyGroups, aspectName);
        let newGroup = [];
        if (group) {
            const aspectProperties = this.config[aspectName];
            let properties;
            if (aspectProperties === '*') {
                properties = getProperty(propertyGroups, aspectName, aspectProperties);
            }
            else {
                properties = aspectProperties
                    .map((propertyName) => getProperty(propertyGroups, aspectName, propertyName))
                    .filter((props) => props !== undefined);
            }
            newGroup = [{ title: group.title, properties }];
        }
        return newGroup;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNwZWN0LW9yaWVudGVkLWNvbmZpZy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Ii9ob21lL3RyYXZpcy9idWlsZC9BbGZyZXNjby9hbGZyZXNjby1uZzItY29tcG9uZW50cy9saWIvY29udGVudC1zZXJ2aWNlcy9zcmMvIiwic291cmNlcyI6WyJsaWIvY29udGVudC1tZXRhZGF0YS9zZXJ2aWNlcy9jb25maWcvYXNwZWN0LW9yaWVudGVkLWNvbmZpZy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQUdILE9BQU8sRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFaEUsTUFBTSxPQUFPLDJCQUEyQjtJQUVwQyxZQUFvQixNQUFXO1FBQVgsV0FBTSxHQUFOLE1BQU0sQ0FBSztJQUFJLENBQUM7SUFFN0IsY0FBYyxDQUFDLFNBQWlCO1FBQ25DLElBQUksSUFBSSxDQUFDLG1CQUFtQixFQUFFLEVBQUU7WUFDNUIsT0FBTyxJQUFJLENBQUM7U0FDZjtRQUNELE1BQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzVDLE9BQU8sVUFBVSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRU0sa0JBQWtCLENBQUMsY0FBc0M7UUFDNUQsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFDdkIsV0FBVyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFdkMsT0FBTyxXQUFXO2FBQ2IsTUFBTSxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsVUFBVSxFQUFFLEVBQUU7WUFDckMsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLHlCQUF5QixDQUFDLGNBQWMsRUFBRSxVQUFVLENBQUMsQ0FBQztZQUM1RSxPQUFPLGdCQUFnQixDQUFDLE1BQU0s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QVUsQ0FBQyxDQUFDO1FBQ25ELElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQztRQUVsQixJQUFJLEtBQUssRUFBRTtZQUNQLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNqRCxJQUFJLFVBQVUsQ0FBQztZQUVmLElBQUksZ0JBQWdCLEtBQUssR0FBRyxFQUFFO2dCQUMxQixVQUFVLEdBQUcsV0FBVyxDQUFDLGNBQWMsRUFBRSxVQUFVLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQzthQUMxRTtpQkFBTTtnQkFDSCxVQUFVLEdBQWUsZ0JBQWlCO3FCQUNyQyxHQUFHLENBQUMsQ0FBQyxZQUFZLEVBQUUsRUFBRSxDQUFDLFdBQVcsQ0FBQyxjQUFjLEVBQUUsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDO3FCQUM1RSxNQUFNLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLEtBQUssS0FBSyxTQUFTLENBQUMsQ0FBQzthQUMvQztZQUVELFFBQVEsR0FBRyxDQUFDLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQztTQUNuRDtRQUVELE9BQU8sUUFBUSxDQUFDO0lBQ3BCLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbnRlbnRNZXRhZGF0YUNvbmZpZywgT3JnYW5pc2VkUHJvcGVydHlHcm91cCwgUHJvcGVydHlHcm91cENvbnRhaW5lciwgUHJvcGVydHkgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL2NvbnRlbnQtbWV0YWRhdGEuaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBnZXRHcm91cCwgZ2V0UHJvcGVydHkgfSBmcm9tICcuL3Byb3BlcnR5LWdyb3VwLXJlYWRlcic7XG5cbmV4cG9ydCBjbGFzcyBBc3BlY3RPcmllbnRlZENvbmZpZ1NlcnZpY2UgaW1wbGVtZW50cyBDb250ZW50TWV0YWRhdGFDb25maWcge1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBjb25maWc6IGFueSkgeyB9XG5cbiAgICBwdWJsaWMgaXNHcm91cEFsbG93ZWQoZ3JvdXBOYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuaXNJbmNsdWRlQWxsRW5hYmxlZCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBncm91cE5hbWVzID0gT2JqZWN0LmtleXModGhpcy5jb25maWcpO1xuICAgICAgICByZXR1cm4gZ3JvdXBOYW1lcy5pbmRleE9mKGdyb3VwTmFtZSkgIT09IC0xO1xuICAgIH1cblxuICAgIHB1YmxpYyByZW9yZ2FuaXNlQnlDb25maWcocHJvcGVydHlHcm91cHM6IFByb3BlcnR5R3JvdXBDb250YWluZXIpOiBPcmdhbmlzZWRQcm9wZXJ0eUdyb3VwW10ge1xuICAgICAgICBjb25zdCBhc3BlY3RzID0gdGhpcy5jb25maWcsXG4gICAgICAgICAgICBhc3BlY3ROYW1lcyA9IE9iamVjdC5rZXlzKGFzcGVjdHMpO1xuXG4gICAgICAgIHJldHVybiBhc3BlY3ROYW1lc1xuICAgICAgICAgICAgLnJlZHVjZSgoZ3JvdXBBY2N1bXVsYXRvciwgYXNwZWN0TmFtZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0dyb3VwID0gdGhpcy5nZXRPcmdhbmlzZWRQcm9wZXJ0eUdyb3VwKHByb3BlcnR5R3JvdXBzLCBhc3BlY3ROYW1lKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ3JvdXBBY2N1bXVsYXRvci5jb25jYXQobmV3R3JvdXApO1xuICAgICAgICAgICAgfSwgW10pXG4gICAgICAgICAgICAuZmlsdGVyKChvcmdhbmlzZWRQcm9wZXJ0eUdyb3VwKSA9PiBvcmdhbmlzZWRQcm9wZXJ0eUdyb3VwLnByb3BlcnRpZXMubGVuZ3RoID4gMCk7XG4gICAgfVxuXG4gICAgcHVibGljIGFwcGVuZEFsbFByZXNldChwcm9wZXJ0eUdyb3VwczogUHJvcGVydHlHcm91cENvbnRhaW5lcik6IE9yZ2FuaXNlZFByb3BlcnR5R3JvdXBbXSB7XG4gICAgICAgIGNvbnN0IGdyb3VwcyA9IE9iamVjdC5rZXlzKHByb3BlcnR5R3JvdXBzKVxuICAgICAgICAgICAgLm1hcCgoZ3JvdXBOYW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlHcm91cCA9IHByb3BlcnR5R3JvdXBzW2dyb3VwTmFtZV0sXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXMgPSBwcm9wZXJ0eUdyb3VwLnByb3BlcnRpZXM7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0FzcGVjdFJlYWRPbmx5KGdyb3VwTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMocHJvcGVydGllcykubWFwKChwcm9wZXJ0eU5hbWUpID0+IHRoaXMuc2V0UmVhZE9ubHlQcm9wZXJ0eShwcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV0pKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgcHJvcGVydHlHcm91cCwge1xuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBPYmplY3Qua2V5cyhwcm9wZXJ0aWVzKS5tYXAoKHByb3BlcnR5TmFtZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNQcm9wZXJ0eVJlYWRPbmx5KHByb3BlcnR5TmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFJlYWRPbmx5UHJvcGVydHkocHJvcGVydGllc1twcm9wZXJ0eU5hbWVdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV07XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gZ3JvdXBzO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2V0UmVhZE9ubHlQcm9wZXJ0eShwcm9wZXJ0eTogUHJvcGVydHkpIHtcbiAgICAgICAgcHJvcGVydHkuZWRpdGFibGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzUHJvcGVydHlSZWFkT25seShwcm9wZXJ0eU5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCByZWFkT25seUFzcGVjdHMgPSB0aGlzLmNvbmZpZy5yZWFkT25seVByb3BlcnRpZXM7XG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVhZE9ubHlBc3BlY3RzKSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlYWRPbmx5QXNwZWN0cy5pbmNsdWRlcyhwcm9wZXJ0eU5hbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHJlYWRPbmx5QXNwZWN0cyA9PT0gcHJvcGVydHlOYW1lO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0FzcGVjdFJlYWRPbmx5KHByb3BlcnR5R3JvdXBOYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgcmVhZE9ubHlBc3BlY3RzID0gdGhpcy5jb25maWcucmVhZE9ubHlBc3BlY3RzO1xuXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlYWRPbmx5QXNwZWN0cykpIHtcbiAgICAgICAgICAgIHJldHVybiByZWFkT25seUFzcGVjdHMuaW5jbHVkZXMocHJvcGVydHlHcm91cE5hbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHJlYWRPbmx5QXNwZWN0cyA9PT0gcHJvcGVydHlHcm91cE5hbWU7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHB1YmxpYyBmaWx0ZXJFeGNsdWRlZFByZXNldChwcm9wZXJ0eUdyb3VwczogT3JnYW5pc2VkUHJvcGVydHlHcm91cFtdKTogT3JnYW5pc2VkUHJvcGVydHlHcm91cFtdIHtcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLmV4Y2x1ZGUpIHtcbiAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eUdyb3Vwcy5maWx0ZXIoKHByZXNldCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiAhdGhpcy5jb25maWcuZXhjbHVkZS5pbmNsdWRlcyhwcmVzZXQubmFtZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcHJvcGVydHlHcm91cHM7XG4gICAgfVxuXG4gICAgcHVibGljIGlzSW5jbHVkZUFsbEVuYWJsZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5pbmNsdWRlQWxsO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0T3JnYW5pc2VkUHJvcGVydHlHcm91cChwcm9wZXJ0eUdyb3VwcywgYXNwZWN0TmFtZSkge1xuICAgICAgICBjb25zdCBncm91cCA9IGdldEdyb3VwKHByb3BlcnR5R3JvdXBzLCBhc3BlY3ROYW1lKTtcbiAgICAgICAgbGV0IG5ld0dyb3VwID0gW107XG5cbiAgICAgICAgaWYgKGdyb3VwKSB7XG4gICAgICAgICAgICBjb25zdCBhc3BlY3RQcm9wZXJ0aWVzID0gdGhpcy5jb25maWdbYXNwZWN0TmFtZV07XG4gICAgICAgICAgICBsZXQgcHJvcGVydGllcztcblxuICAgICAgICAgICAgaWYgKGFzcGVjdFByb3BlcnRpZXMgPT09ICcqJykge1xuICAgICAgICAgICAgICAgIHByb3BlcnRpZXMgPSBnZXRQcm9wZXJ0eShwcm9wZXJ0eUdyb3VwcywgYXNwZWN0TmFtZSwgYXNwZWN0UHJvcGVydGllcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHByb3BlcnRpZXMgPSAoPHN0cmluZ1tdPiBhc3BlY3RQcm9wZXJ0aWVzKVxuICAgICAgICAgICAgICAgICAgICAubWFwKChwcm9wZXJ0eU5hbWUpID0+IGdldFByb3BlcnR5KHByb3BlcnR5R3JvdXBzLCBhc3BlY3ROYW1lLCBwcm9wZXJ0eU5hbWUpKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChwcm9wcykgPT4gcHJvcHMgIT09IHVuZGVmaW5lZCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG5ld0dyb3VwID0gW3sgdGl0bGU6IGdyb3VwLnRpdGxlLCBwcm9wZXJ0aWVzIH1dO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ld0dyb3VwO1xuICAgIH1cbn1cbiJdfQ==