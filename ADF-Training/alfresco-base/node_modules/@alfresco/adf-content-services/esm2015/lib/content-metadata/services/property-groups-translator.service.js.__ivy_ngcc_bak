import { Injectable } from '@angular/core';
import { CardViewTextItemModel, CardViewBoolItemModel, CardViewDateItemModel, CardViewSelectItemModel, CardViewDatetimeItemModel, CardViewIntItemModel, CardViewFloatItemModel, LogService, MultiValuePipe, AppConfigService, DecimalNumberPipe } from '@alfresco/adf-core';
import { of } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@alfresco/adf-core";
const D_TEXT = 'd:text';
const D_MLTEXT = 'd:mltext';
const D_DATE = 'd:date';
const D_DATETIME = 'd:datetime';
const D_INT = 'd:int';
const D_LONG = 'd:long';
const D_FLOAT = 'd:float';
const D_DOUBLE = 'd:double';
const D_BOOLEAN = 'd:boolean';
export class PropertyGroupTranslatorService {
    constructor(logService, multiValuePipe, decimalNumberPipe, appConfig) {
        this.logService = logService;
        this.multiValuePipe = multiValuePipe;
        this.decimalNumberPipe = decimalNumberPipe;
        this.appConfig = appConfig;
        this.valueSeparator = this.appConfig.get('content-metadata.multi-value-pipe-separator');
    }
    translateToCardViewGroups(propertyGroups, propertyValues, definition) {
        return propertyGroups.map((propertyGroup) => {
            const translatedPropertyGroup = Object.assign({}, propertyGroup);
            translatedPropertyGroup.properties = this.translateArray(propertyGroup.properties, propertyValues, definition);
            return translatedPropertyGroup;
        });
    }
    translateProperty(property, startValue, allowEditing = false) {
        this.checkECMTypeValidity(property.dataType);
        const prefix = 'properties.';
        const propertyDefinition = {
            label: property.title || property.id,
            value: startValue ? startValue : property.defaultValue,
            key: `${prefix}${property.id}`,
            default: property.defaultValue,
            editable: property.isProtected ? false : allowEditing,
            constraints: property === null || property === void 0 ? void 0 : property.constraints
        };
        return this.transform(propertyDefinition, property.dataType, property.isMultiValued);
    }
    translateArray(properties, propertyValues, definition) {
        return properties.map((property) => {
            return this.translate(property, propertyValues, this.getPropertyConstraints(property.name, definition));
        });
    }
    translate(property, propertyValues, constraints) {
        let propertyValue;
        if (propertyValues && !this.isEmpty(propertyValues[property.name])) {
            propertyValue = propertyValues[property.name];
        }
        this.checkECMTypeValidity(property.dataType);
        const prefix = 'properties.';
        const propertyDefinition = {
            label: property.title || property.name,
            value: propertyValue,
            key: `${prefix}${property.name}`,
            default: property.defaultValue,
            editable: property.protected ? false : property.editable !== undefined ? property.editable : true,
            constraints: constraints
        };
        return this.transform(propertyDefinition, property.dataType, property.multiValued);
    }
    transform(propertyDefinition, dataType, isMultiValued) {
        let cardViewItemProperty;
        if (this.isListOfValues(propertyDefinition.constraints)) {
            const options = propertyDefinition.constraints[0].parameters.allowedValues.map((value) => ({ key: value, label: value }));
            const properties = Object.assign(propertyDefinition, { options$: of(options) });
            cardViewItemProperty = new CardViewSelectItemModel(properties);
        }
        else {
            switch (dataType) {
                case D_MLTEXT:
                    cardViewItemProperty = new CardViewTextItemModel(Object.assign(propertyDefinition, {
                        multiline: true
                    }));
                    break;
                case D_INT:
                case D_LONG:
                    cardViewItemProperty = new CardViewIntItemModel(Object.assign(propertyDefinition, {
                        multivalued: isMultiValued,
                        pipes: [{ pipe: this.multiValuePipe, params: [this.valueSeparator] }]
                    }));
                    break;
                case D_FLOAT:
                case D_DOUBLE:
                    cardViewItemProperty = new CardViewFloatItemModel(Object.assign(propertyDefinition, {
                        multivalued: isMultiValued,
                        pipes: [
                            { pipe: this.decimalNumberPipe },
                            { pipe: this.multiValuePipe, params: [this.valueSeparator] }
                        ]
                    }));
                    break;
                case D_DATE:
                    cardViewItemProperty = new CardViewDateItemModel(Object.assign(propertyDefinition, {
                        multivalued: isMultiValued,
                        pipes: [{ pipe: this.multiValuePipe, params: [this.valueSeparator] }]
                    }));
                    break;
                case D_DATETIME:
                    cardViewItemProperty = new CardViewDatetimeItemModel(Object.assign(propertyDefinition, {
                        multivalued: isMultiValued,
                        pipes: [{ pipe: this.multiValuePipe, params: [this.valueSeparator] }]
                    }));
                    break;
                case D_BOOLEAN:
                    cardViewItemProperty = new CardViewBoolItemModel(propertyDefinition);
                    break;
                case D_TEXT:
                default:
                    cardViewItemProperty = new CardViewTextItemModel(Object.assign(propertyDefinition, {
                        multivalued: isMultiValued,
                        multiline: isMultiValued,
                        pipes: [{ pipe: this.multiValuePipe, params: [this.valueSeparator] }]
                    }));
            }
        }
        return cardViewItemProperty;
    }
    isListOfValues(constraint) {
        var _a;
        return ((_a = constraint === null || constraint === void 0 ? void 0 : constraint[0]) === null || _a === void 0 ? void 0 : _a.type) === 'LIST';
    }
    getPropertyConstraints(propertyName, definition) {
        var _a, _b;
        return (_b = (_a = definition === null || definition === void 0 ? void 0 : definition.properties.find((item) => item.id === propertyName)) === null || _a === void 0 ? void 0 : _a.constraints) !== null && _b !== void 0 ? _b : [];
    }
    checkECMTypeValidity(ecmPropertyType) {
        if (PropertyGroupTranslatorService.RECOGNISED_ECM_TYPES.indexOf(ecmPropertyType) === -1) {
            this.logService.error(`Unknown type for mapping: ${ecmPropertyType}`);
        }
    }
    isEmpty(value) {
        return value === undefined || value === null || value === '';
    }
}
PropertyGroupTranslatorService.RECOGNISED_ECM_TYPES = [D_TEXT, D_MLTEXT, D_DATE, D_DATETIME, D_INT, D_LONG, D_FLOAT, D_DOUBLE, D_BOOLEAN];
PropertyGroupTranslatorService.ɵprov = i0.ɵɵdefineInjectable({ factory: function PropertyGroupTranslatorService_Factory() { return new PropertyGroupTranslatorService(i0.ɵɵinject(i1.LogService), i0.ɵɵinject(i1.MultiValuePipe), i0.ɵɵinject(i1.DecimalNumberPipe), i0.ɵɵinject(i1.AppConfigService)); }, token: PropertyGroupTranslatorService, providedIn: "root" });
PropertyGroupTranslatorService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
PropertyGroupTranslatorService.ctorParameters = () => [
    { type: LogService },
    { type: MultiValuePipe },
    { type: DecimalNumberPipe },
    { type: AppConfigService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHktZ3JvdXBzLXRyYW5zbGF0b3Iuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL2NvbnRlbnQtc2VydmljZXMvc3JjLyIsInNvdXJjZXMiOlsibGliL2NvbnRlbnQtbWV0YWRhdGEvc2VydmljZXMvcHJvcGVydHktZ3JvdXBzLXRyYW5zbGF0b3Iuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFpQkEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBR0gscUJBQXFCLEVBQ3JCLHFCQUFxQixFQUNyQixxQkFBcUIsRUFDckIsdUJBQXVCLEVBQ3ZCLHlCQUF5QixFQUN6QixvQkFBb0IsRUFDcEIsc0JBQXNCLEVBQ3RCLFVBQVUsRUFDVixjQUFjLEVBQ2QsZ0JBQWdCLEVBQ2hCLGlCQUFpQixFQUNwQixNQUFNLG9CQUFvQixDQUFDO0FBRTVCLE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7OztBQUcxQixNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUM7QUFDeEIsTUFBTSxRQUFRLEdBQUcsVUFBVSxDQUFDO0FBQzVCLE1BQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQztBQUN4QixNQUFNLFVBQVUsR0FBRyxZQUFZLENBQUM7QUFDaEMsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDO0FBQ3RCLE1BQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQztBQUN4QixNQUFNLE9BQU8sR0FBRyxTQUFTLENBQUM7QUFDMUIsTUFBTSxRQUFRLEdBQUcsVUFBVSxDQUFDO0FBQzVCLE1BQU0sU0FBUyxHQUFHLFdBQVcsQ0FBQztBQUs5QixNQUFNLE9BQU8sOEJBQThCO0lBTXZDLFlBQW9CLFVBQXNCLEVBQ3RCLGNBQThCLEVBQzlCLGlCQUFvQyxFQUNwQyxTQUEyQjtRQUgzQixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQ3BDLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBQzNDLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQVMsNkNBQTZDLENBQUMsQ0FBQztJQUNwRyxDQUFDO0lBRU0seUJBQXlCLENBQUMsY0FBd0MsRUFBRSxjQUFjLEVBQUUsVUFBc0I7UUFDN0csT0FBTyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUMsYUFBYSxFQUFFLEVBQUU7WUFDeEMsTUFBTSx1QkFBdUIsR0FBUSxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxhQUFhLENBQUMsQ0FBQztZQUN0RSx1QkFBdUIsQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsVUFBVSxFQUFFLGNBQWMsRUFBRSxVQUFVLENBQUMsQ0FBQztZQUMvRyxPQUFPLHVCQUF1QixDQUFDO1FBQ25DLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVNLGlCQUFpQixDQUFDLFFBQXNCLEVBQUUsVUFBZ0IsRUFBRSxlQUF3QixLQUFLO1FBQzVGLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFN0MsTUFBTSxNQUFNLEdBQUcsYUFBYSxDQUFDO1FBRTdCLE1BQU0sa0JBQWtCLEdBQTJCO1lBQy9DLEtBQUssRUFBRSxRQUFRLENBQUMsS0FBSyxJQUFJLFFBQVEsQ0FBQyxFQUFFO1lBQ3BDLEtBQUssRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLFlBQVk7WUFDdEQsR0FBRyxFQUFFLEdBQUcsTUFBTSxHQUFHLFFBQVEsQ0FBQyxFQUFFLEVBQUU7WUFDOUIsT0FBTyxFQUFFLFFBQVEsQ0FBQyxZQUFZO1lBQzlCLFFBQVEsRUFBRSxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFlBQVk7WUFDckQsV0FBVyxFQUFFLFFBQVEsYUFBUixRQUFRLHVCQUFSLFFBQVEsQ0FBRSxXQUFXO1NBQ3JDLENBQUM7UUFFRixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsa0JBQWtCLEVBQUUsUUFBUSxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDekYsQ0FBQztJQUVPLGNBQWMsQ0FBQyxVQUFzQixFQUFFLGNBQW1CLEVBQUUsVUFBc0I7UUFDdEYsT0FBTyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUU7WUFDL0IsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxjQUFjLEVBQUUsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUM1RyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFTyxTQUFTLENBQUMsUUFBa0IsRUFBRSxjQUFtQixFQUFFLFdBQXlCO1FBQ2hGLElBQUksYUFBa0IsQ0FBQztRQUN2QixJQUFJLGNBQWMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFO1lBQ2hFLGFBQWEsR0FBRyxjQUFjLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2pEO1FBRUQsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUU3QyxNQUFNLE1BQU0sR0FBRyxhQUFhLENBQUM7UUFFN0IsTUFBTSxrQkFBa0IsR0FBMkI7WUFDL0MsS0FBSyxFQUFFLFFBQVEsQ0FBQyxLQUFLLElBQUksUUFBUSxDQUFDLElBQUk7WUFDdEMsS0FBSyxFQUFFLGFBQWE7WUFDcEIsR0FBRyxFQUFFLEdBQUcsTUFBTSxHQUFHLFFBQVEsQ0FBQyxJQUFJLEVBQUU7WUFDaEMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxZQUFZO1lBQzlCLFFBQVEsRUFBRSxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxRQUFRLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJO1lBQ2pHLFdBQVcsRUFBRSxXQUFXO1NBQzNCLENBQUM7UUFFRixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsa0JBQWtCLEVBQUUsUUFBUSxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDdkYsQ0FBQztJQUVPLFNBQVMsQ0FBQyxrQkFBMEMsRUFBRSxRQUFnQixFQUFFLGFBQXNCO1FBQ2xHLElBQUksb0JBQWtDLENBQUM7UUFFdkMsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxFQUFFO1lBQ3JELE1BQU0sT0FBTyxHQUFHLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztZQUMxSCxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLGtCQUFrQixFQUFFLEVBQUUsUUFBUSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFaEYsb0JBQW9CLEdBQUcsSUFBSSx1QkFBdUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztTQUNsRTthQUFNO1lBQ0gsUUFBUSxRQUFRLEVBQUU7Z0JBQ2QsS0FBSyxRQUFRO29CQUNULG9CQUFvQixHQUFHLElBQUkscUJBQXFCLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRTt3QkFDL0UsU0FBUyxFQUFFLElBQUk7cUJBQ2xCLENBQUMsQ0FBQyxDQUFDO29CQUNKLE1BQU07Z0JBRVYsS0FBSyxLQUFLLENBQUM7Z0JBQ1gsS0FBSyxNQUFNO29CQUNQLG9CQUFvQixHQUFHLElBQUksb0JBQW9CLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRTt3QkFDOUUsV0FBVyxFQUFFLGFBQWE7d0JBQzFCLEtBQUssRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxjQUFjLEVBQUUsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUM7cUJBQ3hFLENBQUMsQ0FBQyxDQUFDO29CQUNKLE1BQU07Z0JBRVYsS0FBSyxPQUFPLENBQUM7Z0JBQ2IsS0FBSyxRQUFRO29CQUNULG9CQUFvQixHQUFHLElBQUksc0JBQXNCLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRTt3QkFDaEYsV0FBVyxFQUFFLGFBQWE7d0JBQzFCLEtBQUssRUFBRTs0QkFDSCxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsaUJBQWlCLEVBQUU7NEJBQ2hDLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxjQUFjLEVBQUUsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxFQUFFO3lCQUMvRDtxQkFDSixDQUFDLENBQUMsQ0FBQztvQkFDSixNQUFNO2dCQUVWLEtBQUssTUFBTTtvQkFDUCxvQkFBb0IsR0FBRyxJQUFJLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsa0JBQWtCLEVBQUU7d0JBQy9FLFdBQVcsRUFBRSxhQUFhO3dCQUMxQixLQUFLLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsY0FBYyxFQUFFLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDO3FCQUN4RSxDQUFDLENBQUMsQ0FBQztvQkFDSixNQUFNO2dCQUVWLEtBQUssVUFBVTtvQkFDWCxvQkFBb0IsR0FBRyxJQUFJLHlCQUF5QixDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsa0JBQWtCLEVBQUU7d0JBQ25GLFdBQVcsRUFBRSxhQUFhO3dCQUMxQixLQUFLLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsY0FBYyxFQUFFLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDO3FCQUN4RSxDQUFDLENBQUMsQ0FBQztvQkFDSixNQUFNO2dCQUVWLEtBQUssU0FBUztvQkFDVixvQkFBb0IsR0FBRyxJQUFJLHFCQUFxQixDQUFDLGtCQUFrQixDQUFDLENBQUM7b0JBQ3JFLE1BQU07Z0JBRVYsS0FBSyxNQUFNLENBQUM7Z0JBQ1o7b0JBQ0ksb0JBQW9CLEdBQUcsSUFBSSxxQkFBcUIsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGtCQUFrQixFQUFFO3dCQUMvRSxXQUFXLEVBQUUsYUFBYTt3QkFDMUIsU0FBUyxFQUFFLGFBQWE7d0JBQ3hCLEtBQUssRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxjQUFjLEVBQUUsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUM7cUJBQ3hFLENBQUMsQ0FBQyxDQUFDO2FBQ1g7U0FDSjtRQUVELE9BQU8sb0JBQW9CLENBQUM7SUFDaEMsQ0FBQztJQUVPLGNBQWMsQ0FBQyxVQUF3Qjs7UUFDM0MsT0FBTyxPQUFBLFVBQVUsYUFBVixVQUFVLHVCQUFWLFVBQVUsQ0FBRyxDQUFDLDJDQUFHLElBQUksTUFBSyxNQUFNLENBQUM7SUFDNUMsQ0FBQztJQUVPLHNCQUFzQixDQUFDLFlBQW9CLEVBQUUsVUFBc0I7O1FBQ3ZFLG1CQUFPLFVBQVUsYUFBVixVQUFVLHVCQUFWLFVBQVUsQ0FBRSxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLFlBQVksMkNBQUcsV0FBVyxtQ0FBSSxFQUFFLENBQUM7SUFDOUYsQ0FBQztJQUVPLG9CQUFvQixDQUFDLGVBQXVCO1FBQ2hELElBQUksOEJBQThCLENBQUMsb0JBQW9CLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO1lBQ3JGLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLDZCQUE2QixlQUFlLEVBQUUsQ0FBQyxDQUFDO1NBQ3pFO0lBQ0wsQ0FBQztJQUVPLE9BQU8sQ0FBQyxLQUFVO1FBQ3RCLE9BQU8sS0FBSyxLQUFLLFNBQVMsSUFBSSxLQUFLLEtBQUssSUFBSSxJQUFJLEtBQUssS0FBSyxFQUFFLENBQUM7SUFDakUsQ0FBQzs7QUFsSmUsbURBQW9CLEdBQUcsQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLFNBQVMsQ0FBQyxDQUFDOzs7WUFMOUgsVUFBVSxTQUFDO2dCQUNSLFVBQVUsRUFBRSxNQUFNO2FBQ3JCOzs7WUFyQkcsVUFBVTtZQUNWLGNBQWM7WUFFZCxpQkFBaUI7WUFEakIsZ0JBQWdCIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgICBDYXJkVmlld0l0ZW1Qcm9wZXJ0aWVzLFxuICAgIENhcmRWaWV3SXRlbSxcbiAgICBDYXJkVmlld1RleHRJdGVtTW9kZWwsXG4gICAgQ2FyZFZpZXdCb29sSXRlbU1vZGVsLFxuICAgIENhcmRWaWV3RGF0ZUl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld1NlbGVjdEl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld0RhdGV0aW1lSXRlbU1vZGVsLFxuICAgIENhcmRWaWV3SW50SXRlbU1vZGVsLFxuICAgIENhcmRWaWV3RmxvYXRJdGVtTW9kZWwsXG4gICAgTG9nU2VydmljZSxcbiAgICBNdWx0aVZhbHVlUGlwZSxcbiAgICBBcHBDb25maWdTZXJ2aWNlLFxuICAgIERlY2ltYWxOdW1iZXJQaXBlXG59IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBQcm9wZXJ0eSwgQ2FyZFZpZXdHcm91cCwgT3JnYW5pc2VkUHJvcGVydHlHcm91cCB9IGZyb20gJy4uL2ludGVyZmFjZXMvY29udGVudC1tZXRhZGF0YS5pbnRlcmZhY2VzJztcbmltcG9ydCB7IG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBEZWZpbml0aW9uLCBDb25zdHJhaW50LCBQcm9wZXJ0eSBhcyBQcm9wZXJ0eUJhc2UgfSBmcm9tICdAYWxmcmVzY28vanMtYXBpJztcblxuY29uc3QgRF9URVhUID0gJ2Q6dGV4dCc7XG5jb25zdCBEX01MVEVYVCA9ICdkOm1sdGV4dCc7XG5jb25zdCBEX0RBVEUgPSAnZDpkYXRlJztcbmNvbnN0IERfREFURVRJTUUgPSAnZDpkYXRldGltZSc7XG5jb25zdCBEX0lOVCA9ICdkOmludCc7XG5jb25zdCBEX0xPTkcgPSAnZDpsb25nJztcbmNvbnN0IERfRkxPQVQgPSAnZDpmbG9hdCc7XG5jb25zdCBEX0RPVUJMRSA9ICdkOmRvdWJsZSc7XG5jb25zdCBEX0JPT0xFQU4gPSAnZDpib29sZWFuJztcblxuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBQcm9wZXJ0eUdyb3VwVHJhbnNsYXRvclNlcnZpY2Uge1xuXG4gICAgc3RhdGljIHJlYWRvbmx5IFJFQ09HTklTRURfRUNNX1RZUEVTID0gW0RfVEVYVCwgRF9NTFRFWFQsIERfREFURSwgRF9EQVRFVElNRSwgRF9JTlQsIERfTE9ORywgRF9GTE9BVCwgRF9ET1VCTEUsIERfQk9PTEVBTl07XG5cbiAgICB2YWx1ZVNlcGFyYXRvcjogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBsb2dTZXJ2aWNlOiBMb2dTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgbXVsdGlWYWx1ZVBpcGU6IE11bHRpVmFsdWVQaXBlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgZGVjaW1hbE51bWJlclBpcGU6IERlY2ltYWxOdW1iZXJQaXBlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYXBwQ29uZmlnOiBBcHBDb25maWdTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMudmFsdWVTZXBhcmF0b3IgPSB0aGlzLmFwcENvbmZpZy5nZXQ8c3RyaW5nPignY29udGVudC1tZXRhZGF0YS5tdWx0aS12YWx1ZS1waXBlLXNlcGFyYXRvcicpO1xuICAgIH1cblxuICAgIHB1YmxpYyB0cmFuc2xhdGVUb0NhcmRWaWV3R3JvdXBzKHByb3BlcnR5R3JvdXBzOiBPcmdhbmlzZWRQcm9wZXJ0eUdyb3VwW10sIHByb3BlcnR5VmFsdWVzLCBkZWZpbml0aW9uOiBEZWZpbml0aW9uKTogQ2FyZFZpZXdHcm91cFtdIHtcbiAgICAgICAgcmV0dXJuIHByb3BlcnR5R3JvdXBzLm1hcCgocHJvcGVydHlHcm91cCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdHJhbnNsYXRlZFByb3BlcnR5R3JvdXA6IGFueSA9IE9iamVjdC5hc3NpZ24oe30sIHByb3BlcnR5R3JvdXApO1xuICAgICAgICAgICAgdHJhbnNsYXRlZFByb3BlcnR5R3JvdXAucHJvcGVydGllcyA9IHRoaXMudHJhbnNsYXRlQXJyYXkocHJvcGVydHlHcm91cC5wcm9wZXJ0aWVzLCBwcm9wZXJ0eVZhbHVlcywgZGVmaW5pdGlvbik7XG4gICAgICAgICAgICByZXR1cm4gdHJhbnNsYXRlZFByb3BlcnR5R3JvdXA7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyB0cmFuc2xhdGVQcm9wZXJ0eShwcm9wZXJ0eTogUHJvcGVydHlCYXNlLCBzdGFydFZhbHVlPzogYW55LCBhbGxvd0VkaXRpbmc6IGJvb2xlYW4gPSBmYWxzZSk6IENhcmRWaWV3SXRlbSB7XG4gICAgICAgIHRoaXMuY2hlY2tFQ01UeXBlVmFsaWRpdHkocHJvcGVydHkuZGF0YVR5cGUpO1xuXG4gICAgICAgIGNvbnN0IHByZWZpeCA9ICdwcm9wZXJ0aWVzLic7XG5cbiAgICAgICAgY29uc3QgcHJvcGVydHlEZWZpbml0aW9uOiBDYXJkVmlld0l0ZW1Qcm9wZXJ0aWVzID0ge1xuICAgICAgICAgICAgbGFiZWw6IHByb3BlcnR5LnRpdGxlIHx8IHByb3BlcnR5LmlkLFxuICAgICAgICAgICAgdmFsdWU6IHN0YXJ0VmFsdWUgPyBzdGFydFZhbHVlIDogcHJvcGVydHkuZGVmYXVsdFZhbHVlLFxuICAgICAgICAgICAga2V5OiBgJHtwcmVmaXh9JHtwcm9wZXJ0eS5pZH1gLFxuICAgICAgICAgICAgZGVmYXVsdDogcHJvcGVydHkuZGVmYXVsdFZhbHVlLFxuICAgICAgICAgICAgZWRpdGFibGU6IHByb3BlcnR5LmlzUHJvdGVjdGVkID8gZmFsc2UgOiBhbGxvd0VkaXRpbmcsXG4gICAgICAgICAgICBjb25zdHJhaW50czogcHJvcGVydHk/LmNvbnN0cmFpbnRzXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHRoaXMudHJhbnNmb3JtKHByb3BlcnR5RGVmaW5pdGlvbiwgcHJvcGVydHkuZGF0YVR5cGUsIHByb3BlcnR5LmlzTXVsdGlWYWx1ZWQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgdHJhbnNsYXRlQXJyYXkocHJvcGVydGllczogUHJvcGVydHlbXSwgcHJvcGVydHlWYWx1ZXM6IGFueSwgZGVmaW5pdGlvbjogRGVmaW5pdGlvbik6IENhcmRWaWV3SXRlbVtdIHtcbiAgICAgICAgcmV0dXJuIHByb3BlcnRpZXMubWFwKChwcm9wZXJ0eSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudHJhbnNsYXRlKHByb3BlcnR5LCBwcm9wZXJ0eVZhbHVlcywgdGhpcy5nZXRQcm9wZXJ0eUNvbnN0cmFpbnRzKHByb3BlcnR5Lm5hbWUsIGRlZmluaXRpb24pKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB0cmFuc2xhdGUocHJvcGVydHk6IFByb3BlcnR5LCBwcm9wZXJ0eVZhbHVlczogYW55LCBjb25zdHJhaW50czogQ29uc3RyYWludFtdKTogQ2FyZFZpZXdJdGVtIHtcbiAgICAgICAgbGV0IHByb3BlcnR5VmFsdWU6IGFueTtcbiAgICAgICAgaWYgKHByb3BlcnR5VmFsdWVzICYmICF0aGlzLmlzRW1wdHkocHJvcGVydHlWYWx1ZXNbcHJvcGVydHkubmFtZV0pKSB7XG4gICAgICAgICAgICBwcm9wZXJ0eVZhbHVlID0gcHJvcGVydHlWYWx1ZXNbcHJvcGVydHkubmFtZV07XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNoZWNrRUNNVHlwZVZhbGlkaXR5KHByb3BlcnR5LmRhdGFUeXBlKTtcblxuICAgICAgICBjb25zdCBwcmVmaXggPSAncHJvcGVydGllcy4nO1xuXG4gICAgICAgIGNvbnN0IHByb3BlcnR5RGVmaW5pdGlvbjogQ2FyZFZpZXdJdGVtUHJvcGVydGllcyA9IHtcbiAgICAgICAgICAgIGxhYmVsOiBwcm9wZXJ0eS50aXRsZSB8fCBwcm9wZXJ0eS5uYW1lLFxuICAgICAgICAgICAgdmFsdWU6IHByb3BlcnR5VmFsdWUsXG4gICAgICAgICAgICBrZXk6IGAke3ByZWZpeH0ke3Byb3BlcnR5Lm5hbWV9YCxcbiAgICAgICAgICAgIGRlZmF1bHQ6IHByb3BlcnR5LmRlZmF1bHRWYWx1ZSxcbiAgICAgICAgICAgIGVkaXRhYmxlOiBwcm9wZXJ0eS5wcm90ZWN0ZWQgPyBmYWxzZSA6IHByb3BlcnR5LmVkaXRhYmxlICE9PSB1bmRlZmluZWQgPyBwcm9wZXJ0eS5lZGl0YWJsZSA6IHRydWUsXG4gICAgICAgICAgICBjb25zdHJhaW50czogY29uc3RyYWludHNcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm0ocHJvcGVydHlEZWZpbml0aW9uLCBwcm9wZXJ0eS5kYXRhVHlwZSwgcHJvcGVydHkubXVsdGlWYWx1ZWQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgdHJhbnNmb3JtKHByb3BlcnR5RGVmaW5pdGlvbjogQ2FyZFZpZXdJdGVtUHJvcGVydGllcywgZGF0YVR5cGU6IHN0cmluZywgaXNNdWx0aVZhbHVlZDogYm9vbGVhbik6IENhcmRWaWV3SXRlbSB7XG4gICAgICAgIGxldCBjYXJkVmlld0l0ZW1Qcm9wZXJ0eTogQ2FyZFZpZXdJdGVtO1xuXG4gICAgICAgIGlmICh0aGlzLmlzTGlzdE9mVmFsdWVzKHByb3BlcnR5RGVmaW5pdGlvbi5jb25zdHJhaW50cykpIHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBwcm9wZXJ0eURlZmluaXRpb24uY29uc3RyYWludHNbMF0ucGFyYW1ldGVycy5hbGxvd2VkVmFsdWVzLm1hcCgodmFsdWUpID0+ICh7IGtleTogdmFsdWUsIGxhYmVsOiB2YWx1ZSB9KSk7XG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbihwcm9wZXJ0eURlZmluaXRpb24sIHsgb3B0aW9ucyQ6IG9mKG9wdGlvbnMpIH0pO1xuXG4gICAgICAgICAgICBjYXJkVmlld0l0ZW1Qcm9wZXJ0eSA9IG5ldyBDYXJkVmlld1NlbGVjdEl0ZW1Nb2RlbChwcm9wZXJ0aWVzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN3aXRjaCAoZGF0YVR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIERfTUxURVhUOlxuICAgICAgICAgICAgICAgICAgICBjYXJkVmlld0l0ZW1Qcm9wZXJ0eSA9IG5ldyBDYXJkVmlld1RleHRJdGVtTW9kZWwoT2JqZWN0LmFzc2lnbihwcm9wZXJ0eURlZmluaXRpb24sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpbGluZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBEX0lOVDpcbiAgICAgICAgICAgICAgICBjYXNlIERfTE9ORzpcbiAgICAgICAgICAgICAgICAgICAgY2FyZFZpZXdJdGVtUHJvcGVydHkgPSBuZXcgQ2FyZFZpZXdJbnRJdGVtTW9kZWwoT2JqZWN0LmFzc2lnbihwcm9wZXJ0eURlZmluaXRpb24sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpdmFsdWVkOiBpc011bHRpVmFsdWVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGlwZXM6IFt7IHBpcGU6IHRoaXMubXVsdGlWYWx1ZVBpcGUsIHBhcmFtczogW3RoaXMudmFsdWVTZXBhcmF0b3JdIH1dXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIERfRkxPQVQ6XG4gICAgICAgICAgICAgICAgY2FzZSBEX0RPVUJMRTpcbiAgICAgICAgICAgICAgICAgICAgY2FyZFZpZXdJdGVtUHJvcGVydHkgPSBuZXcgQ2FyZFZpZXdGbG9hdEl0ZW1Nb2RlbChPYmplY3QuYXNzaWduKHByb3BlcnR5RGVmaW5pdGlvbiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGl2YWx1ZWQ6IGlzTXVsdGlWYWx1ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwaXBlczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgcGlwZTogdGhpcy5kZWNpbWFsTnVtYmVyUGlwZSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgcGlwZTogdGhpcy5tdWx0aVZhbHVlUGlwZSwgcGFyYW1zOiBbdGhpcy52YWx1ZVNlcGFyYXRvcl0gfVxuICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBEX0RBVEU6XG4gICAgICAgICAgICAgICAgICAgIGNhcmRWaWV3SXRlbVByb3BlcnR5ID0gbmV3IENhcmRWaWV3RGF0ZUl0ZW1Nb2RlbChPYmplY3QuYXNzaWduKHByb3BlcnR5RGVmaW5pdGlvbiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGl2YWx1ZWQ6IGlzTXVsdGlWYWx1ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwaXBlczogW3sgcGlwZTogdGhpcy5tdWx0aVZhbHVlUGlwZSwgcGFyYW1zOiBbdGhpcy52YWx1ZVNlcGFyYXRvcl0gfV1cbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgRF9EQVRFVElNRTpcbiAgICAgICAgICAgICAgICAgICAgY2FyZFZpZXdJdGVtUHJvcGVydHkgPSBuZXcgQ2FyZFZpZXdEYXRldGltZUl0ZW1Nb2RlbChPYmplY3QuYXNzaWduKHByb3BlcnR5RGVmaW5pdGlvbiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGl2YWx1ZWQ6IGlzTXVsdGlWYWx1ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwaXBlczogW3sgcGlwZTogdGhpcy5tdWx0aVZhbHVlUGlwZSwgcGFyYW1zOiBbdGhpcy52YWx1ZVNlcGFyYXRvcl0gfV1cbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgRF9CT09MRUFOOlxuICAgICAgICAgICAgICAgICAgICBjYXJkVmlld0l0ZW1Qcm9wZXJ0eSA9IG5ldyBDYXJkVmlld0Jvb2xJdGVtTW9kZWwocHJvcGVydHlEZWZpbml0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIERfVEVYVDpcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBjYXJkVmlld0l0ZW1Qcm9wZXJ0eSA9IG5ldyBDYXJkVmlld1RleHRJdGVtTW9kZWwoT2JqZWN0LmFzc2lnbihwcm9wZXJ0eURlZmluaXRpb24sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpdmFsdWVkOiBpc011bHRpVmFsdWVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlsaW5lOiBpc011bHRpVmFsdWVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGlwZXM6IFt7IHBpcGU6IHRoaXMubXVsdGlWYWx1ZVBpcGUsIHBhcmFtczogW3RoaXMudmFsdWVTZXBhcmF0b3JdIH1dXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjYXJkVmlld0l0ZW1Qcm9wZXJ0eTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzTGlzdE9mVmFsdWVzKGNvbnN0cmFpbnQ6IENvbnN0cmFpbnRbXSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gY29uc3RyYWludD8uWzBdPy50eXBlID09PSAnTElTVCc7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRQcm9wZXJ0eUNvbnN0cmFpbnRzKHByb3BlcnR5TmFtZTogc3RyaW5nLCBkZWZpbml0aW9uOiBEZWZpbml0aW9uKTogQ29uc3RyYWludFtdIHtcbiAgICAgICAgcmV0dXJuIGRlZmluaXRpb24/LnByb3BlcnRpZXMuZmluZCgoaXRlbSkgPT4gaXRlbS5pZCA9PT0gcHJvcGVydHlOYW1lKT8uY29uc3RyYWludHMgPz8gW107XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGVja0VDTVR5cGVWYWxpZGl0eShlY21Qcm9wZXJ0eVR5cGU6IHN0cmluZykge1xuICAgICAgICBpZiAoUHJvcGVydHlHcm91cFRyYW5zbGF0b3JTZXJ2aWNlLlJFQ09HTklTRURfRUNNX1RZUEVTLmluZGV4T2YoZWNtUHJvcGVydHlUeXBlKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5lcnJvcihgVW5rbm93biB0eXBlIGZvciBtYXBwaW5nOiAke2VjbVByb3BlcnR5VHlwZX1gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaXNFbXB0eSh2YWx1ZTogYW55KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSAnJztcbiAgICB9XG59XG4iXX0=