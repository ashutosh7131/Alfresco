/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, ViewChild, ViewEncapsulation, EventEmitter, Input, Output } from '@angular/core';
import { PeopleProcessService, UserProcessModel, LogService, TranslationService } from '@alfresco/adf-core';
import { PeopleSearchFieldComponent } from '../people-search-field/people-search-field.component';
import { getDisplayUser } from '../../helpers/get-display-user';
import { of } from 'rxjs';
import { catchError } from 'rxjs/operators';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@alfresco/adf-core';
import * as ɵngcc2 from '../people-search-field/people-search-field.component';
import * as ɵngcc3 from '@angular/common';
import * as ɵngcc4 from '@angular/material/button';
import * as ɵngcc5 from '@angular/material/icon';

const _c0 = ["peopleSearchField"];
function PeopleSelectorComponent_button_2_Template(rf, ctx) { if (rf & 1) {
    const _r3 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 3);
    ɵngcc0.ɵɵlistener("click", function PeopleSelectorComponent_button_2_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r3); const ctx_r2 = ɵngcc0.ɵɵnextContext(); return ctx_r2.userDeselected(); });
    ɵngcc0.ɵɵelementStart(1, "mat-icon");
    ɵngcc0.ɵɵtext(2, "cancel");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} }
const DEFAULT_ASSIGNEE_PLACEHOLDER = 'ADF_TASK_LIST.PEOPLE.ASSIGNEE';
export class PeopleSelectorComponent {
    constructor(peopleProcessService, logService, translationService) {
        this.peopleProcessService = peopleProcessService;
        this.logService = logService;
        this.translationService = translationService;
        this.peopleIdChange = new EventEmitter();
        this.performSearch = this.searchUser.bind(this);
        this.defaultPlaceholder = this.translationService.instant(DEFAULT_ASSIGNEE_PLACEHOLDER);
    }
    searchUser(searchWord) {
        return this.peopleProcessService.getWorkflowUsers(undefined, searchWord)
            .pipe(catchError(this.onSearchUserError.bind(this)));
    }
    onSearchUserError() {
        this.logService.error('getWorkflowUsers threw error');
        return of([]);
    }
    userSelected(user) {
        this.updateUserSelection(user);
    }
    userDeselected() {
        this.updateUserSelection(undefined);
    }
    updateUserSelection(user) {
        this.selectedUser = user;
        this.peopleIdChange.emit(user && user.id || undefined);
        this.searchFieldComponent.reset();
    }
    get placeholder() {
        if (!this.selectedUser) {
            return this.defaultPlaceholder;
        }
        return getDisplayUser(this.selectedUser.firstName, this.selectedUser.lastName, ' ');
    }
}
PeopleSelectorComponent.ɵfac = function PeopleSelectorComponent_Factory(t) { return new (t || PeopleSelectorComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.PeopleProcessService), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.LogService), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.TranslationService)); };
PeopleSelectorComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: PeopleSelectorComponent, selectors: [["adf-people-selector"]], viewQuery: function PeopleSelectorComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵstaticViewQuery(_c0, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.searchFieldComponent = _t.first);
    } }, hostAttrs: [1, "adf-people-selector"], inputs: { peopleId: "peopleId" }, outputs: { peopleIdChange: "peopleIdChange" }, decls: 3, vars: 3, consts: [[1, "adf-people-selector-field", 3, "performSearch", "placeholder", "rowClick"], ["peopleSearchField", ""], ["mat-icon-button", "", "class", "adf-people-selector-deselect", "data-automation-id", "adf-people-selector-deselect", 3, "click", 4, "ngIf"], ["mat-icon-button", "", "data-automation-id", "adf-people-selector-deselect", 1, "adf-people-selector-deselect", 3, "click"]], template: function PeopleSelectorComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "adf-people-search-field", 0, 1);
        ɵngcc0.ɵɵlistener("rowClick", function PeopleSelectorComponent_Template_adf_people_search_field_rowClick_0_listener($event) { return ctx.userSelected($event); });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(2, PeopleSelectorComponent_button_2_Template, 3, 0, "button", 2);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("performSearch", ctx.performSearch)("placeholder", ctx.placeholder);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.selectedUser);
    } }, directives: [ɵngcc2.PeopleSearchFieldComponent, ɵngcc3.NgIf, ɵngcc4.MatButton, ɵngcc5.MatIcon], styles: [".adf-people-selector{display:flex;flex-flow:row;justify-content:space-between}.adf-people-selector-field{flex:1 1 auto}.adf-people-selector-deselect{flex:0 0 auto;right:5px;top:5px}"], encapsulation: 2 });
PeopleSelectorComponent.ctorParameters = () => [
    { type: PeopleProcessService },
    { type: LogService },
    { type: TranslationService }
];
PeopleSelectorComponent.propDecorators = {
    peopleId: [{ type: Input }],
    peopleIdChange: [{ type: Output }],
    searchFieldComponent: [{ type: ViewChild, args: ['peopleSearchField', { static: true },] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(PeopleSelectorComponent, [{
        type: Component,
        args: [{
                selector: 'adf-people-selector',
                template: "<adf-people-search-field\n    #peopleSearchField\n    class=\"adf-people-selector-field\"\n    [performSearch]=\"performSearch\"\n    [placeholder]=\"placeholder\"\n    (rowClick)=\"userSelected($event)\">\n</adf-people-search-field>\n<button\n    *ngIf=\"selectedUser\"\n    mat-icon-button\n    class=\"adf-people-selector-deselect\"\n    data-automation-id=\"adf-people-selector-deselect\"\n    (click)=\"userDeselected()\">\n        <mat-icon>cancel</mat-icon>\n</button>\n",
                host: { 'class': 'adf-people-selector' },
                encapsulation: ViewEncapsulation.None,
                styles: [".adf-people-selector{display:flex;flex-flow:row;justify-content:space-between}.adf-people-selector-field{flex:1 1 auto}.adf-people-selector-deselect{flex:0 0 auto;right:5px;top:5px}"]
            }]
    }], function () { return [{ type: ɵngcc1.PeopleProcessService }, { type: ɵngcc1.LogService }, { type: ɵngcc1.TranslationService }]; }, { peopleIdChange: [{
            type: Output
        }], peopleId: [{
            type: Input
        }], searchFieldComponent: [{
            type: ViewChild,
            args: ['peopleSearchField', { static: true }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGVvcGxlLXNlbGVjdG9yLmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL3Byb2Nlc3Mtc2VydmljZXMvc3JjL2xpYi9wZW9wbGUvY29tcG9uZW50cy9wZW9wbGUtc2VsZWN0b3IvcGVvcGxlLXNlbGVjdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBRUgsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFckcsT0FBTyxFQUFFLG9CQUFvQixFQUFFLGdCQUFnQixFQUFFLFVBQVUsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzVHLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLHNEQUFzRCxDQUFDO0FBQ2xHLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNoRSxPQUFPLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRTVDLE1BQU0sNEJBQTRCLEdBQUcsK0JBQStCLENBQUM7QUFVckUsTUFBTSxPQUFPLHVCQUF1QjtBQUNwQyxJQWVJLFlBQ1ksb0JBQTBDLEVBQzFDLFVBQXNCLEVBQ3RCLGtCQUFzQztBQUN0RCxRQUhnQix5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCO0FBQUMsUUFDM0MsZUFBVSxHQUFWLFVBQVUsQ0FBWTtBQUFDLFFBQ3ZCLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7QUFBQyxRQUUvQyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7QUFDakQsUUFBUSxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3hELFFBQVEsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsNEJBQTRCLENBQUMsQ0FBQztBQUNoRyxJQUFJLENBQUM7QUFDTCxJQUNJLFVBQVUsQ0FBQyxVQUFrQjtBQUFJLFFBQzdCLE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxVQUFVLENBQUM7QUFDaEYsYUFBYSxJQUFJLENBQ0QsVUFBVSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FDaEQsQ0FBQztBQUNkLElBQUksQ0FBQztBQUNMLElBQ1ksaUJBQWlCO0FBQUssUUFDMUIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsOEJBQThCLENBQUMsQ0FBQztBQUM5RCxRQUFRLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ3RCLElBQUksQ0FBQztBQUNMLElBQ0ksWUFBWSxDQUFDLElBQXNCO0FBQUksUUFDbkMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3ZDLElBQUksQ0FBQztBQUNMLElBQ0ksY0FBYztBQUFLLFFBQ2YsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQzVDLElBQUksQ0FBQztBQUNMLElBQ1ksbUJBQW1CLENBQUMsSUFBc0I7QUFBSSxRQUNsRCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztBQUNqQyxRQUFRLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsRUFBRSxJQUFJLFNBQVMsQ0FBQyxDQUFDO0FBQy9ELFFBQVEsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEtBQUssRUFBRSxDQUFDO0FBQzFDLElBQUksQ0FBQztBQUNMLElBQ0ksSUFBSSxXQUFXO0FBQ25CLFFBQVEsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUU7QUFDaEMsWUFBWSxPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztBQUMzQyxTQUFTO0FBQ1QsUUFDUSxPQUFPLGNBQWMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztBQUM1RixJQUFJLENBQUM7QUFDTDttREFuRUMsU0FBUyxTQUFDLGtCQUNQLFFBQVEsRUFBRSxxQkFBcUIsa0JBQy9COzs7OztrRUFBK0Msa0JBRS9DLElBQUksRUFBRSxFQUFFO0FBQU8sRUFBRSxxQkFBcUIsRUFBRSxrQkFDeEMsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUksaU9BQ3hDOzs7Ozs7Ozs7Z1VBRUc7QUFBQztBQUdKLFlBbkJRLG9CQUFvQjtBQUFJLFlBQWdCLFVBQVU7QUFBSSxZQUFGLGtCQUFrQjtBQUFHO0FBQUc7QUFDbEUsdUJBaUJkLEtBQUs7QUFDUiw2QkFHRyxNQUFNO0FBQ1QsbUNBRUcsU0FBUyxTQUFDLG1CQUFtQixFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtBQUNoRDs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgVmlld0NoaWxkLCBWaWV3RW5jYXBzdWxhdGlvbiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBQZXJmb3JtU2VhcmNoQ2FsbGJhY2sgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL3BlcmZvcm0tc2VhcmNoLWNhbGxiYWNrLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQZW9wbGVQcm9jZXNzU2VydmljZSwgVXNlclByb2Nlc3NNb2RlbCwgTG9nU2VydmljZSwgVHJhbnNsYXRpb25TZXJ2aWNlIH0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IFBlb3BsZVNlYXJjaEZpZWxkQ29tcG9uZW50IH0gZnJvbSAnLi4vcGVvcGxlLXNlYXJjaC1maWVsZC9wZW9wbGUtc2VhcmNoLWZpZWxkLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBnZXREaXNwbGF5VXNlciB9IGZyb20gJy4uLy4uL2hlbHBlcnMvZ2V0LWRpc3BsYXktdXNlcic7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuY29uc3QgREVGQVVMVF9BU1NJR05FRV9QTEFDRUhPTERFUiA9ICdBREZfVEFTS19MSVNULlBFT1BMRS5BU1NJR05FRSc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLXBlb3BsZS1zZWxlY3RvcicsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3Blb3BsZS1zZWxlY3Rvci5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vcGVvcGxlLXNlbGVjdG9yLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgaG9zdDogeyAnY2xhc3MnOiAnYWRmLXBlb3BsZS1zZWxlY3RvcicgfSxcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXG59KVxuXG5leHBvcnQgY2xhc3MgUGVvcGxlU2VsZWN0b3JDb21wb25lbnQge1xuXG4gICAgQElucHV0KClcbiAgICBwZW9wbGVJZDogVXNlclByb2Nlc3NNb2RlbDtcblxuICAgIC8vIFBvb3JseSBkb2N1bWVudGVkIEFuZ3VsYXIgbWFnaWMgZm9yIFsocGVvcGxlSWQpXVxuICAgIEBPdXRwdXQoKVxuICAgIHBlb3BsZUlkQ2hhbmdlOiBFdmVudEVtaXR0ZXI8bnVtYmVyPjtcblxuICAgIEBWaWV3Q2hpbGQoJ3Blb3BsZVNlYXJjaEZpZWxkJywgeyBzdGF0aWM6IHRydWUgfSlcbiAgICBzZWFyY2hGaWVsZENvbXBvbmVudDogUGVvcGxlU2VhcmNoRmllbGRDb21wb25lbnQ7XG5cbiAgICBwZXJmb3JtU2VhcmNoOiBQZXJmb3JtU2VhcmNoQ2FsbGJhY2s7XG4gICAgc2VsZWN0ZWRVc2VyOiBVc2VyUHJvY2Vzc01vZGVsO1xuICAgIGRlZmF1bHRQbGFjZWhvbGRlcjogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgcGVvcGxlUHJvY2Vzc1NlcnZpY2U6IFBlb3BsZVByb2Nlc3NTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgdHJhbnNsYXRpb25TZXJ2aWNlOiBUcmFuc2xhdGlvblNlcnZpY2UpIHtcblxuICAgICAgICB0aGlzLnBlb3BsZUlkQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLnBlcmZvcm1TZWFyY2ggPSB0aGlzLnNlYXJjaFVzZXIuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5kZWZhdWx0UGxhY2Vob2xkZXIgPSB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS5pbnN0YW50KERFRkFVTFRfQVNTSUdORUVfUExBQ0VIT0xERVIpO1xuICAgIH1cblxuICAgIHNlYXJjaFVzZXIoc2VhcmNoV29yZDogc3RyaW5nKTogT2JzZXJ2YWJsZTx7fSB8IFVzZXJQcm9jZXNzTW9kZWxbXT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5wZW9wbGVQcm9jZXNzU2VydmljZS5nZXRXb3JrZmxvd1VzZXJzKHVuZGVmaW5lZCwgc2VhcmNoV29yZClcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IodGhpcy5vblNlYXJjaFVzZXJFcnJvci5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uU2VhcmNoVXNlckVycm9yKCk6IE9ic2VydmFibGU8VXNlclByb2Nlc3NNb2RlbFtdPiB7XG4gICAgICAgIHRoaXMubG9nU2VydmljZS5lcnJvcignZ2V0V29ya2Zsb3dVc2VycyB0aHJldyBlcnJvcicpO1xuICAgICAgICByZXR1cm4gb2YoW10pO1xuICAgIH1cblxuICAgIHVzZXJTZWxlY3RlZCh1c2VyOiBVc2VyUHJvY2Vzc01vZGVsKTogdm9pZCB7XG4gICAgICAgIHRoaXMudXBkYXRlVXNlclNlbGVjdGlvbih1c2VyKTtcbiAgICB9XG5cbiAgICB1c2VyRGVzZWxlY3RlZCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy51cGRhdGVVc2VyU2VsZWN0aW9uKHVuZGVmaW5lZCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVVc2VyU2VsZWN0aW9uKHVzZXI6IFVzZXJQcm9jZXNzTW9kZWwpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZFVzZXIgPSB1c2VyO1xuICAgICAgICB0aGlzLnBlb3BsZUlkQ2hhbmdlLmVtaXQodXNlciAmJiB1c2VyLmlkIHx8IHVuZGVmaW5lZCk7XG4gICAgICAgIHRoaXMuc2VhcmNoRmllbGRDb21wb25lbnQucmVzZXQoKTtcbiAgICB9XG5cbiAgICBnZXQgcGxhY2Vob2xkZXIoKSB7XG4gICAgICAgIGlmICghdGhpcy5zZWxlY3RlZFVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRlZmF1bHRQbGFjZWhvbGRlcjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBnZXREaXNwbGF5VXNlcih0aGlzLnNlbGVjdGVkVXNlci5maXJzdE5hbWUsIHRoaXMuc2VsZWN0ZWRVc2VyLmxhc3ROYW1lLCAnICcpO1xuICAgIH1cbn1cbiJdfQ==