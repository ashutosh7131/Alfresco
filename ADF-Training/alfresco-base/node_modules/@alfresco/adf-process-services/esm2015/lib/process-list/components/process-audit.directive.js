/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { DownloadService } from '@alfresco/adf-core';
import { Directive, EventEmitter, Input, Output } from '@angular/core';
import { ProcessService } from './../services/process.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@alfresco/adf-core';
import * as ɵngcc2 from './../services/process.service';
const JSON_FORMAT = 'json';
const PDF_FORMAT = 'pdf';
export class ProcessAuditDirective {
    constructor(downloadService, processListService) {
        this.downloadService = downloadService;
        this.processListService = processListService;
        this.fileName = 'Audit';
        this.format = 'pdf';
        this.download = true;
        this.clicked = new EventEmitter();
        this.error = new EventEmitter();
    }
    ngOnChanges() {
        if (!this.isValidType()) {
            this.setDefaultFormatType();
        }
    }
    isValidType() {
        return this.format && (this.isJsonFormat() || this.isPdfFormat());
    }
    setDefaultFormatType() {
        this.format = PDF_FORMAT;
    }
    fetchAuditInfo() {
        if (this.isPdfFormat()) {
            this.processListService.fetchProcessAuditPdfById(this.processId).subscribe((blob) => {
                if (this.download) {
                    this.downloadService.downloadBlob(blob, this.fileName + '.pdf');
                }
                this.clicked.emit({ format: this.format, value: blob, fileName: this.fileName });
            }, (err) => this.error.emit(err));
        }
        else {
            this.processListService.fetchProcessAuditJsonById(this.processId).subscribe((res) => this.clicked.emit({ format: this.format, value: res, fileName: this.fileName }), (err) => this.error.emit(err));
        }
    }
    onClickAudit() {
        this.fetchAuditInfo();
    }
    isJsonFormat() {
        return this.format === JSON_FORMAT;
    }
    isPdfFormat() {
        return this.format === PDF_FORMAT;
    }
}
ProcessAuditDirective.ɵfac = function ProcessAuditDirective_Factory(t) { return new (t || ProcessAuditDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.DownloadService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ProcessService)); };
ProcessAuditDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: ProcessAuditDirective, selectors: [["button", "adf-process-audit", ""]], hostAttrs: ["role", "button"], hostBindings: function ProcessAuditDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function ProcessAuditDirective_click_HostBindingHandler() { return ctx.onClickAudit(); });
    } }, inputs: { fileName: "fileName", format: "format", download: "download", processId: ["process-id", "processId"] }, outputs: { clicked: "clicked", error: "error" }, features: [ɵngcc0.ɵɵNgOnChangesFeature] });
ProcessAuditDirective.ctorParameters = () => [
    { type: DownloadService },
    { type: ProcessService }
];
ProcessAuditDirective.propDecorators = {
    processId: [{ type: Input, args: ['process-id',] }],
    fileName: [{ type: Input }],
    format: [{ type: Input }],
    download: [{ type: Input }],
    clicked: [{ type: Output }],
    error: [{ type: Output }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ProcessAuditDirective, [{
        type: Directive,
        args: [{
                selector: 'button[adf-process-audit]',
                host: {
                    'role': 'button',
                    '(click)': 'onClickAudit()'
                }
            }]
    }], function () { return [{ type: ɵngcc1.DownloadService }, { type: ɵngcc2.ProcessService }]; }, { fileName: [{
            type: Input
        }], format: [{
            type: Input
        }], download: [{
            type: Input
        }], clicked: [{
            type: Output
        }], error: [{
            type: Output
        }], processId: [{
            type: Input,
            args: ['process-id']
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzcy1hdWRpdC5kaXJlY3RpdmUuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9wcm9jZXNzLXNlcnZpY2VzL3NyYy9saWIvcHJvY2Vzcy1saXN0L2NvbXBvbmVudHMvcHJvY2Vzcy1hdWRpdC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUlILE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQWEsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2xGLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQzs7OztBQUUvRCxNQUFNLFdBQVcsR0FBVyxNQUFNLENBQUM7QUFDbkMsTUFBTSxVQUFVLEdBQVcsS0FBSyxDQUFDO0FBVWpDLE1BQU0sT0FBTyxxQkFBcUI7QUFBRyxJQThCakMsWUFBb0IsZUFBZ0MsRUFDaEMsa0JBQWtDO0FBQzFELFFBRndCLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtBQUFDLFFBQ2pDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBZ0I7QUFBQyxRQXZCdkQsYUFBUSxHQUFXLE9BQU8sQ0FBQztBQUMvQixRQUdJLFdBQU0sR0FBVyxLQUFLLENBQUM7QUFDM0IsUUFHSSxhQUFRLEdBQVksSUFBSSxDQUFDO0FBQzdCLFFBR0ksWUFBTyxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO0FBQ3pELFFBR0ksVUFBSyxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO0FBQ3ZELElBT0ksQ0FBQztBQUNMLElBQ0ksV0FB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b2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vKiB0c2xpbnQ6ZGlzYWJsZTpuby1pbnB1dC1yZW5hbWUgICovXG5cbmltcG9ydCB7IERvd25sb2FkU2VydmljZSB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBEaXJlY3RpdmUsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBQcm9jZXNzU2VydmljZSB9IGZyb20gJy4vLi4vc2VydmljZXMvcHJvY2Vzcy5zZXJ2aWNlJztcblxuY29uc3QgSlNPTl9GT1JNQVQ6IHN0cmluZyA9ICdqc29uJztcbmNvbnN0IFBERl9GT1JNQVQ6IHN0cmluZyA9ICdwZGYnO1xuXG5ARGlyZWN0aXZlKHtcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IGRpcmVjdGl2ZS1zZWxlY3RvclxuICAgIHNlbGVjdG9yOiAnYnV0dG9uW2FkZi1wcm9jZXNzLWF1ZGl0XScsXG4gICAgaG9zdDoge1xuICAgICAgICAncm9sZSc6ICdidXR0b24nLFxuICAgICAgICAnKGNsaWNrKSc6ICdvbkNsaWNrQXVkaXQoKSdcbiAgICB9XG59KVxuZXhwb3J0IGNsYXNzIFByb2Nlc3NBdWRpdERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XG5cbiAgICAvKiogSUQgb2YgdGhlIHByb2Nlc3MuICovXG4gICAgQElucHV0KCdwcm9jZXNzLWlkJylcbiAgICBwcm9jZXNzSWQ6IHN0cmluZztcblxuICAgIC8qKiBOYW1lIG9mIHRoZSBmaWxlIHRvIGRvd25sb2FkIChmb3IgUERGIGRvd25sb2FkcykuICovXG4gICAgQElucHV0KClcbiAgICBmaWxlTmFtZTogc3RyaW5nID0gJ0F1ZGl0JztcblxuICAgIC8qKiBGb3JtYXQgZm9yIHRoZSBhdWRpdCBpbmZvcm1hdGlvbiAoY2FuIGJlIFwicGRmXCIgb3IgXCJqc29uXCIpLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZm9ybWF0OiBzdHJpbmcgPSAncGRmJztcblxuICAgIC8qKiBFbmFibGVzIGRvd25sb2FkaW5nIG9mIHRoZSBhdWRpdCBmaWxlIG9uIGNsaWNraW5nLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZG93bmxvYWQ6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgZGVjb3JhdGVkIGVsZW1lbnQgaXMgY2xpY2tlZC4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBjbGlja2VkOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMuICovXG4gICAgQE91dHB1dCgpXG4gICAgZXJyb3I6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gZG93bmxvYWRTZXJ2aWNlXG4gICAgICogQHBhcmFtIHByb2Nlc3NMaXN0U2VydmljZVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZG93bmxvYWRTZXJ2aWNlOiBEb3dubG9hZFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBwcm9jZXNzTGlzdFNlcnZpY2U6IFByb2Nlc3NTZXJ2aWNlKSB7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5pc1ZhbGlkVHlwZSgpKSB7XG4gICAgICAgICAgICB0aGlzLnNldERlZmF1bHRGb3JtYXRUeXBlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpc1ZhbGlkVHlwZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0ICYmICh0aGlzLmlzSnNvbkZvcm1hdCgpIHx8IHRoaXMuaXNQZGZGb3JtYXQoKSk7XG4gICAgfVxuXG4gICAgc2V0RGVmYXVsdEZvcm1hdFR5cGUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZm9ybWF0ID0gUERGX0ZPUk1BVDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBmZXRjaCB0aGUgYXVkaXQgaW5mb3JtYXRpb24gaW4gdGhlIHJlcXVlc3RlZCBmb3JtYXRcbiAgICAgKi9cbiAgICBmZXRjaEF1ZGl0SW5mbygpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuaXNQZGZGb3JtYXQoKSkge1xuICAgICAgICAgICAgdGhpcy5wcm9jZXNzTGlzdFNlcnZpY2UuZmV0Y2hQcm9jZXNzQXVkaXRQZGZCeUlkKHRoaXMucHJvY2Vzc0lkKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKGJsb2I6IEJsb2IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZG93bmxvYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZG93bmxvYWRTZXJ2aWNlLmRvd25sb2FkQmxvYihibG9iLCB0aGlzLmZpbGVOYW1lICsgJy5wZGYnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWNrZWQuZW1pdCh7IGZvcm1hdDogdGhpcy5mb3JtYXQsIHZhbHVlOiBibG9iLCBmaWxlTmFtZTogdGhpcy5maWxlTmFtZSB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnIpID0+IHRoaXMuZXJyb3IuZW1pdChlcnIpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0xpc3RTZXJ2aWNlLmZldGNoUHJvY2Vzc0F1ZGl0SnNvbkJ5SWQodGhpcy5wcm9jZXNzSWQpLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAocmVzKSA9PiB0aGlzLmNsaWNrZWQuZW1pdCh7IGZvcm1hdDogdGhpcy5mb3JtYXQsIHZhbHVlOiByZXMsIGZpbGVOYW1lOiB0aGlzLmZpbGVOYW1lIH0pLFxuICAgICAgICAgICAgICAgIChlcnIpID0+IHRoaXMuZXJyb3IuZW1pdChlcnIpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uQ2xpY2tBdWRpdCgpIHtcbiAgICAgICAgdGhpcy5mZXRjaEF1ZGl0SW5mbygpO1xuICAgIH1cblxuICAgIGlzSnNvbkZvcm1hdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0ID09PSBKU09OX0ZPUk1BVDtcbiAgICB9XG5cbiAgICBpc1BkZkZvcm1hdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0ID09PSBQREZfRk9STUFUO1xuICAgIH1cblxufVxuIl19