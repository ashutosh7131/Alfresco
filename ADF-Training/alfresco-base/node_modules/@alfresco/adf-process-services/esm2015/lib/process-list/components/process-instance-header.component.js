/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { AppConfigService, CardViewDateItemModel, CardViewTextItemModel, TranslationService } from '@alfresco/adf-core';
import { Component, Input } from '@angular/core';
import { ProcessInstance } from '../models/process-instance.model';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@alfresco/adf-core';
import * as ɵngcc2 from '@angular/common';
import * as ɵngcc3 from '@angular/material/card';

function ProcessInstanceHeaderComponent_mat_card_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "mat-card", 1);
    ɵngcc0.ɵɵelementStart(1, "mat-card-content");
    ɵngcc0.ɵɵelement(2, "adf-card-view", 2);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("properties", ctx_r0.properties);
} }
export class ProcessInstanceHeaderComponent {
    constructor(translationService, appConfig) {
        this.translationService = translationService;
        this.appConfig = appConfig;
        this.dateFormat = this.appConfig.get('dateValues.defaultDateFormat');
        this.dateLocale = this.appConfig.get('dateValues.defaultDateLocale');
    }
    ngOnChanges() {
        this.refreshData();
    }
    refreshData() {
        if (this.processInstance) {
            const defaultProperties = this.initDefaultProperties();
            const filteredProperties = this.appConfig.get('adf-process-instance-header.presets.properties');
            this.properties = defaultProperties.filter((cardItem) => this.isValidSelection(filteredProperties, cardItem));
        }
    }
    initDefaultProperties() {
        return [
            new CardViewTextItemModel({
                label: 'ADF_PROCESS_LIST.PROPERTIES.STATUS',
                value: this.getProcessStatus(),
                key: 'status'
            }),
            new CardViewDateItemModel({
                label: 'ADF_PROCESS_LIST.PROPERTIES.END_DATE',
                value: this.processInstance.ended,
                format: this.dateFormat,
                locale: this.dateLocale,
                key: 'ended',
                default: this.translationService.instant('ADF_PROCESS_LIST.PROPERTIES.END_DATE_DEFAULT')
            }),
            new CardViewTextItemModel({
                label: 'ADF_PROCESS_LIST.PROPERTIES.CATEGORY',
                value: this.processInstance.processDefinitionCategory,
                key: 'category',
                default: this.translationService.instant('ADF_PROCESS_LIST.PROPERTIES.CATEGORY_DEFAULT')
            }),
            new CardViewTextItemModel({
                label: 'ADF_PROCESS_LIST.PROPERTIES.BUSINESS_KEY',
                value: this.processInstance.businessKey,
                key: 'businessKey',
                default: this.translationService.instant('ADF_PROCESS_LIST.PROPERTIES.BUSINESS_KEY_DEFAULT')
            }),
            new CardViewTextItemModel({
                label: 'ADF_PROCESS_LIST.PROPERTIES.CREATED_BY',
                value: this.getStartedByFullName(),
                key: 'createdBy',
                default: this.translationService.instant('ADF_PROCESS_LIST.PROPERTIES.CREATED_BY_DEFAULT')
            }),
            new CardViewDateItemModel({
                label: 'ADF_PROCESS_LIST.PROPERTIES.CREATED',
                value: this.processInstance.started,
                format: this.dateFormat,
                locale: this.dateLocale,
                key: 'created'
            }),
            new CardViewTextItemModel({ label: 'ADF_PROCESS_LIST.PROPERTIES.ID',
                value: this.processInstance.id,
                key: 'id'
            }),
            new CardViewTextItemModel({ label: 'ADF_PROCESS_LIST.PROPERTIES.DESCRIPTION',
                value: this.processInstance.processDefinitionDescription,
                key: 'description',
                default: this.translationService.instant('ADF_PROCESS_LIST.PROPERTIES.DESCRIPTION_DEFAULT')
            })
        ];
    }
    isValidSelection(filteredProperties, cardItem) {
        return filteredProperties ? filteredProperties.indexOf(cardItem.key) >= 0 : true;
    }
    getProcessStatus() {
        if (this.processInstance) {
            return this.isRunning() ? 'Running' : 'Completed';
        }
        return 'Unknown';
    }
    getStartedByFullName() {
        let fullName = '';
        if (this.processInstance && this.processInstance.startedBy) {
            fullName += this.processInstance.startedBy.firstName || '';
            fullName += fullName ? ' ' : '';
            fullName += this.processInstance.startedBy.lastName || '';
        }
        return fullName;
    }
    isRunning() {
        return this.processInstance && !this.processInstance.ended;
    }
}
ProcessInstanceHeaderComponent.ɵfac = function ProcessInstanceHeaderComponent_Factory(t) { return new (t || ProcessInstanceHeaderComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.TranslationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.AppConfigService)); };
ProcessInstanceHeaderComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ProcessInstanceHeaderComponent, selectors: [["adf-process-instance-header"]], inputs: { processInstance: "processInstance" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 1, vars: 1, consts: [["class", "adf-card-container", 4, "ngIf"], [1, "adf-card-container"], [3, "properties"]], template: function ProcessInstanceHeaderComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, ProcessInstanceHeaderComponent_mat_card_0_Template, 3, 1, "mat-card", 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", ctx.processInstance);
    } }, directives: [ɵngcc2.NgIf, ɵngcc3.MatCard, ɵngcc3.MatCardContent, ɵngcc1.CardViewComponent], styles: ["[_nghost-%COMP%]{width:100%}.adf-card-container[_ngcontent-%COMP%]{font-family:inherit}"] });
ProcessInstanceHeaderComponent.ctorParameters = () => [
    { type: TranslationService },
    { type: AppConfigService }
];
ProcessInstanceHeaderComponent.propDecorators = {
    processInstance: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ProcessInstanceHeaderComponent, [{
        type: Component,
        args: [{
                selector: 'adf-process-instance-header',
                template: "<mat-card *ngIf=\"processInstance\" class=\"adf-card-container\">\n    <mat-card-content>\n        <adf-card-view [properties]=\"properties\"></adf-card-view>\n    </mat-card-content>\n</mat-card>\n",
                styles: [":host{width:100%}.adf-card-container{font-family:inherit}"]
            }]
    }], function () { return [{ type: ɵngcc1.TranslationService }, { type: ɵngcc1.AppConfigService }]; }, { processInstance: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzcy1pbnN0YW5jZS1oZWFkZXIuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9ob21lL3RyYXZpcy9idWlsZC9BbGZyZXNjby9hbGZyZXNjby1uZzItY29tcG9uZW50cy9saWIvcHJvY2Vzcy1zZXJ2aWNlcy9zcmMvbGliL3Byb2Nlc3MtbGlzdC9jb21wb25lbnRzL3Byb2Nlc3MtaW5zdGFuY2UtaGVhZGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBRUgsT0FBTyxFQUFFLGdCQUFnQixFQUFFLHFCQUFxQixFQUF1QyxxQkFBcUIsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzdKLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBQzVELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFPbkUsTUFBTSxPQUFPLDhCQUE4QjtBQUFHLElBVTFDLFlBQW9CLGtCQUFzQyxFQUN0QyxTQUEyQjtBQUNuRCxRQUZ3Qix1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO0FBQUMsUUFDdkMsY0FBUyxHQUFULFNBQVMsQ0FBa0I7QUFBQyxRQUM1QyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLDhCQUE4QixDQUFDLENBQUM7QUFDN0UsUUFBUSxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLDhCQUE4QixDQUFDLENBQUM7QUFDN0UsSUFBSSxDQUFDO0FBQ0wsSUFDSSxXQUFXO0FBQ2YsUUFBUSxJQUFJLENBQUMsV0FBVyxFQUFFLENB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QUFDLENBQUMsRUFBRSxDQUFDO0FBQzVDLFlBQVksUUFBUSxJQUFJLElBQUksQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDLFFBQVEsSUFBSSxFQUFFLENBQUM7QUFDdEUsU0FBUztBQUNULFFBQVEsT0FBTyxRQUFRLENBQUM7QUFDeEIsSUFBSSxDQUFDO0FBQ0wsSUFDSSxTQUFTO0FBQUssUUFDVixPQUFPLElBQUksQ0FBQyxlQUFlLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQztBQUNuRSxJQUFJLENBQUM7QUFDTDswREFySEMsU0FBUyxTQUFDLGtCQUNQLFFBQVEsRUFBRSw2QkFBNkIsa0JBQ3ZDO2lIQUF1RCxxR0FFMUQ7Ozs7NE1BQ0k7QUFBQztBQUF3RCxZQVRnRCxrQkFBa0I7QUFBSSxZQUEzSCxnQkFBZ0I7QUFBRztBQUFHO0FBQWtELDhCQVk1RSxLQUFLO0FBQ1Q7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEFwcENvbmZpZ1NlcnZpY2UsIENhcmRWaWV3RGF0ZUl0ZW1Nb2RlbCwgQ2FyZFZpZXdJdGVtLCBDYXJkVmlld0Jhc2VJdGVtTW9kZWwsIENhcmRWaWV3VGV4dEl0ZW1Nb2RlbCwgVHJhbnNsYXRpb25TZXJ2aWNlIH0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUHJvY2Vzc0luc3RhbmNlIH0gZnJvbSAnLi4vbW9kZWxzL3Byb2Nlc3MtaW5zdGFuY2UubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi1wcm9jZXNzLWluc3RhbmNlLWhlYWRlcicsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3Byb2Nlc3MtaW5zdGFuY2UtaGVhZGVyLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9wcm9jZXNzLWluc3RhbmNlLWhlYWRlci5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgUHJvY2Vzc0luc3RhbmNlSGVhZGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcblxuICAgIC8qKiAoKipyZXF1aXJlZCoqKSBGdWxsIGRldGFpbHMgb2YgdGhlIHByb2Nlc3MgaW5zdGFuY2UgdG8gZGlzcGxheSBpbmZvcm1hdGlvbiBhYm91dC4gKi9cbiAgICBASW5wdXQoKVxuICAgIHByb2Nlc3NJbnN0YW5jZTogUHJvY2Vzc0luc3RhbmNlO1xuXG4gICAgcHJvcGVydGllczogQ2FyZFZpZXdJdGVtIFtdO1xuICAgIGRhdGVGb3JtYXQ6IHN0cmluZztcbiAgICBkYXRlTG9jYWxlOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHRyYW5zbGF0aW9uU2VydmljZTogVHJhbnNsYXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYXBwQ29uZmlnOiBBcHBDb25maWdTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuZGF0ZUZvcm1hdCA9IHRoaXMuYXBwQ29uZmlnLmdldCgnZGF0ZVZhbHVlcy5kZWZhdWx0RGF0ZUZvcm1hdCcpO1xuICAgICAgICB0aGlzLmRhdGVMb2NhbGUgPSB0aGlzLmFwcENvbmZpZy5nZXQoJ2RhdGVWYWx1ZXMuZGVmYXVsdERhdGVMb2NhbGUnKTtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcygpIHtcbiAgICAgICAgdGhpcy5yZWZyZXNoRGF0YSgpO1xuICAgIH1cblxuICAgIHJlZnJlc2hEYXRhKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5wcm9jZXNzSW5zdGFuY2UpIHtcbiAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRQcm9wZXJ0aWVzID0gdGhpcy5pbml0RGVmYXVsdFByb3BlcnRpZXMoKTtcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlcmVkUHJvcGVydGllczogc3RyaW5nW10gPSB0aGlzLmFwcENvbmZpZy5nZXQoJ2FkZi1wcm9jZXNzLWluc3RhbmNlLWhlYWRlci5wcmVzZXRzLnByb3BlcnRpZXMnKTtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydGllcyA9IGRlZmF1bHRQcm9wZXJ0aWVzLmZpbHRlcigoY2FyZEl0ZW0pID0+IHRoaXMuaXNWYWxpZFNlbGVjdGlvbihmaWx0ZXJlZFByb3BlcnRpZXMsIGNhcmRJdGVtKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGluaXREZWZhdWx0UHJvcGVydGllcygpOiBhbnlbXSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfUFJPQ0VTU19MSVNULlBST1BFUlRJRVMuU1RBVFVTJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ2V0UHJvY2Vzc1N0YXR1cygpLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdzdGF0dXMnXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdEYXRlSXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfUFJPQ0VTU19MSVNULlBST1BFUlRJRVMuRU5EX0RBVEUnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5wcm9jZXNzSW5zdGFuY2UuZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdDogdGhpcy5kYXRlRm9ybWF0LFxuICAgICAgICAgICAgICAgICAgICBsb2NhbGU6IHRoaXMuZGF0ZUxvY2FsZSxcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnZW5kZWQnLFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS5pbnN0YW50KCdBREZfUFJPQ0VTU19MSVNULlBST1BFUlRJRVMuRU5EX0RBVEVfREVGQVVMVCcpXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfUFJPQ0VTU19MSVNULlBST1BFUlRJRVMuQ0FURUdPUlknLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5wcm9jZXNzSW5zdGFuY2UucHJvY2Vzc0RlZmluaXRpb25DYXRlZ29yeSxcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnY2F0ZWdvcnknLFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS5pbnN0YW50KCdBREZfUFJPQ0VTU19MSVNULlBST1BFUlRJRVMuQ0FURUdPUllfREVGQVVMVCcpXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfUFJPQ0VTU19MSVNULlBST1BFUlRJRVMuQlVTSU5FU1NfS0VZJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMucHJvY2Vzc0luc3RhbmNlLmJ1c2luZXNzS2V5LFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdidXNpbmVzc0tleScsXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmluc3RhbnQoJ0FERl9QUk9DRVNTX0xJU1QuUFJPUEVSVElFUy5CVVNJTkVTU19LRVlfREVGQVVMVCcpXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfUFJPQ0VTU19MSVNULlBST1BFUlRJRVMuQ1JFQVRFRF9CWScsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdldFN0YXJ0ZWRCeUZ1bGxOYW1lKCksXG4gICAgICAgICAgICAgICAgICAgIGtleTogJ2NyZWF0ZWRCeScsXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmluc3RhbnQoJ0FERl9QUk9DRVNTX0xJU1QuUFJPUEVSVElFUy5DUkVBVEVEX0JZX0RFRkFVTFQnKVxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3RGF0ZUl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX1BST0NFU1NfTElTVC5QUk9QRVJUSUVTLkNSRUFURUQnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5wcm9jZXNzSW5zdGFuY2Uuc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiB0aGlzLmRhdGVGb3JtYXQsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsZTogdGhpcy5kYXRlTG9jYWxlLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdjcmVhdGVkJ1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3VGV4dEl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7bGFiZWw6ICdBREZfUFJPQ0VTU19MSVNULlBST1BFUlRJRVMuSUQnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnByb2Nlc3NJbnN0YW5jZS5pZCxcbiAgICAgICAgICAgICAgICBrZXk6ICdpZCdcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3VGV4dEl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7bGFiZWw6ICdBREZfUFJPQ0VTU19MSVNULlBST1BFUlRJRVMuREVTQ1JJUFRJT04nLFxuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnByb2Nlc3NJbnN0YW5jZS5wcm9jZXNzRGVmaW5pdGlvbkRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgIGtleTogJ2Rlc2NyaXB0aW9uJyxcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS5pbnN0YW50KCdBREZfUFJPQ0VTU19MSVNULlBST1BFUlRJRVMuREVTQ1JJUFRJT05fREVGQVVMVCcpXG4gICAgICAgICAgICB9KVxuICAgICAgICBdO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNWYWxpZFNlbGVjdGlvbihmaWx0ZXJlZFByb3BlcnRpZXM6IHN0cmluZ1tdLCBjYXJkSXRlbTogQ2FyZFZpZXdCYXNlSXRlbU1vZGVsKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBmaWx0ZXJlZFByb3BlcnRpZXMgPyBmaWx0ZXJlZFByb3BlcnRpZXMuaW5kZXhPZihjYXJkSXRlbS5rZXkpID49IDAgOiB0cnVlO1xuICAgIH1cblxuICAgIGdldFByb2Nlc3NTdGF0dXMoKTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHRoaXMucHJvY2Vzc0luc3RhbmNlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pc1J1bm5pbmcoKSA/ICdSdW5uaW5nJyA6ICdDb21wbGV0ZWQnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnVW5rbm93bic7XG4gICAgfVxuXG4gICAgZ2V0U3RhcnRlZEJ5RnVsbE5hbWUoKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IGZ1bGxOYW1lID0gJyc7XG4gICAgICAgIGlmICh0aGlzLnByb2Nlc3NJbnN0YW5jZSAmJiB0aGlzLnByb2Nlc3NJbnN0YW5jZS5zdGFydGVkQnkpIHtcbiAgICAgICAgICAgIGZ1bGxOYW1lICs9IHRoaXMucHJvY2Vzc0luc3RhbmNlLnN0YXJ0ZWRCeS5maXJzdE5hbWUgfHwgJyc7XG4gICAgICAgICAgICBmdWxsTmFtZSArPSBmdWxsTmFtZSA/ICcgJyA6ICcnO1xuICAgICAgICAgICAgZnVsbE5hbWUgKz0gdGhpcy5wcm9jZXNzSW5zdGFuY2Uuc3RhcnRlZEJ5Lmxhc3ROYW1lIHx8ICcnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmdWxsTmFtZTtcbiAgICB9XG5cbiAgICBpc1J1bm5pbmcoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NJbnN0YW5jZSAmJiAhdGhpcy5wcm9jZXNzSW5zdGFuY2UuZW5kZWQ7XG4gICAgfVxufVxuIl19