/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, EventEmitter, Input, Output, ViewChild, ViewEncapsulation } from '@angular/core';
import { ActivitiContentService, AppConfigService, AppConfigValues, AppsProcessService } from '@alfresco/adf-core';
import { ProcessDefinitionRepresentation } from './../models/process-definition.model';
import { ProcessInstance } from './../models/process-instance.model';
import { ProcessService } from './../services/process.service';
import { FormControl, Validators } from '@angular/forms';
import { Subject, forkJoin } from 'rxjs';
import { map, takeUntil } from 'rxjs/operators';
import { MatAutocompleteTrigger } from '@angular/material/autocomplete';
import { StartFormComponent } from '../../form';
import { ProcessNamePipe } from '../../pipes/process-name.pipe';
export class StartProcessInstanceComponent {
    constructor(activitiProcess, activitiContentService, appsProcessService, appConfig, processNamePipe) {
        this.activitiProcess = activitiProcess;
        this.activitiContentService = activitiContentService;
        this.appsProcessService = appsProcessService;
        this.appConfig = appConfig;
        this.processNamePipe = processNamePipe;
        this.MAX_LENGTH = 255;
        this.name = '';
        this.showSelectProcessDropdown = true;
        this.showSelectApplicationDropdown = false;
        this.processFilterSelector = true;
        this.start = new EventEmitter();
        this.cancel = new EventEmitter();
        this.error = new EventEmitter();
        this.processDefinitionSelection = new EventEmitter();
        this.applicationSelection = new EventEmitter();
        this.processDefinitions = [];
        this.maxProcessNameLength = this.MAX_LENGTH;
        this.applications = [];
        this.isProcessDefinitionsLoading = true;
        this.isAppsLoading = true;
        this.onDestroy$ = new Subject();
    }
    ngOnInit() {
        this.processNameInput = new FormControl('', [Validators.required, Validators.maxLength(this.maxProcessNameLength), Validators.pattern('^[^\\s]+(\\s+[^\\s]+)*$')]);
        this.processDefinitionInput = new FormControl();
        this.load();
        this.filteredProcessesDefinitions$ = this.processDefinitionInput.valueChanges
            .pipe(map((value) => this._filter(value)), takeUntil(this.onDestroy$));
        this.activitiContentService.getAlfrescoRepositories().subscribe((repoList) => {
            if (repoList && repoList[0]) {
                const alfrescoRepository = repoList[0];
                this.alfrescoRepositoryName = `alfresco-${alfrescoRepository.id}-${alfrescoRepository.name}`;
            }
        });
    }
    ngOnDestroy() {
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
    ngOnChanges(changes) {
        if (changes['values'] && changes['values'].currentValue) {
            this.moveNodeFromCStoPS();
        }
        if (this.isAppIdChanged(changes)) {
            this.appId = changes['appId'].currentValue;
            this.load();
        }
        if (this.isProcessDefinitionChanged(changes)) {
            this.processDefinitionName = changes['processDefinitionName'].currentValue;
            this.filterProcessDefinitionByName();
        }
    }
    isAppIdChanged(changes) {
        return changes['appId'] && changes['appId'].currentValue && changes['appId'].currentValue !== changes['appId'].previousValue;
    }
    isProcessDefinitionChanged(changes) {
        return changes['processDefinitionName'] && changes['processDefinitionName'].currentValue &&
            changes['processDefinitionName'].currentValue !== changes['processDefinitionName'].previousValue;
    }
    _filter(value) {
        if (value !== null && value !== undefined) {
            const filterValue = value.toLowerCase();
            const filteredProcess = this.processDefinitions.filter((option) => option.name.toLowerCase().includes(filterValue));
            if (this.processFilterSelector) {
                this.selectedProcessDef = this.getSelectedProcess(filterValue);
            }
            return filteredProcess;
        }
        return [];
    }
    getSelectedProcess(selectedProcess) {
        let processSelected = this.processDefinitions.find((process) => process.name.toLowerCase() === selectedProcess);
        if (!processSelected) {
            processSelected = new ProcessDefinitionRepresentation();
        }
        return processSelected;
    }
    load() {
        if (this.showSelectApplicationDropdown) {
            this.loadApps();
        }
        else {
            this.loadProcessDefinitions(this.appId);
        }
    }
    loadProcessDefinitions(appId) {
        this.isProcessDefinitionsLoading = true;
        this.resetSelectedProcessDefinition();
        this.activitiProcess.getProcessDefinitions(appId).pipe(map((processDefinitionRepresentations) => {
            let currentProcessDef;
            if (processDefinitionRepresentations.length === 1) {
                currentProcessDef = processDefinitionRepresentations[0];
            }
            if (this.processDefinitionName) {
                const filteredProcessDefinition = processDefinitionRepresentations.find((processDefinition) => {
                    return processDefinition.name === this.processDefinitionName;
                });
                if (filteredProcessDefinition) {
                    currentProcessDef = filteredProcessDefinition;
                }
            }
            return { currentProcessDef, processDefinitionRepresentations };
        })).subscribe((filteredProcessDefinitions) => {
            this.processDefinitions = filteredProcessDefinitions.processDefinitionRepresentations;
            this.processDefinitionSelectionChanged(filteredProcessDefinitions.currentProcessDef);
            this.processDefinitionInput.setValue(this.selectedProcessDef ? this.selectedProcessDef.name : '');
            this.isProcessDefinitionsLoading = false;
        }, (error) => {
            this.isProcessDefinitionsLoading = false;
            this.error.emit(error);
        });
    }
    filterProcessDefinitionByName() {
        if (this.processDefinitionName) {
            const filteredProcessDef = this.processDefinitions.find((processDefinition) => {
                return processDefinition.name === this.processDefinitionName;
            });
            if (filteredProcessDef) {
                this.processDefinitionSelectionChanged(filteredProcessDef);
                this.processDefinitionInput.setValue(this.selectedProcessDef ? this.selectedProcessDef.name : '');
            }
        }
    }
    loadApps() {
        this.isAppsLoading = true;
        this.appsProcessService
            .getDeployedApplications()
            .pipe(map((response) => {
            const applications = this.removeDefaultApps(response);
            let currentApplication;
            if (applications && applications.length === 1) {
                currentApplication = applications[0];
            }
            const filteredApp = applications.find(app => app.id === +this.appId);
            if (filteredApp) {
                currentApplication = filteredApp;
            }
            return { currentApplication, applications };
        }))
            .subscribe((filteredApps) => {
            this.applications = filteredApps.applications;
            this.selectedApplication = filteredApps.currentApplication;
            this.applicationSelection.emit(this.selectedApplication);
            this.toggleProcessNameAndDefinitionsDropdown();
            this.isAppsLoading = false;
            this.loadProcessDefinitionsBasedOnSelectedApp();
        }, (err) => {
            this.isAppsLoading = false;
            this.error.emit(err);
        });
    }
    loadProcessDefinitionsBasedOnSelectedApp() {
        if (this.selectedApplication && this.selectedApplication.id) {
            this.loadProcessDefinitions(this.selectedApplication ? this.selectedApplication.id : null);
        }
        else {
            this.isProcessDefinitionsLoading = false;
            this.resetProcessDefinitions();
        }
    }
    onAppSelectionChange(selectedApplication) {
        this.resetProcessDefinitions();
        this.selectedApplication = selectedApplication.value;
        this.applicationSelection.emit(this.selectedApplication);
        this.toggleProcessNameAndDefinitionsDropdown();
        this.loadProcessDefinitionsBasedOnSelectedApp();
    }
    isAppSelected() {
        return !!(this.selectedApplication && this.selectedApplication.id);
    }
    removeDefaultApps(apps) {
        return apps.filter((app) => app.id);
    }
    hasApplications() {
        return this.applications && this.applications.length > 0;
    }
    hasProcessDefinitions() {
        return this.processDefinitions && this.processDefinitions.length > 0;
    }
    isProcessDefinitionSelected() {
        return !!(this.selectedProcessDef && this.selectedProcessDef.id);
    }
    isProcessDefinitionsEmpty() {
        return this.processDefinitions.length === 0;
    }
    disableDropdownButton() {
        return this.showSelectApplicationDropdown && !this.isAppSelected();
    }
    getAlfrescoRepositoryName() {
        let alfrescoRepositoryName = this.appConfig.get(AppConfigValues.ALFRESCO_REPOSITORY_NAME);
        if (!alfrescoRepositoryName) {
            alfrescoRepositoryName = this.alfrescoRepositoryName;
        }
        return alfrescoRepositoryName + 'Alfresco';
    }
    moveNodeFromCStoPS() {
        const accountIdentifier = this.getAlfrescoRepositoryName();
        for (const key in this.values) {
            if (this.values.hasOwnProperty(key)) {
                const currentValue = Array.isArray(this.values[key]) ? this.values[key] : [this.values[key]];
                const contents = currentValue.filter((value) => value && value.isFile)
                    .map((content) => this.activitiContentService.applyAlfrescoNode(content, null, accountIdentifier));
                forkJoin(contents).subscribe((res) => {
                    this.movedNodeToPS = { [key]: [...res] };
                });
            }
        }
    }
    startProcess(outcome) {
        if (this.selectedProcessDef && this.selectedProcessDef.id && this.nameController.value) {
            const formValues = this.startForm ? this.startForm.form.values : undefined;
            this.activitiProcess.startProcess(this.selectedProcessDef.id, this.nameController.value, outcome, formValues, this.variables).subscribe((res) => {
                this.name = '';
                this.start.emit(res);
            }, (err) => {
                this.error.emit(err);
            });
        }
    }
    cancelStartProcess() {
        this.cancel.emit();
    }
    hasStartForm() {
        return this.selectedProcessDef && this.selectedProcessDef.hasStartForm;
    }
    isStartFormMissingOrValid() {
        if (this.startForm) {
            return this.startForm.form && this.startForm.form.isValid;
        }
        else {
            return true;
        }
    }
    validateForm() {
        return this.selectedProcessDef && this.selectedProcessDef.id && this.processNameInput.valid && this.isStartFormMissingOrValid();
    }
    resetSelectedProcessDefinition() {
        this.selectedProcessDef = undefined;
        if (this.processDefinitionInput) {
            this.processDefinitionInput.setValue('');
        }
    }
    resetProcessDefinitions() {
        this.processDefinitions = [];
        this.resetSelectedProcessDefinition();
    }
    onOutcomeClick(outcome) {
        this.startProcess(outcome);
    }
    reset() {
        this.resetSelectedProcessDefinition();
        this.name = '';
        if (this.startForm) {
            this.startForm.data = {};
        }
    }
    displayFn(process) {
        if (process) {
            let processName = process;
            if (typeof process !== 'string') {
                processName = process.name;
            }
            return processName;
        }
        return undefined;
    }
    displayDropdown(event) {
        event.stopPropagation();
        if (!this.inputAutocomplete.panelOpen) {
            this.processDefinitionInput.setValue('');
            this.inputAutocomplete.openPanel();
        }
        else {
            this.inputAutocomplete.closePanel();
        }
    }
    get nameController() {
        return this.processNameInput;
    }
    get processDefinitionController() {
        return this.processDefinitionInput;
    }
    toggleProcessNameAndDefinitionsDropdown() {
        if (!this.isAppSelected()) {
            this.processDefinitionController.disable();
            this.nameController.disable();
        }
        else {
            this.processDefinitionController.enable();
            this.nameController.enable();
        }
    }
    processDefinitionSelectionChanged(processDefinition) {
        if (processDefinition) {
            const processInstanceDetails = new ProcessInstance({ processDefinitionName: processDefinition.name });
            const processName = this.processNamePipe.transform(this.name, processInstanceDetails);
            this.processNameInput.setValue(processName);
            this.processNameInput.markAsDirty();
            this.processNameInput.markAsTouched();
            this.selectedProcessDef = processDefinition;
            this.processDefinitionSelection.emit(this.selectedProcessDef);
        }
        else {
            this.nameController.reset();
        }
    }
    isLoading() {
        return this.showSelectApplicationDropdown ? this.isAppsLoading : false;
    }
}
StartProcessInstanceComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-start-process',
                template: "\n<ng-container *ngIf=\"isLoading(); then showLoadingTemplate; else showStartProcessTemplate\"></ng-container>\n    <ng-template #showLoadingTemplate>\n        <mat-spinner class=\"adf-start-process-loading\"></mat-spinner>\n    </ng-template>\n<ng-template #showStartProcessTemplate>\n    <ng-container *ngIf=\"hasApplications() || hasProcessDefinitions() ; else showEmptyTemplate\">\n        <div class=\"adf-start-process\">\n            <div class=\"adf-title\" *ngIf=\"title\">{{ title | translate}}</div>\n            <div class=\"content\">\n                <div class=\"adf-start-process-definition-container\">\n                    <mat-form-field *ngIf=\"showSelectApplicationDropdown\" [floatLabel]=\"'always'\" class=\"adf-start-process-app-list\">\n                        <mat-select\n                            placeholder=\"{{ 'ADF_PROCESS_LIST.START_PROCESS.FORM.LABEL.SELECT_APPLICATION' | translate }}\"\n                            (selectionChange)=\"onAppSelectionChange($event)\"\n                            [(ngModel)]=\"selectedApplication\"\n                            data-automation-id=\"adf-start-process-apps-drop-down\">\n                            <mat-option \n                                *ngFor=\"let application of applications\"\n                                [value]=\"application\"\n                                [attr.data-automation-id]=\"'adf-start-process-apps-option-' + application.name\">\n                                {{ application.name }}\n                            </mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                    <mat-form-field class=\"adf-process-input-container\" [floatLabel]=\"'always'\">\n                        <mat-label>{{'ADF_PROCESS_LIST.START_PROCESS.FORM.LABEL.TYPE' | translate}}</mat-label>\n                        <input\n                            type=\"text\"\n                            matInput\n                            [formControl]=\"processDefinitionInput\"\n                            [matAutocomplete]=\"auto\"\n                            id=\"processDefinitionName\"\n                            #inputAutocomplete>\n                        <div class=\"adf-process-input-autocomplete\">\n                            <mat-autocomplete\n                                #auto=\"matAutocomplete\"\n                                id=\"processDefinitionOptions\"\n                                [displayWith]=\"displayFn\">\n                                <mat-option *ngFor=\"let processDef of filteredProcessesDefinitions$ | async\" [value]=\"processDef.name\"\n                                (click)=\"processDefinitionSelectionChanged(processDef)\">\n                                    {{ processDef.name }}\n                                </mat-option>\n                            </mat-autocomplete>\n                            <ng-container *ngIf=\"!isProcessDefinitionsLoading ; else showProcessDefLoadingTemplate\">\n                                <button\n                                    id=\"adf-select-process-dropdown\"\n                                    *ngIf=\"showSelectProcessDropdown\"\n                                    mat-icon-button\n                                    (click)=\"displayDropdown($event)\"\n                                    [disabled]=\"disableDropdownButton()\">\n                                    <mat-icon>arrow_drop_down</mat-icon>\n                                </button>\n                            </ng-container>\n                            <ng-template #showProcessDefLoadingTemplate>\n                                <mat-spinner id=\"adf-select-process-spinner\" [diameter]=\"20\"></mat-spinner>\n                            </ng-template>\n                        </div>\n                    </mat-form-field>\n                </div>\n                <mat-form-field class=\"adf-process-input-container\" [floatLabel]=\"'always'\">\n                    <mat-label>{{'ADF_PROCESS_LIST.START_PROCESS.FORM.LABEL.NAME' | translate}}</mat-label>\n                    <input\n                        matInput\n                        [formControl]=\"processNameInput\"\n                        id=\"processName\"\n                        required/>\n                    <mat-error *ngIf=\"nameController.hasError('maxlength')\">\n                        {{ 'ADF_PROCESS_LIST.START_PROCESS.ERROR.MAXIMUM_LENGTH' | translate : { characters : maxProcessNameLength } }}\n                    </mat-error>\n                    <mat-error *ngIf=\"nameController.hasError('required')\">\n                        {{ 'ADF_PROCESS_LIST.START_PROCESS.ERROR.PROCESS_NAME_REQUIRED' | translate }}\n                    </mat-error>\n                    <mat-error *ngIf=\"nameController.hasError('pattern')\">\n                        {{ 'ADF_PROCESS_LIST.START_PROCESS.ERROR.SPACE_VALIDATOR' | translate }}\n                    </mat-error>\n                </mat-form-field>\n        \n                <ng-container *ngIf=\"!isProcessDefinitionsLoading ; else showStartFormLoadingTemplate\">\n                    <ng-container *ngIf=\"isProcessDefinitionSelected() ; else emptyProcessDefTemplate\">\n                        <ng-container  *ngIf=\"hasStartForm(); else noStartFormTemplate\">\n                            <adf-start-form\n                                #startForm\n                                [data]=\"movedNodeToPS\"\n                                [disableStartProcessButton]=\"processNameInput.invalid\"\n                                [processDefinitionId]=\"selectedProcessDef.id\"\n                                (outcomeClick)=\"onOutcomeClick($event)\"\n                                [showRefreshButton]=\"false\">\n                                <button\n                                    adf-form-custom-button\n                                    mat-button\n                                    (click)=\"cancelStartProcess()\"\n                                    id=\"cancel_process\">\n                                    {{'ADF_PROCESS_LIST.START_PROCESS.FORM.ACTION.CANCEL'| translate | uppercase}}\n                                </button>\n                            </adf-start-form>\n                        </ng-container>\n                        <ng-template #noStartFormTemplate>\n                            <adf-empty-content \n                                class=\"adf-start-process-empty-template\"\n                                [icon]=\"'assessment'\"\n                                [title]=\"'ADF_PROCESS_LIST.START_PROCESS.NO_START_FORM'  | translate\">\n                            </adf-empty-content>\n                        </ng-template>\n                    </ng-container>\n                    <ng-template #emptyProcessDefTemplate>\n                        <adf-empty-content class=\"adf-start-process-empty-template\"\n                            [icon]=\"'assessment'\"\n                            [title]=\"'ADF_PROCESS_LIST.START_PROCESS.NO_PROCESS_DEF_SELECTED'  | translate\">\n                        </adf-empty-content>\n                    </ng-template>\n                </ng-container>\n                <ng-template #showStartFormLoadingTemplate>\n                    <mat-spinner class=\"adf-start-process-loading\"></mat-spinner>\n                </ng-template>\n            </div>\n            <div class=\"mat-content-actions\" *ngIf=\"!hasStartForm()\">\n                <button\n                    mat-button\n                    *ngIf=\"!hasStartForm()\"\n                    (click)=\"cancelStartProcess()\"\n                    id=\"cancel_process\">\n                    {{'ADF_PROCESS_LIST.START_PROCESS.FORM.ACTION.CANCEL'| translate | uppercase}}\n                </button>\n                <button\n                    color=\"primary\"\n                    mat-button\n                    *ngIf=\"!hasStartForm()\"\n                    [disabled]=\"!validateForm()\"\n                    (click)=\"startProcess()\"\n                    data-automation-id=\"btn-start\"\n                    id=\"button-start\"\n                    class=\"btn-start\">\n                    {{'ADF_PROCESS_LIST.START_PROCESS.FORM.ACTION.START' | translate | uppercase}}\n                </button>\n            </div>\n        </div>\n    </ng-container>\n        <ng-template #showEmptyTemplate>\n            <adf-empty-content class=\"adf-start-process-empty-template\"\n                [icon]=\"'assessment'\"\n                [title]=\"'ADF_PROCESS_LIST.START_PROCESS.NO_PROCESS_DEFINITIONS' | translate\">\n            </adf-empty-content>\n        </ng-template>    \n</ng-template>\n",
                encapsulation: ViewEncapsulation.None,
                styles: [".adf-start-process{margin-left:auto;margin-right:auto;margin-top:10px;width:96%}.adf-start-process mat-form-field{width:100%}.adf-start-process .mat-form-field-label{color:var(--theme-colors-mat-grey-dark)}.adf-start-process .mat-content-actions{text-align:right}.adf-start-process .mat-button{text-transform:uppercase!important}.adf-title{padding-bottom:1.25em}.adf-process-input-container mat-form-field{width:100%}.adf-process-input-autocomplete{display:flex}.adf-process-input-autocomplete button{position:absolute;right:-14px;top:0}.adf-process-input-autocomplete mat-spinner{position:absolute;right:-1px;top:0}.adf-start-form-container .mat-card{box-shadow:none!important;padding:0!important}.adf-start-form-actions{text-align:right!important}.adf-start-process-definition-container{align-items:baseline;display:flex;flex-direction:row;justify-content:space-around}.adf-start-process-app-list{margin-right:10px}@media (max-width:600px){.adf-start-process{margin-left:auto;margin-right:auto;width:90%}}.adf-start-process-loading{margin-left:calc(50% - 50px);margin-right:calc(50% - 50px)}"]
            },] }
];
StartProcessInstanceComponent.ctorParameters = () => [
    { type: ProcessService },
    { type: ActivitiContentService },
    { type: AppsProcessService },
    { type: AppConfigService },
    { type: ProcessNamePipe }
];
StartProcessInstanceComponent.propDecorators = {
    appId: [{ type: Input }],
    title: [{ type: Input }],
    processDefinitionName: [{ type: Input }],
    variables: [{ type: Input }],
    values: [{ type: Input }],
    name: [{ type: Input }],
    showSelectProcessDropdown: [{ type: Input }],
    showSelectApplicationDropdown: [{ type: Input }],
    processFilterSelector: [{ type: Input }],
    start: [{ type: Output }],
    cancel: [{ type: Output }],
    error: [{ type: Output }],
    processDefinitionSelection: [{ type: Output }],
    applicationSelection: [{ type: Output }],
    startForm: [{ type: ViewChild, args: ['startForm',] }],
    inputAutocomplete: [{ type: ViewChild, args: [MatAutocompleteTrigger,] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhcnQtcHJvY2Vzcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9wcm9jZXNzLXNlcnZpY2VzL3NyYy8iLCJzb3VyY2VzIjpbImxpYi9wcm9jZXNzLWxpc3QvY29tcG9uZW50cy9zdGFydC1wcm9jZXNzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7QUFFSCxPQUFPLEVBQ0gsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQzlCLE1BQU0sRUFBaUIsU0FBUyxFQUFFLGlCQUFpQixFQUN0RCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQ0gsc0JBQXNCLEVBQ3RCLGdCQUFnQixFQUNoQixlQUFlLEVBQ2Ysa0JBQWtCLEVBRXJCLE1BQU0sb0JBQW9CLENBQUM7QUFFNUIsT0FBTyxFQUFFLCtCQUErQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDdkYsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUMvRCxPQUFPLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBbUIsTUFBTSxnQkFBZ0IsQ0FBQztBQUMxRSxPQUFPLEVBQWMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNyRCxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRXhFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUdoRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFRaEUsTUFBTSxPQUFPLDZCQUE2QjtJQXFGdEMsWUFBb0IsZUFBK0IsRUFD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QU8sSUFBSSxDQUFDLDZCQUE2QixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDM0UsQ0FBQzs7O1lBL2JKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsbUJBQW1CO2dCQUM3QixxZ1JBQTZDO2dCQUU3QyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTs7YUFDeEM7OztZQWhCUSxjQUFjO1lBVG5CLHNCQUFzQjtZQUd0QixrQkFBa0I7WUFGbEIsZ0JBQWdCO1lBaUJYLGVBQWU7OztvQkFlbkIsS0FBSztvQkFJTCxLQUFLO29DQUlMLEtBQUs7d0JBTUwsS0FBSztxQkFJTCxLQUFLO21CQUlMLEtBQUs7d0NBSUwsS0FBSzs0Q0FJTCxLQUFLO29DQUlMLEtBQUs7b0JBSUwsTUFBTTtxQkFJTixNQUFNO29CQUlOLE1BQU07eUNBSU4sTUFBTTttQ0FJTixNQUFNO3dCQUdOLFNBQVMsU0FBQyxXQUFXO2dDQUdyQixTQUFTLFNBQUMsc0JBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHtcbiAgICBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LFxuICAgIE91dHB1dCwgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkLCBWaWV3RW5jYXBzdWxhdGlvbiwgT25EZXN0cm95XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgICBBY3Rpdml0aUNvbnRlbnRTZXJ2aWNlLFxuICAgIEFwcENvbmZpZ1NlcnZpY2UsXG4gICAgQXBwQ29uZmlnVmFsdWVzLFxuICAgIEFwcHNQcm9jZXNzU2VydmljZSxcbiAgICBGb3JtVmFsdWVzXG59IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBQcm9jZXNzSW5zdGFuY2VWYXJpYWJsZSB9IGZyb20gJy4uL21vZGVscy9wcm9jZXNzLWluc3RhbmNlLXZhcmlhYmxlLm1vZGVsJztcbmltcG9ydCB7IFByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb24gfSBmcm9tICcuLy4uL21vZGVscy9wcm9jZXNzLWRlZmluaXRpb24ubW9kZWwnO1xuaW1wb3J0IHsgUHJvY2Vzc0luc3RhbmNlIH0gZnJvbSAnLi8uLi9tb2RlbHMvcHJvY2Vzcy1pbnN0YW5jZS5tb2RlbCc7XG5pbXBvcnQgeyBQcm9jZXNzU2VydmljZSB9IGZyb20gJy4vLi4vc2VydmljZXMvcHJvY2Vzcy5zZXJ2aWNlJztcbmltcG9ydCB7IEZvcm1Db250cm9sLCBWYWxpZGF0b3JzLCBBYnN0cmFjdENvbnRyb2wgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0LCBmb3JrSm9pbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBNYXRBdXRvY29tcGxldGVUcmlnZ2VyIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvYXV0b2NvbXBsZXRlJztcbmltcG9ydCB7IE1hdFNlbGVjdENoYW5nZSB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3NlbGVjdCc7XG5pbXBvcnQgeyBTdGFydEZvcm1Db21wb25lbnQgfSBmcm9tICcuLi8uLi9mb3JtJztcbmltcG9ydCB7IE1pbmltYWxOb2RlLCBSZWxhdGVkQ29udGVudFJlcHJlc2VudGF0aW9uIH0gZnJvbSAnQGFsZnJlc2NvL2pzLWFwaSc7XG5pbXBvcnQgeyBBcHBEZWZpbml0aW9uUmVwcmVzZW50YXRpb25Nb2RlbCB9IGZyb20gJy4uLy4uL3Rhc2stbGlzdCc7XG5pbXBvcnQgeyBQcm9jZXNzTmFtZVBpcGUgfSBmcm9tICcuLi8uLi9waXBlcy9wcm9jZXNzLW5hbWUucGlwZSc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLXN0YXJ0LXByb2Nlc3MnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9zdGFydC1wcm9jZXNzLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9zdGFydC1wcm9jZXNzLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBTdGFydFByb2Nlc3NJbnN0YW5jZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgT25Jbml0LCBPbkRlc3Ryb3kge1xuXG4gICAgTUFYX0xFTkdUSDogbnVtYmVyID0gMjU1O1xuXG4gICAgLyoqIChvcHRpb25hbCkgTGltaXQgdGhlIGxpc3Qgb2YgcHJvY2Vzc2VzIHRoYXQgY2FuIGJlIHN0YXJ0ZWQgdG8gdGhvc2VcbiAgICAgKiBjb250YWluZWQgaW4gdGhlIHNwZWNpZmllZCBhcHAuXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBhcHBJZDogbnVtYmVyO1xuXG4gICAgLyoqIChvcHRpb25hbCkgRGVmaW5lIHRoZSBoZWFkZXIgb2YgdGhlIGNvbXBvbmVudC4gKi9cbiAgICBASW5wdXQoKVxuICAgIHRpdGxlOiBzdHJpbmc7XG5cbiAgICAvKiogKG9wdGlvbmFsKSBEZWZpbml0aW9uIG5hbWUgb2YgdGhlIHByb2Nlc3MgdG8gc3RhcnQuICovXG4gICAgQElucHV0KClcbiAgICBwcm9jZXNzRGVmaW5pdGlvbk5hbWU6IHN0cmluZztcblxuICAgIC8qKiBWYXJpYWJsZXMgaW4gdGhlIGlucHV0IHRvIHRoZSBwcm9jZXNzXG4gICAgICogW1Jlc3RWYXJpYWJsZV0oaHR0cHM6Ly9naXRodWIuY29tL0FsZnJlc2NvL2FsZnJlc2NvLWpzLWFwaS90cmVlL21hc3Rlci9zcmMvYWxmcmVzY28tYWN0aXZpdGktcmVzdC1hcGkvZG9jcy9SZXN0VmFyaWFibGUubWQpLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgdmFyaWFibGVzOiBQcm9jZXNzSW5zdGFuY2VWYXJpYWJsZVtdO1xuXG4gICAgLyoqIFBhcmFtZXRlciB0byBwYXNzIGZvcm0gZmllbGQgdmFsdWVzIGluIHRoZSBzdGFydCBmb3JtIGlmIG9uZSBpcyBhc3NvY2lhdGVkLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgdmFsdWVzOiBGb3JtVmFsdWVzO1xuXG4gICAgLyoqIChvcHRpb25hbCkgTmFtZSB0byBhc3NpZ24gdG8gdGhlIGN1cnJlbnQgcHJvY2Vzcy4gKi9cbiAgICBASW5wdXQoKVxuICAgIG5hbWU6IHN0cmluZyA9ICcnO1xuXG4gICAgLyoqIEhpZGUgb3Igc2hvdyB0aGUgcHJvY2VzcyBzZWxlY3Rpb24gZHJvcGRvd24uICovXG4gICAgQElucHV0KClcbiAgICBzaG93U2VsZWN0UHJvY2Vzc0Ryb3Bkb3duOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiAob3B0aW9uYWwpIEhpZGUgb3Igc2hvdyBhcHBsaWNhdGlvbiBzZWxlY3Rpb24gZHJvcGRvd24uICovXG4gICAgQElucHV0KClcbiAgICBzaG93U2VsZWN0QXBwbGljYXRpb25Ecm9wZG93bjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqIChvcHRpb25hbCkgUGFyYW1ldGVyIHRvIGVuYWJsZSBzZWxlY3Rpb24gb2YgcHJvY2VzcyB3aGVuIGZpbHRlcmluZy4gKi9cbiAgICBASW5wdXQoKVxuICAgIHByb2Nlc3NGaWx0ZXJTZWxlY3RvcjogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSBwcm9jZXNzIHN0YXJ0cy4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBzdGFydDogRXZlbnRFbWl0dGVyPFByb2Nlc3NJbnN0YW5jZT4gPSBuZXcgRXZlbnRFbWl0dGVyPFByb2Nlc3NJbnN0YW5jZT4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIHByb2Nlc3MgaXMgY2FuY2VsZWQuICovXG4gICAgQE91dHB1dCgpXG4gICAgY2FuY2VsOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGFuIGVycm9yIG9jY3Vycy4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBlcnJvcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gcHJvY2VzcyBkZWZpbml0aW9uIHNlbGVjdGlvbiBjaGFuZ2VzLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHByb2Nlc3NEZWZpbml0aW9uU2VsZWN0aW9uOiBFdmVudEVtaXR0ZXI8UHJvY2Vzc0RlZmluaXRpb25SZXByZXNlbnRhdGlvbj4gPSBuZXcgRXZlbnRFbWl0dGVyPFByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb24+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGFwcGxpY2F0aW9uIHNlbGVjdGlvbiBjaGFuZ2VzLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIGFwcGxpY2F0aW9uU2VsZWN0aW9uOiBFdmVudEVtaXR0ZXI8QXBwRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uTW9kZWw+ID0gbmV3IEV2ZW50RW1pdHRlcjxBcHBEZWZpbml0aW9uUmVwcmVzZW50YXRpb25Nb2RlbD4oKTtcblxuICAgIEBWaWV3Q2hpbGQoJ3N0YXJ0Rm9ybScpXG4gICAgc3RhcnRGb3JtOiBTdGFydEZvcm1Db21wb25lbnQ7XG5cbiAgICBAVmlld0NoaWxkKE1hdEF1dG9jb21wbGV0ZVRyaWdnZXIpXG4gICAgaW5wdXRBdXRvY29tcGxldGU6IE1hdEF1dG9jb21wbGV0ZVRyaWdnZXI7XG5cbiAgICBwcm9jZXNzRGVmaW5pdGlvbnM6IFByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb25bXSA9IFtdO1xuICAgIHNlbGVjdGVkUHJvY2Vzc0RlZjogUHJvY2Vzc0RlZmluaXRpb25SZXByZXNlbnRhdGlvbjtcbiAgICBwcm9jZXNzTmFtZUlucHV0OiBGb3JtQ29udHJvbDtcbiAgICBwcm9jZXNzRGVmaW5pdGlvbklucHV0OiBGb3JtQ29udHJvbDtcbiAgICBmaWx0ZXJlZFByb2Nlc3Nlc0RlZmluaXRpb25zJDogT2JzZXJ2YWJsZTxQcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uW10+O1xuICAgIG1heFByb2Nlc3NOYW1lTGVuZ3RoOiBudW1iZXIgPSB0aGlzLk1BWF9MRU5HVEg7XG4gICAgYWxmcmVzY29SZXBvc2l0b3J5TmFtZTogc3RyaW5nO1xuICAgIGFwcGxpY2F0aW9uczogQXBwRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uTW9kZWxbXSA9IFtdO1xuICAgIHNlbGVjdGVkQXBwbGljYXRpb246IEFwcERlZmluaXRpb25SZXByZXNlbnRhdGlvbk1vZGVsO1xuXG4gICAgaXNQcm9jZXNzRGVmaW5pdGlvbnNMb2FkaW5nID0gdHJ1ZTtcbiAgICBpc0FwcHNMb2FkaW5nID0gdHJ1ZTtcbiAgICBtb3ZlZE5vZGVUb1BTOiBGb3JtVmFsdWVzO1xuXG4gICAgcHJpdmF0ZSBvbkRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFjdGl2aXRpUHJvY2VzczogUHJvY2Vzc1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhY3Rpdml0aUNvbnRlbnRTZXJ2aWNlOiBBY3Rpdml0aUNvbnRlbnRTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYXBwc1Byb2Nlc3NTZXJ2aWNlOiBBcHBzUHJvY2Vzc1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhcHBDb25maWc6IEFwcENvbmZpZ1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBwcm9jZXNzTmFtZVBpcGU6IFByb2Nlc3NOYW1lUGlwZSkge1xuICAgICAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5wcm9jZXNzTmFtZUlucHV0ID0gbmV3IEZvcm1Db250cm9sKCcnLCBbVmFsaWRhdG9ycy5yZXF1aXJlZCwgVmFsaWRhdG9ycy5tYXhMZW5ndGgodGhpcy5tYXhQcm9jZXNzTmFtZUxlbmd0aCksIFZhbGlkYXRvcnMucGF0dGVybignXlteXFxcXHNdKyhcXFxccytbXlxcXFxzXSspKiQnKV0pO1xuICAgICAgICB0aGlzLnByb2Nlc3NEZWZpbml0aW9uSW5wdXQgPSBuZXcgRm9ybUNvbnRyb2woKTtcblxuICAgICAgICB0aGlzLmxvYWQoKTtcblxuICAgICAgICB0aGlzLmZpbHRlcmVkUHJvY2Vzc2VzRGVmaW5pdGlvbnMkID0gdGhpcy5wcm9jZXNzRGVmaW5pdGlvbklucHV0LnZhbHVlQ2hhbmdlc1xuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKCh2YWx1ZSkgPT4gdGhpcy5fZmlsdGVyKHZhbHVlKSksXG4gICAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMub25EZXN0cm95JClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgdGhpcy5hY3Rpdml0aUNvbnRlbnRTZXJ2aWNlLmdldEFsZnJlc2NvUmVwb3NpdG9yaWVzKCkuc3Vic2NyaWJlKChyZXBvTGlzdCkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlcG9MaXN0ICYmIHJlcG9MaXN0WzBdKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYWxmcmVzY29SZXBvc2l0b3J5ID0gcmVwb0xpc3RbMF07XG4gICAgICAgICAgICAgICAgdGhpcy5hbGZyZXNjb1JlcG9zaXRvcnlOYW1lID0gYGFsZnJlc2NvLSR7YWxmcmVzY29SZXBvc2l0b3J5LmlkfS0ke2FsZnJlc2NvUmVwb3NpdG9yeS5uYW1lfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLm9uRGVzdHJveSQubmV4dCh0cnVlKTtcbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLmNvbXBsZXRlKCk7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgICAgICBpZiAoY2hhbmdlc1sndmFsdWVzJ10gJiYgY2hhbmdlc1sndmFsdWVzJ10uY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLm1vdmVOb2RlRnJvbUNTdG9QUygpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNBcHBJZENoYW5nZWQoY2hhbmdlcykpIHtcbiAgICAgICAgICAgIHRoaXMuYXBwSWQgPSBjaGFuZ2VzWydhcHBJZCddLmN1cnJlbnRWYWx1ZTtcbiAgICAgICAgICAgIHRoaXMubG9hZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNQcm9jZXNzRGVmaW5pdGlvbkNoYW5nZWQoY2hhbmdlcykpIHtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0RlZmluaXRpb25OYW1lID0gY2hhbmdlc1sncHJvY2Vzc0RlZmluaXRpb25OYW1lJ10uY3VycmVudFZhbHVlO1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJQcm9jZXNzRGVmaW5pdGlvbkJ5TmFtZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0FwcElkQ2hhbmdlZChjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIHJldHVybiBjaGFuZ2VzWydhcHBJZCddICYmIGNoYW5nZXNbJ2FwcElkJ10uY3VycmVudFZhbHVlICYmIGNoYW5nZXNbJ2FwcElkJ10uY3VycmVudFZhbHVlICE9PSBjaGFuZ2VzWydhcHBJZCddLnByZXZpb3VzVmFsdWU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc1Byb2Nlc3NEZWZpbml0aW9uQ2hhbmdlZChjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIHJldHVybiBjaGFuZ2VzWydwcm9jZXNzRGVmaW5pdGlvbk5hbWUnXSAmJiBjaGFuZ2VzWydwcm9jZXNzRGVmaW5pdGlvbk5hbWUnXS5jdXJyZW50VmFsdWUgJiZcbiAgICAgICAgY2hhbmdlc1sncHJvY2Vzc0RlZmluaXRpb25OYW1lJ10uY3VycmVudFZhbHVlICE9PSBjaGFuZ2VzWydwcm9jZXNzRGVmaW5pdGlvbk5hbWUnXS5wcmV2aW91c1ZhbHVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2ZpbHRlcih2YWx1ZTogc3RyaW5nKTogUHJvY2Vzc0RlZmluaXRpb25SZXByZXNlbnRhdGlvbltdIHtcbiAgICAgICAgaWYgKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlclZhbHVlID0gdmFsdWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlcmVkUHJvY2VzcyA9IHRoaXMucHJvY2Vzc0RlZmluaXRpb25zLmZpbHRlcigob3B0aW9uKSA9PiBvcHRpb24ubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGZpbHRlclZhbHVlKSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnByb2Nlc3NGaWx0ZXJTZWxlY3Rvcikge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRQcm9jZXNzRGVmID0gdGhpcy5nZXRTZWxlY3RlZFByb2Nlc3MoZmlsdGVyVmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZpbHRlcmVkUHJvY2VzcztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBnZXRTZWxlY3RlZFByb2Nlc3Moc2VsZWN0ZWRQcm9jZXNzOiBzdHJpbmcpOiBQcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uIHtcbiAgICAgICAgbGV0IHByb2Nlc3NTZWxlY3RlZCA9IHRoaXMucHJvY2Vzc0RlZmluaXRpb25zLmZpbmQoKHByb2Nlc3MpID0+IHByb2Nlc3MubmFtZS50b0xvd2VyQ2FzZSgpID09PSBzZWxlY3RlZFByb2Nlc3MpO1xuXG4gICAgICAgIGlmICghcHJvY2Vzc1NlbGVjdGVkKSB7XG4gICAgICAgICAgICBwcm9jZXNzU2VsZWN0ZWQgPSBuZXcgUHJvY2Vzc0RlZmluaXRpb25SZXByZXNlbnRhdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwcm9jZXNzU2VsZWN0ZWQ7XG4gICAgfVxuXG4gICAgbG9hZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuc2hvd1NlbGVjdEFwcGxpY2F0aW9uRHJvcGRvd24pIHtcbiAgICAgICAgICAgIHRoaXMubG9hZEFwcHMoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubG9hZFByb2Nlc3NEZWZpbml0aW9ucyh0aGlzLmFwcElkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGxvYWRQcm9jZXNzRGVmaW5pdGlvbnMoYXBwSWQ6IGFueSk6IHZvaWQge1xuICAgICAgICB0aGlzLmlzUHJvY2Vzc0RlZmluaXRpb25zTG9hZGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMucmVzZXRTZWxlY3RlZFByb2Nlc3NEZWZpbml0aW9uKCk7XG5cbiAgICAgICAgdGhpcy5hY3Rpdml0aVByb2Nlc3MuZ2V0UHJvY2Vzc0RlZmluaXRpb25zKGFwcElkKS5waXBlKFxuICAgICAgICAgICAgbWFwKChwcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uczogUHJvY2Vzc0RlZmluaXRpb25SZXByZXNlbnRhdGlvbltdKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRQcm9jZXNzRGVmOiBQcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9uO1xuXG4gICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb25zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50UHJvY2Vzc0RlZiA9IHByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb25zWzBdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnByb2Nlc3NEZWZpbml0aW9uTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWx0ZXJlZFByb2Nlc3NEZWZpbml0aW9uID0gcHJvY2Vzc0RlZmluaXRpb25SZXByZXNlbnRhdGlvbnMuZmluZCgocHJvY2Vzc0RlZmluaXRpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9jZXNzRGVmaW5pdGlvbi5uYW1lID09PSB0aGlzLnByb2Nlc3NEZWZpbml0aW9uTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJlZFByb2Nlc3NEZWZpbml0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50UHJvY2Vzc0RlZiA9IGZpbHRlcmVkUHJvY2Vzc0RlZmluaXRpb247XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4geyBjdXJyZW50UHJvY2Vzc0RlZiwgcHJvY2Vzc0RlZmluaXRpb25SZXByZXNlbnRhdGlvbnMgfTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKGZpbHRlcmVkUHJvY2Vzc0RlZmluaXRpb25zKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzRGVmaW5pdGlvbnMgPSBmaWx0ZXJlZFByb2Nlc3NEZWZpbml0aW9ucy5wcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9ucztcbiAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NEZWZpbml0aW9uU2VsZWN0aW9uQ2hhbmdlZChmaWx0ZXJlZFByb2Nlc3NEZWZpbml0aW9ucy5jdXJyZW50UHJvY2Vzc0RlZik7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzRGVmaW5pdGlvbklucHV0LnNldFZhbHVlKHRoaXMuc2VsZWN0ZWRQcm9jZXNzRGVmID8gdGhpcy5zZWxlY3RlZFByb2Nlc3NEZWYubmFtZSA6ICcnKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzUHJvY2Vzc0RlZmluaXRpb25zTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNQcm9jZXNzRGVmaW5pdGlvbnNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvci5lbWl0KGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZpbHRlclByb2Nlc3NEZWZpbml0aW9uQnlOYW1lKCkge1xuICAgICAgICBpZiAodGhpcy5wcm9jZXNzRGVmaW5pdGlvbk5hbWUpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlcmVkUHJvY2Vzc0RlZiA9IHRoaXMucHJvY2Vzc0RlZmluaXRpb25zLmZpbmQoKHByb2Nlc3NEZWZpbml0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NEZWZpbml0aW9uLm5hbWUgPT09IHRoaXMucHJvY2Vzc0RlZmluaXRpb25OYW1lO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChmaWx0ZXJlZFByb2Nlc3NEZWYpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NEZWZpbml0aW9uU2VsZWN0aW9uQ2hhbmdlZChmaWx0ZXJlZFByb2Nlc3NEZWYpO1xuICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzc0RlZmluaXRpb25JbnB1dC5zZXRWYWx1ZSh0aGlzLnNlbGVjdGVkUHJvY2Vzc0RlZiA/IHRoaXMuc2VsZWN0ZWRQcm9jZXNzRGVmLm5hbWUgOiAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsb2FkQXBwcygpIHtcbiAgICAgICAgdGhpcy5pc0FwcHNMb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5hcHBzUHJvY2Vzc1NlcnZpY2VcbiAgICAgICAgICAgIC5nZXREZXBsb3llZEFwcGxpY2F0aW9ucygpXG4gICAgICAgICAgICAucGlwZShtYXAoKHJlc3BvbnNlOiBBcHBEZWZpbml0aW9uUmVwcmVzZW50YXRpb25Nb2RlbFtdKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFwcGxpY2F0aW9ucyA9IHRoaXMucmVtb3ZlRGVmYXVsdEFwcHMocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgY3VycmVudEFwcGxpY2F0aW9uOiBBcHBEZWZpbml0aW9uUmVwcmVzZW50YXRpb25Nb2RlbDtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoYXBwbGljYXRpb25zICYmIGFwcGxpY2F0aW9ucy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBcHBsaWNhdGlvbiA9IGFwcGxpY2F0aW9uc1swXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbHRlcmVkQXBwID0gYXBwbGljYXRpb25zLmZpbmQoIGFwcCA9PiBhcHAuaWQgPT09ICt0aGlzLmFwcElkICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkQXBwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50QXBwbGljYXRpb24gPSBmaWx0ZXJlZEFwcDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IGN1cnJlbnRBcHBsaWNhdGlvbiwgYXBwbGljYXRpb25zIH07XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKGZpbHRlcmVkQXBwcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGxpY2F0aW9ucyA9IGZpbHRlcmVkQXBwcy5hcHBsaWNhdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRBcHBsaWNhdGlvbiA9IGZpbHRlcmVkQXBwcy5jdXJyZW50QXBwbGljYXRpb247XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbGljYXRpb25TZWxlY3Rpb24uZW1pdCh0aGlzLnNlbGVjdGVkQXBwbGljYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZVByb2Nlc3NOYW1lQW5kRGVmaW5pdGlvbnNEcm9wZG93bigpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQXBwc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkUHJvY2Vzc0RlZmluaXRpb25zQmFzZWRPblNlbGVjdGVkQXBwKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNBcHBzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yLmVtaXQoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuXG4gICAgfVxuXG4gICAgbG9hZFByb2Nlc3NEZWZpbml0aW9uc0Jhc2VkT25TZWxlY3RlZEFwcCgpIHtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRBcHBsaWNhdGlvbiAmJiB0aGlzLnNlbGVjdGVkQXBwbGljYXRpb24uaWQpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZFByb2Nlc3NEZWZpbml0aW9ucyh0aGlzLnNlbGVjdGVkQXBwbGljYXRpb24gPyB0aGlzLnNlbGVjdGVkQXBwbGljYXRpb24uaWQgOiBudWxsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaXNQcm9jZXNzRGVmaW5pdGlvbnNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnJlc2V0UHJvY2Vzc0RlZmluaXRpb25zKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbkFwcFNlbGVjdGlvbkNoYW5nZShzZWxlY3RlZEFwcGxpY2F0aW9uOiBNYXRTZWxlY3RDaGFuZ2UpIHtcbiAgICAgICAgdGhpcy5yZXNldFByb2Nlc3NEZWZpbml0aW9ucygpO1xuICAgICAgICB0aGlzLnNlbGVjdGVkQXBwbGljYXRpb24gPSBzZWxlY3RlZEFwcGxpY2F0aW9uLnZhbHVlO1xuICAgICAgICB0aGlzLmFwcGxpY2F0aW9uU2VsZWN0aW9uLmVtaXQodGhpcy5zZWxlY3RlZEFwcGxpY2F0aW9uKTtcbiAgICAgICAgdGhpcy50b2dnbGVQcm9jZXNzTmFtZUFuZERlZmluaXRpb25zRHJvcGRvd24oKTtcbiAgICAgICAgdGhpcy5sb2FkUHJvY2Vzc0RlZmluaXRpb25zQmFzZWRPblNlbGVjdGVkQXBwKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0FwcFNlbGVjdGVkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gISEodGhpcy5zZWxlY3RlZEFwcGxpY2F0aW9uICYmIHRoaXMuc2VsZWN0ZWRBcHBsaWNhdGlvbi5pZCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW1vdmVEZWZhdWx0QXBwcyhhcHBzOiBBcHBEZWZpbml0aW9uUmVwcmVzZW50YXRpb25Nb2RlbCBbXSk6IEFwcERlZmluaXRpb25SZXByZXNlbnRhdGlvbk1vZGVsW10ge1xuICAgICAgICByZXR1cm4gYXBwcy5maWx0ZXIoKGFwcCkgPT4gYXBwLmlkKTtcbiAgICB9XG5cbiAgICBoYXNBcHBsaWNhdGlvbnMoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmFwcGxpY2F0aW9ucyAmJiB0aGlzLmFwcGxpY2F0aW9ucy5sZW5ndGggPiAwO1xuICAgIH1cblxuICAgIGhhc1Byb2Nlc3NEZWZpbml0aW9ucygpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc0RlZmluaXRpb25zICYmIHRoaXMucHJvY2Vzc0RlZmluaXRpb25zLmxlbmd0aCA+IDA7XG4gICAgfVxuXG4gICAgaXNQcm9jZXNzRGVmaW5pdGlvblNlbGVjdGVkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gISEodGhpcy5zZWxlY3RlZFByb2Nlc3NEZWYgJiYgdGhpcy5zZWxlY3RlZFByb2Nlc3NEZWYuaWQpO1xuICAgIH1cblxuICAgIGlzUHJvY2Vzc0RlZmluaXRpb25zRW1wdHkoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NEZWZpbml0aW9ucy5sZW5ndGggPT09IDA7XG4gICAgfVxuXG4gICAgZGlzYWJsZURyb3Bkb3duQnV0dG9uKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5zaG93U2VsZWN0QXBwbGljYXRpb25Ecm9wZG93biAmJiAhdGhpcy5pc0FwcFNlbGVjdGVkKCk7XG4gICAgfVxuXG4gICAgZ2V0QWxmcmVzY29SZXBvc2l0b3J5TmFtZSgpOiBzdHJpbmcge1xuICAgICAgICBsZXQgYWxmcmVzY29SZXBvc2l0b3J5TmFtZSA9IHRoaXMuYXBwQ29uZmlnLmdldDxzdHJpbmc+KEFwcENvbmZpZ1ZhbHVlcy5BTEZSRVNDT19SRVBPU0lUT1JZX05BTUUpO1xuICAgICAgICBpZiAoIWFsZnJlc2NvUmVwb3NpdG9yeU5hbWUpIHtcbiAgICAgICAgICAgIGFsZnJlc2NvUmVwb3NpdG9yeU5hbWUgPSB0aGlzLmFsZnJlc2NvUmVwb3NpdG9yeU5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFsZnJlc2NvUmVwb3NpdG9yeU5hbWUgKyAnQWxmcmVzY28nO1xuICAgIH1cblxuICAgIG1vdmVOb2RlRnJvbUNTdG9QUygpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgYWNjb3VudElkZW50aWZpZXIgPSB0aGlzLmdldEFsZnJlc2NvUmVwb3NpdG9yeU5hbWUoKTtcblxuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLnZhbHVlcykge1xuICAgICAgICAgICAgaWYgKHRoaXMudmFsdWVzLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50VmFsdWUgPSBBcnJheS5pc0FycmF5KHRoaXMudmFsdWVzW2tleV0pID8gdGhpcy52YWx1ZXNba2V5XSA6IFt0aGlzLnZhbHVlc1trZXldXTtcbiAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50cyA9IGN1cnJlbnRWYWx1ZS5maWx0ZXIoKHZhbHVlOiBhbnkpID0+IHZhbHVlICYmIHZhbHVlLmlzRmlsZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKGNvbnRlbnQ6IE1pbmltYWxOb2RlKSA9PiB0aGlzLmFjdGl2aXRpQ29udGVudFNlcnZpY2UuYXBwbHlBbGZyZXNjb05vZGUoY29udGVudCwgbnVsbCwgYWNjb3VudElkZW50aWZpZXIpKTtcbiAgICAgICAgICAgICAgICBmb3JrSm9pbihjb250ZW50cykuc3Vic2NyaWJlKChyZXM6IFJlbGF0ZWRDb250ZW50UmVwcmVzZW50YXRpb25bXSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVkTm9kZVRvUFMgPSB7IFtrZXldOiBbLi4ucmVzXX07XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGFydFByb2Nlc3Mob3V0Y29tZT86IHN0cmluZykge1xuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFByb2Nlc3NEZWYgJiYgdGhpcy5zZWxlY3RlZFByb2Nlc3NEZWYuaWQgJiYgdGhpcy5uYW1lQ29udHJvbGxlci52YWx1ZSkge1xuICAgICAgICAgICAgY29uc3QgZm9ybVZhbHVlcyA9IHRoaXMuc3RhcnRGb3JtID8gdGhpcy5zdGFydEZvcm0uZm9ybS52YWx1ZXMgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLmFjdGl2aXRpUHJvY2Vzcy5zdGFydFByb2Nlc3ModGhpcy5zZWxlY3RlZFByb2Nlc3NEZWYuaWQsIHRoaXMubmFtZUNvbnRyb2xsZXIudmFsdWUsIG91dGNvbWUsIGZvcm1WYWx1ZXMsIHRoaXMudmFyaWFibGVzKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm5hbWUgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFydC5lbWl0KHJlcyk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IuZW1pdChlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjYW5jZWxTdGFydFByb2Nlc3MoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY2FuY2VsLmVtaXQoKTtcbiAgICB9XG5cbiAgICBoYXNTdGFydEZvcm0oKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkUHJvY2Vzc0RlZiAmJiB0aGlzLnNlbGVjdGVkUHJvY2Vzc0RlZi5oYXNTdGFydEZvcm07XG4gICAgfVxuXG4gICAgaXNTdGFydEZvcm1NaXNzaW5nT3JWYWxpZCgpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhcnRGb3JtKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zdGFydEZvcm0uZm9ybSAmJiB0aGlzLnN0YXJ0Rm9ybS5mb3JtLmlzVmFsaWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhbGlkYXRlRm9ybSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRQcm9jZXNzRGVmICYmIHRoaXMuc2VsZWN0ZWRQcm9jZXNzRGVmLmlkICYmIHRoaXMucHJvY2Vzc05hbWVJbnB1dC52YWxpZCAmJiB0aGlzLmlzU3RhcnRGb3JtTWlzc2luZ09yVmFsaWQoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlc2V0U2VsZWN0ZWRQcm9jZXNzRGVmaW5pdGlvbigpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZFByb2Nlc3NEZWYgPSB1bmRlZmluZWQ7XG4gICAgICAgIGlmICh0aGlzLnByb2Nlc3NEZWZpbml0aW9uSW5wdXQpIHtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0RlZmluaXRpb25JbnB1dC5zZXRWYWx1ZSgnJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHJlc2V0UHJvY2Vzc0RlZmluaXRpb25zKCkge1xuICAgICAgICB0aGlzLnByb2Nlc3NEZWZpbml0aW9ucyA9IFtdO1xuICAgICAgICB0aGlzLnJlc2V0U2VsZWN0ZWRQcm9jZXNzRGVmaW5pdGlvbigpO1xuICAgIH1cblxuICAgIHB1YmxpYyBvbk91dGNvbWVDbGljayhvdXRjb21lOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5zdGFydFByb2Nlc3Mob3V0Y29tZSk7XG4gICAgfVxuXG4gICAgcmVzZXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMucmVzZXRTZWxlY3RlZFByb2Nlc3NEZWZpbml0aW9uKCk7XG4gICAgICAgIHRoaXMubmFtZSA9ICcnO1xuICAgICAgICBpZiAodGhpcy5zdGFydEZvcm0pIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRGb3JtLmRhdGEgPSB7fTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGRpc3BsYXlGbihwcm9jZXNzOiBhbnkpOiBzdHJpbmcge1xuICAgICAgICBpZiAocHJvY2Vzcykge1xuICAgICAgICAgICAgbGV0IHByb2Nlc3NOYW1lID0gcHJvY2VzcztcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcHJvY2VzcyAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBwcm9jZXNzTmFtZSA9IHByb2Nlc3MubmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBwcm9jZXNzTmFtZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGRpc3BsYXlEcm9wZG93bihldmVudCkge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgaWYgKCF0aGlzLmlucHV0QXV0b2NvbXBsZXRlLnBhbmVsT3Blbikge1xuICAgICAgICAgICAgdGhpcy5wcm9jZXNzRGVmaW5pdGlvbklucHV0LnNldFZhbHVlKCcnKTtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRBdXRvY29tcGxldGUub3BlblBhbmVsKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmlucHV0QXV0b2NvbXBsZXRlLmNsb3NlUGFuZWwoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBuYW1lQ29udHJvbGxlcigpOiBBYnN0cmFjdENvbnRyb2wge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzTmFtZUlucHV0O1xuICAgIH1cblxuICAgIGdldCBwcm9jZXNzRGVmaW5pdGlvbkNvbnRyb2xsZXIoKTogQWJzdHJhY3RDb250cm9sIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc0RlZmluaXRpb25JbnB1dDtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRvZ2dsZVByb2Nlc3NOYW1lQW5kRGVmaW5pdGlvbnNEcm9wZG93bigpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzQXBwU2VsZWN0ZWQoKSkge1xuICAgICAgICAgICAgdGhpcy5wcm9jZXNzRGVmaW5pdGlvbkNvbnRyb2xsZXIuZGlzYWJsZSgpO1xuICAgICAgICAgICAgdGhpcy5uYW1lQ29udHJvbGxlci5kaXNhYmxlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NEZWZpbml0aW9uQ29udHJvbGxlci5lbmFibGUoKTtcbiAgICAgICAgICAgIHRoaXMubmFtZUNvbnRyb2xsZXIuZW5hYmxlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm9jZXNzRGVmaW5pdGlvblNlbGVjdGlvbkNoYW5nZWQocHJvY2Vzc0RlZmluaXRpb246IFByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb24pIHtcbiAgICAgICAgaWYgKHByb2Nlc3NEZWZpbml0aW9uKSB7XG4gICAgICAgICAgICBjb25zdCBwcm9jZXNzSW5zdGFuY2VEZXRhaWxzID0gbmV3IFByb2Nlc3NJbnN0YW5jZSh7IHByb2Nlc3NEZWZpbml0aW9uTmFtZTogcHJvY2Vzc0RlZmluaXRpb24ubmFtZSB9KTtcbiAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NOYW1lID0gdGhpcy5wcm9jZXNzTmFtZVBpcGUudHJhbnNmb3JtKHRoaXMubmFtZSwgcHJvY2Vzc0luc3RhbmNlRGV0YWlscyk7XG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NOYW1lSW5wdXQuc2V0VmFsdWUocHJvY2Vzc05hbWUpO1xuICAgICAgICAgICAgdGhpcy5wcm9jZXNzTmFtZUlucHV0Lm1hcmtBc0RpcnR5KCk7XG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NOYW1lSW5wdXQubWFya0FzVG91Y2hlZCgpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFByb2Nlc3NEZWYgPSBwcm9jZXNzRGVmaW5pdGlvbjtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0RlZmluaXRpb25TZWxlY3Rpb24uZW1pdCh0aGlzLnNlbGVjdGVkUHJvY2Vzc0RlZik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm5hbWVDb250cm9sbGVyLnJlc2V0KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpc0xvYWRpbmcoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnNob3dTZWxlY3RBcHBsaWNhdGlvbkRyb3Bkb3duID8gdGhpcy5pc0FwcHNMb2FkaW5nIDogZmFsc2U7XG4gICAgfVxufVxuIl19