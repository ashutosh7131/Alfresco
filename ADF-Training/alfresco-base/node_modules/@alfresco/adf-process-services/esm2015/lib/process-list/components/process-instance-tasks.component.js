/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { LogService } from '@alfresco/adf-core';
import { DatePipe } from '@angular/common';
import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { MatDialog } from '@angular/material/dialog';
import { Observable, Subject } from 'rxjs';
import { TaskDetailsEvent } from '../../task-list';
import { ProcessInstance } from '../models/process-instance.model';
import { ProcessService } from './../services/process.service';
import { share, takeUntil } from 'rxjs/operators';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './../services/process.service';
import * as ɵngcc2 from '@alfresco/adf-core';
import * as ɵngcc3 from '@angular/material/dialog';
import * as ɵngcc4 from '@angular/common';
import * as ɵngcc5 from '@angular/material/chips';
import * as ɵngcc6 from '@angular/material/button';
import * as ɵngcc7 from '@angular/material/icon';
import * as ɵngcc8 from '@angular/material/list';
import * as ɵngcc9 from '@angular/material/core';
import * as ɵngcc10 from '../../form/start-form.component';
import * as ɵngcc11 from '@ngx-translate/core';

const _c0 = ["startDialog"];
const _c1 = ["taskDetails"];
function ProcessInstanceTasksComponent_div_0_Template(rf, ctx) { if (rf & 1) {
    const _r8 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 8);
    ɵngcc0.ɵɵelementStart(1, "button", 9);
    ɵngcc0.ɵɵlistener("click", function ProcessInstanceTasksComponent_div_0_Template_button_click_1_listener() { ɵngcc0.ɵɵrestoreView(_r8); const ctx_r7 = ɵngcc0.ɵɵnextContext(); return ctx_r7.onRefreshClicked(); });
    ɵngcc0.ɵɵelementStart(2, "mat-icon", 10);
    ɵngcc0.ɵɵtext(3, "refresh");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} }
const _c2 = function (a0, a1) { return { user: a0, created: a1 }; };
function ProcessInstanceTasksComponent_div_7_mat_list_item_2_Template(rf, ctx) { if (rf & 1) {
    const _r12 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "mat-list-item", 13);
    ɵngcc0.ɵɵlistener("click", function ProcessInstanceTasksComponent_div_7_mat_list_item_2_Template_mat_list_item_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r12); const task_r10 = ctx.$implicit; const ctx_r11 = ɵngcc0.ɵɵnextContext(2); return ctx_r11.clickTask(task_r10); });
    ɵngcc0.ɵɵelementStart(1, "mat-icon", 14);
    ɵngcc0.ɵɵtext(2, "assignment");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "h3", 15);
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "span", 15);
    ɵngcc0.ɵɵtext(6);
    ɵngcc0.ɵɵpipe(7, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const task_r10 = ctx.$implicit;
    const ctx_r9 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵtextInterpolate(task_r10.name || "Nameless task");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind2(7, 2, "ADF_PROCESS_LIST.DETAILS.LABELS.TASK_SUBTITLE", ɵngcc0.ɵɵpureFunction2(5, _c2, ctx_r9.getUserFullName(task_r10.assignee), ctx_r9.getFormatDate(task_r10.created, "mediumDate"))), " ");
} }
function ProcessInstanceTasksComponent_div_7_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 11);
    ɵngcc0.ɵɵelementStart(1, "mat-list");
    ɵngcc0.ɵɵtemplate(2, ProcessInstanceTasksComponent_div_7_mat_list_item_2_Template, 8, 8, "mat-list-item", 12);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r1.activeTasks);
} }
function ProcessInstanceTasksComponent_div_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 16);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 1, "ADF_PROCESS_LIST.DETAILS.TASKS.NO_ACTIVE"), "\n");
} }
function ProcessInstanceTasksComponent_div_9_Template(rf, ctx) { if (rf & 1) {
    const _r14 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵelementStart(1, "span", 17);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "div", 18);
    ɵngcc0.ɵɵelementStart(5, "mat-list");
    ɵngcc0.ɵɵelementStart(6, "mat-list-item", 13);
    ɵngcc0.ɵɵlistener("click", function ProcessInstanceTasksComponent_div_9_Template_mat_list_item_click_6_listener() { ɵngcc0.ɵɵrestoreView(_r14); const ctx_r13 = ɵngcc0.ɵɵnextContext(); return ctx_r13.clickStartTask(); });
    ɵngcc0.ɵɵelementStart(7, "mat-icon", 14);
    ɵngcc0.ɵɵtext(8, "assignment");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(9, "h3", 15);
    ɵngcc0.ɵɵtext(10);
    ɵngcc0.ɵɵpipe(11, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(12, "span", 15);
    ɵngcc0.ɵɵtext(13);
    ɵngcc0.ɵɵpipe(14, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 3, "ADF_PROCESS_LIST.DETAILS.LABELS.START_FORM"));
    ɵngcc0.ɵɵadvance(8);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(11, 5, "ADF_PROCESS_LIST.DETAILS.LABELS.START_FORM"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind2(14, 7, "ADF_PROCESS_LIST.DETAILS.LABELS.TASK_SUBTITLE", ɵngcc0.ɵɵpureFunction2(10, _c2, ctx_r3.getUserFullName(ctx_r3.processInstanceDetails.startedBy), ctx_r3.getFormatDate(ctx_r3.processInstanceDetails.started, "mediumDate"))), " ");
} }
function ProcessInstanceTasksComponent_div_16_mat_list_item_2_Template(rf, ctx) { if (rf & 1) {
    const _r18 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "mat-list-item", 13);
    ɵngcc0.ɵɵlistener("click", function ProcessInstanceTasksComponent_div_16_mat_list_item_2_Template_mat_list_item_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r18); const task_r16 = ctx.$implicit; const ctx_r17 = ɵngcc0.ɵɵnextContext(2); return ctx_r17.clickTask(task_r16); });
    ɵngcc0.ɵɵelementStart(1, "mat-icon", 14);
    ɵngcc0.ɵɵtext(2, "assignment");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "h3", 15);
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "span", 15);
    ɵngcc0.ɵɵtext(6);
    ɵngcc0.ɵɵpipe(7, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const task_r16 = ctx.$implicit;
    const ctx_r15 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵtextInterpolate(task_r16.name || "Nameless task");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind2(7, 2, "ADF_PROCESS_LIST.DETAILS.LABELS.TASK_SUBTITLE", ɵngcc0.ɵɵpureFunction2(5, _c2, ctx_r15.getUserFullName(task_r16.assignee), ctx_r15.getFormatDate(task_r16.created, "mediumDate"))), " ");
} }
function ProcessInstanceTasksComponent_div_16_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 19);
    ɵngcc0.ɵɵelementStart(1, "mat-list");
    ɵngcc0.ɵɵtemplate(2, ProcessInstanceTasksComponent_div_16_mat_list_item_2_Template, 8, 8, "mat-list-item", 12);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r4 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r4.completedTasks);
} }
function ProcessInstanceTasksComponent_div_17_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 20);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 1, "ADF_PROCESS_LIST.DETAILS.TASKS.NO_COMPLETED"), "\n");
} }
function ProcessInstanceTasksComponent_18_ng_template_0_Template(rf, ctx) { if (rf & 1) {
    const _r22 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 22);
    ɵngcc0.ɵɵelementStart(1, "h4", 23);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "div", 24);
    ɵngcc0.ɵɵelementStart(5, "adf-start-form", 25);
    ɵngcc0.ɵɵlistener("formContentClicked", function ProcessInstanceTasksComponent_18_ng_template_0_Template_adf_start_form_formContentClicked_5_listener() { ɵngcc0.ɵɵrestoreView(_r22); const ctx_r21 = ɵngcc0.ɵɵnextContext(2); return ctx_r21.onFormContentClick(); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(6, "div", 26);
    ɵngcc0.ɵɵelementStart(7, "button", 27);
    ɵngcc0.ɵɵlistener("click", function ProcessInstanceTasksComponent_18_ng_template_0_Template_button_click_7_listener() { ɵngcc0.ɵɵrestoreView(_r22); const ctx_r23 = ɵngcc0.ɵɵnextContext(2); return ctx_r23.closeStartDialog(); });
    ɵngcc0.ɵɵtext(8);
    ɵngcc0.ɵɵpipe(9, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r20 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 5, "ADF_PROCESS_LIST.DETAILS.LABELS.START_FORM"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("processId", ctx_r20.processId)("showRefreshButton", false)("readOnlyForm", true);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(9, 7, "ADF_PROCESS_LIST.DETAILS.TASKS.TASK_CLOSE"));
} }
function ProcessInstanceTasksComponent_18_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ProcessInstanceTasksComponent_18_ng_template_0_Template, 10, 9, "ng-template", null, 21, ɵngcc0.ɵɵtemplateRefExtractor);
} }
export class ProcessInstanceTasksComponent {
    constructor(activitiProcess, logService, dialog) {
        this.activitiProcess = activitiProcess;
        this.logService = logService;
        this.dialog = dialog;
        this.showRefreshButton = true;
        this.error = new EventEmitter();
        this.activeTasks = [];
        this.completedTasks = [];
        this.onDestroy$ = new Subject();
        this.taskClick = new EventEmitter();
        this.task$ = new Observable((observer) => this.taskObserver = observer)
            .pipe(share());
        this.completedTask$ = new Observable((observer) => this.completedTaskObserver = observer)
            .pipe(share());
    }
    ngOnInit() {
        this.task$
            .pipe(takeUntil(this.onDestroy$))
            .subscribe(task => this.activeTasks.push(task));
        this.completedTask$
            .pipe(takeUntil(this.onDestroy$))
            .subscribe(task => this.completedTasks.push(task));
    }
    ngOnDestroy() {
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
    ngOnChanges(changes) {
        const processInstanceDetails = changes['processInstanceDetails'];
        if (processInstanceDetails && processInstanceDetails.currentValue) {
            this.load(processInstanceDetails.currentValue.id);
        }
    }
    load(processInstanceId) {
        this.loadActive(processInstanceId);
        this.loadCompleted(processInstanceId);
    }
    loadActive(processInstanceId) {
        this.activeTasks = [];
        if (processInstanceId) {
            this.activitiProcess.getProcessTasks(processInstanceId, null).subscribe((res) => {
                res.forEach((task) => {
                    this.taskObserver.next(task);
                });
            }, (err) => {
                this.error.emit(err);
            });
        }
        else {
            this.activeTasks = [];
        }
    }
    loadCompleted(processInstanceId) {
        this.completedTasks = [];
        if (processInstanceId) {
            this.activitiProcess.getProcessTasks(processInstanceId, 'completed').subscribe((res) => {
                res.forEach((task) => {
                    this.completedTaskObserver.next(task);
                });
            }, (err) => {
                this.error.emit(err);
            });
        }
        else {
            this.completedTasks = [];
        }
    }
    hasStartFormDefined() {
        return this.processInstanceDetails && this.processInstanceDetails.startFormDefined === true;
    }
    getUserFullName(user) {
        if (user) {
            return (user.firstName && user.firstName !== 'null'
                ? user.firstName + ' ' : '') +
                user.lastName;
        }
        return 'Nobody';
    }
    getFormatDate(value, format) {
        const datePipe = new DatePipe('en-US');
        try {
            return datePipe.transform(value, format);
        }
        catch (err) {
            this.logService.error(`ProcessListInstanceTask: error parsing date ${value} to format ${format}`);
            return value;
        }
    }
    clickTask(task) {
        const args = new TaskDetailsEvent(task);
        this.taskClick.emit(args);
    }
    clickStartTask() {
        this.processId = this.processInstanceDetails.id;
        this.showStartDialog();
    }
    showStartDialog() {
        this.dialog.open(this.startDialog, { height: '500px', width: '700px' });
    }
    closeStartDialog() {
        this.dialog.closeAll();
    }
    onRefreshClicked() {
        this.load(this.processInstanceDetails.id);
    }
    onFormContentClick() {
        this.closeStartDialog();
    }
}
ProcessInstanceTasksComponent.ɵfac = function ProcessInstanceTasksComponent_Factory(t) { return new (t || ProcessInstanceTasksComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ProcessService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LogService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.MatDialog)); };
ProcessInstanceTasksComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ProcessInstanceTasksComponent, selectors: [["adf-process-instance-tasks"]], viewQuery: function ProcessInstanceTasksComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, true);
        ɵngcc0.ɵɵviewQuery(_c1, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.startDialog = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.taskDetails = _t.first);
    } }, inputs: { showRefreshButton: "showRefreshButton", processInstanceDetails: "processInstanceDetails" }, outputs: { error: "error", taskClick: "taskClick" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 19, vars: 15, consts: [["class", "process-tasks-refresh", 4, "ngIf"], [1, "adf-chip-label"], ["color", "accent", "selected", "true", 1, "adf-process-badge"], ["class", "menu-container", "data-automation-id", "active-tasks", 4, "ngIf"], ["data-automation-id", "active-tasks-none", "class", "no-results", 4, "ngIf"], [4, "ngIf"], ["class", "menu-container", "data-automation-id", "completed-tasks", 4, "ngIf"], ["data-automation-id", "completed-tasks-none", "class", "no-results", 4, "ngIf"], [1, "process-tasks-refresh"], ["mat-icon-button", "", 3, "click"], ["aria-label", "Refresh", 1, "md-24"], ["data-automation-id", "active-tasks", 1, "menu-container"], ["class", "process-tasks__task-item", 3, "click", 4, "ngFor", "ngForOf"], [1, "process-tasks__task-item", 3, "click"], ["mat-list-icon", ""], ["matLine", ""], ["data-automation-id", "active-tasks-none", 1, "no-results"], [1, "adf-activiti-label"], ["data-automation-id", "start-form", 1, "menu-container"], ["data-automation-id", "completed-tasks", 1, "menu-container"], ["data-automation-id", "completed-tasks-none", 1, "no-results"], ["startDialog", ""], ["id", "adf-start-process-dialog", 1, "adf-start-process-dialog"], ["matDialogTitle", ""], ["mat-dialog-content", "", 1, "adf-start-process-dialog-content"], [3, "processId", "showRefreshButton", "readOnlyForm", "formContentClicked"], ["mat-dialog-actions", "", 1, "adf-start-process-dialog-actions"], ["mat-button", "", "type", "button", 3, "click"]], template: function ProcessInstanceTasksComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, ProcessInstanceTasksComponent_div_0_Template, 4, 0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "mat-chip-list");
        ɵngcc0.ɵɵelementStart(2, "span", 1);
        ɵngcc0.ɵɵtext(3);
        ɵngcc0.ɵɵpipe(4, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(5, "mat-chip", 2);
        ɵngcc0.ɵɵtext(6);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(7, ProcessInstanceTasksComponent_div_7_Template, 3, 1, "div", 3);
        ɵngcc0.ɵɵtemplate(8, ProcessInstanceTasksComponent_div_8_Template, 3, 3, "div", 4);
        ɵngcc0.ɵɵtemplate(9, ProcessInstanceTasksComponent_div_9_Template, 15, 13, "div", 5);
        ɵngcc0.ɵɵelementStart(10, "mat-chip-list");
        ɵngcc0.ɵɵelementStart(11, "span", 1);
        ɵngcc0.ɵɵtext(12);
        ɵngcc0.ɵɵpipe(13, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(14, "mat-chip", 2);
        ɵngcc0.ɵɵtext(15);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(16, ProcessInstanceTasksComponent_div_16_Template, 3, 1, "div", 6);
        ɵngcc0.ɵɵtemplate(17, ProcessInstanceTasksComponent_div_17_Template, 3, 3, "div", 7);
        ɵngcc0.ɵɵtemplate(18, ProcessInstanceTasksComponent_18_Template, 2, 0, undefined, 5);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", ctx.showRefreshButton);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(4, 11, "ADF_PROCESS_LIST.DETAILS.LABELS.TASKS_ACTIVE"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ctx.activeTasks == null ? null : ctx.activeTasks.length);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", (ctx.activeTasks == null ? null : ctx.activeTasks.length) > 0);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", (ctx.activeTasks == null ? null : ctx.activeTasks.length) === 0);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.hasStartFormDefined());
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(13, 13, "ADF_PROCESS_LIST.DETAILS.LABELS.TASKS_COMPLETED"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ctx.completedTasks == null ? null : ctx.completedTasks.length);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", (ctx.completedTasks == null ? null : ctx.completedTasks.length) > 0);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", (ctx.completedTasks == null ? null : ctx.completedTasks.length) === 0);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.hasStartFormDefined());
    } }, directives: [ɵngcc4.NgIf, ɵngcc5.MatChipList, ɵngcc5.MatChip, ɵngcc6.MatButton, ɵngcc7.MatIcon, ɵngcc8.MatList, ɵngcc4.NgForOf, ɵngcc8.MatListItem, ɵngcc8.MatListIconCssMatStyler, ɵngcc9.MatLine, ɵngcc3.MatDialogTitle, ɵngcc3.MatDialogContent, ɵngcc10.StartFormComponent, ɵngcc3.MatDialogActions], pipes: [ɵngcc11.TranslatePipe], styles: ["[_nghost-%COMP%]{width:100%}.activiti-label[_ngcontent-%COMP%]{font-weight:bolder;vertical-align:top}.adf-process-badge[_ngcontent-%COMP%]{outline:none;pointer-events:none}.adf-chip-label[_ngcontent-%COMP%]{font-weight:700;margin-right:8px;position:relative;top:5px}.menu-container[_ngcontent-%COMP%]{margin-bottom:32px}.activiti-label[_ngcontent-%COMP%] + .icon[_ngcontent-%COMP%]{position:relative;top:-2px}.task-details-dialog[_ngcontent-%COMP%]{position:fixed;top:50%;transform:translateY(-50%);width:40%}.process-tasks-refresh[_ngcontent-%COMP%]{float:right}.adf-start-process-dialog[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.adf-start-process-dialog-content[_ngcontent-%COMP%]{flex-grow:1}.adf-start-process-dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.no-results[_ngcontent-%COMP%]{color:rgba(0,0,0,.54);display:block;font-size:14px;font-weight:400;letter-spacing:0;line-height:18px;margin-left:9px;padding:12px}.process-tasks__task-item[_ngcontent-%COMP%]{cursor:pointer}"] });
ProcessInstanceTasksComponent.ctorParameters = () => [
    { type: ProcessService },
    { type: LogService },
    { type: MatDialog }
];
ProcessInstanceTasksComponent.propDecorators = {
    processInstanceDetails: [{ type: Input }],
    showRefreshButton: [{ type: Input }],
    error: [{ type: Output }],
    startDialog: [{ type: ViewChild, args: ['startDialog',] }],
    taskDetails: [{ type: ViewChild, args: ['taskDetails',] }],
    taskClick: [{ type: Output }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ProcessInstanceTasksComponent, [{
        type: Component,
        args: [{
                selector: 'adf-process-instance-tasks',
                template: "<div  *ngIf=\"showRefreshButton\" class=\"process-tasks-refresh\" >\n    <button mat-icon-button (click)=\"onRefreshClicked()\">\n        <mat-icon class=\"md-24\" aria-label=\"Refresh\">refresh</mat-icon>\n    </button>\n</div>\n\n<!-- ACTIVE FORM -->\n\n<mat-chip-list>\n    <span class=\"adf-chip-label\">{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASKS_ACTIVE'|translate }}</span>\n    <mat-chip class=\"adf-process-badge\" color=\"accent\" selected=\"true\">{{activeTasks?.length}}</mat-chip>\n</mat-chip-list>\n\n<div class=\"menu-container\" *ngIf=\"activeTasks?.length > 0\" data-automation-id=\"active-tasks\">\n    <mat-list>\n        <mat-list-item class=\"process-tasks__task-item\" *ngFor=\"let task of activeTasks\" (click)=\"clickTask(task)\">\n                <mat-icon mat-list-icon>assignment</mat-icon>\n                <h3 matLine>{{task.name || 'Nameless task'}}</h3>\n                <span matLine>\n                    {{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASK_SUBTITLE' | translate:{user: getUserFullName(task.assignee), created: getFormatDate(task.created, 'mediumDate') } }}\n                </span>\n        </mat-list-item>\n    </mat-list>\n</div>\n\n<!-- START FORM -->\n\n<div *ngIf=\"activeTasks?.length === 0\" data-automation-id=\"active-tasks-none\" class=\"no-results\">\n    {{ 'ADF_PROCESS_LIST.DETAILS.TASKS.NO_ACTIVE' | translate }}\n</div>\n\n<div *ngIf=\"hasStartFormDefined()\">\n    <span class=\"adf-activiti-label\">{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.START_FORM'|translate }}</span>\n\n    <!--IF START TASK COMPLETED -->\n    <div class=\"menu-container\" data-automation-id=\"start-form\">\n        <mat-list>\n            <mat-list-item class=\"process-tasks__task-item\" (click)=\"clickStartTask()\">\n                <mat-icon mat-list-icon>assignment</mat-icon>\n                <h3 matLine>{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.START_FORM'|translate }}</h3>\n                <span matLine>\n                    {{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASK_SUBTITLE' | translate:{user:getUserFullName(processInstanceDetails.startedBy), created: getFormatDate(processInstanceDetails.started, 'mediumDate') } }}\n                </span>\n            </mat-list-item>\n        </mat-list>\n    </div>\n\n</div>\n\n<!-- COMPLETED FORM -->\n<mat-chip-list>\n        <span class=\"adf-chip-label\">{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASKS_COMPLETED'|translate }}</span>\n        <mat-chip class=\"adf-process-badge\" color=\"accent\" selected=\"true\">{{completedTasks?.length}}</mat-chip>\n</mat-chip-list>\n\n<div class=\"menu-container\" *ngIf=\"completedTasks?.length > 0\" data-automation-id=\"completed-tasks\">\n    <mat-list>\n        <mat-list-item class=\"process-tasks__task-item\" *ngFor=\"let task of completedTasks\" (click)=\"clickTask(task)\">\n            <mat-icon mat-list-icon>assignment</mat-icon>\n            <h3 matLine>{{task.name || 'Nameless task'}}</h3>\n            <span matLine>\n                {{ 'ADF_PROCESS_LIST.DETAILS.LABELS.TASK_SUBTITLE' | translate:{user:getUserFullName(task.assignee), created: getFormatDate(task.created, 'mediumDate') } }}\n            </span>\n        </mat-list-item>\n    </mat-list>\n</div>\n\n<div *ngIf=\"completedTasks?.length === 0\" data-automation-id=\"completed-tasks-none\" class=\"no-results\">\n    {{ 'ADF_PROCESS_LIST.DETAILS.TASKS.NO_COMPLETED' | translate }}\n</div>\n\n<ng-template *ngIf=\"hasStartFormDefined()\" #startDialog>\n    <div id=\"adf-start-process-dialog\" class=\"adf-start-process-dialog\">\n        <h4 matDialogTitle>{{ 'ADF_PROCESS_LIST.DETAILS.LABELS.START_FORM'|translate }}</h4>\n        <div mat-dialog-content class=\"adf-start-process-dialog-content\">\n            <adf-start-form [processId]=\"processId\"\n                                 [showRefreshButton]=\"false\" [readOnlyForm]=\"true\"\n                                 (formContentClicked)='onFormContentClick()'>\n            </adf-start-form>\n        </div>\n        <div mat-dialog-actions class=\"adf-start-process-dialog-actions\">\n            <button mat-button type=\"button\" (click)=\"closeStartDialog()\">{{ 'ADF_PROCESS_LIST.DETAILS.TASKS.TASK_CLOSE' | translate }}</button>\n        </div>\n    </div>\n</ng-template>\n",
                styles: [":host{width:100%}.activiti-label{font-weight:bolder;vertical-align:top}.adf-process-badge{outline:none;pointer-events:none}.adf-chip-label{font-weight:700;margin-right:8px;position:relative;top:5px}.menu-container{margin-bottom:32px}.activiti-label+.icon{position:relative;top:-2px}.task-details-dialog{position:fixed;top:50%;transform:translateY(-50%);width:40%}.process-tasks-refresh{float:right}.adf-start-process-dialog{display:flex;flex-direction:column;height:100%;width:100%}.adf-start-process-dialog-content{flex-grow:1}.adf-start-process-dialog-actions{display:flex;justify-content:flex-end}.no-results{color:rgba(0,0,0,.54);display:block;font-size:14px;font-weight:400;letter-spacing:0;line-height:18px;margin-left:9px;padding:12px}.process-tasks__task-item{cursor:pointer}"]
            }]
    }], function () { return [{ type: ɵngcc1.ProcessService }, { type: ɵngcc2.LogService }, { type: ɵngcc3.MatDialog }]; }, { showRefreshButton: [{
            type: Input
        }], error: [{
            type: Output
        }], taskClick: [{
            type: Output
        }], processInstanceDetails: [{
            type: Input
        }], startDialog: [{
            type: ViewChild,
            args: ['startDialog']
        }], taskDetails: [{
            type: ViewChild,
            args: ['taskDetails']
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzcy1pbnN0YW5jZS10YXNrcy5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9wcm9jZXNzLXNlcnZpY2VzL3NyYy9saWIvcHJvY2Vzcy1saXN0L2NvbXBvbmVudHMvcHJvY2Vzcy1pbnN0YW5jZS10YXNrcy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUVILE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNoRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFxQixNQUFNLEVBQWlCLFNBQVMsRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUMvSCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDckQsT0FBTyxFQUFFLFVBQVUsRUFBWSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDckQsT0FBTyxFQUFFLGdCQUFnQixFQUFvQixNQUFNLGlCQUFpQixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNuRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDL0QsT0FBTyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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QUFBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IExvZ1NlcnZpY2UgfSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgRGF0ZVBpcGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkNoYW5nZXMsIE9uSW5pdCwgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0RGlhbG9nIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZGlhbG9nJztcbmltcG9ydCB7IE9ic2VydmFibGUsIE9ic2VydmVyLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBUYXNrRGV0YWlsc0V2ZW50LCBUYXNrRGV0YWlsc01vZGVsIH0gZnJvbSAnLi4vLi4vdGFzay1saXN0JztcbmltcG9ydCB7IFByb2Nlc3NJbnN0YW5jZSB9IGZyb20gJy4uL21vZGVscy9wcm9jZXNzLWluc3RhbmNlLm1vZGVsJztcbmltcG9ydCB7IFByb2Nlc3NTZXJ2aWNlIH0gZnJvbSAnLi8uLi9zZXJ2aWNlcy9wcm9jZXNzLnNlcnZpY2UnO1xuaW1wb3J0IHsgc2hhcmUsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhZGYtcHJvY2Vzcy1pbnN0YW5jZS10YXNrcycsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3Byb2Nlc3MtaW5zdGFuY2UtdGFza3MuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3Byb2Nlc3MtaW5zdGFuY2UtdGFza3MuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIFByb2Nlc3NJbnN0YW5jZVRhc2tzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG5cbiAgICAvKiogKCoqcmVxdWlyZWQqKikgVGhlIElEIG9mIHRoZSBwcm9jZXNzIGluc3RhbmNlIHRvIGRpc3BsYXkgdGFza3MgZm9yLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgcHJvY2Vzc0luc3RhbmNlRGV0YWlsczogUHJvY2Vzc0luc3RhbmNlO1xuXG4gICAgLyoqIFRvZ2dsZXMgd2hldGhlciB0byBzaG93IGEgcmVmcmVzaCBidXR0b24gbmV4dCB0byB0aGUgbGlzdCBvZiB0YXNrcyB0byBhbGxvd1xuICAgICAqIGl0IHRvIGJlIHVwZGF0ZWQgZnJvbSB0aGUgc2VydmVyLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd1JlZnJlc2hCdXR0b246IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMuICovXG4gICAgQE91dHB1dCgpXG4gICAgZXJyb3I6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICBhY3RpdmVUYXNrczogVGFza0RldGFpbHNNb2RlbFtdID0gW107XG4gICAgY29tcGxldGVkVGFza3M6IFRhc2tEZXRhaWxzTW9kZWxbXSA9IFtdO1xuXG4gICAgcHJpdmF0ZSB0YXNrT2JzZXJ2ZXI6IE9ic2VydmVyPFRhc2tEZXRhaWxzTW9kZWw+O1xuICAgIHByaXZhdGUgY29tcGxldGVkVGFza09ic2VydmVyOiBPYnNlcnZlcjxUYXNrRGV0YWlsc01vZGVsPjtcbiAgICBwcml2YXRlIG9uRGVzdHJveSQgPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xuXG4gICAgdGFzayQ6IE9ic2VydmFibGU8VGFza0RldGFpbHNNb2RlbD47XG4gICAgY29tcGxldGVkVGFzayQ6IE9ic2VydmFibGU8VGFza0RldGFpbHNNb2RlbD47XG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIHByb2Nlc3NJZDogc3RyaW5nO1xuXG4gICAgQFZpZXdDaGlsZCgnc3RhcnREaWFsb2cnKVxuICAgIHN0YXJ0RGlhbG9nOiBhbnk7XG5cbiAgICBAVmlld0NoaWxkKCd0YXNrRGV0YWlscycpXG4gICAgdGFza0RldGFpbHM6IGFueTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gYSB0YXNrIGlzIGNsaWNrZWQuICovXG4gICAgQE91dHB1dCgpXG4gICAgdGFza0NsaWNrOiBFdmVudEVtaXR0ZXI8VGFza0RldGFpbHNFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPFRhc2tEZXRhaWxzRXZlbnQ+KCk7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFjdGl2aXRpUHJvY2VzczogUHJvY2Vzc1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsb2dTZXJ2aWNlOiBMb2dTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgZGlhbG9nOiBNYXREaWFsb2cpIHtcbiAgICAgICAgdGhpcy50YXNrJCA9IG5ldyBPYnNlcnZhYmxlPFRhc2tEZXRhaWxzTW9kZWw+KChvYnNlcnZlcikgPT4gdGhpcy50YXNrT2JzZXJ2ZXIgPSBvYnNlcnZlcilcbiAgICAgICAgICAgIC5waXBlKHNoYXJlKCkpO1xuICAgICAgICB0aGlzLmNvbXBsZXRlZFRhc2skID0gbmV3IE9ic2VydmFibGU8VGFza0RldGFpbHNNb2RlbD4oKG9ic2VydmVyKSA9PiB0aGlzLmNvbXBsZXRlZFRhc2tPYnNlcnZlciA9IG9ic2VydmVyKVxuICAgICAgICAgICAgLnBpcGUoc2hhcmUoKSk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMudGFzayRcbiAgICAgICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpKVxuICAgICAgICAgICAgLnN1YnNjcmliZSh0YXNrID0+IHRoaXMuYWN0aXZlVGFza3MucHVzaCh0YXNrKSk7XG5cbiAgICAgICAgdGhpcy5jb21wbGV0ZWRUYXNrJFxuICAgICAgICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMub25EZXN0cm95JCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKHRhc2sgPT4gdGhpcy5jb21wbGV0ZWRUYXNrcy5wdXNoKHRhc2spKTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLm5leHQodHJ1ZSk7XG4gICAgICAgIHRoaXMub25EZXN0cm95JC5jb21wbGV0ZSgpO1xuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgICAgY29uc3QgcHJvY2Vzc0luc3RhbmNlRGV0YWlscyA9IGNoYW5nZXNbJ3Byb2Nlc3NJbnN0YW5jZURldGFpbHMnXTtcbiAgICAgICAgaWYgKHByb2Nlc3NJbnN0YW5jZURldGFpbHMgJiYgcHJvY2Vzc0luc3RhbmNlRGV0YWlscy5jdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZChwcm9jZXNzSW5zdGFuY2VEZXRhaWxzLmN1cnJlbnRWYWx1ZS5pZCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsb2FkKHByb2Nlc3NJbnN0YW5jZUlkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5sb2FkQWN0aXZlKHByb2Nlc3NJbnN0YW5jZUlkKTtcbiAgICAgICAgdGhpcy5sb2FkQ29tcGxldGVkKHByb2Nlc3NJbnN0YW5jZUlkKTtcbiAgICB9XG5cbiAgICBsb2FkQWN0aXZlKHByb2Nlc3NJbnN0YW5jZUlkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5hY3RpdmVUYXNrcyA9IFtdO1xuICAgICAgICBpZiAocHJvY2Vzc0luc3RhbmNlSWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlQcm9jZXNzLmdldFByb2Nlc3NUYXNrcyhwcm9jZXNzSW5zdGFuY2VJZCwgbnVsbCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgIChyZXM6IFRhc2tEZXRhaWxzTW9kZWxbXSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXMuZm9yRWFjaCgodGFzaykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50YXNrT2JzZXJ2ZXIubmV4dCh0YXNrKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IuZW1pdChlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZVRhc2tzID0gW107XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsb2FkQ29tcGxldGVkKHByb2Nlc3NJbnN0YW5jZUlkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5jb21wbGV0ZWRUYXNrcyA9IFtdO1xuICAgICAgICBpZiAocHJvY2Vzc0luc3RhbmNlSWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZpdGlQcm9jZXNzLmdldFByb2Nlc3NUYXNrcyhwcm9jZXNzSW5zdGFuY2VJZCwgJ2NvbXBsZXRlZCcpLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAocmVzOiBUYXNrRGV0YWlsc01vZGVsW10pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzLmZvckVhY2goKHRhc2spID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGVkVGFza09ic2VydmVyLm5leHQodGFzayk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yLmVtaXQoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZWRUYXNrcyA9IFtdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaGFzU3RhcnRGb3JtRGVmaW5lZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc0luc3RhbmNlRGV0YWlscyAmJiB0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMuc3RhcnRGb3JtRGVmaW5lZCA9PT0gdHJ1ZTtcbiAgICB9XG5cbiAgICBnZXRVc2VyRnVsbE5hbWUodXNlcjogYW55KTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiAodXNlci5maXJzdE5hbWUgJiYgdXNlci5maXJzdE5hbWUgIT09ICdudWxsJ1xuICAgICAgICAgICAgICAgICAgICA/IHVzZXIuZmlyc3ROYW1lICsgJyAnIDogJycpICtcbiAgICAgICAgICAgICAgICB1c2VyLmxhc3ROYW1lO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnTm9ib2R5JztcbiAgICB9XG5cbiAgICBnZXRGb3JtYXREYXRlKHZhbHVlOiBhbnksIGZvcm1hdDogc3RyaW5nKTogYW55IHtcbiAgICAgICAgY29uc3QgZGF0ZVBpcGUgPSBuZXcgRGF0ZVBpcGUoJ2VuLVVTJyk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gZGF0ZVBpcGUudHJhbnNmb3JtKHZhbHVlLCBmb3JtYXQpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5lcnJvcihgUHJvY2Vzc0xpc3RJbnN0YW5jZVRhc2s6IGVycm9yIHBhcnNpbmcgZGF0ZSAke3ZhbHVlfSB0byBmb3JtYXQgJHtmb3JtYXR9YCk7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjbGlja1Rhc2sodGFzazogVGFza0RldGFpbHNNb2RlbCkge1xuICAgICAgICBjb25zdCBhcmdzID0gbmV3IFRhc2tEZXRhaWxzRXZlbnQodGFzayk7XG4gICAgICAgIHRoaXMudGFza0NsaWNrLmVtaXQoYXJncyk7XG4gICAgfVxuXG4gICAgY2xpY2tTdGFydFRhc2soKSB7XG4gICAgICAgIHRoaXMucHJvY2Vzc0lkID0gdGhpcy5wcm9jZXNzSW5zdGFuY2VEZXRhaWxzLmlkO1xuICAgICAgICB0aGlzLnNob3dTdGFydERpYWxvZygpO1xuICAgIH1cblxuICAgIHNob3dTdGFydERpYWxvZygpIHtcbiAgICAgICAgdGhpcy5kaWFsb2cub3Blbih0aGlzLnN0YXJ0RGlhbG9nLCB7IGhlaWdodDogJzUwMHB4Jywgd2lkdGg6ICc3MDBweCcgfSk7XG4gICAgfVxuXG4gICAgY2xvc2VTdGFydERpYWxvZygpIHtcbiAgICAgICAgdGhpcy5kaWFsb2cuY2xvc2VBbGwoKTtcbiAgICB9XG5cbiAgICBvblJlZnJlc2hDbGlja2VkKCkge1xuICAgICAgICB0aGlzLmxvYWQodGhpcy5wcm9jZXNzSW5zdGFuY2VEZXRhaWxzLmlkKTtcbiAgICB9XG5cbiAgICBvbkZvcm1Db250ZW50Q2xpY2soKSB7XG4gICAgICAgIHRoaXMuY2xvc2VTdGFydERpYWxvZygpO1xuICAgIH1cbn1cbiJdfQ==