/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { LogService } from '@alfresco/adf-core';
import { DatePipe } from '@angular/common';
import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { ProcessService } from './../services/process.service';
import { ProcessInstanceHeaderComponent } from './process-instance-header.component';
import { ProcessInstanceTasksComponent } from './process-instance-tasks.component';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './../services/process.service';
import * as ɵngcc2 from '@alfresco/adf-core';
import * as ɵngcc3 from '@angular/common';
import * as ɵngcc4 from '@angular/material/card';
import * as ɵngcc5 from './process-instance-header.component';
import * as ɵngcc6 from '@angular/material/button';
import * as ɵngcc7 from './process-instance-tasks.component';
import * as ɵngcc8 from '../../process-comments/process-comments.component';
import * as ɵngcc9 from '@ngx-translate/core';

const _c0 = ["processInstanceHeader"];
const _c1 = ["processInstanceTasks"];
function ProcessInstanceDetailsComponent_div_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 1, "ADF_PROCESS_LIST.DETAILS.MESSAGES.NONE"));
} }
function ProcessInstanceDetailsComponent_mat_card_1_div_14_Template(rf, ctx) { if (rf & 1) {
    const _r7 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 9);
    ɵngcc0.ɵɵelementStart(1, "button", 10);
    ɵngcc0.ɵɵlistener("click", function ProcessInstanceDetailsComponent_mat_card_1_div_14_Template_button_click_1_listener() { ɵngcc0.ɵɵrestoreView(_r7); const ctx_r6 = ɵngcc0.ɵɵnextContext(2); return ctx_r6.cancelProcess(); });
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 1, "ADF_PROCESS_LIST.DETAILS.BUTTON.CANCEL"));
} }
function ProcessInstanceDetailsComponent_mat_card_1_Template(rf, ctx) { if (rf & 1) {
    const _r9 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "mat-card");
    ɵngcc0.ɵɵelementStart(1, "mat-card-header");
    ɵngcc0.ɵɵelementStart(2, "mat-card-title");
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "mat-card-content");
    ɵngcc0.ɵɵelementStart(5, "adf-process-instance-header", 1, 2);
    ɵngcc0.ɵɵlistener("showProcessDiagram", function ProcessInstanceDetailsComponent_mat_card_1_Template_adf_process_instance_header_showProcessDiagram_5_listener() { ɵngcc0.ɵɵrestoreView(_r9); const ctx_r8 = ɵngcc0.ɵɵnextContext(); return ctx_r8.onShowProcessDiagram(); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(7, "button", 3);
    ɵngcc0.ɵɵlistener("click", function ProcessInstanceDetailsComponent_mat_card_1_Template_button_click_7_listener() { ɵngcc0.ɵɵrestoreView(_r9); const ctx_r10 = ɵngcc0.ɵɵnextContext(); return ctx_r10.onShowProcessDiagram(); });
    ɵngcc0.ɵɵtext(8);
    ɵngcc0.ɵɵpipe(9, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(10, "mat-card");
    ɵngcc0.ɵɵelementStart(11, "mat-card-content");
    ɵngcc0.ɵɵelementStart(12, "adf-process-instance-tasks", 4, 5);
    ɵngcc0.ɵɵlistener("taskClick", function ProcessInstanceDetailsComponent_mat_card_1_Template_adf_process_instance_tasks_taskClick_12_listener($event) { ɵngcc0.ɵɵrestoreView(_r9); const ctx_r11 = ɵngcc0.ɵɵnextContext(); return ctx_r11.onTaskClicked($event); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(14, ProcessInstanceDetailsComponent_mat_card_1_div_14_Template, 4, 3, "div", 6);
    ɵngcc0.ɵɵelementStart(15, "mat-card");
    ɵngcc0.ɵɵelementStart(16, "mat-card-content");
    ɵngcc0.ɵɵelement(17, "adf-process-instance-comments", 7, 8);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ctx_r1.getProcessNameOrDescription("medium"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("processInstance", ctx_r1.processInstanceDetails);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("disabled", !ctx_r1.isRunning());
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(9, 8, "ADF_PROCESS_LIST.DETAILS.BUTTON.SHOW_DIAGRAM"));
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("processInstanceDetails", ctx_r1.processInstanceDetails);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.isRunning());
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("readOnly", false)("processInstanceId", ctx_r1.processInstanceDetails.id);
} }
export class ProcessInstanceDetailsComponent {
    constructor(activitiProcess, logService) {
        this.activitiProcess = activitiProcess;
        this.logService = logService;
        this.showTitle = true;
        this.showRefreshButton = true;
        this.processCancelled = new EventEmitter();
        this.error = new EventEmitter();
        this.taskClick = new EventEmitter();
        this.showProcessDiagram = new EventEmitter();
    }
    ngOnChanges(changes) {
        const processInstanceId = changes['processInstanceId'];
        if (processInstanceId && !processInstanceId.currentValue) {
            this.reset();
            return;
        }
        if (processInstanceId && processInstanceId.currentValue) {
            this.load(processInstanceId.currentValue);
            return;
        }
    }
    reset() {
        this.processInstanceDetails = null;
    }
    load(processId) {
        if (processId) {
            this.activitiProcess.getProcess(processId).subscribe((res) => {
                this.processInstanceDetails = res;
            });
        }
    }
    isRunning() {
        return this.processInstanceDetails && !this.processInstanceDetails.ended;
    }
    cancelProcess() {
        this.activitiProcess.cancelProcess(this.processInstanceId).subscribe((data) => {
            this.processCancelled.emit(data);
        }, (err) => {
            this.error.emit(err);
        });
    }
    onTaskClicked(event) {
        this.taskClick.emit(event);
    }
    getProcessNameOrDescription(dateFormat) {
        let name = '';
        if (this.processInstanceDetails) {
            name = this.processInstanceDetails.name ||
                this.processInstanceDetails.processDefinitionName + ' - ' + this.getFormatDate(this.processInstanceDetails.started, dateFormat);
        }
        return name;
    }
    getFormatDate(value, format) {
        const datePipe = new DatePipe('en-US');
        try {
            return datePipe.transform(value, format);
        }
        catch (err) {
            this.logService.error(`ProcessListInstanceHeader: error parsing date ${value} to format ${format}`);
        }
    }
    onShowProcessDiagram() {
        this.showProcessDiagram.emit({ value: this.processInstanceId });
    }
}
ProcessInstanceDetailsComponent.ɵfac = function ProcessInstanceDetailsComponent_Factory(t) { return new (t || ProcessInstanceDetailsComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ProcessService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LogService)); };
ProcessInstanceDetailsComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ProcessInstanceDetailsComponent, selectors: [["adf-process-instance-details"]], viewQuery: function ProcessInstanceDetailsComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, true);
        ɵngcc0.ɵɵviewQuery(_c1, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.processInstanceHeader = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.tasksList = _t.first);
    } }, inputs: { showTitle: "showTitle", showRefreshButton: "showRefreshButton", processInstanceId: "processInstanceId" }, outputs: { processCancelled: "processCancelled", error: "error", taskClick: "taskClick", showProcessDiagram: "showProcessDiagram" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 2, vars: 2, consts: [[4, "ngIf"], [3, "processInstance", "showProcessDiagram"], ["processInstanceHeader", ""], ["mat-button", "", "id", "show-diagram-button", "type", "button", "mat-button", "", "mat-raised-button", "", 1, "adf-in-medias-res-button", 3, "disabled", "click"], [3, "processInstanceDetails", "taskClick"], ["processInstanceTasks", ""], ["data-automation-id", "header-status", "class", "adf-in-medias-res-button", 4, "ngIf"], [3, "readOnly", "processInstanceId"], ["activitiComments", ""], ["data-automation-id", "header-status", 1, "adf-in-medias-res-button"], ["mat-button", "", "type", "button", 3, "click"]], template: function ProcessInstanceDetailsComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, ProcessInstanceDetailsComponent_div_0_Template, 3, 3, "div", 0);
        ɵngcc0.ɵɵtemplate(1, ProcessInstanceDetailsComponent_mat_card_1_Template, 19, 10, "mat-card", 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", !ctx.processInstanceDetails);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.processInstanceDetails);
    } }, directives: [ɵngcc3.NgIf, ɵngcc4.MatCard, ɵngcc4.MatCardHeader, ɵngcc4.MatCardTitle, ɵngcc4.MatCardContent, ɵngcc5.ProcessInstanceHeaderComponent, ɵngcc6.MatButton, ɵngcc7.ProcessInstanceTasksComponent, ɵngcc8.ProcessCommentsComponent], pipes: [ɵngcc9.TranslatePipe], styles: ["[_nghost-%COMP%]{width:100%}.activiti-process-container[_ngcontent-%COMP%]{min-height:100px;overflow:visible;padding:10px;width:100%}.adf-comments-dialog[_ngcontent-%COMP%]{position:fixed;top:50%;transform:translateY(-50%);width:40%}.adf-in-medias-res-button[_ngcontent-%COMP%]{margin:16px 0}"] });
ProcessInstanceDetailsComponent.ctorParameters = () => [
    { type: ProcessService },
    { type: LogService }
];
ProcessInstanceDetailsComponent.propDecorators = {
    processInstanceId: [{ type: Input }],
    processInstanceHeader: [{ type: ViewChild, args: ['processInstanceHeader',] }],
    tasksList: [{ type: ViewChild, args: ['processInstanceTasks',] }],
    showTitle: [{ type: Input }],
    showRefreshButton: [{ type: Input }],
    processCancelled: [{ type: Output }],
    error: [{ type: Output }],
    taskClick: [{ type: Output }],
    showProcessDiagram: [{ type: Output }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ProcessInstanceDetailsComponent, [{
        type: Component,
        args: [{
                selector: 'adf-process-instance-details',
                template: "<div *ngIf=\"!processInstanceDetails\">{{ 'ADF_PROCESS_LIST.DETAILS.MESSAGES.NONE'|translate }}</div>\n<mat-card *ngIf=\"processInstanceDetails\">\n    <mat-card-header>\n        <mat-card-title>{{ getProcessNameOrDescription('medium') }}</mat-card-title>\n    </mat-card-header>\n    <mat-card-content>\n        <adf-process-instance-header\n            #processInstanceHeader\n            [processInstance]=\"processInstanceDetails\"\n            (showProcessDiagram)=\"onShowProcessDiagram()\">\n        </adf-process-instance-header>\n\n        <button\n            class=\"adf-in-medias-res-button\"\n            mat-button id=\"show-diagram-button\"\n            type=\"button\"\n            mat-button mat-raised-button\n            [disabled]=\"!isRunning()\"\n            (click)=\"onShowProcessDiagram()\">{{ 'ADF_PROCESS_LIST.DETAILS.BUTTON.SHOW_DIAGRAM' | translate }}</button>\n\n        <mat-card>\n            <mat-card-content>\n                <adf-process-instance-tasks\n                    #processInstanceTasks\n                    [processInstanceDetails]=\"processInstanceDetails\"\n                    (taskClick)=\"onTaskClicked($event)\">\n                </adf-process-instance-tasks>\n            </mat-card-content>\n        </mat-card>\n\n        <div data-automation-id=\"header-status\" *ngIf=\"isRunning()\" class=\"adf-in-medias-res-button\">\n            <button mat-button type=\"button\" (click)=\"cancelProcess()\">{{ 'ADF_PROCESS_LIST.DETAILS.BUTTON.CANCEL' | translate }}</button>\n        </div>\n\n        <mat-card>\n            <mat-card-content>\n                <adf-process-instance-comments #activitiComments\n                    [readOnly]=\"false\"\n                    [processInstanceId]=\"processInstanceDetails.id\">\n                </adf-process-instance-comments>\n            </mat-card-content>\n        </mat-card>\n\n    </mat-card-content>\n</mat-card>\n",
                styles: [":host{width:100%}.activiti-process-container{min-height:100px;overflow:visible;padding:10px;width:100%}.adf-comments-dialog{position:fixed;top:50%;transform:translateY(-50%);width:40%}.adf-in-medias-res-button{margin:16px 0}"]
            }]
    }], function () { return [{ type: ɵngcc1.ProcessService }, { type: ɵngcc2.LogService }]; }, { showTitle: [{
            type: Input
        }], showRefreshButton: [{
            type: Input
        }], processCancelled: [{
            type: Output
        }], error: [{
            type: Output
        }], taskClick: [{
            type: Output
        }], showProcessDiagram: [{
            type: Output
        }], processInstanceId: [{
            type: Input
        }], processInstanceHeader: [{
            type: ViewChild,
            args: ['processInstanceHeader']
        }], tasksList: [{
            type: ViewChild,
            args: ['processInstanceTasks']
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzcy1pbnN0YW5jZS1kZXRhaWxzLmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL3Byb2Nlc3Mtc2VydmljZXMvc3JjL2xpYi9wcm9jZXNzLWxpc3QvY29tcG9uZW50cy9wcm9jZXNzLWluc3RhbmNlLWRldGFpbHMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFFSCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDaEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBYSxNQUFNLEVBQWlCLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUk1RyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDL0QsT0FBTyxFQUFFLDhCQUE4QixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDckYsT0FBTyxFQUFFLDZCQUE2QixFQUFFLE1BQU0sb0NBQW9DLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFPbkYsTUFBTSxPQUFPLCtCQUErQjtBQUFHLElBMkMzQyxZQUFvQixlQUErQixFQUMvQixVQUFzQjtBQUM5QyxRQUZ3QixvQkFBZSxHQUFmLGVBQWUsQ0FBZ0I7QUFBQyxRQUNoQyxlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQUMsUUE5QjNDLGNBQVMsR0FBWSxJQUFJLENB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LENBQUMsQ0FBQztBQUMvQyxRQUFRLElBQUk7QUFDWixZQUFZLE9BQU8sUUFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDckQsU0FBUztBQUFDLFFBQUEsT0FBTyxHQUFHLEVBQUU7QUFDdEIsWUFBWSxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxpREFBaUQsS0FBSyxjQUFjLE1BQU0sRUFBRSxDQUFDLENBQUM7QUFDaEgsU0FBUztBQUNULElBQUksQ0FBQztBQUNMLElBQ0ksb0JBQW9CO0FBQ3hCLFFBQVEsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxFQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsaUJBQWlCLEVBQUMsQ0FBQyxDQUFDO0FBQ3RFLElBQUksQ0FBQztBQUNMOzJEQXhIQyxTQUFTLFNBQUMsa0JBQ1AsUUFBUSxFQUFFLDhCQUE4QixrQkFDeEM7Ozs7Ozs7Ozs7Ozs7RUFBd0Q7O2tMQUUzRCx1WkFDSTtBQUFDO0FBQXlELFlBVHRELGNBQWM7QUFBSSxZQU5sQixVQUFVO0FBQUc7QUFBRztBQUNFLGdDQWlCdEIsS0FBSztBQUNSLG9DQUVHLFNBQVMsU0FBQyx1QkFBdUI7QUFDakMsd0JBRUEsU0FBUyxTQUFDLHNCQUFzQjtBQUNoQyx3QkFHQSxLQUFLO0FBQ1IsZ0NBR0csS0FBSztBQUNSLCtCQUdHLE1BQU07QUFDVCxvQkFHRyxNQUFNO0FBQ1Qsd0JBR0csTUFBTTtBQUNULGlDQUtHLE1BQU07QUFDVjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgTG9nU2VydmljZSB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBEYXRlUGlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFRhc2tEZXRhaWxzRXZlbnQgfSBmcm9tICcuLi8uLi90YXNrLWxpc3QnO1xuXG5pbXBvcnQgeyBQcm9jZXNzSW5zdGFuY2UgfSBmcm9tICcuLi9tb2RlbHMvcHJvY2Vzcy1pbnN0YW5jZS5tb2RlbCc7XG5pbXBvcnQgeyBQcm9jZXNzU2VydmljZSB9IGZyb20gJy4vLi4vc2VydmljZXMvcHJvY2Vzcy5zZXJ2aWNlJztcbmltcG9ydCB7IFByb2Nlc3NJbnN0YW5jZUhlYWRlckNvbXBvbmVudCB9IGZyb20gJy4vcHJvY2Vzcy1pbnN0YW5jZS1oZWFkZXIuY29tcG9uZW50JztcbmltcG9ydCB7IFByb2Nlc3NJbnN0YW5jZVRhc2tzQ29tcG9uZW50IH0gZnJvbSAnLi9wcm9jZXNzLWluc3RhbmNlLXRhc2tzLmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLXByb2Nlc3MtaW5zdGFuY2UtZGV0YWlscycsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3Byb2Nlc3MtaW5zdGFuY2UtZGV0YWlscy5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vcHJvY2Vzcy1pbnN0YW5jZS1kZXRhaWxzLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBQcm9jZXNzSW5zdGFuY2VEZXRhaWxzQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcblxuICAgIC8qKiAocmVxdWlyZWQpIFRoZSBudW1lcmljIElEIG9mIHRoZSBwcm9jZXNzIGluc3RhbmNlIHRvIGRpc3BsYXkuICovXG4gICAgQElucHV0KClcbiAgICBwcm9jZXNzSW5zdGFuY2VJZDogc3RyaW5nO1xuXG4gICAgQFZpZXdDaGlsZCgncHJvY2Vzc0luc3RhbmNlSGVhZGVyJylcbiAgICBwcm9jZXNzSW5zdGFuY2VIZWFkZXI6IFByb2Nlc3NJbnN0YW5jZUhlYWRlckNvbXBvbmVudDtcblxuICAgIEBWaWV3Q2hpbGQoJ3Byb2Nlc3NJbnN0YW5jZVRhc2tzJylcbiAgICB0YXNrc0xpc3Q6IFByb2Nlc3NJbnN0YW5jZVRhc2tzQ29tcG9uZW50O1xuXG4gICAgLyoqIFRvZ2dsZXMgd2hldGhlciB0byBzaG93IG9yIGhpZGUgdGhlIHRpdGxlLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd1RpdGxlOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBUb2dnbGVzIHdoZXRoZXIgdG8gc2hvdyBvciBoaWRlIHRoZSByZWZyZXNoIGJ1dHRvbi4gKi9cbiAgICBASW5wdXQoKVxuICAgIHNob3dSZWZyZXNoQnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIGN1cnJlbnQgcHJvY2VzcyBpcyBjYW5jZWxsZWQgYnkgdGhlIHVzZXIgZnJvbSB3aXRoaW4gdGhlIGNvbXBvbmVudC4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBwcm9jZXNzQ2FuY2VsbGVkID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGFuIGVycm9yIG9jY3Vycy4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBlcnJvciA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBhIHRhc2sgaXMgY2xpY2tlZC4gKi9cbiAgICBAT3V0cHV0KClcbiAgICB0YXNrQ2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyPFRhc2tEZXRhaWxzRXZlbnQ+KCk7XG5cbiAgICBwcm9jZXNzSW5zdGFuY2VEZXRhaWxzOiBQcm9jZXNzSW5zdGFuY2U7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSBcInNob3cgZGlhZ3JhbVwiIGJ1dHRvbiBpcyBjbGlja2VkLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHNob3dQcm9jZXNzRGlhZ3JhbSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0gdHJhbnNsYXRlIFRyYW5zbGF0aW9uIHNlcnZpY2VcbiAgICAgKiBAcGFyYW0gYWN0aXZpdGlQcm9jZXNzICAgUHJvY2VzcyBzZXJ2aWNlXG4gICAgICovXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBhY3Rpdml0aVByb2Nlc3M6IFByb2Nlc3NTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgbG9nU2VydmljZTogTG9nU2VydmljZSkge1xuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgICAgY29uc3QgcHJvY2Vzc0luc3RhbmNlSWQgPSBjaGFuZ2VzWydwcm9jZXNzSW5zdGFuY2VJZCddO1xuICAgICAgICBpZiAocHJvY2Vzc0luc3RhbmNlSWQgJiYgIXByb2Nlc3NJbnN0YW5jZUlkLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcm9jZXNzSW5zdGFuY2VJZCAmJiBwcm9jZXNzSW5zdGFuY2VJZC5jdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZChwcm9jZXNzSW5zdGFuY2VJZC5jdXJyZW50VmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzZXQgdGhlIHRhc2sgZGV0YWlsXG4gICAgICovXG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMucHJvY2Vzc0luc3RhbmNlRGV0YWlscyA9IG51bGw7XG4gICAgfVxuXG4gICAgbG9hZChwcm9jZXNzSWQ6IHN0cmluZykge1xuICAgICAgICBpZiAocHJvY2Vzc0lkKSB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2aXRpUHJvY2Vzcy5nZXRQcm9jZXNzKHByb2Nlc3NJZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgIChyZXM6IFByb2Nlc3NJbnN0YW5jZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMgPSByZXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlzUnVubmluZygpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc0luc3RhbmNlRGV0YWlscyAmJiAhdGhpcy5wcm9jZXNzSW5zdGFuY2VEZXRhaWxzLmVuZGVkO1xuICAgIH1cblxuICAgIGNhbmNlbFByb2Nlc3MoKSB7XG4gICAgICAgIHRoaXMuYWN0aXZpdGlQcm9jZXNzLmNhbmNlbFByb2Nlc3ModGhpcy5wcm9jZXNzSW5zdGFuY2VJZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NDYW5jZWxsZWQuZW1pdChkYXRhKTtcbiAgICAgICAgICAgIH0sIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yLmVtaXQoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIGJ1YmJsZXMgKHRhc2tDbGljaykgZXZlbnRcbiAgICBvblRhc2tDbGlja2VkKGV2ZW50OiBUYXNrRGV0YWlsc0V2ZW50KSB7XG4gICAgICAgIHRoaXMudGFza0NsaWNrLmVtaXQoZXZlbnQpO1xuICAgIH1cblxuICAgIGdldFByb2Nlc3NOYW1lT3JEZXNjcmlwdGlvbihkYXRlRm9ybWF0OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBsZXQgbmFtZSA9ICcnO1xuICAgICAgICBpZiAodGhpcy5wcm9jZXNzSW5zdGFuY2VEZXRhaWxzKSB7XG4gICAgICAgICAgICBuYW1lID0gdGhpcy5wcm9jZXNzSW5zdGFuY2VEZXRhaWxzLm5hbWUgfHxcbiAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMucHJvY2Vzc0RlZmluaXRpb25OYW1lICsgJyAtICcgKyB0aGlzLmdldEZvcm1hdERhdGUodGhpcy5wcm9jZXNzSW5zdGFuY2VEZXRhaWxzLnN0YXJ0ZWQsIGRhdGVGb3JtYXQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuYW1lO1xuICAgIH1cblxuICAgIGdldEZvcm1hdERhdGUodmFsdWU6IGFueSwgZm9ybWF0OiBzdHJpbmcpOiBhbnkge1xuICAgICAgICBjb25zdCBkYXRlUGlwZSA9IG5ldyBEYXRlUGlwZSgnZW4tVVMnKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBkYXRlUGlwZS50cmFuc2Zvcm0odmFsdWUsIGZvcm1hdCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKGBQcm9jZXNzTGlzdEluc3RhbmNlSGVhZGVyOiBlcnJvciBwYXJzaW5nIGRhdGUgJHt2YWx1ZX0gdG8gZm9ybWF0ICR7Zm9ybWF0fWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25TaG93UHJvY2Vzc0RpYWdyYW0oKSB7XG4gICAgICAgIHRoaXMuc2hvd1Byb2Nlc3NEaWFncmFtLmVtaXQoe3ZhbHVlOiB0aGlzLnByb2Nlc3NJbnN0YW5jZUlkfSk7XG4gICAgfVxuXG59XG4iXX0=