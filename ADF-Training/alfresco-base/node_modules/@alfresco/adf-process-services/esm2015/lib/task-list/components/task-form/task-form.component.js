/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, Input, Output, EventEmitter, ViewEncapsulation } from '@angular/core';
import { AuthenticationService, TranslationService } from '@alfresco/adf-core';
import { TaskListService } from '../../services/tasklist.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../../services/tasklist.service';
import * as ɵngcc2 from '@alfresco/adf-core';
import * as ɵngcc3 from '@angular/common';
import * as ɵngcc4 from '../../../form/form.component';
import * as ɵngcc5 from '../../../form/form-custom-outcomes.component';
import * as ɵngcc6 from '../task-standalone.component';
import * as ɵngcc7 from '@angular/material/card';
import * as ɵngcc8 from '@angular/material/button';
import * as ɵngcc9 from './claim-task.directive';
import * as ɵngcc10 from './unclaim-task.directive';
import * as ɵngcc11 from '@angular/flex-layout/flex';
import * as ɵngcc12 from '@angular/material/progress-spinner';
import * as ɵngcc13 from '@ngx-translate/core';

function TaskFormComponent_ng_container_0_adf_form_1_ng_template_2_Template(rf, ctx) { }
function TaskFormComponent_ng_container_0_adf_form_1_Template(rf, ctx) { if (rf & 1) {
    const _r10 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "adf-form", 5);
    ɵngcc0.ɵɵlistener("formSaved", function TaskFormComponent_ng_container_0_adf_form_1_Template_adf_form_formSaved_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r10); const ctx_r9 = ɵngcc0.ɵɵnextContext(2); return ctx_r9.onFormSaved($event); })("formCompleted", function TaskFormComponent_ng_container_0_adf_form_1_Template_adf_form_formCompleted_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r10); const ctx_r11 = ɵngcc0.ɵɵnextContext(2); return ctx_r11.onFormCompleted($event); })("formContentClicked", function TaskFormComponent_ng_container_0_adf_form_1_Template_adf_form_formContentClicked_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r10); const ctx_r12 = ɵngcc0.ɵɵnextContext(2); return ctx_r12.onFormContentClick($event); })("formLoaded", function TaskFormComponent_ng_container_0_adf_form_1_Template_adf_form_formLoaded_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r10); const ctx_r13 = ɵngcc0.ɵɵnextContext(2); return ctx_r13.onFormLoaded($event); })("formError", function TaskFormComponent_ng_container_0_adf_form_1_Template_adf_form_formError_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r10); const ctx_r14 = ɵngcc0.ɵɵnextContext(2); return ctx_r14.onFormError($event); })("error", function TaskFormComponent_ng_container_0_adf_form_1_Template_adf_form_error_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r10); const ctx_r15 = ɵngcc0.ɵɵnextContext(2); return ctx_r15.onError($event); })("executeOutcome", function TaskFormComponent_ng_container_0_adf_form_1_Template_adf_form_executeOutcome_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r10); const ctx_r16 = ɵngcc0.ɵɵnextContext(2); return ctx_r16.onFormExecuteOutcome($event); });
    ɵngcc0.ɵɵelementStart(1, "adf-form-custom-outcomes");
    ɵngcc0.ɵɵtemplate(2, TaskFormComponent_ng_container_0_adf_form_1_ng_template_2_Template, 0, 0, "ng-template", 6);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵnextContext();
    const _r6 = ɵngcc0.ɵɵreference(5);
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("taskId", ctx_r3.taskDetails == null ? null : ctx_r3.taskDetails.id)("showTitle", ctx_r3.showFormTitle)("showValidationIcon", ctx_r3.showFormValidationIcon)("showRefreshButton", ctx_r3.showFormRefreshButton)("showCompleteButton", ctx_r3.showFormCompleteButton)("showSaveButton", ctx_r3.isSaveButtonVisible())("disableCompleteButton", !ctx_r3.isCompleteButtonEnabled())("readOnly", ctx_r3.isReadOnlyForm())("fieldValidators", ctx_r3.fieldValidators);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", _r6);
} }
function TaskFormComponent_ng_container_0_ng_template_2_adf_task_standalone_0_Template(rf, ctx) { if (rf & 1) {
    const _r21 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "adf-task-standalone", 9);
    ɵngcc0.ɵɵlistener("complete", function TaskFormComponent_ng_container_0_ng_template_2_adf_task_standalone_0_Template_adf_task_standalone_complete_0_listener() { ɵngcc0.ɵɵrestoreView(_r21); const ctx_r20 = ɵngcc0.ɵɵnextContext(3); return ctx_r20.onCompleteTask(); })("showAttachForm", function TaskFormComponent_ng_container_0_ng_template_2_adf_task_standalone_0_Template_adf_task_standalone_showAttachForm_0_listener() { ɵngcc0.ɵɵrestoreView(_r21); const ctx_r22 = ɵngcc0.ɵɵnextContext(3); return ctx_r22.onShowAttachForm(); });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r17 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵproperty("taskName", ctx_r17.taskDetails.name)("taskId", ctx_r17.taskDetails.id)("isCompleted", ctx_r17.isCompletedTask())("hasCompletePermission", ctx_r17.isCompleteButtonVisible())("hideCancelButton", ctx_r17.showCancelButton);
} }
function TaskFormComponent_ng_container_0_ng_template_2_ng_template_1_ng_container_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 1, "FORM.FORM_RENDERER.NAMELESS_TASK"), " ");
} }
function TaskFormComponent_ng_container_0_ng_template_2_ng_template_1_adf_empty_content_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "adf-empty-content", 17);
    ɵngcc0.ɵɵpipe(1, "async");
} if (rf & 2) {
    const ctx_r24 = ɵngcc0.ɵɵnextContext(4);
    ɵngcc0.ɵɵproperty("icon", "description")("title", ɵngcc0.ɵɵpipeBind1(1, 3, ctx_r24.getCompletedTaskTranslatedMessage()))("subtitle", "ADF_TASK_FORM.COMPLETED_TASK.SUBTITLE");
} }
function TaskFormComponent_ng_container_0_ng_template_2_ng_template_1_ng_template_9_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "adf-empty-content", 17);
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("icon", "description")("title", "ADF_TASK_LIST.STANDALONE_TASK.NO_FORM_MESSAGE")("subtitle", "ADF_TASK_FORM.EMPTY_FORM.SUBTITLE");
} }
function TaskFormComponent_ng_container_0_ng_template_2_ng_template_1_ng_template_12_Template(rf, ctx) { }
function TaskFormComponent_ng_container_0_ng_template_2_ng_template_1_button_13_Template(rf, ctx) { if (rf & 1) {
    const _r30 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 18);
    ɵngcc0.ɵɵlistener("click", function TaskFormComponent_ng_container_0_ng_template_2_ng_template_1_button_13_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r30); const ctx_r29 = ɵngcc0.ɵɵnextContext(4); return ctx_r29.onCompleteTask(); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r28 = ɵngcc0.ɵɵnextContext(4);
    ɵngcc0.ɵɵproperty("disabled", ctx_r28.canCompleteNoFormTask());
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 2, "ADF_TASK_FORM.EMPTY_FORM.BUTTONS.COMPLETE"), " ");
} }
function TaskFormComponent_ng_container_0_ng_template_2_ng_template_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "mat-card", 10);
    ɵngcc0.ɵɵelementStart(1, "mat-card-header");
    ɵngcc0.ɵɵelementStart(2, "mat-card-title");
    ɵngcc0.ɵɵelementStart(3, "h4");
    ɵngcc0.ɵɵelementStart(4, "span", 11);
    ɵngcc0.ɵɵtext(5);
    ɵngcc0.ɵɵtemplate(6, TaskFormComponent_ng_container_0_ng_template_2_ng_template_1_ng_container_6_Template, 3, 3, "ng-container", 12);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(7, "mat-card-content");
    ɵngcc0.ɵɵtemplate(8, TaskFormComponent_ng_container_0_ng_template_2_ng_template_1_adf_empty_content_8_Template, 2, 5, "adf-empty-content", 13);
    ɵngcc0.ɵɵtemplate(9, TaskFormComponent_ng_container_0_ng_template_2_ng_template_1_ng_template_9_Template, 1, 3, "ng-template", null, 14, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(11, "mat-card-actions", 15);
    ɵngcc0.ɵɵtemplate(12, TaskFormComponent_ng_container_0_ng_template_2_ng_template_1_ng_template_12_Template, 0, 0, "ng-template", 6);
    ɵngcc0.ɵɵtemplate(13, TaskFormComponent_ng_container_0_ng_template_2_ng_template_1_button_13_Template, 3, 4, "button", 16);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const _r25 = ɵngcc0.ɵɵreference(10);
    ɵngcc0.ɵɵnextContext(2);
    const _r6 = ɵngcc0.ɵɵreference(5);
    const ctx_r19 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵtextInterpolate1(" ", ctx_r19.taskDetails.name, " ");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r19.taskDetails.name);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r19.isCompletedTask())("ngIfElse", _r25);
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", _r6);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r19.isCompletedTask());
} }
function TaskFormComponent_ng_container_0_ng_template_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, TaskFormComponent_ng_container_0_ng_template_2_adf_task_standalone_0_Template, 1, 5, "adf-task-standalone", 7);
    ɵngcc0.ɵɵtemplate(1, TaskFormComponent_ng_container_0_ng_template_2_ng_template_1_Template, 14, 6, "ng-template", null, 8, ɵngcc0.ɵɵtemplateRefExtractor);
} if (rf & 2) {
    const _r18 = ɵngcc0.ɵɵreference(2);
    const ctx_r5 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r5.isStandaloneTask())("ngIfElse", _r18);
} }
function TaskFormComponent_ng_container_0_ng_template_4_button_0_Template(rf, ctx) { if (rf & 1) {
    const _r35 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 22);
    ɵngcc0.ɵɵlistener("click", function TaskFormComponent_ng_container_0_ng_template_4_button_0_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r35); const ctx_r34 = ɵngcc0.ɵɵnextContext(3); return ctx_r34.onCancel(); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 1, "ADF_TASK_FORM.EMPTY_FORM.BUTTONS.CANCEL"), " ");
} }
function TaskFormComponent_ng_container_0_ng_template_4_button_1_Template(rf, ctx) { if (rf & 1) {
    const _r37 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 23);
    ɵngcc0.ɵɵlistener("success", function TaskFormComponent_ng_container_0_ng_template_4_button_1_Template_button_success_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r37); const ctx_r36 = ɵngcc0.ɵɵnextContext(3); return ctx_r36.onClaimTask($event); })("error", function TaskFormComponent_ng_container_0_ng_template_4_button_1_Template_button_error_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r37); const ctx_r38 = ɵngcc0.ɵɵnextContext(3); return ctx_r38.onClaimTaskError($event); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r32 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵproperty("taskId", ctx_r32.taskId);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 2, "ADF_TASK_FORM.EMPTY_FORM.BUTTONS.CLAIM"), " ");
} }
function TaskFormComponent_ng_container_0_ng_template_4_button_2_Template(rf, ctx) { if (rf & 1) {
    const _r40 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 24);
    ɵngcc0.ɵɵlistener("success", function TaskFormComponent_ng_container_0_ng_template_4_button_2_Template_button_success_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r40); const ctx_r39 = ɵngcc0.ɵɵnextContext(3); return ctx_r39.onUnclaimTask($event); })("error", function TaskFormComponent_ng_container_0_ng_template_4_button_2_Template_button_error_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r40); const ctx_r41 = ɵngcc0.ɵɵnextContext(3); return ctx_r41.onUnclaimTaskError($event); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r33 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵproperty("taskId", ctx_r33.taskId);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 2, "ADF_TASK_FORM.EMPTY_FORM.BUTTONS.UNCLAIM"), " ");
} }
function TaskFormComponent_ng_container_0_ng_template_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, TaskFormComponent_ng_container_0_ng_template_4_button_0_Template, 3, 3, "button", 19);
    ɵngcc0.ɵɵtemplate(1, TaskFormComponent_ng_container_0_ng_template_4_button_1_Template, 3, 4, "button", 20);
    ɵngcc0.ɵɵtemplate(2, TaskFormComponent_ng_container_0_ng_template_4_button_2_Template, 3, 4, "button", 21);
} if (rf & 2) {
    const ctx_r7 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r7.showCancelButton);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r7.isTaskClaimable());
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r7.isTaskClaimedByCandidateMember());
} }
function TaskFormComponent_ng_container_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, TaskFormComponent_ng_container_0_adf_form_1_Template, 3, 10, "adf-form", 2);
    ɵngcc0.ɵɵtemplate(2, TaskFormComponent_ng_container_0_ng_template_2_Template, 3, 2, "ng-template", null, 3, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵtemplate(4, TaskFormComponent_ng_container_0_ng_template_4_Template, 3, 3, "ng-template", null, 4, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const _r4 = ɵngcc0.ɵɵreference(3);
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.hasFormKey())("ngIfElse", _r4);
} }
function TaskFormComponent_ng_template_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 25);
    ɵngcc0.ɵɵelement(1, "mat-spinner");
    ɵngcc0.ɵɵelementEnd();
} }
export class TaskFormComponent {
    constructor(taskListService, authService, translationService) {
        this.taskListService = taskListService;
        this.authService = authService;
        this.translationService = translationService;
        this.showFormTitle = false;
        this.showFormCompleteButton = true;
        this.showFormSaveButton = true;
        this.showCancelButton = true;
        this.readOnlyForm = false;
        this.showFormRefreshButton = true;
        this.showFormValidationIcon = true;
        this.fieldValidators = [];
        this.formSaved = new EventEmitter();
        this.formCompleted = new EventEmitter();
        this.formContentClicked = new EventEmitter();
        this.formLoaded = new EventEmitter();
        this.showAttachForm = new EventEmitter();
        this.executeOutcome = new EventEmitter();
        this.completed = new EventEmitter();
        this.formError = new EventEmitter();
        this.error = new EventEmitter();
        this.cancel = new EventEmitter();
        this.taskClaimed = new EventEmitter();
        this.taskUnclaimed = new EventEmitter();
        this.loading = false;
        this.internalReadOnlyForm = false;
    }
    ngOnInit() {
        this.authService.getBpmLoggedUser().subscribe(user => {
            this.currentLoggedUser = user;
        });
        this.loadTask(this.taskId);
    }
    ngOnChanges(changes) {
        const taskId = changes['taskId'];
        if (taskId && taskId.currentValue) {
            this.loadTask(this.taskId);
            return;
        }
    }
    loadTask(taskId) {
        this.loading = true;
        if (taskId) {
            this.taskListService.getTaskDetails(taskId).subscribe((res) => {
                this.taskDetails = res;
                if (!this.taskDetails.name) {
                    this.taskDetails.name = 'No name';
                }
                const endDate = res.endDate;
                if (endDate && !isNaN(endDate.getTime())) {
                    this.internalReadOnlyForm = true;
                }
                else {
                    this.internalReadOnlyForm = this.readOnlyForm;
                }
                this.loading = false;
            });
        }
    }
    onFormSaved(savedForm) {
        this.formSaved.emit(savedForm);
    }
    onFormCompleted(form) {
        this.formCompleted.emit(form);
    }
    onFormLoaded(form) {
        this.formLoaded.emit(form);
    }
    onFormContentClick(content) {
        this.formContentClicked.emit(content);
    }
    onFormExecuteOutcome(outcome) {
        this.executeOutcome.emit(outcome);
    }
    onFormError(error) {
        this.formError.emit(error);
    }
    onError(error) {
        this.error.emit(error);
    }
    onCompleteTask() {
        this.taskListService.completeTask(this.taskDetails.id).subscribe(() => this.completed.emit(), (error) => this.error.emit(error));
    }
    onCancel() {
        this.cancel.emit();
    }
    onShowAttachForm() {
        this.showAttachForm.emit();
    }
    hasFormKey() {
        return (this.taskDetails && (!!this.taskDetails.formKey));
    }
    isStandaloneTask() {
        return !(this.taskDetails && (!!this.taskDetails.processDefinitionId));
    }
    isTaskLoaded() {
        return !!this.taskDetails;
    }
    isCompletedTask() {
        return this.taskDetails && this.taskDetails.endDate !== undefined && this.taskDetails.endDate !== null;
    }
    isCompleteButtonVisible() {
        return !this.hasFormKey() && this.isTaskActive() && this.isCompleteButtonEnabled();
    }
    isTaskActive() {
        return this.taskDetails && this.taskDetails.duration === null;
    }
    isAssigned() {
        return !!this.taskDetails.assignee;
    }
    hasEmailAddress() {
        return this.taskDetails.assignee.email ? true : false;
    }
    isAssignedToMe() {
        return this.isAssigned() && this.hasEmailAddress() ?
            this.isEmailEqual() :
            this.isExternalIdEqual();
    }
    isEmailEqual() {
        return (this.taskDetails.assignee && this.currentLoggedUser) && (this.taskDetails.assignee.email.toLocaleLowerCase() === this.currentLoggedUser.email.toLocaleLowerCase());
    }
    isExternalIdEqual() {
        return (this.taskDetails.assignee && this.currentLoggedUser) && (this.taskDetails.assignee.externalId === this.currentLoggedUser.externalId);
    }
    isCompleteButtonEnabled() {
        return this.isAssignedToMe() || this.canInitiatorComplete();
    }
    canInitiatorComplete() {
        return this.taskDetails.initiatorCanCompleteTask;
    }
    isReadOnlyForm() {
        let readOnlyForm;
        if (this.isCandidateMember()) {
            readOnlyForm = this.internalReadOnlyForm || !this.isAssignedToMe();
        }
        else {
            readOnlyForm = this.internalReadOnlyForm || !(this.isAssignedToMe() || this.canCurrentUserAsInitiatorComplete() || this.isCurrentUserInvolved());
        }
        return readOnlyForm;
    }
    isCurrentUserInvolved() {
        var _a, _b;
        let isInvolved = false;
        if (this.taskDetails.involvedPeople && this.currentLoggedUser) {
            const userInvolved = this.taskDetails.involvedPeople.find((involvedUser) => involvedUser.email.toLocaleLowerCase() === this.currentLoggedUser.email.toLocaleLowerCase() ||
                involvedUser.id + '' === this.currentLoggedUser.externalId);
            isInvolved = !!userInvolved;
        }
        if (((_a = this.taskDetails.involvedGroups) === null || _a === void 0 ? void 0 : _a.length) && ((_b = this.currentLoggedUser.groups) === null || _b === void 0 ? void 0 : _b.length) && !isInvolved) {
            const userGroup = this.taskDetails.involvedGroups.find((involvedGroup) => this.currentLoggedUser.groups.find(group => group.name === involvedGroup.name.toLocaleLowerCase() || group.id === involvedGroup.id));
            isInvolved = !!userGroup;
        }
        return isInvolved;
    }
    canCurrentUserAsInitiatorComplete() {
        return this.canInitiatorComplete() && this.isProcessInitiator();
    }
    isProcessInitiator() {
        return this.currentLoggedUser && (this.currentLoggedUser.id === +this.taskDetails.processInstanceStartUserId);
    }
    isSaveButtonVisible() {
        return this.showFormSaveButton && (!this.canInitiatorComplete() || this.isAssignedToMe() || this.isCurrentUserInvolved());
    }
    canCompleteNoFormTask() {
        return this.isReadOnlyForm();
    }
    getCompletedTaskTranslatedMessage() {
        return this.translationService.get('ADF_TASK_FORM.COMPLETED_TASK.TITLE', { taskName: this.taskDetails.name });
    }
    isCandidateMember() {
        return this.taskDetails.managerOfCandidateGroup || this.taskDetails.memberOfCandidateGroup || this.taskDetails.memberOfCandidateUsers;
    }
    isTaskClaimable() {
        return this.isCandidateMember() && !this.isAssigned();
    }
    isTaskClaimedByCandidateMember() {
        return this.isCandidateMember() && this.isAssignedToMe() && !this.isCompletedTask();
    }
    reloadTask() {
        this.loadTask(this.taskId);
    }
    onClaimTask(taskId) {
        this.taskClaimed.emit(taskId);
    }
    onClaimTaskError(error) {
        this.error.emit(error);
    }
    onUnclaimTask(taskId) {
        this.taskUnclaimed.emit(taskId);
    }
    onUnclaimTaskError(error) {
        this.error.emit(error);
    }
}
TaskFormComponent.ɵfac = function TaskFormComponent_Factory(t) { return new (t || TaskFormComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.TaskListService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.AuthenticationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.TranslationService)); };
TaskFormComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: TaskFormComponent, selectors: [["adf-task-form"]], inputs: { showFormTitle: "showFormTitle", showFormCompleteButton: "showFormCompleteButton", showFormSaveButton: "showFormSaveButton", showCancelButton: "showCancelButton", readOnlyForm: "readOnlyForm", showFormRefreshButton: "showFormRefreshButton", showFormValidationIcon: "showFormValidationIcon", fieldValidators: "fieldValidators", taskId: "taskId" }, outputs: { formSaved: "formSaved", formCompleted: "formCompleted", formContentClicked: "formContentClicked", formLoaded: "formLoaded", showAttachForm: "showAttachForm", executeOutcome: "executeOutcome", completed: "completed", formError: "formError", error: "error", cancel: "cancel", taskClaimed: "taskClaimed", taskUnclaimed: "taskUnclaimed" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 3, vars: 2, consts: [[4, "ngIf", "ngIfElse"], ["loadingTemplate", ""], [3, "taskId", "showTitle", "showValidationIcon", "showRefreshButton", "showCompleteButton", "showSaveButton", "disableCompleteButton", "readOnly", "fieldValidators", "formSaved", "formCompleted", "formContentClicked", "formLoaded", "formError", "error", "executeOutcome", 4, "ngIf", "ngIfElse"], ["withoutForm", ""], ["taskFormButtons", ""], [3, "taskId", "showTitle", "showValidationIcon", "showRefreshButton", "showCompleteButton", "showSaveButton", "disableCompleteButton", "readOnly", "fieldValidators", "formSaved", "formCompleted", "formContentClicked", "formLoaded", "formError", "error", "executeOutcome"], [3, "ngTemplateOutlet"], [3, "taskName", "taskId", "isCompleted", "hasCompletePermission", "hideCancelButton", "complete", "showAttachForm", 4, "ngIf", "ngIfElse"], ["emptyFormMessage", ""], [3, "taskName", "taskId", "isCompleted", "hasCompletePermission", "hideCancelButton", "complete", "showAttachForm"], [1, "adf-task-form-container"], [1, "adf-form-title"], [4, "ngIf"], [3, "icon", "title", "subtitle", 4, "ngIf", "ngIfElse"], ["emptyFormTemplate", ""], [1, "adf-task-form-actions"], ["mat-button", "", "id", "adf-no-form-complete-button", "color", "primary", 3, "disabled", "click", 4, "ngIf"], [3, "icon", "title", "subtitle"], ["mat-button", "", "id", "adf-no-form-complete-button", "color", "primary", 3, "disabled", "click"], ["mat-button", "", "id", "adf-no-form-cancel-button", 3, "click", 4, "ngIf"], ["mat-button", "", "data-automation-id", "adf-task-form-claim-button", "adf-claim-task", "", 3, "taskId", "success", "error", 4, "ngIf"], ["mat-button", "", "data-automation-id", "adf-task-form-unclaim-button", "adf-unclaim-task", "", 3, "taskId", "success", "error", 4, "ngIf"], ["mat-button", "", "id", "adf-no-form-cancel-button", 3, "click"], ["mat-button", "", "data-automation-id", "adf-task-form-claim-button", "adf-claim-task", "", 3, "taskId", "success", "error"], ["mat-button", "", "data-automation-id", "adf-task-form-unclaim-button", "adf-unclaim-task", "", 3, "taskId", "success", "error"], ["fxLayout", "row", "fxLayoutAlign", "center stretch"]], template: function TaskFormComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, TaskFormComponent_ng_container_0_Template, 6, 2, "ng-container", 0);
        ɵngcc0.ɵɵtemplate(1, TaskFormComponent_ng_template_1_Template, 2, 0, "ng-template", null, 1, ɵngcc0.ɵɵtemplateRefExtractor);
    } if (rf & 2) {
        const _r1 = ɵngcc0.ɵɵreference(2);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.loading)("ngIfElse", _r1);
    } }, directives: [ɵngcc3.NgIf, ɵngcc4.FormComponent, ɵngcc5.FormCustomOutcomesComponent, ɵngcc3.NgTemplateOutlet, ɵngcc6.TaskStandaloneComponent, ɵngcc7.MatCard, ɵngcc7.MatCardHeader, ɵngcc7.MatCardTitle, ɵngcc7.MatCardContent, ɵngcc7.MatCardActions, ɵngcc2.EmptyContentComponent, ɵngcc8.MatButton, ɵngcc9.ClaimTaskDirective, ɵngcc10.UnclaimTaskDirective, ɵngcc11.DefaultLayoutDirective, ɵngcc11.DefaultLayoutAlignDirective, ɵngcc12.MatSpinner], pipes: [ɵngcc13.TranslatePipe, ɵngcc3.AsyncPipe], styles: [".adf-task-form-container{overflow:hidden}.adf-task-form-actions{float:right;padding-bottom:25px!important;padding-right:25px!important}.adf-task-form-actions .mat-button{border-radius:5px;height:36px}.adf-task-form-actions .mat-button-wrapper{font-size:var(--theme-body-2-font-size);font-weight:700;height:20px;opacity:.54;width:58px}"], encapsulation: 2 });
TaskFormComponent.ctorParameters = () => [
    { type: TaskListService },
    { type: AuthenticationService },
    { type: TranslationService }
];
TaskFormComponent.propDecorators = {
    taskId: [{ type: Input }],
    showFormTitle: [{ type: Input }],
    showFormCompleteButton: [{ type: Input }],
    showFormSaveButton: [{ type: Input }],
    showCancelButton: [{ type: Input }],
    readOnlyForm: [{ type: Input }],
    showFormRefreshButton: [{ type: Input }],
    showFormValidationIcon: [{ type: Input }],
    fieldValidators: [{ type: Input }],
    formSaved: [{ type: Output }],
    formCompleted: [{ type: Output }],
    formContentClicked: [{ type: Output }],
    formLoaded: [{ type: Output }],
    showAttachForm: [{ type: Output }],
    executeOutcome: [{ type: Output }],
    completed: [{ type: Output }],
    formError: [{ type: Output }],
    error: [{ type: Output }],
    cancel: [{ type: Output }],
    taskClaimed: [{ type: Output }],
    taskUnclaimed: [{ type: Output }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(TaskFormComponent, [{
        type: Component,
        args: [{
                selector: 'adf-task-form',
                template: "<ng-container *ngIf=\"!loading; else loadingTemplate\">\n  <adf-form *ngIf=\"hasFormKey(); else withoutForm\"\n    [taskId]=\"taskDetails?.id\"\n    [showTitle]=\"showFormTitle\"\n    [showValidationIcon]=\"showFormValidationIcon\"\n    [showRefreshButton]=\"showFormRefreshButton\"\n    [showCompleteButton]=\"showFormCompleteButton\"\n    [showSaveButton]=\"isSaveButtonVisible()\"\n    [disableCompleteButton]=\"!isCompleteButtonEnabled()\"\n    [readOnly]=\"isReadOnlyForm()\"\n    [fieldValidators]=\"fieldValidators\"\n    (formSaved)='onFormSaved($event)'\n    (formCompleted)='onFormCompleted($event)'\n    (formContentClicked)='onFormContentClick($event)'\n    (formLoaded)='onFormLoaded($event)'\n    (formError)='onFormError($event)'\n    (error)='onError($event)'\n    (executeOutcome)='onFormExecuteOutcome($event)'>\n    <adf-form-custom-outcomes>\n        <ng-template [ngTemplateOutlet]=\"taskFormButtons\">\n        </ng-template>\n    </adf-form-custom-outcomes>\n  </adf-form>\n  <ng-template #withoutForm>\n    <adf-task-standalone *ngIf=\"isStandaloneTask(); else emptyFormMessage\"\n        [taskName]=\"taskDetails.name\"\n        [taskId]=\"taskDetails.id\"\n        [isCompleted]=\"isCompletedTask()\"\n        [hasCompletePermission]=\"isCompleteButtonVisible()\"\n        [hideCancelButton]=\"showCancelButton\"\n        (complete)=\"onCompleteTask()\"\n        (showAttachForm)=\"onShowAttachForm()\">\n    </adf-task-standalone>\n      <ng-template #emptyFormMessage>\n        <mat-card class=\"adf-task-form-container\">\n            <mat-card-header>\n                <mat-card-title>\n                    <h4>\n                        <span class=\"adf-form-title\">\n                            {{taskDetails.name}}\n                            <ng-container *ngIf=\"!taskDetails.name\">\n                                {{'FORM.FORM_RENDERER.NAMELESS_TASK' | translate}}\n                            </ng-container>\n                        </span>\n                    </h4>\n                </mat-card-title>\n            </mat-card-header>\n            <mat-card-content>\n                <adf-empty-content *ngIf=\"isCompletedTask(); else emptyFormTemplate\"\n                    [icon]=\"'description'\"\n                    [title]=\"getCompletedTaskTranslatedMessage() | async\"\n                    [subtitle]=\"'ADF_TASK_FORM.COMPLETED_TASK.SUBTITLE'\">\n                </adf-empty-content>\n                <ng-template #emptyFormTemplate>\n                    <adf-empty-content\n                        [icon]=\"'description'\"\n                        [title]=\"'ADF_TASK_LIST.STANDALONE_TASK.NO_FORM_MESSAGE'\"\n                        [subtitle]=\"'ADF_TASK_FORM.EMPTY_FORM.SUBTITLE'\">\n                    </adf-empty-content>\n                </ng-template>\n            </mat-card-content>\n            <mat-card-actions class=\"adf-task-form-actions\">\n                <ng-template [ngTemplateOutlet]=\"taskFormButtons\"></ng-template>\n                <button mat-button\n                    *ngIf=\"!isCompletedTask()\" id=\"adf-no-form-complete-button\"\n                    color=\"primary\"\n                    [disabled]=\"canCompleteNoFormTask()\"\n                    (click)=\"onCompleteTask()\">\n                    {{'ADF_TASK_FORM.EMPTY_FORM.BUTTONS.COMPLETE' | translate}}\n                </button>\n            </mat-card-actions>\n        </mat-card>\n      </ng-template>\n  </ng-template>\n\n  <ng-template #taskFormButtons>\n        <button mat-button id=\"adf-no-form-cancel-button\"\n            *ngIf=\"showCancelButton\"\n            (click)=\"onCancel()\">\n            {{'ADF_TASK_FORM.EMPTY_FORM.BUTTONS.CANCEL' | translate}}\n        </button>\n        <button mat-button data-automation-id=\"adf-task-form-claim-button\"\n            *ngIf=\"isTaskClaimable()\"\n            adf-claim-task\n            [taskId]=\"taskId\"\n            (success)=\"onClaimTask($event)\"\n            (error)=\"onClaimTaskError($event)\">\n            {{ 'ADF_TASK_FORM.EMPTY_FORM.BUTTONS.CLAIM' | translate }}\n        </button>\n        <button mat-button data-automation-id=\"adf-task-form-unclaim-button\"\n            *ngIf=\"isTaskClaimedByCandidateMember()\"\n            adf-unclaim-task\n            [taskId]=\"taskId\"\n            (success)=\"onUnclaimTask($event)\"\n            (error)=\"onUnclaimTaskError($event)\">\n            {{ 'ADF_TASK_FORM.EMPTY_FORM.BUTTONS.UNCLAIM' | translate }}\n        </button>\n  </ng-template>\n</ng-container>\n<ng-template #loadingTemplate>\n  <div fxLayout=\"row\" fxLayoutAlign=\"center stretch\">\n      <mat-spinner></mat-spinner>\n  </div>\n</ng-template>\n",
                encapsulation: ViewEncapsulation.None,
                styles: [".adf-task-form-container{overflow:hidden}.adf-task-form-actions{float:right;padding-bottom:25px!important;padding-right:25px!important}.adf-task-form-actions .mat-button{border-radius:5px;height:36px}.adf-task-form-actions .mat-button-wrapper{font-size:var(--theme-body-2-font-size);font-weight:700;height:20px;opacity:.54;width:58px}"]
            }]
    }], function () { return [{ type: ɵngcc1.TaskListService }, { type: ɵngcc2.AuthenticationService }, { type: ɵngcc2.TranslationService }]; }, { showFormTitle: [{
            type: Input
        }], showFormCompleteButton: [{
            type: Input
        }], showFormSaveButton: [{
            type: Input
        }], showCancelButton: [{
            type: Input
        }], readOnlyForm: [{
            type: Input
        }], showFormRefreshButton: [{
            type: Input
        }], showFormValidationIcon: [{
            type: Input
        }], fieldValidators: [{
            type: Input
        }], formSaved: [{
            type: Output
        }], formCompleted: [{
            type: Output
        }], formContentClicked: [{
            type: Output
        }], formLoaded: [{
            type: Output
        }], showAttachForm: [{
            type: Output
        }], executeOutcome: [{
            type: Output
        }], completed: [{
            type: Output
        }], formError: [{
            type: Output
        }], error: [{
            type: Output
        }], cancel: [{
            type: Output
        }], taskClaimed: [{
            type: Output
        }], taskUnclaimed: [{
            type: Output
        }], taskId: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFzay1mb3JtLmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL3Byb2Nlc3Mtc2VydmljZXMvc3JjL2xpYi90YXNrLWxpc3QvY29tcG9uZW50cy90YXNrLWZvcm0vdGFzay1mb3JtLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBRUgsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBaUIsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDakgsT0FBTyxFQUtMLHFCQUFxQixFQUNyQixrQkFBa0IsRUFFbkIsTUFBTSxvQkFBb0IsQ0FBQztBQUU1QixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0saUNBQWlDLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBVWxFLE1BQU0sT0FBTyxpQkFBaUI7QUFBRyxJQWdHL0IsWUFDVSxlQUFnQyxFQUNoQyxXQUFrQyxFQUNsQyxrQkFBc0M7QUFDL0MsUUFIUyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7QUFBQyxRQUNqQyxnQkFBVyxHQUFYLFdBQVcsQ0FBdUI7QUFBQyxRQUNuQyx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO0FBQ2xELFFBNUZF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Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgU2ltcGxlQ2hhbmdlcywgVmlld0VuY2Fwc3VsYXRpb24gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIEZvcm1Nb2RlbCxcbiAgQ29udGVudExpbmtNb2RlbCxcbiAgRm9ybUZpZWxkVmFsaWRhdG9yLFxuICBGb3JtT3V0Y29tZUV2ZW50LFxuICBBdXRoZW50aWNhdGlvblNlcnZpY2UsXG4gIFRyYW5zbGF0aW9uU2VydmljZSxcbiAgRm9ybUZpZWxkTW9kZWxcbn0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IFRhc2tEZXRhaWxzTW9kZWwgfSBmcm9tICcuLi8uLi9tb2RlbHMvdGFzay1kZXRhaWxzLm1vZGVsJztcbmltcG9ydCB7IFRhc2tMaXN0U2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3Rhc2tsaXN0LnNlcnZpY2UnO1xuaW1wb3J0IHsgVXNlclJlcHJlc2VudGF0aW9uLCBMaWdodEdyb3VwUmVwcmVzZW50YXRpb24sIExpZ2h0VXNlclJlcHJlc2VudGF0aW9uIH0gZnJvbSAnQGFsZnJlc2NvL2pzLWFwaSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2FkZi10YXNrLWZvcm0nLFxuICB0ZW1wbGF0ZVVybDogJy4vdGFzay1mb3JtLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vdGFzay1mb3JtLmNvbXBvbmVudC5zY3NzJ10sXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgVGFza0Zvcm1Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIC8qKiAoKipyZXF1aXJlZCoqKSBUaGUgaWQgb2YgdGhlIHRhc2sgd2hvc2UgZGV0YWlscyB3ZSBhcmUgYXNraW5nIGZvci4gKi9cbiAgQElucHV0KClcbiAgdGFza0lkOiBzdHJpbmc7XG5cbiAgLyoqIFRvZ2dsZXMgcmVuZGVyaW5nIG9mIHRoZSBmb3JtIHRpdGxlLiAqL1xuICBASW5wdXQoKVxuICBzaG93Rm9ybVRpdGxlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgLyoqIFRvZ2dsZXMgcmVuZGVyaW5nIG9mIHRoZSBgQ29tcGxldGVgIG91dGNvbWUgYnV0dG9uLiAqL1xuICBASW5wdXQoKVxuICBzaG93Rm9ybUNvbXBsZXRlQnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAvKiogVG9nZ2xlcyByZW5kZXJpbmcgb2YgdGhlIGBTYXZlYCBvdXRjb21lIGJ1dHRvbi4gKi9cbiAgQElucHV0KClcbiAgc2hvd0Zvcm1TYXZlQnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAvKiogVG9nZ2xlIHJlbmRlcmluZyBvZiB0aGUgYENhbmNlbGAgYnV0dG9uLiAqL1xuICBASW5wdXQoKVxuICBzaG93Q2FuY2VsQnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAvKiogVG9nZ2xlcyByZWFkLW9ubHkgc3RhdGUgb2YgdGhlIGZvcm0uIEFsbCBmb3JtIHdpZGdldHMgcmVuZGVyIGFzIHJlYWQtb25seVxuICAgKiBpZiBlbmFibGVkLlxuICAgKi9cbiAgQElucHV0KClcbiAgcmVhZE9ubHlGb3JtOiBib29sZWFuID0gZmFsc2U7XG5cbiAgLyoqIFRvZ2dsZXMgcmVuZGVyaW5nIG9mIHRoZSBgUmVmcmVzaGAgYnV0dG9uLiAqL1xuICBASW5wdXQoKVxuICBzaG93Rm9ybVJlZnJlc2hCdXR0b246IGJvb2xlYW4gPSB0cnVlO1xuXG4gIC8qKiBUb2dnbGUgcmVuZGVyaW5nIG9mIHRoZSB2YWxpZGF0aW9uIGljb24gbmV4dCB0byB0aGUgZm9ybSB0aXRsZS4gKi9cbiAgQElucHV0KClcbiAgc2hvd0Zvcm1WYWxpZGF0aW9uSWNvbjogYm9vbGVhbiA9IHRydWU7XG5cbiAgLyoqIEZpZWxkIHZhbGlkYXRvcnMgZm9yIHVzZSB3aXRoIHRoZSBmb3JtLiAqL1xuICBASW5wdXQoKVxuICBmaWVsZFZhbGlkYXRvcnM6IEZvcm1GaWVsZFZhbGlkYXRvcltdID0gW107XG5cbiAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgZm9ybSBpcyBzdWJtaXR0ZWQgd2l0aCB0aGUgYFNhdmVgIG9yIGN1c3RvbSBvdXRjb21lcy4gKi9cbiAgQE91dHB1dCgpXG4gIGZvcm1TYXZlZCA9IG5ldyBFdmVudEVtaXR0ZXI8Rm9ybU1vZGVsPigpO1xuXG4gIC8qKiBFbWl0dGVkIHdoZW4gdGhlIGZvcm0gaXMgc3VibWl0dGVkIHdpdGggdGhlIGBDb21wbGV0ZWAgb3V0Y29tZS4gKi9cbiAgQE91dHB1dCgpXG4gIGZvcm1Db21wbGV0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPEZvcm1Nb2RlbD4oKTtcblxuICAvKiogRW1pdHRlZCB3aGVuIHRoZSBmb3JtIGZpZWxkIGNvbnRlbnQgaXMgY2xpY2tlZC4gKi9cbiAgQE91dHB1dCgpXG4gIGZvcm1Db250ZW50Q2xpY2tlZCA9IG5ldyBFdmVudEVtaXR0ZXI8Q29udGVudExpbmtNb2RlbD4oKTtcblxuICAvKiogRW1pdHRlZCB3aGVuIHRoZSBmb3JtIGlzIGxvYWRlZCBvciByZWxvYWRlZC4gKi9cbiAgQE91dHB1dCgpXG4gIGZvcm1Mb2FkZWQgPSBuZXcgRXZlbnRFbWl0dGVyPEZvcm1Nb2RlbD4oKTtcblxuICAvKiogRW1pdHRlZCB3aGVuIHRoZSBmb3JtIGFzc29jaWF0ZWQgd2l0aCB0aGUgZm9ybSB0YXNrIGlzIGF0dGFjaGVkLiAqL1xuICBAT3V0cHV0KClcbiAgc2hvd0F0dGFjaEZvcm06IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICAvKiogRW1pdHRlZCB3aGVuIGFueSBvdXRjb21lIGlzIGV4ZWN1dGVkLiBEZWZhdWx0IGJlaGF2aW91ciBjYW4gYmUgcHJldmVudGVkXG4gICAqIHZpYSBgZXZlbnQucHJldmVudERlZmF1bHQoKWAuXG4gICAqL1xuICBAT3V0cHV0KClcbiAgZXhlY3V0ZU91dGNvbWUgPSBuZXcgRXZlbnRFbWl0dGVyPEZvcm1PdXRjb21lRXZlbnQ+KCk7XG5cbiAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgZm9ybSBhc3NvY2lhdGVkIHdpdGggdGhlIHRhc2sgaXMgY29tcGxldGVkLiAqL1xuICBAT3V0cHV0KClcbiAgY29tcGxldGVkID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG4gIC8qKiBFbWl0dGVkIHdoZW4gdGhlIHN1cHBsaWVkIGZvcm0gdmFsdWVzIGhhdmUgYSB2YWxpZGF0aW9uIGVycm9yLiAqL1xuICBAT3V0cHV0KClcbiAgZm9ybUVycm9yOiBFdmVudEVtaXR0ZXI8Rm9ybUZpZWxkTW9kZWxbXT4gPSBuZXcgRXZlbnRFbWl0dGVyPEZvcm1GaWVsZE1vZGVsW10+KCk7XG5cbiAgLyoqIEVtaXR0ZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMuICovXG4gIEBPdXRwdXQoKVxuICBlcnJvciA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIC8qKiBFbWl0dGVkIHdoZW4gdGhlIFwiQ2FuY2VsXCIgYnV0dG9uIGlzIGNsaWNrZWQuICovXG4gIEBPdXRwdXQoKVxuICBjYW5jZWwgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cbiAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgdGFzayBpcyBjbGFpbWVkLiAqL1xuICBAT3V0cHV0KClcbiAgdGFza0NsYWltZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcblxuICAvKiogRW1pdHRlZCB3aGVuIHRoZSB0YXNrIGlzIHVuY2xhaW1lZCAoaWUsIHJlcXVldWVkKS4uICovXG4gIEBPdXRwdXQoKVxuICB0YXNrVW5jbGFpbWVkID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG5cbiAgdGFza0RldGFpbHM6IFRhc2tEZXRhaWxzTW9kZWw7XG4gIGN1cnJlbnRMb2dnZWRVc2VyOiBVc2VyUmVwcmVzZW50YXRpb247XG4gIGxvYWRpbmc6IGJvb2xlYW4gPSBmYWxzZTtcbiAgY29tcGxldGVkVGFza01lc3NhZ2U6IHN0cmluZztcbiAgaW50ZXJuYWxSZWFkT25seUZvcm06IGJvb2xlYW4gPSBmYWxzZTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHRhc2tMaXN0U2VydmljZTogVGFza0xpc3RTZXJ2aWNlLFxuICAgIHByaXZhdGUgYXV0aFNlcnZpY2U6IEF1dGhlbnRpY2F0aW9uU2VydmljZSxcbiAgICBwcml2YXRlIHRyYW5zbGF0aW9uU2VydmljZTogVHJhbnNsYXRpb25TZXJ2aWNlXG4gICkge1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5hdXRoU2VydmljZS5nZXRCcG1Mb2dnZWRVc2VyKCkuc3Vic2NyaWJlKHVzZXIgPT4ge1xuICAgICAgdGhpcy5jdXJyZW50TG9nZ2VkVXNlciA9IHVzZXI7XG4gICAgfSk7XG4gICAgdGhpcy5sb2FkVGFzayh0aGlzLnRhc2tJZCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgY29uc3QgdGFza0lkID0gY2hhbmdlc1sndGFza0lkJ107XG4gICAgaWYgKHRhc2tJZCAmJiB0YXNrSWQuY3VycmVudFZhbHVlKSB7XG4gICAgICAgIHRoaXMubG9hZFRhc2sodGhpcy50YXNrSWQpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICB9XG5cbiAgbG9hZFRhc2sodGFza0lkOiBzdHJpbmcpIHtcbiAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuICAgIGlmICh0YXNrSWQpIHtcbiAgICAgIHRoaXMudGFza0xpc3RTZXJ2aWNlLmdldFRhc2tEZXRhaWxzKHRhc2tJZCkuc3Vic2NyaWJlKFxuICAgICAgICAocmVzOiBUYXNrRGV0YWlsc01vZGVsKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnRhc2tEZXRhaWxzID0gcmVzO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMudGFza0RldGFpbHMubmFtZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudGFza0RldGFpbHMubmFtZSA9ICdObyBuYW1lJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgZW5kRGF0ZTogYW55ID0gcmVzLmVuZERhdGU7XG4gICAgICAgICAgICBpZiAoZW5kRGF0ZSAmJiAhaXNOYU4oZW5kRGF0ZS5nZXRUaW1lKCkpKSB7XG4gICAgICAgICAgICAgIHRoaXMuaW50ZXJuYWxSZWFkT25seUZvcm0gPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmludGVybmFsUmVhZE9ubHlGb3JtID0gdGhpcy5yZWFkT25seUZvcm07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgb25Gb3JtU2F2ZWQoc2F2ZWRGb3JtOiBGb3JtTW9kZWwpIHtcbiAgICB0aGlzLmZvcm1TYXZlZC5lbWl0KHNhdmVkRm9ybSk7XG4gIH1cblxuICBvbkZvcm1Db21wbGV0ZWQoZm9ybTogRm9ybU1vZGVsKSB7XG4gICAgICB0aGlzLmZvcm1Db21wbGV0ZWQuZW1pdChmb3JtKTtcbiAgfVxuXG4gIG9uRm9ybUxvYWRlZChmb3JtOiBGb3JtTW9kZWwpOiB2b2lkIHtcbiAgICB0aGlzLmZvcm1Mb2FkZWQuZW1pdChmb3JtKTtcbiAgfVxuXG4gIG9uRm9ybUNvbnRlbnRDbGljayhjb250ZW50OiBDb250ZW50TGlua01vZGVsKTogdm9pZCB7XG4gICAgICB0aGlzLmZvcm1Db250ZW50Q2xpY2tlZC5lbWl0KGNvbnRlbnQpO1xuICB9XG5cbiAgb25Gb3JtRXhlY3V0ZU91dGNvbWUob3V0Y29tZTogRm9ybU91dGNvbWVFdmVudCkge1xuICAgIHRoaXMuZXhlY3V0ZU91dGNvbWUuZW1pdChvdXRjb21lKTtcbiAgfVxuXG4gIG9uRm9ybUVycm9yKGVycm9yOiBhbnkpIHtcbiAgICB0aGlzLmZvcm1FcnJvci5lbWl0KGVycm9yKTtcbiAgfVxuXG4gIG9uRXJyb3IoZXJyb3I6IGFueSkge1xuICAgIHRoaXMuZXJyb3IuZW1pdChlcnJvcik7XG4gIH1cblxuICBvbkNvbXBsZXRlVGFzaygpIHtcbiAgICB0aGlzLnRhc2tMaXN0U2VydmljZS5jb21wbGV0ZVRhc2sodGhpcy50YXNrRGV0YWlscy5pZCkuc3Vic2NyaWJlKFxuICAgICAgKCkgPT4gdGhpcy5jb21wbGV0ZWQuZW1pdCgpLFxuICAgICAgKGVycm9yKSA9PiB0aGlzLmVycm9yLmVtaXQoZXJyb3IpKTtcbiAgfVxuXG4gIG9uQ2FuY2VsKCkge1xuICAgIHRoaXMuY2FuY2VsLmVtaXQoKTtcbiAgfVxuXG4gIG9uU2hvd0F0dGFjaEZvcm0oKSB7XG4gICAgdGhpcy5zaG93QXR0YWNoRm9ybS5lbWl0KCk7XG4gIH1cblxuICBoYXNGb3JtS2V5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAodGhpcy50YXNrRGV0YWlscyAmJiAoISF0aGlzLnRhc2tEZXRhaWxzLmZvcm1LZXkpKTtcbiAgfVxuXG4gIGlzU3RhbmRhbG9uZVRhc2soKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICEodGhpcy50YXNrRGV0YWlscyAmJiAoISF0aGlzLnRhc2tEZXRhaWxzLnByb2Nlc3NEZWZpbml0aW9uSWQpKTtcbiAgfVxuXG4gIGlzVGFza0xvYWRlZCgpOiBib29sZWFuIHtcbiAgICAgIHJldHVybiAhIXRoaXMudGFza0RldGFpbHM7XG4gIH1cblxuICBpc0NvbXBsZXRlZFRhc2soKTogYm9vbGVhbiB7XG4gICAgICByZXR1cm4gdGhpcy50YXNrRGV0YWlscyAmJiB0aGlzLnRhc2tEZXRhaWxzLmVuZERhdGUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnRhc2tEZXRhaWxzLmVuZERhdGUgIT09IG51bGw7XG4gIH1cblxuICBpc0NvbXBsZXRlQnV0dG9uVmlzaWJsZSgpOiBib29sZWFuIHtcbiAgICAgIHJldHVybiAhdGhpcy5oYXNGb3JtS2V5KCkgJiYgdGhpcy5pc1Rhc2tBY3RpdmUoKSAmJiB0aGlzLmlzQ29tcGxldGVCdXR0b25FbmFibGVkKCk7XG4gIH1cblxuICBpc1Rhc2tBY3RpdmUoKSB7XG4gICAgcmV0dXJuIHRoaXMudGFza0RldGFpbHMgJiYgdGhpcy50YXNrRGV0YWlscy5kdXJhdGlvbiA9PT0gbnVsbDtcbiAgfVxuXG4gIGlzQXNzaWduZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICEhdGhpcy50YXNrRGV0YWlscy5hc3NpZ25lZTtcbiAgfVxuXG4gIHByaXZhdGUgaGFzRW1haWxBZGRyZXNzKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy50YXNrRGV0YWlscy5hc3NpZ25lZS5lbWFpbCA/IHRydWUgOiBmYWxzZTtcbiAgfVxuXG4gIGlzQXNzaWduZWRUb01lKCk6IGJvb2xlYW4ge1xuICAgICAgcmV0dXJuIHRoaXMuaXNBc3NpZ25lZCgpICYmIHRoaXMuaGFzRW1haWxBZGRyZXNzKCkgP1xuICAgICAgICAgIHRoaXMuaXNFbWFpbEVxdWFsKCkgOlxuICAgICAgICAgIHRoaXMuaXNFeHRlcm5hbElkRXF1YWwoKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNFbWFpbEVxdWFsKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAodGhpcy50YXNrRGV0YWlscy5hc3NpZ25lZSAmJiB0aGlzLmN1cnJlbnRMb2dnZWRVc2VyKSAmJiAoIHRoaXMudGFza0RldGFpbHMuYXNzaWduZWUuZW1haWwudG9Mb2NhbGVMb3dlckNhc2UoKSA9PT0gdGhpcy5jdXJyZW50TG9nZ2VkVXNlci5lbWFpbC50b0xvY2FsZUxvd2VyQ2FzZSgpKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNFeHRlcm5hbElkRXF1YWwoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICh0aGlzLnRhc2tEZXRhaWxzLmFzc2lnbmVlICYmIHRoaXMuY3VycmVudExvZ2dlZFVzZXIpICYmICh0aGlzLnRhc2tEZXRhaWxzLmFzc2lnbmVlLmV4dGVybmFsSWQgPT09IHRoaXMuY3VycmVudExvZ2dlZFVzZXIuZXh0ZXJuYWxJZCk7XG4gIH1cblxuICBpc0NvbXBsZXRlQnV0dG9uRW5hYmxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pc0Fzc2lnbmVkVG9NZSgpIHx8IHRoaXMuY2FuSW5pdGlhdG9yQ29tcGxldGUoKTtcbiAgfVxuXG4gIGNhbkluaXRpYXRvckNvbXBsZXRlKCk6IGJvb2xlYW4ge1xuICAgICAgcmV0dXJuIHRoaXMudGFza0RldGFpbHMuaW5pdGlhdG9yQ2FuQ29tcGxldGVUYXNrO1xuICB9XG5cbiAgaXNSZWFkT25seUZvcm0oKTogYm9vbGVhbiB7XG4gICAgbGV0IHJlYWRPbmx5Rm9ybTogYm9vbGVhbjtcbiAgICBpZiAodGhpcy5pc0NhbmRpZGF0ZU1lbWJlcigpKSB7XG4gICAgICByZWFkT25seUZvcm0gPSB0aGlzLmludGVybmFsUmVhZE9ubHlGb3JtIHx8ICF0aGlzLmlzQXNzaWduZWRUb01lKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlYWRPbmx5Rm9ybSA9IHRoaXMuaW50ZXJuYWxSZWFkT25seUZvcm0gfHwgISh0aGlzLmlzQXNzaWduZWRUb01lKCkgfHwgdGhpcy5jYW5DdXJyZW50VXNlckFzSW5pdGlhdG9yQ29tcGxldGUoKSB8fCB0aGlzLmlzQ3VycmVudFVzZXJJbnZvbHZlZCgpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVhZE9ubHlGb3JtO1xuICB9XG5cbiAgaXNDdXJyZW50VXNlckludm9sdmVkKCk6IGJvb2xlYW4ge1xuICAgIGxldCBpc0ludm9sdmVkID0gZmFsc2U7XG4gICAgaWYgKHRoaXMudGFza0RldGFpbHMuaW52b2x2ZWRQZW9wbGUgJiYgdGhpcy5jdXJyZW50TG9nZ2VkVXNlcikge1xuICAgICAgY29uc3QgdXNlckludm9sdmVkID0gdGhpcy50YXNrRGV0YWlscy5pbnZvbHZlZFBlb3BsZS5maW5kKFxuICAgICAgICAoaW52b2x2ZWRVc2VyOiBMaWdodFVzZXJSZXByZXNlbnRhdGlvbikgPT5cbiAgICAgICAgICBpbnZvbHZlZFVzZXIuZW1haWwudG9Mb2NhbGVMb3dlckNhc2UoKSA9PT0gdGhpcy5jdXJyZW50TG9nZ2VkVXNlci5lbWFpbC50b0xvY2FsZUxvd2VyQ2FzZSgpIHx8XG4gICAgICAgICAgaW52b2x2ZWRVc2VyLmlkICsgJycgPT09IHRoaXMuY3VycmVudExvZ2dlZFVzZXIuZXh0ZXJuYWxJZFxuICAgICAgICApO1xuICAgICAgaXNJbnZvbHZlZCA9ICEhdXNlckludm9sdmVkO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnRhc2tEZXRhaWxzLmludm9sdmVkR3JvdXBzPy5sZW5ndGggJiYgdGhpcy5jdXJyZW50TG9nZ2VkVXNlci5ncm91cHM/Lmxlbmd0aCAmJiAhaXNJbnZvbHZlZCkge1xuICAgICAgICBjb25zdCB1c2VyR3JvdXAgPSB0aGlzLnRhc2tEZXRhaWxzLmludm9sdmVkR3JvdXBzLmZpbmQoXG4gICAgICAgICAgICAoaW52b2x2ZWRHcm91cDogTGlnaHRHcm91cFJlcHJlc2VudGF0aW9uKSA9PlxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudExvZ2dlZFVzZXIuZ3JvdXBzLmZpbmQoXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwID0+IGdyb3VwLm5hbWUgPT09IGludm9sdmVkR3JvdXAubmFtZS50b0xvY2FsZUxvd2VyQ2FzZSgpIHx8IGdyb3VwLmlkID09PSBpbnZvbHZlZEdyb3VwLmlkXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgICBpc0ludm9sdmVkID0gISF1c2VyR3JvdXA7XG4gICAgfVxuICAgIHJldHVybiBpc0ludm9sdmVkO1xuICB9XG5cbiAgY2FuQ3VycmVudFVzZXJBc0luaXRpYXRvckNvbXBsZXRlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmNhbkluaXRpYXRvckNvbXBsZXRlKCkgJiYgdGhpcy5pc1Byb2Nlc3NJbml0aWF0b3IoKTtcbiAgfVxuXG4gIGlzUHJvY2Vzc0luaXRpYXRvcigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50TG9nZ2VkVXNlciAmJiAoIHRoaXMuY3VycmVudExvZ2dlZFVzZXIuaWQgPT09ICt0aGlzLnRhc2tEZXRhaWxzLnByb2Nlc3NJbnN0YW5jZVN0YXJ0VXNlcklkKTtcbiAgfVxuXG4gIGlzU2F2ZUJ1dHRvblZpc2libGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc2hvd0Zvcm1TYXZlQnV0dG9uICYmICghdGhpcy5jYW5Jbml0aWF0b3JDb21wbGV0ZSgpIHx8IHRoaXMuaXNBc3NpZ25lZFRvTWUoKSB8fCB0aGlzLmlzQ3VycmVudFVzZXJJbnZvbHZlZCgpKTtcbiAgfVxuXG4gIGNhbkNvbXBsZXRlTm9Gb3JtVGFzaygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pc1JlYWRPbmx5Rm9ybSgpO1xuICB9XG5cbiAgZ2V0Q29tcGxldGVkVGFza1RyYW5zbGF0ZWRNZXNzYWdlKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgcmV0dXJuIHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmdldCgnQURGX1RBU0tfRk9STS5DT01QTEVURURfVEFTSy5USVRMRScsIHsgdGFza05hbWU6IHRoaXMudGFza0RldGFpbHMubmFtZSB9KTtcbiAgfVxuXG4gIGlzQ2FuZGlkYXRlTWVtYmVyKCk6IGJvb2xlYW4ge1xuICAgICAgcmV0dXJuIHRoaXMudGFza0RldGFpbHMubWFuYWdlck9mQ2FuZGlkYXRlR3JvdXAgfHwgdGhpcy50YXNrRGV0YWlscy5tZW1iZXJPZkNhbmRpZGF0ZUdyb3VwIHx8IHRoaXMudGFza0RldGFpbHMubWVtYmVyT2ZDYW5kaWRhdGVVc2VycztcbiAgfVxuXG4gIGlzVGFza0NsYWltYWJsZSgpOiBib29sZWFuIHtcbiAgICAgIHJldHVybiB0aGlzLmlzQ2FuZGlkYXRlTWVtYmVyKCkgJiYgIXRoaXMuaXNBc3NpZ25lZCgpO1xuICB9XG5cbiAgaXNUYXNrQ2xhaW1lZEJ5Q2FuZGlkYXRlTWVtYmVyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzQ2FuZGlkYXRlTWVtYmVyKCkgJiYgdGhpcy5pc0Fzc2lnbmVkVG9NZSgpICYmICF0aGlzLmlzQ29tcGxldGVkVGFzaygpO1xuICB9XG5cbiAgcmVsb2FkVGFzaygpIHtcbiAgICB0aGlzLmxvYWRUYXNrKHRoaXMudGFza0lkKTtcbiAgfVxuXG4gIG9uQ2xhaW1UYXNrKHRhc2tJZDogc3RyaW5nKSB7XG4gICAgdGhpcy50YXNrQ2xhaW1lZC5lbWl0KHRhc2tJZCk7XG4gIH1cblxuICBvbkNsYWltVGFza0Vycm9yKGVycm9yOiBhbnkpIHtcbiAgICB0aGlzLmVycm9yLmVtaXQoZXJyb3IpO1xuICB9XG5cbiAgb25VbmNsYWltVGFzayh0YXNrSWQ6IHN0cmluZykge1xuICAgIHRoaXMudGFza1VuY2xhaW1lZC5lbWl0KHRhc2tJZCk7XG4gIH1cblxuICBvblVuY2xhaW1UYXNrRXJyb3IoZXJyb3I6IGFueSkge1xuICAgIHRoaXMuZXJyb3IuZW1pdChlcnJvcik7XG4gIH1cbn1cbiJdfQ==