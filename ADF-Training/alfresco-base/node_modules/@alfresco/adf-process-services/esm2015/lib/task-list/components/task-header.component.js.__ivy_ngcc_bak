/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, EventEmitter, Input, Output, ViewEncapsulation } from '@angular/core';
import { BpmUserService, CardViewDateItemModel, CardViewMapItemModel, CardViewTextItemModel, TranslationService, AppConfigService, CardViewIntItemModel, CardViewItemLengthValidator } from '@alfresco/adf-core';
import { TaskDetailsModel } from '../models/task-details.model';
import { TaskDescriptionValidator } from '../validators/task-description.validator';
export class TaskHeaderComponent {
    constructor(bpmUserService, translationService, appConfig) {
        this.bpmUserService = bpmUserService;
        this.translationService = translationService;
        this.appConfig = appConfig;
        this.formName = null;
        this.showClaimRelease = true;
        this.claim = new EventEmitter();
        this.unclaim = new EventEmitter();
        this.properties = [];
        this.inEdit = false;
        this.displayDateClearAction = false;
        this.dateFormat = this.appConfig.get('dateValues.defaultDateFormat');
        this.dateLocale = this.appConfig.get('dateValues.defaultDateLocale');
    }
    ngOnInit() {
        this.loadCurrentBpmUserId();
        this.initData();
    }
    ngOnChanges(changes) {
        var _a, _b;
        const taskDetailsChange = changes['taskDetails'];
        if (((_a = taskDetailsChange === null || taskDetailsChange === void 0 ? void 0 : taskDetailsChange.currentValue) === null || _a === void 0 ? void 0 : _a.id) !== ((_b = taskDetailsChange === null || taskDetailsChange === void 0 ? void 0 : taskDetailsChange.previousValue) === null || _b === void 0 ? void 0 : _b.id)) {
            this.initData();
        }
        else {
            this.refreshData();
        }
    }
    initDefaultProperties(parentInfoMap) {
        return [
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.ASSIGNEE',
                value: this.taskDetails.getFullName(),
                key: 'assignee',
                default: this.translationService.instant('ADF_TASK_LIST.PROPERTIES.ASSIGNEE_DEFAULT'),
                clickable: !this.isCompleted(),
                icon: 'create'
            }),
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.STATUS',
                value: this.getTaskStatus(),
                key: 'status'
            }),
            new CardViewIntItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.PRIORITY',
                value: this.taskDetails.priority,
                key: 'priority',
                editable: true,
                validators: [new CardViewItemLengthValidator(1, 10)]
            }),
            new CardViewDateItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.DUE_DATE',
                value: this.taskDetails.dueDate,
                key: 'dueDate',
                default: this.translationService.instant('ADF_TASK_LIST.PROPERTIES.DUE_DATE_DEFAULT'),
                editable: true,
                format: this.dateFormat,
                locale: this.dateLocale
            }),
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.CATEGORY',
                value: this.taskDetails.category,
                key: 'category',
                default: this.translationService.instant('ADF_TASK_LIST.PROPERTIES.CATEGORY_DEFAULT')
            }),
            new CardViewMapItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.PARENT_NAME',
                value: parentInfoMap,
                key: 'parentName',
                default: this.translationService.instant('ADF_TASK_LIST.PROPERTIES.PARENT_NAME_DEFAULT'),
                clickable: true
            }),
            new CardViewDateItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.CREATED',
                value: this.taskDetails.created,
                key: 'created',
                format: this.dateFormat,
                locale: this.dateLocale
            }),
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.DURATION',
                value: this.getTaskDuration(),
                key: 'duration'
            }),
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.PARENT_TASK_ID',
                value: this.taskDetails.parentTaskId,
                key: 'parentTaskId'
            }),
            new CardViewDateItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.END_DATE',
                value: this.taskDetails.endDate,
                key: 'endDate',
                format: this.dateFormat,
                locale: this.dateLocale
            }),
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.ID',
                value: this.taskDetails.id,
                key: 'id'
            }),
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.DESCRIPTION',
                value: this.taskDetails.description,
                key: 'description',
                default: this.translationService.instant('ADF_TASK_LIST.PROPERTIES.DESCRIPTION_DEFAULT'),
                multiline: true,
                editable: true,
                validators: [new TaskDescriptionValidator()]
            }),
            new CardViewTextItemModel({
                label: 'ADF_TASK_LIST.PROPERTIES.FORM_NAME',
                value: this.formName,
                key: 'formName',
                default: this.translationService.instant('ADF_TASK_LIST.PROPERTIES.FORM_NAME_DEFAULT'),
                clickable: this.isFormClickable(),
                icon: 'create'
            })
        ];
    }
    initData() {
        if (this.taskDetails) {
            const parentInfoMap = this.getParentInfo();
            const defaultProperties = this.initDefaultProperties(parentInfoMap);
            const filteredProperties = this.appConfig.get('adf-task-header.presets.properties');
            this.properties = defaultProperties.filter((cardItem) => this.isValidSelection(filteredProperties, cardItem));
        }
    }
    refreshData() {
        this.properties = this.properties.map((cardItem) => {
            if (cardItem.key === 'formName' && cardItem.value !== this.formName) {
                return new CardViewTextItemModel({
                    label: 'ADF_TASK_LIST.PROPERTIES.FORM_NAME',
                    value: this.formName,
                    key: 'formName',
                    default: this.translationService.instant('ADF_TASK_LIST.PROPERTIES.FORM_NAME_DEFAULT'),
                    clickable: this.isFormClickable(),
                    icon: 'create'
                });
            }
            else {
                return cardItem;
            }
        });
    }
    isValidSelection(filteredProperties, cardItem) {
        return filteredProperties ? filteredProperties.indexOf(cardItem.key) >= 0 : true;
    }
    loadCurrentBpmUserId() {
        this.bpmUserService.getCurrentUserInfo().subscribe((res) => {
            this.currentUserId = res ? +res.id : null;
        });
    }
    getParentInfo() {
        if (this.taskDetails.processInstanceId && this.taskDetails.processDefinitionName) {
            return new Map([[this.taskDetails.processInstanceId, this.taskDetails.processDefinitionName]]);
        }
        return new Map();
    }
    hasAssignee() {
        return !!this.taskDetails.assignee;
    }
    isAssignedTo(userId) {
        return this.hasAssignee() ? this.taskDetails.assignee.id === userId : false;
    }
    isAssignedToCurrentUser() {
        return this.hasAssignee() && this.isAssignedTo(this.currentUserId);
    }
    isCandidateMember() {
        return this.taskDetails.managerOfCandidateGroup || this.taskDetails.memberOfCandidateGroup || this.taskDetails.memberOfCandidateUsers;
    }
    isTaskClaimable() {
        return !this.hasAssignee() && this.isCandidateMember();
    }
    isTaskClaimedByCandidateMember() {
        return this.isCandidateMember() && this.isAssignedToCurrentUser() && !this.isCompleted();
    }
    getTaskStatus() {
        return (this.taskDetails && this.taskDetails.isCompleted()) ? 'Completed' : 'Running';
    }
    onClaimTask(taskId) {
        this.claim.emit(taskId);
    }
    onUnclaimTask(taskId) {
        this.unclaim.emit(taskId);
    }
    isCompleted() {
        return this.taskDetails && !!this.taskDetails.endDate;
    }
    isFormClickable() {
        return !!this.formName && !this.isCompleted();
    }
    getTaskDuration() {
        return this.taskDetails.duration ? `${this.taskDetails.duration} ms` : '';
    }
}
TaskHeaderComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-task-header',
                template: "<mat-card *ngIf=\"taskDetails\" class=\"adf-card-container\">\n    <mat-card-content>\n        <adf-card-view [properties]=\"properties\" [editable]=\"!isCompleted()\" [displayClearAction]=\"displayDateClearAction\"></adf-card-view>\n    </mat-card-content>\n\n    <mat-card-actions class=\"adf-controls\" *ngIf=\"showClaimRelease\">\n        <button *ngIf=\"isTaskClaimedByCandidateMember()\" \n            mat-button \n            data-automation-id=\"header-unclaim-button\" \n            id=\"unclaim-task\" \n            class=\"adf-claim-controls\"\n            adf-unclaim-task\n            [taskId]=\"taskDetails.id\"\n            (success)=\"onUnclaimTask($event)\">\n            {{ 'ADF_TASK_LIST.DETAILS.BUTTON.UNCLAIM' | translate }}\n        </button>\n        <button *ngIf=\"isTaskClaimable()\" \n            mat-button \n            data-automation-id=\"header-claim-button\" \n            id=\"claim-task\" \n            class=\"adf-claim-controls\"\n            adf-claim-task\n            [taskId]=\"taskDetails.id\"\n            (success)=\"onClaimTask($event)\">\n            {{ 'ADF_TASK_LIST.DETAILS.BUTTON.CLAIM' | translate }}\n        </button>\n    </mat-card-actions>\n</mat-card>\n",
                encapsulation: ViewEncapsulation.None,
                styles: [".adf-controls{display:flex;justify-content:space-between}.adf-edit-controls{display:flex;justify-content:flex-end;margin-left:auto}.adf-save-edit-mode,.adf-switch-to-edit-mode{color:var(--theme-primary-color)}.adf-cancel-edit-mode,.adf-claim-controls{color:#838383}.adf-card-container{font-family:inherit}@media screen and (max-width:959px){adf-card-view .adf-property-value{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}}"]
            },] }
];
TaskHeaderComponent.ctorParameters = () => [
    { type: BpmUserService },
    { type: TranslationService },
    { type: AppConfigService }
];
TaskHeaderComponent.propDecorators = {
    formName: [{ type: Input }],
    taskDetails: [{ type: Input }],
    showClaimRelease: [{ type: Input }],
    claim: [{ type: Output }],
    unclaim: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFzay1oZWFkZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Ii9ob21lL3RyYXZpcy9idWlsZC9BbGZyZXNjby9hbGZyZXNjby1uZzItY29tcG9uZW50cy9saWIvcHJvY2Vzcy1zZXJ2aWNlcy9zcmMvIiwic291cmNlcyI6WyJsaWIvdGFzay1saXN0L2NvbXBvbmVudHMvdGFzay1oZWFkZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQUVILE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFpQixpQkFBaUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1SCxPQUFPLEVBQ0gsY0FBYyxFQUNkLHFCQUFxQixFQUNyQixvQkFBb0IsRUFDcEIscUJBQXFCLEVBRXJCLGtCQUFrQixFQUNsQixnQkFBZ0IsRUFDaEIsb0JBQW9CLEVBQ3BCLDJCQUEyQixFQUM5QixNQUFNLG9CQUFvQixDQUFDO0FBQzVCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ2hFLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBUXBGLE1BQU0sT0FBTyxtQkFBbUI7SUE4QjVCLFlBQW9CLGNBQThCLEVBQzlCLGtCQUFzQyxFQUN0QyxTQUEyQjtRQUYzQixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQUN0QyxjQUFTLEdBQVQsU0FBUyxDQUFrQjtRQTVCL0MsYUFBUSxHQUFXLElBQUksQ0FBQztRQVF4QixxQkFBZ0IsR0FBRyxJQUFJLENBQUM7UUFJeEIsVUFBSyxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBSW5ELFlBQU8sR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUlyRCxlQUFVLEdBQVcsRUFBRSxDQUFDO1FBQ3hCLFdBQU0sR0FBWSxLQUFLLENBQUM7UUFDeEIs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TyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBS0QsV0FBVztRQUNQLE9BQU8sSUFBSSxDQUFDLFdBQVcsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUM7SUFDMUQsQ0FBQztJQUVELGVBQWU7UUFDWCxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ2xELENBQUM7SUFFRCxlQUFlO1FBQ1gsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDOUUsQ0FBQzs7O1lBN1NKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsaUJBQWlCO2dCQUMzQixzc0NBQTJDO2dCQUUzQyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTs7YUFDeEM7OztZQWxCRyxjQUFjO1lBS2Qsa0JBQWtCO1lBQ2xCLGdCQUFnQjs7O3VCQWdCZixLQUFLOzBCQUlMLEtBQUs7K0JBSUwsS0FBSztvQkFJTCxNQUFNO3NCQUlOLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBPdXRwdXQsIFNpbXBsZUNoYW5nZXMsIFZpZXdFbmNhcHN1bGF0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICAgIEJwbVVzZXJTZXJ2aWNlLFxuICAgIENhcmRWaWV3RGF0ZUl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld01hcEl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld1RleHRJdGVtTW9kZWwsXG4gICAgQ2FyZFZpZXdCYXNlSXRlbU1vZGVsLFxuICAgIFRyYW5zbGF0aW9uU2VydmljZSxcbiAgICBBcHBDb25maWdTZXJ2aWNlLFxuICAgIENhcmRWaWV3SW50SXRlbU1vZGVsLFxuICAgIENhcmRWaWV3SXRlbUxlbmd0aFZhbGlkYXRvclxufSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgVGFza0RldGFpbHNNb2RlbCB9IGZyb20gJy4uL21vZGVscy90YXNrLWRldGFpbHMubW9kZWwnO1xuaW1wb3J0IHsgVGFza0Rlc2NyaXB0aW9uVmFsaWRhdG9yIH0gZnJvbSAnLi4vdmFsaWRhdG9ycy90YXNrLWRlc2NyaXB0aW9uLnZhbGlkYXRvcic7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLXRhc2staGVhZGVyJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vdGFzay1oZWFkZXIuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3Rhc2staGVhZGVyLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBUYXNrSGVhZGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzLCBPbkluaXQge1xuXG4gICAgLyoqIFRoZSBuYW1lIG9mIHRoZSBmb3JtLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZm9ybU5hbWU6IHN0cmluZyA9IG51bGw7XG5cbiAgICAvKiogKHJlcXVpcmVkKSBEZXRhaWxzIHJlbGF0ZWQgdG8gdGhlIHRhc2suICovXG4gICAgQElucHV0KClcbiAgICB0YXNrRGV0YWlsczogVGFza0RldGFpbHNNb2RlbDtcblxuICAgIC8qKiBUb2dnbGVzIGRpc3BsYXkgb2YgdGhlIGNsYWltL3JlbGVhc2UgYnV0dG9uLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd0NsYWltUmVsZWFzZSA9IHRydWU7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSB0YXNrIGlzIGNsYWltZWQuICovXG4gICAgQE91dHB1dCgpXG4gICAgY2xhaW06IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSB0YXNrIGlzIHVuY2xhaW1lZCAoaWUsIHJlcXVldWUpLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHVuY2xhaW06IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICBwcml2YXRlIGN1cnJlbnRVc2VySWQ6IG51bWJlcjtcblxuICAgIHByb3BlcnRpZXM6IGFueSBbXSA9IFtdO1xuICAgIGluRWRpdDogYm9vbGVhbiA9IGZhbHNlO1xuICAgIGRpc3BsYXlEYXRlQ2xlYXJBY3Rpb24gPSBmYWxzZTtcbiAgICBkYXRlRm9ybWF0OiBzdHJpbmc7XG4gICAgZGF0ZUxvY2FsZTogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBicG1Vc2VyU2VydmljZTogQnBtVXNlclNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB0cmFuc2xhdGlvblNlcnZpY2U6IFRyYW5zbGF0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFwcENvbmZpZzogQXBwQ29uZmlnU2VydmljZSkge1xuICAgICAgICB0aGlzLmRhdGVGb3JtYXQgPSB0aGlzLmFwcENvbmZpZy5nZXQoJ2RhdGVWYWx1ZXMuZGVmYXVsdERhdGVGb3JtYXQnKTtcbiAgICAgICAgdGhpcy5kYXRlTG9jYWxlID0gdGhpcy5hcHBDb25maWcuZ2V0KCdkYXRlVmFsdWVzLmRlZmF1bHREYXRlTG9jYWxlJyk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMubG9hZEN1cnJlbnRCcG1Vc2VySWQoKTtcbiAgICAgICAgdGhpcy5pbml0RGF0YSgpO1xuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgICAgY29uc3QgdGFza0RldGFpbHNDaGFuZ2UgPSBjaGFuZ2VzWyd0YXNrRGV0YWlscyddO1xuICAgICAgICBpZiAodGFza0RldGFpbHNDaGFuZ2U/LmN1cnJlbnRWYWx1ZT8uaWQgIT09IHRhc2tEZXRhaWxzQ2hhbmdlPy5wcmV2aW91c1ZhbHVlPy5pZCkge1xuICAgICAgICAgICAgdGhpcy5pbml0RGF0YSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZWZyZXNoRGF0YSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpbml0RGVmYXVsdFByb3BlcnRpZXMocGFyZW50SW5mb01hcCk6IGFueVtdIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIG5ldyBDYXJkVmlld1RleHRJdGVtTW9kZWwoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9UQVNLX0xJU1QuUFJPUEVSVElFUy5BU1NJR05FRScsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnRhc2tEZXRhaWxzLmdldEZ1bGxOYW1lKCksXG4gICAgICAgICAgICAgICAgICAgIGtleTogJ2Fzc2lnbmVlJyxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudCgnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLkFTU0lHTkVFX0RFRkFVTFQnKSxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2thYmxlOiAhdGhpcy5pc0NvbXBsZXRlZCgpLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnY3JlYXRlJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfVEFTS19MSVNULlBST1BFUlRJRVMuU1RBVFVTJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ2V0VGFza1N0YXR1cygpLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdzdGF0dXMnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIG5ldyBDYXJkVmlld0ludEl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLlBSSU9SSVRZJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudGFza0RldGFpbHMucHJpb3JpdHksXG4gICAgICAgICAgICAgICAgICAgIGtleTogJ3ByaW9yaXR5JyxcbiAgICAgICAgICAgICAgICAgICAgZWRpdGFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkYXRvcnM6IFtuZXcgQ2FyZFZpZXdJdGVtTGVuZ3RoVmFsaWRhdG9yKDEsIDEwKV1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3RGF0ZUl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLkRVRV9EQVRFJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudGFza0RldGFpbHMuZHVlRGF0ZSxcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnZHVlRGF0ZScsXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmluc3RhbnQoJ0FERl9UQVNLX0xJU1QuUFJPUEVSVElFUy5EVUVfREFURV9ERUZBVUxUJyksXG4gICAgICAgICAgICAgICAgICAgIGVkaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IHRoaXMuZGF0ZUZvcm1hdCxcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxlOiB0aGlzLmRhdGVMb2NhbGVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3VGV4dEl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLkNBVEVHT1JZJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudGFza0RldGFpbHMuY2F0ZWdvcnksXG4gICAgICAgICAgICAgICAgICAgIGtleTogJ2NhdGVnb3J5JyxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudCgnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLkNBVEVHT1JZX0RFRkFVTFQnKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdNYXBJdGVtTW9kZWwoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9UQVNLX0xJU1QuUFJPUEVSVElFUy5QQVJFTlRfTkFNRScsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwYXJlbnRJbmZvTWFwLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdwYXJlbnROYW1lJyxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudCgnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLlBBUkVOVF9OQU1FX0RFRkFVTFQnKSxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2thYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIG5ldyBDYXJkVmlld0RhdGVJdGVtTW9kZWwoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9UQVNLX0xJU1QuUFJPUEVSVElFUy5DUkVBVEVEJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudGFza0RldGFpbHMuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnY3JlYXRlZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdDogdGhpcy5kYXRlRm9ybWF0LFxuICAgICAgICAgICAgICAgICAgICBsb2NhbGU6IHRoaXMuZGF0ZUxvY2FsZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfVEFTS19MSVNULlBST1BFUlRJRVMuRFVSQVRJT04nLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5nZXRUYXNrRHVyYXRpb24oKSxcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnZHVyYXRpb24nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIG5ldyBDYXJkVmlld1RleHRJdGVtTW9kZWwoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9UQVNLX0xJU1QuUFJPUEVSVElFUy5QQVJFTlRfVEFTS19JRCcsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnRhc2tEZXRhaWxzLnBhcmVudFRhc2tJZCxcbiAgICAgICAgICAgICAgICAgICAga2V5OiAncGFyZW50VGFza0lkJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdEYXRlSXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfVEFTS19MSVNULlBST1BFUlRJRVMuRU5EX0RBVEUnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy50YXNrRGV0YWlscy5lbmREYXRlLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdlbmREYXRlJyxcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiB0aGlzLmRhdGVGb3JtYXQsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsZTogdGhpcy5kYXRlTG9jYWxlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIG5ldyBDYXJkVmlld1RleHRJdGVtTW9kZWwoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9UQVNLX0xJU1QuUFJPUEVSVElFUy5JRCcsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnRhc2tEZXRhaWxzLmlkLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdpZCdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3VGV4dEl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLkRFU0NSSVBUSU9OJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudGFza0RldGFpbHMuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGtleTogJ2Rlc2NyaXB0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudCgnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLkRFU0NSSVBUSU9OX0RFRkFVTFQnKSxcbiAgICAgICAgICAgICAgICAgICAgbXVsdGlsaW5lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBlZGl0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdG9yczogW25ldyBUYXNrRGVzY3JpcHRpb25WYWxpZGF0b3IoKV1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3VGV4dEl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLkZPUk1fTkFNRScsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmZvcm1OYW1lLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdmb3JtTmFtZScsXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmluc3RhbnQoJ0FERl9UQVNLX0xJU1QuUFJPUEVSVElFUy5GT1JNX05BTUVfREVGQVVMVCcpLFxuICAgICAgICAgICAgICAgICAgICBjbGlja2FibGU6IHRoaXMuaXNGb3JtQ2xpY2thYmxlKCksXG4gICAgICAgICAgICAgICAgICAgIGljb246ICdjcmVhdGUnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKVxuICAgICAgICBdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlZnJlc2ggdGhlIGNhcmQgZGF0YVxuICAgICAqL1xuICAgIGluaXREYXRhKCkge1xuICAgICAgICBpZiAodGhpcy50YXNrRGV0YWlscykge1xuICAgICAgICAgICAgY29uc3QgcGFyZW50SW5mb01hcCA9IHRoaXMuZ2V0UGFyZW50SW5mbygpO1xuICAgICAgICAgICAgY29uc3QgZGVmYXVsdFByb3BlcnRpZXMgPSB0aGlzLmluaXREZWZhdWx0UHJvcGVydGllcyhwYXJlbnRJbmZvTWFwKTtcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlcmVkUHJvcGVydGllczogc3RyaW5nW10gPSB0aGlzLmFwcENvbmZpZy5nZXQoJ2FkZi10YXNrLWhlYWRlci5wcmVzZXRzLnByb3BlcnRpZXMnKTtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydGllcyA9IGRlZmF1bHRQcm9wZXJ0aWVzLmZpbHRlcigoY2FyZEl0ZW0pID0+IHRoaXMuaXNWYWxpZFNlbGVjdGlvbihmaWx0ZXJlZFByb3BlcnRpZXMsIGNhcmRJdGVtKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWZyZXNoIHRoZSBjYXJkIGRhdGFcbiAgICAgKi9cbiAgICByZWZyZXNoRGF0YSgpIHtcbiAgICAgICAgdGhpcy5wcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzLm1hcCgoY2FyZEl0ZW0pID0+IHtcbiAgICAgICAgICAgIGlmIChjYXJkSXRlbS5rZXkgPT09ICdmb3JtTmFtZScgJiYgY2FyZEl0ZW0udmFsdWUgIT09IHRoaXMuZm9ybU5hbWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IENhcmRWaWV3VGV4dEl0ZW1Nb2RlbCh7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX1RBU0tfTElTVC5QUk9QRVJUSUVTLkZPUk1fTkFNRScsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmZvcm1OYW1lLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdmb3JtTmFtZScsXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmluc3RhbnQoJ0FERl9UQVNLX0xJU1QuUFJPUEVSVElFUy5GT1JNX05BTUVfREVGQVVMVCcpLFxuICAgICAgICAgICAgICAgICAgICBjbGlja2FibGU6IHRoaXMuaXNGb3JtQ2xpY2thYmxlKCksXG4gICAgICAgICAgICAgICAgICAgIGljb246ICdjcmVhdGUnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYXJkSXRlbTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc1ZhbGlkU2VsZWN0aW9uKGZpbHRlcmVkUHJvcGVydGllczogc3RyaW5nW10sIGNhcmRJdGVtOiBDYXJkVmlld0Jhc2VJdGVtTW9kZWwpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGZpbHRlcmVkUHJvcGVydGllcyA/IGZpbHRlcmVkUHJvcGVydGllcy5pbmRleE9mKGNhcmRJdGVtLmtleSkgPj0gMCA6IHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9hZHMgY3VycmVudCBicG0gdXNlcklkXG4gICAgICovXG4gICAgcHJpdmF0ZSBsb2FkQ3VycmVudEJwbVVzZXJJZCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5icG1Vc2VyU2VydmljZS5nZXRDdXJyZW50VXNlckluZm8oKS5zdWJzY3JpYmUoKHJlcykgPT4ge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50VXNlcklkID0gcmVzID8gK3Jlcy5pZCA6IG51bGw7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgcHJvY2VzcyBwYXJlbnQgaW5mb3JtYXRpb25cbiAgICAgKi9cbiAgICBnZXRQYXJlbnRJbmZvKCk6IE1hcDxzdHJpbmcsIHN0cmluZz4ge1xuICAgICAgICBpZiAodGhpcy50YXNrRGV0YWlscy5wcm9jZXNzSW5zdGFuY2VJZCAmJiB0aGlzLnRhc2tEZXRhaWxzLnByb2Nlc3NEZWZpbml0aW9uTmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBNYXAoW1t0aGlzLnRhc2tEZXRhaWxzLnByb2Nlc3NJbnN0YW5jZUlkLCB0aGlzLnRhc2tEZXRhaWxzLnByb2Nlc3NEZWZpbml0aW9uTmFtZV1dKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IE1hcCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERvZXMgdGhlIHRhc2sgaGF2ZSBhbiBhc3NpZ25lZVxuICAgICAqL1xuICAgIHB1YmxpYyBoYXNBc3NpZ25lZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy50YXNrRGV0YWlscy5hc3NpZ25lZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIHRhc2sgaXMgYXNzaWduZWQgdG8gbG9nZ2VkIGluIHVzZXJcbiAgICAgKi9cbiAgICBwdWJsaWMgaXNBc3NpZ25lZFRvKHVzZXJJZDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhc0Fzc2lnbmVlKCkgPyB0aGlzLnRhc2tEZXRhaWxzLmFzc2lnbmVlLmlkID09PSB1c2VySWQgOiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgdGFzayBhc3NpZ25lZFxuICAgICAqL1xuICAgIHB1YmxpYyBpc0Fzc2lnbmVkVG9DdXJyZW50VXNlcigpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzQXNzaWduZWUoKSAmJiB0aGlzLmlzQXNzaWduZWRUbyh0aGlzLmN1cnJlbnRVc2VySWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSB1c2VyIGlzIGEgY2FuZGlkYXRlIG1lbWJlclxuICAgICAqL1xuICAgIGlzQ2FuZGlkYXRlTWVtYmVyKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy50YXNrRGV0YWlscy5tYW5hZ2VyT2ZDYW5kaWRhdGVHcm91cCB8fCB0aGlzLnRhc2tEZXRhaWxzLm1lbWJlck9mQ2FuZGlkYXRlR3JvdXAgfHwgdGhpcy50YXNrRGV0YWlscy5tZW1iZXJPZkNhbmRpZGF0ZVVzZXJzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSB0YXNrIGNsYWltYWJsZVxuICAgICAqL1xuICAgIHB1YmxpYyBpc1Rhc2tDbGFpbWFibGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhdGhpcy5oYXNBc3NpZ25lZSgpICYmIHRoaXMuaXNDYW5kaWRhdGVNZW1iZXIoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgdGFzayBjbGFpbWVkIGJ5IGNhbmRpZGF0ZSBtZW1iZXIuXG4gICAgICovXG4gICAgcHVibGljIGlzVGFza0NsYWltZWRCeUNhbmRpZGF0ZU1lbWJlcigpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNDYW5kaWRhdGVNZW1iZXIoKSAmJiB0aGlzLmlzQXNzaWduZWRUb0N1cnJlbnRVc2VyKCkgJiYgIXRoaXMuaXNDb21wbGV0ZWQoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRhc2sncyBzdGF0dXNcbiAgICAgKi9cbiAgICBnZXRUYXNrU3RhdHVzKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiAodGhpcy50YXNrRGV0YWlscyAmJiB0aGlzLnRhc2tEZXRhaWxzLmlzQ29tcGxldGVkKCkpID8gJ0NvbXBsZXRlZCcgOiAnUnVubmluZyc7XG4gICAgfVxuXG4gICAgb25DbGFpbVRhc2sodGFza0lkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5jbGFpbS5lbWl0KHRhc2tJZCk7XG4gICAgfVxuXG4gICAgb25VbmNsYWltVGFzayh0YXNrSWQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLnVuY2xhaW0uZW1pdCh0YXNrSWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgdGFzayBpcyBjb21wbGV0ZWRcbiAgICAgKi9cbiAgICBpc0NvbXBsZXRlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGFza0RldGFpbHMgJiYgISF0aGlzLnRhc2tEZXRhaWxzLmVuZERhdGU7XG4gICAgfVxuXG4gICAgaXNGb3JtQ2xpY2thYmxlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gISF0aGlzLmZvcm1OYW1lICYmICF0aGlzLmlzQ29tcGxldGVkKCk7XG4gICAgfVxuXG4gICAgZ2V0VGFza0R1cmF0aW9uKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tEZXRhaWxzLmR1cmF0aW9uID8gYCR7dGhpcy50YXNrRGV0YWlscy5kdXJhdGlvbn0gbXNgIDogJyc7XG4gICAgfVxufVxuIl19