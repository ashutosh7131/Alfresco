import { Injectable } from '@angular/core';
import { from, throwError, of } from 'rxjs';
import { map, catchError } from 'rxjs/operators';
import { AlfrescoApiService, AppConfigService, LogService } from '@alfresco/adf-core';
import * as i0 from "@angular/core";
import * as i1 from "@alfresco/adf-core";
export class AppsProcessCloudService {
    constructor(apiService, logService, appConfigService) {
        this.apiService = apiService;
        this.logService = logService;
        this.appConfigService = appConfigService;
        this.loadApps();
    }
    getDeployedApplicationsByStatus(status, role) {
        return this.hasDeployedApps() ? of(this.deployedApps) : this.getApplicationsByStatus(status, role);
    }
    hasDeployedApps() {
        return this.deployedApps && this.deployedApps.length > 0;
    }
    loadApps() {
        const apps = this.appConfigService.get('alfresco-deployed-apps', []);
        apps.map((app) => {
            app.theme = app.theme ? app.theme : 'theme-1';
            app.icon = app.icon ? app.icon : 'favorite';
        });
        this.deployedApps = apps;
    }
    getApplicationsByStatus(status, role) {
        if (status === '') {
            return of([]);
        }
        const api = this.apiService.getInstance().oauth2Auth;
        const path = this.getApplicationUrl();
        const pathParams = {}, queryParams = { status: status, roles: role, sort: 'name' }, headerParams = {}, formParams = {}, bodyParam = {}, contentTypes = ['application/json'], accepts = ['application/json'];
        return from(api.callCustomApi(path, 'GET', pathParams, queryParams, headerParams, formParams, bodyParam, contentTypes, accepts))
            .pipe(map((applications) => {
            return applications.list.entries.map((application) => application.entry);
        }), catchError((err) => this.handleError(err)));
    }
    getApplicationUrl() {
        return `${this.appConfigService.get('bpmHost')}/deployment-service/v1/applications`;
    }
    handleError(error) {
        this.logService.error(error);
        return throwError(error || 'Server error');
    }
}
AppsProcessCloudService.ɵprov = i0.ɵɵdefineInjectable({ factory: function AppsProcessCloudService_Factory() { return new AppsProcessCloudService(i0.ɵɵinject(i1.AlfrescoApiService), i0.ɵɵinject(i1.LogService), i0.ɵɵinject(i1.AppConfigService)); }, token: AppsProcessCloudService, providedIn: "root" });
AppsProcessCloudService.decorators = [
    { type: Injectable, args: [{ providedIn: 'root' },] }
];
AppsProcessCloudService.ctorParameters = () => [
    { type: AlfrescoApiService },
    { type: LogService },
    { type: AppConfigService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwcy1wcm9jZXNzLWNsb3VkLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9wcm9jZXNzLXNlcnZpY2VzLWNsb3VkL3NyYy8iLCJzb3VyY2VzIjpbImxpYi9hcHAvc2VydmljZXMvYXBwcy1wcm9jZXNzLWNsb3VkLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBaUJBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFjLElBQUksRUFBRSxVQUFVLEVBQUUsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3hELE9BQU8sRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDakQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLGdCQUFnQixFQUFFLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDOzs7QUFLdEYsTUFBTSxPQUFPLHVCQUF1QjtJQUloQyxZQUNZLFVBQThCLEVBQzlCLFVBQXNCLEVBQ3RCLGdCQUFrQztRQUZsQyxlQUFVLEdBQVYsVUFBVSxDQUFvQjtRQUM5QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDMUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFRRCwrQkFBK0IsQ0FBQyxNQUFjLEVBQUUsSUFBYTtRQUN6RCxPQUFPLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztJQUN2RyxDQUFDO0lBRUQsZUFBZTtRQUNYLE9BQU8sSUFBSSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDN0QsQ0FBQztJQUVELFFBQVE7UUFDSixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxDQUFNLHdCQUF3QixFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQzFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtZQUNiLEdBQUcsQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1lBQzlDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDO1FBQ2hELENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7SUFDN0IsQ0FBQztJQUVPLHVCQUF1QixDQUFDLE1BQWMsRUFBRSxJQUFhO1FBQ3pELElBQUksTUFBTSxLQUFLLEVBQUUsRUFBRTtZQUNmLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ2pCO1FBQ0QsTUFBTSxHQUFHLEdBQWUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxVQUFVLENBQUM7UUFDakUsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDdEMsTUFBTSxVQUFVLEdBQUcsRUFBRSxFQUFFLFdBQVcsR0FBRyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFHLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEVBQy9FLFlBQVksR0FBRyxFQUFFLEVBQUUsVUFBVSxHQUFHLEVBQUUsRUFBRSxTQUFTLEdBQUcsRUFBRSxFQUNsRCxZQUFZLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxFQUFFLE9BQU8sR0FBRyxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFFeEUsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQ25HLFlBQVksRUFBRSxPQUFPLENBQUMsQ0FBQzthQUN0QixJQUFJLENBQ0QsR0FBRyxDQUFDLENBQUMsWUFBaUIsRUFBRSxFQUFFO1lBQ3RCLE9BQU8sWUFBWSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0UsQ0FBQyxDQUFDLEVBQ0YsVUFBVSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQzdDLENBQUM7SUFDVixDQUFDO0lBRU8saUJBQWlCO1FBQ3JCLE9BQU8sR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxxQ0FBcUMsQ0FBQztJQUN4RixDQUFDO0lBRU8sV0FBVyxDQUFDLEtBQVc7UUFDM0IsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0IsT0FBTyxVQUFVLENBQUMsS0FBSyxJQUFJLGNBQWMsQ0FBQyxDQUFDO0lBQy9DLENBQUM7Ozs7WUE5REosVUFBVSxTQUFDLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRTs7O1lBSnpCLGtCQUFrQjtZQUFvQixVQUFVO1lBQTVCLGdCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIGZyb20sIHRocm93RXJyb3IsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBBbGZyZXNjb0FwaVNlcnZpY2UsIEFwcENvbmZpZ1NlcnZpY2UsIExvZ1NlcnZpY2UgfSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgT2F1dGgyQXV0aCB9IGZyb20gJ0BhbGZyZXNjby9qcy1hcGknO1xuaW1wb3J0IHsgQXBwbGljYXRpb25JbnN0YW5jZU1vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL2FwcGxpY2F0aW9uLWluc3RhbmNlLm1vZGVsJztcblxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcbmV4cG9ydCBjbGFzcyBBcHBzUHJvY2Vzc0Nsb3VkU2VydmljZSB7XG5cbiAgICBkZXBsb3llZEFwcHM6IEFwcGxpY2F0aW9uSW5zdGFuY2VNb2RlbFtdO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgYXBpU2VydmljZTogQWxmcmVzY29BcGlTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgYXBwQ29uZmlnU2VydmljZTogQXBwQ29uZmlnU2VydmljZSkge1xuICAgICAgICB0aGlzLmxvYWRBcHBzKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhIGxpc3Qgb2YgZGVwbG95ZWQgYXBwcyBmb3IgdGhpcyB1c2VyIGJ5IHN0YXR1cy5cbiAgICAgKiBAcGFyYW0gc3RhdHVzIFJlcXVpcmVkIHN0YXR1cyB2YWx1ZVxuICAgICAqIEBwYXJhbSByb2xlIHRvIGZpbHRlciB0aGUgYXBwc1xuICAgICAqIEByZXR1cm5zIFRoZSBsaXN0IG9mIGRlcGxveWVkIGFwcHNcbiAgICAgKi9cbiAgICBnZXREZXBsb3llZEFwcGxpY2F0aW9uc0J5U3RhdHVzKHN0YXR1czogc3RyaW5nLCByb2xlPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxBcHBsaWNhdGlvbkluc3RhbmNlTW9kZWxbXT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5oYXNEZXBsb3llZEFwcHMoKSA/IG9mKHRoaXMuZGVwbG95ZWRBcHBzKSA6IHRoaXMuZ2V0QXBwbGljYXRpb25zQnlTdGF0dXMoc3RhdHVzLCByb2xlKTtcbiAgICB9XG5cbiAgICBoYXNEZXBsb3llZEFwcHMoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmRlcGxveWVkQXBwcyAmJiB0aGlzLmRlcGxveWVkQXBwcy5sZW5ndGggPiAwO1xuICAgIH1cblxuICAgIGxvYWRBcHBzKCkge1xuICAgICAgICBjb25zdCBhcHBzID0gdGhpcy5hcHBDb25maWdTZXJ2aWNlLmdldDxhbnk+KCdhbGZyZXNjby1kZXBsb3llZC1hcHBzJywgW10pO1xuICAgICAgICBhcHBzLm1hcCgoYXBwKSA9PiB7XG4gICAgICAgICAgICBhcHAudGhlbWUgPSBhcHAudGhlbWUgPyBhcHAudGhlbWUgOiAndGhlbWUtMSc7XG4gICAgICAgICAgICBhcHAuaWNvbiA9IGFwcC5pY29uID8gYXBwLmljb24gOiAnZmF2b3JpdGUnO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5kZXBsb3llZEFwcHMgPSBhcHBzO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0QXBwbGljYXRpb25zQnlTdGF0dXMoc3RhdHVzOiBzdHJpbmcsIHJvbGU/OiBzdHJpbmcpOiBPYnNlcnZhYmxlPEFwcGxpY2F0aW9uSW5zdGFuY2VNb2RlbFtdPiB7XG4gICAgICAgIGlmIChzdGF0dXMgPT09ICcnKSB7XG4gICAgICAgICAgICByZXR1cm4gb2YoW10pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFwaTogT2F1dGgyQXV0aCA9IHRoaXMuYXBpU2VydmljZS5nZXRJbnN0YW5jZSgpLm9hdXRoMkF1dGg7XG4gICAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmdldEFwcGxpY2F0aW9uVXJsKCk7XG4gICAgICAgIGNvbnN0IHBhdGhQYXJhbXMgPSB7fSwgcXVlcnlQYXJhbXMgPSB7IHN0YXR1czogc3RhdHVzLCByb2xlcyA6IHJvbGUsIHNvcnQ6ICduYW1lJyB9LFxuICAgICAgICAgICAgaGVhZGVyUGFyYW1zID0ge30sIGZvcm1QYXJhbXMgPSB7fSwgYm9keVBhcmFtID0ge30sXG4gICAgICAgICAgICBjb250ZW50VHlwZXMgPSBbJ2FwcGxpY2F0aW9uL2pzb24nXSwgYWNjZXB0cyA9IFsnYXBwbGljYXRpb24vanNvbiddO1xuXG4gICAgICAgIHJldHVybiBmcm9tKGFwaS5jYWxsQ3VzdG9tQXBpKHBhdGgsICdHRVQnLCBwYXRoUGFyYW1zLCBxdWVyeVBhcmFtcywgaGVhZGVyUGFyYW1zLCBmb3JtUGFyYW1zLCBib2R5UGFyYW0sXG4gICAgICAgICAgICBjb250ZW50VHlwZXMsIGFjY2VwdHMpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKChhcHBsaWNhdGlvbnM6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBwbGljYXRpb25zLmxpc3QuZW50cmllcy5tYXAoKGFwcGxpY2F0aW9uKSA9PiBhcHBsaWNhdGlvbi5lbnRyeSk7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0QXBwbGljYXRpb25VcmwoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMuYXBwQ29uZmlnU2VydmljZS5nZXQoJ2JwbUhvc3QnKX0vZGVwbG95bWVudC1zZXJ2aWNlL3YxL2FwcGxpY2F0aW9uc2A7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVFcnJvcihlcnJvcj86IGFueSkge1xuICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm4gdGhyb3dFcnJvcihlcnJvciB8fCAnU2VydmVyIGVycm9yJyk7XG4gICAgfVxufVxuIl19