/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, Input, EventEmitter, Output } from '@angular/core';
import { FormGroup, FormControl } from '@angular/forms';
import { DateCloudFilterType } from '../../models/date-cloud-filter.model';
import moment from 'moment-es6';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/material/form-field';
import * as ɵngcc2 from '@angular/material/select';
import * as ɵngcc3 from '@angular/common';
import * as ɵngcc4 from '@angular/material/core';
import * as ɵngcc5 from '@angular/material/datepicker';
import * as ɵngcc6 from '@angular/forms';
import * as ɵngcc7 from '@ngx-translate/core';

function DateRangeFilterComponent_mat_option_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "mat-option", 4);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const propertyOption_r2 = ctx.$implicit;
    ɵngcc0.ɵɵproperty("value", propertyOption_r2.value);
    ɵngcc0.ɵɵattribute("data-automation-id", "adf-cloud-edit-process-property-options-" + propertyOption_r2.value.toString());
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 3, propertyOption_r2.label), " ");
} }
function DateRangeFilterComponent_ng_container_4_Template(rf, ctx) { if (rf & 1) {
    const _r5 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelementStart(1, "mat-form-field", 5);
    ɵngcc0.ɵɵelementStart(2, "mat-label");
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "mat-date-range-input", 6);
    ɵngcc0.ɵɵelement(6, "input", 7);
    ɵngcc0.ɵɵpipe(7, "translate");
    ɵngcc0.ɵɵelement(8, "input", 8);
    ɵngcc0.ɵɵpipe(9, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(10, "mat-datepicker-toggle", 9);
    ɵngcc0.ɵɵelementStart(11, "mat-date-range-picker", 10, 11);
    ɵngcc0.ɵɵlistener("closed", function DateRangeFilterComponent_ng_container_4_Template_mat_date_range_picker_closed_11_listener() { ɵngcc0.ɵɵrestoreView(_r5); const ctx_r4 = ɵngcc0.ɵɵnextContext(); return ctx_r4.onDateRangeClosed(); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const _r3 = ɵngcc0.ɵɵreference(12);
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("floatLabel", "auto");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(4, 8, "ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE_TITLE"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("formGroup", ctx_r1.dateRangeForm)("rangePicker", _r3);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵpropertyInterpolate("placeholder", ɵngcc0.ɵɵpipeBind1(7, 10, "ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.START_DATE"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵpropertyInterpolate("placeholder", ɵngcc0.ɵɵpipeBind1(9, 12, "ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.END_DATE"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("for", _r3);
    ɵngcc0.ɵɵattribute("data-automation-id", "adf-cloud-edit-process-property-date-range-" + ctx_r1.processFilterProperty.key);
} }
export class DateRangeFilterComponent {
    constructor() {
        this.dateChanged = new EventEmitter();
        this.dateTypeChange = new EventEmitter();
        this.filteredProperties = [];
        this.dateRangeForm = new FormGroup({
            from: new FormControl(),
            to: new FormControl()
        });
    }
    ngOnInit() {
        this.options = this.options ? this.options : this.createDefaultRangeOptions();
        const defaultProperties = this.createDefaultDateOptions();
        this.filteredProperties = defaultProperties.filter((filterProperty) => this.isValidProperty(this.options, filterProperty.value.toString()));
        if (this.hasPreselectedValues()) {
            this.setPreselectedValues();
        }
    }
    onSelectionChange(option) {
        this.type = option.value;
        if (!this.isDateRangeType()) {
            this.dateTypeChange.emit(this.type);
        }
    }
    isDateRangeType() {
        return this.type === DateCloudFilterType.RANGE;
    }
    onDateRangeClosed() {
        const dateRange = {
            startDate: moment(this.dateRangeForm.controls.from.value).startOf('day').toISOString(true),
            endDate: moment(this.dateRangeForm.controls.to.value).endOf('day').toISOString(true)
        };
        this.dateChanged.emit(dateRange);
    }
    hasPreselectedValues() {
        var _a, _b;
        return !!((_a = this.processFilterProperty) === null || _a === void 0 ? void 0 : _a.attributes) && !!((_b = this.processFilterProperty) === null || _b === void 0 ? void 0 : _b.value);
    }
    setPreselectedValues() {
        const from = this.getFilterAttribute('from');
        const to = this.getFilterAttribute('to');
        const type = this.getFilterAttribute('dateType');
        this.dateRangeForm.get('from').setValue(moment(this.getFilterValue(from)));
        this.dateRangeForm.get('to').setValue(moment(this.getFilterValue(to)));
        this.type = this.getFilterValue(type);
    }
    getFilterAttribute(key) {
        return this.processFilterProperty.attributes[key];
    }
    getFilterValue(attribute) {
        return this.processFilterProperty.value[attribute];
    }
    isValidProperty(filterProperties, key) {
        return filterProperties ? filterProperties.indexOf(key) >= 0 : true;
    }
    createDefaultRangeOptions() {
        return [
            DateCloudFilterType.NO_DATE,
            DateCloudFilterType.TODAY,
            DateCloudFilterType.WEEK,
            DateCloudFilterType.MONTH,
            DateCloudFilterType.QUARTER,
            DateCloudFilterType.YEAR,
            DateCloudFilterType.RANGE
        ];
    }
    createDefaultDateOptions() {
        return [
            {
                value: DateCloudFilterType.NO_DATE,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.NO_DATE'
            },
            {
                value: DateCloudFilterType.TODAY,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.TODAY'
            },
            {
                value: DateCloudFilterType.TOMORROW,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.TOMORROW'
            },
            {
                value: DateCloudFilterType.NEXT_7_DAYS,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.NEXT_7_DAYS'
            },
            {
                value: DateCloudFilterType.WEEK,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.WEEK'
            },
            {
                value: DateCloudFilterType.MONTH,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.MONTH'
            },
            {
                value: DateCloudFilterType.QUARTER,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.QUARTER'
            },
            {
                value: DateCloudFilterType.YEAR,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.YEAR'
            },
            {
                value: DateCloudFilterType.RANGE,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.RANGE'
            }
        ];
    }
}
DateRangeFilterComponent.ɵfac = function DateRangeFilterComponent_Factory(t) { return new (t || DateRangeFilterComponent)(); };
DateRangeFilterComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: DateRangeFilterComponent, selectors: [["adf-cloud-date-range-filter"]], inputs: { options: "options", processFilterProperty: "processFilterProperty" }, outputs: { dateChanged: "dateChanged", dateTypeChange: "dateTypeChange" }, decls: 5, vars: 9, consts: [[3, "floatLabel"], [3, "placeholder", "value", "selectionChange"], [3, "value", 4, "ngFor", "ngForOf"], [4, "ngIf"], [3, "value"], [1, "adf-cloud-date-range-picker", 3, "floatLabel"], [3, "formGroup", "rangePicker"], ["matStartDate", "", "formControlName", "from", 3, "placeholder"], ["matEndDate", "", "formControlName", "to", 3, "placeholder"], ["matSuffix", "", 3, "for"], [3, "closed"], ["picker", ""]], template: function DateRangeFilterComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "mat-form-field", 0);
        ɵngcc0.ɵɵelementStart(1, "mat-select", 1);
        ɵngcc0.ɵɵlistener("selectionChange", function DateRangeFilterComponent_Template_mat_select_selectionChange_1_listener($event) { return ctx.onSelectionChange($event); });
        ɵngcc0.ɵɵpipe(2, "translate");
        ɵngcc0.ɵɵtemplate(3, DateRangeFilterComponent_mat_option_3_Template, 3, 5, "mat-option", 2);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(4, DateRangeFilterComponent_ng_container_4_Template, 13, 14, "ng-container", 3);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("floatLabel", "auto");
        ɵngcc0.ɵɵattribute("data-automation-id", ctx.processFilterProperty.key);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵpropertyInterpolate("placeholder", ɵngcc0.ɵɵpipeBind1(2, 7, ctx.processFilterProperty.label));
        ɵngcc0.ɵɵproperty("value", ctx.type);
        ɵngcc0.ɵɵattribute("data-automation-id", "adf-cloud-edit-process-property-" + ctx.processFilterProperty.key);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.filteredProperties);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.isDateRangeType());
    } }, directives: [ɵngcc1.MatFormField, ɵngcc2.MatSelect, ɵngcc3.NgForOf, ɵngcc3.NgIf, ɵngcc4.MatOption, ɵngcc1.MatLabel, ɵngcc5.MatDateRangeInput, ɵngcc6.NgControlStatusGroup, ɵngcc6.FormGroupDirective, ɵngcc5.MatStartDate, ɵngcc6.DefaultValueAccessor, ɵngcc6.NgControlStatus, ɵngcc6.FormControlName, ɵngcc5.MatEndDate, ɵngcc5.MatDatepickerToggle, ɵngcc1.MatSuffix, ɵngcc5.MatDateRangePicker], pipes: [ɵngcc7.TranslatePipe], styles: [".adf-cloud-date-range-picker[_ngcontent-%COMP%]{margin:0 10px}"] });
DateRangeFilterComponent.propDecorators = {
    processFilterProperty: [{ type: Input }],
    options: [{ type: Input }],
    dateChanged: [{ type: Output }],
    dateTypeChange: [{ type: Output }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DateRangeFilterComponent, [{
        type: Component,
        args: [{
                selector: 'adf-cloud-date-range-filter',
                template: "\n<mat-form-field [floatLabel]=\"'auto'\" [attr.data-automation-id]=\"processFilterProperty.key\">\n    <mat-select\n        placeholder=\"{{ processFilterProperty.label | translate }}\"\n        [value]=\"type\"\n        (selectionChange)=\"onSelectionChange($event)\"\n        [attr.data-automation-id]=\"'adf-cloud-edit-process-property-' + processFilterProperty.key\">\n        <mat-option *ngFor=\"let propertyOption of filteredProperties\" [value]=\"propertyOption.value\" [attr.data-automation-id]=\"'adf-cloud-edit-process-property-options-' + propertyOption.value.toString()\">\n            {{ propertyOption.label | translate }}\n        </mat-option>\n    </mat-select>\n</mat-form-field>\n\n<ng-container *ngIf=\"isDateRangeType()\">\n    <mat-form-field [floatLabel]=\"'auto'\" class=\"adf-cloud-date-range-picker\">\n        <mat-label>{{ 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE_TITLE' | translate }}</mat-label>\n        <mat-date-range-input [formGroup]=\"dateRangeForm\" [rangePicker]=\"picker\">\n          <input matStartDate formControlName=\"from\" placeholder=\"{{ 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.START_DATE' | translate }}\">\n          <input matEndDate formControlName=\"to\" placeholder=\"{{ 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.END_DATE' | translate }}\">\n        </mat-date-range-input>\n        <mat-datepicker-toggle\n            matSuffix\n            [for]=\"picker\"\n            [attr.data-automation-id]=\"'adf-cloud-edit-process-property-date-range-' + processFilterProperty.key\"></mat-datepicker-toggle>\n        <mat-date-range-picker #picker (closed)=\"onDateRangeClosed()\"></mat-date-range-picker>\n    </mat-form-field>\n</ng-container>\n",
                styles: [".adf-cloud-date-range-picker{margin:0 10px}"]
            }]
    }], function () { return []; }, { dateChanged: [{
            type: Output
        }], dateTypeChange: [{
            type: Output
        }], options: [{
            type: Input
        }], processFilterProperty: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1yYW5nZS1maWx0ZXIuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9ob21lL3RyYXZpcy9idWlsZC9BbGZyZXNjby9hbGZyZXNjby1uZzItY29tcG9uZW50cy9saWIvcHJvY2Vzcy1zZXJ2aWNlcy1jbG91ZC9zcmMvbGliL2NvbW1vbi9kYXRlLXJhbmdlLWZpbHRlci9kYXRlLXJhbmdlLWZpbHRlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUVILE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHdkUsT0FBTyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4RCxPQUFPLEVBQW1CLG1CQUFtQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDNUYsT0FBTyxNQUFNLE1BQU0sWUFBWSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQU8vQixNQUFNLE9BQU8sd0JBQXdCO0FBQ3RDLElBTkE7QUFDRyxRQWFDLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQW1CLENBQUM7QUFDdEQsUUFFSSxtQkFBYyxHQUFHLElBQUksWUFBWSxFQUF1QixDQUFDO0FBQzdELFFBRUksdUJBQWtCLEdBQTJCLEVBQUUsQ0FBQztBQUNwRCxRQUFJLGtCQUFhLEdBQUcsSUFBSSxTQUFTLENBQUM7QUFDbEMsWUFBUSxJQUFJLEVBQUUsSUFBSSxXQUFXLEVBQUU7QUFDL0IsWUFBUSxFQUFFLEVBQUUsSUFBSSxXQUFXLEVBQUU7QUFDN0IsU0FBSyxDQUFDLENBQUM7QUFD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bGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBFdmVudEVtaXR0ZXIsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0U2VsZWN0Q2hhbmdlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvc2VsZWN0JztcbmltcG9ydCB7IFByb2Nlc3NGaWx0ZXJQcm9wZXJ0aWVzLCBQcm9jZXNzRmlsdGVyT3B0aW9ucyB9IGZyb20gJy4uLy4uL3Byb2Nlc3MvcHJvY2Vzcy1maWx0ZXJzL21vZGVscy9wcm9jZXNzLWZpbHRlci1jbG91ZC5tb2RlbCc7XG5pbXBvcnQgeyBGb3JtR3JvdXAsIEZvcm1Db250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgRGF0ZVJhbmdlRmlsdGVyLCBEYXRlQ2xvdWRGaWx0ZXJUeXBlIH0gZnJvbSAnLi4vLi4vbW9kZWxzL2RhdGUtY2xvdWQtZmlsdGVyLm1vZGVsJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50LWVzNic7XG5cbkBDb21wb25lbnQoe1xuICAgICBzZWxlY3RvcjogJ2FkZi1jbG91ZC1kYXRlLXJhbmdlLWZpbHRlcicsXG4gICAgIHN0eWxlVXJsczogWycuL2RhdGUtcmFuZ2UtZmlsdGVyLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgIHRlbXBsYXRlVXJsOiAnLi9kYXRlLXJhbmdlLWZpbHRlci5jb21wb25lbnQuaHRtbCdcbiB9KVxuIGV4cG9ydCBjbGFzcyBEYXRlUmFuZ2VGaWx0ZXJDb21wb25lbnQge1xuXG4gICAgQElucHV0KClcbiAgICBwcm9jZXNzRmlsdGVyUHJvcGVydHk6IFByb2Nlc3NGaWx0ZXJQcm9wZXJ0aWVzO1xuXG4gICAgQElucHV0KClcbiAgICBvcHRpb25zOiBEYXRlQ2xvdWRGaWx0ZXJUeXBlW107XG5cbiAgICBAT3V0cHV0KClcbiAgICBkYXRlQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXI8RGF0ZVJhbmdlRmlsdGVyPigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgZGF0ZVR5cGVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPERhdGVDbG91ZEZpbHRlclR5cGU+KCk7XG5cbiAgICB0eXBlOiBEYXRlQ2xvdWRGaWx0ZXJUeXBlO1xuICAgIGZpbHRlcmVkUHJvcGVydGllczogUHJvY2Vzc0ZpbHRlck9wdGlvbnNbXSA9IFtdO1xuICAgIGRhdGVSYW5nZUZvcm0gPSBuZXcgRm9ybUdyb3VwKHtcbiAgICAgICAgZnJvbTogbmV3IEZvcm1Db250cm9sKCksXG4gICAgICAgIHRvOiBuZXcgRm9ybUNvbnRyb2woKVxuICAgIH0pO1xuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IHRoaXMub3B0aW9ucyA/IHRoaXMub3B0aW9ucyA6IHRoaXMuY3JlYXRlRGVmYXVsdFJhbmdlT3B0aW9ucygpO1xuICAgICAgICBjb25zdCBkZWZhdWx0UHJvcGVydGllcyA9IHRoaXMuY3JlYXRlRGVmYXVsdERhdGVPcHRpb25zKCk7XG4gICAgICAgIHRoaXMuZmlsdGVyZWRQcm9wZXJ0aWVzID0gZGVmYXVsdFByb3BlcnRpZXMuZmlsdGVyKChmaWx0ZXJQcm9wZXJ0eSkgPT4gdGhpcy5pc1ZhbGlkUHJvcGVydHkodGhpcy5vcHRpb25zLCBmaWx0ZXJQcm9wZXJ0eS52YWx1ZS50b1N0cmluZygpKSk7XG4gICAgICAgIGlmICh0aGlzLmhhc1ByZXNlbGVjdGVkVmFsdWVzKCkpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0UHJlc2VsZWN0ZWRWYWx1ZXMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uU2VsZWN0aW9uQ2hhbmdlKG9wdGlvbjogTWF0U2VsZWN0Q2hhbmdlKSB7XG4gICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbi52YWx1ZTtcbiAgICAgICAgaWYgKCF0aGlzLmlzRGF0ZVJhbmdlVHlwZSgpKSB7XG4gICAgICAgICAgICB0aGlzLmRhdGVUeXBlQ2hhbmdlLmVtaXQodGhpcy50eXBlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlzRGF0ZVJhbmdlVHlwZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gRGF0ZUNsb3VkRmlsdGVyVHlwZS5SQU5HRTtcbiAgICB9XG5cbiAgICBvbkRhdGVSYW5nZUNsb3NlZCgpIHtcbiAgICAgICAgY29uc3QgZGF0ZVJhbmdlID0ge1xuICAgICAgICAgICAgc3RhcnREYXRlOiBtb21lbnQodGhpcy5kYXRlUmFuZ2VGb3JtLmNvbnRyb2xzLmZyb20udmFsdWUpLnN0YXJ0T2YoJ2RheScpLnRvSVNPU3RyaW5nKHRydWUpLFxuICAgICAgICAgICAgZW5kRGF0ZTogbW9tZW50KHRoaXMuZGF0ZVJhbmdlRm9ybS5jb250cm9scy50by52YWx1ZSkuZW5kT2YoJ2RheScpLnRvSVNPU3RyaW5nKHRydWUpXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZGF0ZUNoYW5nZWQuZW1pdChkYXRlUmFuZ2UpO1xuICAgIH1cblxuICAgIHByaXZhdGUgaGFzUHJlc2VsZWN0ZWRWYWx1ZXMoKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMucHJvY2Vzc0ZpbHRlclByb3BlcnR5Py5hdHRyaWJ1dGVzICYmICEhdGhpcy5wcm9jZXNzRmlsdGVyUHJvcGVydHk/LnZhbHVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2V0UHJlc2VsZWN0ZWRWYWx1ZXMoKSB7XG4gICAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmdldEZpbHRlckF0dHJpYnV0ZSgnZnJvbScpO1xuICAgICAgICBjb25zdCB0byA9IHRoaXMuZ2V0RmlsdGVyQXR0cmlidXRlKCd0bycpO1xuICAgICAgICBjb25zdCB0eXBlID0gdGhpcy5nZXRGaWx0ZXJBdHRyaWJ1dGUoJ2RhdGVUeXBlJyk7XG5cbiAgICAgICAgdGhpcy5kYXRlUmFuZ2VGb3JtLmdldCgnZnJvbScpLnNldFZhbHVlKG1vbWVudCh0aGlzLmdldEZpbHRlclZhbHVlKGZyb20pKSk7XG4gICAgICAgIHRoaXMuZGF0ZVJhbmdlRm9ybS5nZXQoJ3RvJykuc2V0VmFsdWUobW9tZW50KHRoaXMuZ2V0RmlsdGVyVmFsdWUodG8pKSk7XG4gICAgICAgIHRoaXMudHlwZSA9IHRoaXMuZ2V0RmlsdGVyVmFsdWUodHlwZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRGaWx0ZXJBdHRyaWJ1dGUoa2V5OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRmlsdGVyUHJvcGVydHkuYXR0cmlidXRlc1trZXldO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0RmlsdGVyVmFsdWUoYXR0cmlidXRlOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc0ZpbHRlclByb3BlcnR5LnZhbHVlW2F0dHJpYnV0ZV07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc1ZhbGlkUHJvcGVydHkoZmlsdGVyUHJvcGVydGllczogc3RyaW5nW10sIGtleTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBmaWx0ZXJQcm9wZXJ0aWVzID8gZmlsdGVyUHJvcGVydGllcy5pbmRleE9mKGtleSkgPj0gMCA6IHRydWU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjcmVhdGVEZWZhdWx0UmFuZ2VPcHRpb25zKCk6IERhdGVDbG91ZEZpbHRlclR5cGVbXSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBEYXRlQ2xvdWRGaWx0ZXJUeXBlLk5PX0RBVEUsXG4gICAgICAgICAgICBEYXRlQ2xvdWRGaWx0ZXJUeXBlLlRPREFZLFxuICAgICAgICAgICAgRGF0ZUNsb3VkRmlsdGVyVHlwZS5XRUVLLFxuICAgICAgICAgICAgRGF0ZUNsb3VkRmlsdGVyVHlwZS5NT05USCxcbiAgICAgICAgICAgIERhdGVDbG91ZEZpbHRlclR5cGUuUVVBUlRFUixcbiAgICAgICAgICAgIERhdGVDbG91ZEZpbHRlclR5cGUuWUVBUixcbiAgICAgICAgICAgIERhdGVDbG91ZEZpbHRlclR5cGUuUkFOR0VcbiAgICAgICAgXTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNyZWF0ZURlZmF1bHREYXRlT3B0aW9ucygpOiBQcm9jZXNzRmlsdGVyT3B0aW9uc1tdIHtcbiAgICAgICAgcmV0dXJuICBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IERhdGVDbG91ZEZpbHRlclR5cGUuTk9fREFURSxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9DTE9VRF9FRElUX1BST0NFU1NfRklMVEVSLkxBQkVMLkRBVEVfUkFOR0UuTk9fREFURSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IERhdGVDbG91ZEZpbHRlclR5cGUuVE9EQVksXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfQ0xPVURfRURJVF9QUk9DRVNTX0ZJTFRFUi5MQUJFTC5EQVRFX1JBTkdFLlRPREFZJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogRGF0ZUNsb3VkRmlsdGVyVHlwZS5UT01PUlJPVyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9DTE9VRF9FRElUX1BST0NFU1NfRklMVEVSLkxBQkVMLkRBVEVfUkFOR0UuVE9NT1JST1cnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBEYXRlQ2xvdWRGaWx0ZXJUeXBlLk5FWFRfN19EQVlTLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX0NMT1VEX0VESVRfUFJPQ0VTU19GSUxURVIuTEFCRUwuREFURV9SQU5HRS5ORVhUXzdfREFZUydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IERhdGVDbG91ZEZpbHRlclR5cGUuV0VFSyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9DTE9VRF9FRElUX1BST0NFU1NfRklMVEVSLkxBQkVMLkRBVEVfUkFOR0UuV0VFSydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IERhdGVDbG91ZEZpbHRlclR5cGUuTU9OVEgsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfQ0xPVURfRURJVF9QUk9DRVNTX0ZJTFRFUi5MQUJFTC5EQVRFX1JBTkdFLk1PTlRIJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogRGF0ZUNsb3VkRmlsdGVyVHlwZS5RVUFSVEVSLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX0NMT1VEX0VESVRfUFJPQ0VTU19GSUxURVIuTEFCRUwuREFURV9SQU5HRS5RVUFSVEVSJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogRGF0ZUNsb3VkRmlsdGVyVHlwZS5ZRUFSLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX0NMT1VEX0VESVRfUFJPQ0VTU19GSUxURVIuTEFCRUwuREFURV9SQU5HRS5ZRUFSJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogRGF0ZUNsb3VkRmlsdGVyVHlwZS5SQU5HRSxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9DTE9VRF9FRElUX1BST0NFU1NfRklMVEVSLkxBQkVMLkRBVEVfUkFOR0UuUkFOR0UnXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG4gICAgfVxuIH1cbiJdfQ==