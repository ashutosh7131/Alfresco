/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, Input, EventEmitter, Output } from '@angular/core';
import { FormGroup, FormControl } from '@angular/forms';
import { DateCloudFilterType } from '../../models/date-cloud-filter.model';
import moment from 'moment-es6';
export class DateRangeFilterComponent {
    constructor() {
        this.dateChanged = new EventEmitter();
        this.dateTypeChange = new EventEmitter();
        this.filteredProperties = [];
        this.dateRangeForm = new FormGroup({
            from: new FormControl(),
            to: new FormControl()
        });
    }
    ngOnInit() {
        this.options = this.options ? this.options : this.createDefaultRangeOptions();
        const defaultProperties = this.createDefaultDateOptions();
        this.filteredProperties = defaultProperties.filter((filterProperty) => this.isValidProperty(this.options, filterProperty.value.toString()));
        if (this.hasPreselectedValues()) {
            this.setPreselectedValues();
        }
    }
    onSelectionChange(option) {
        this.type = option.value;
        if (!this.isDateRangeType()) {
            this.dateTypeChange.emit(this.type);
        }
    }
    isDateRangeType() {
        return this.type === DateCloudFilterType.RANGE;
    }
    onDateRangeClosed() {
        const dateRange = {
            startDate: moment(this.dateRangeForm.controls.from.value).startOf('day').toISOString(true),
            endDate: moment(this.dateRangeForm.controls.to.value).endOf('day').toISOString(true)
        };
        this.dateChanged.emit(dateRange);
    }
    hasPreselectedValues() {
        var _a, _b;
        return !!((_a = this.processFilterProperty) === null || _a === void 0 ? void 0 : _a.attributes) && !!((_b = this.processFilterProperty) === null || _b === void 0 ? void 0 : _b.value);
    }
    setPreselectedValues() {
        const from = this.getFilterAttribute('from');
        const to = this.getFilterAttribute('to');
        const type = this.getFilterAttribute('dateType');
        this.dateRangeForm.get('from').setValue(moment(this.getFilterValue(from)));
        this.dateRangeForm.get('to').setValue(moment(this.getFilterValue(to)));
        this.type = this.getFilterValue(type);
    }
    getFilterAttribute(key) {
        return this.processFilterProperty.attributes[key];
    }
    getFilterValue(attribute) {
        return this.processFilterProperty.value[attribute];
    }
    isValidProperty(filterProperties, key) {
        return filterProperties ? filterProperties.indexOf(key) >= 0 : true;
    }
    createDefaultRangeOptions() {
        return [
            DateCloudFilterType.NO_DATE,
            DateCloudFilterType.TODAY,
            DateCloudFilterType.WEEK,
            DateCloudFilterType.MONTH,
            DateCloudFilterType.QUARTER,
            DateCloudFilterType.YEAR,
            DateCloudFilterType.RANGE
        ];
    }
    createDefaultDateOptions() {
        return [
            {
                value: DateCloudFilterType.NO_DATE,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.NO_DATE'
            },
            {
                value: DateCloudFilterType.TODAY,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.TODAY'
            },
            {
                value: DateCloudFilterType.TOMORROW,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.TOMORROW'
            },
            {
                value: DateCloudFilterType.NEXT_7_DAYS,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.NEXT_7_DAYS'
            },
            {
                value: DateCloudFilterType.WEEK,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.WEEK'
            },
            {
                value: DateCloudFilterType.MONTH,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.MONTH'
            },
            {
                value: DateCloudFilterType.QUARTER,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.QUARTER'
            },
            {
                value: DateCloudFilterType.YEAR,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.YEAR'
            },
            {
                value: DateCloudFilterType.RANGE,
                label: 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE.RANGE'
            }
        ];
    }
}
DateRangeFilterComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-cloud-date-range-filter',
                template: "\n<mat-form-field [floatLabel]=\"'auto'\" [attr.data-automation-id]=\"processFilterProperty.key\">\n    <mat-select\n        placeholder=\"{{ processFilterProperty.label | translate }}\"\n        [value]=\"type\"\n        (selectionChange)=\"onSelectionChange($event)\"\n        [attr.data-automation-id]=\"'adf-cloud-edit-process-property-' + processFilterProperty.key\">\n        <mat-option *ngFor=\"let propertyOption of filteredProperties\" [value]=\"propertyOption.value\" [attr.data-automation-id]=\"'adf-cloud-edit-process-property-options-' + propertyOption.value.toString()\">\n            {{ propertyOption.label | translate }}\n        </mat-option>\n    </mat-select>\n</mat-form-field>\n\n<ng-container *ngIf=\"isDateRangeType()\">\n    <mat-form-field [floatLabel]=\"'auto'\" class=\"adf-cloud-date-range-picker\">\n        <mat-label>{{ 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.DATE_RANGE_TITLE' | translate }}</mat-label>\n        <mat-date-range-input [formGroup]=\"dateRangeForm\" [rangePicker]=\"picker\">\n          <input matStartDate formControlName=\"from\" placeholder=\"{{ 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.START_DATE' | translate }}\">\n          <input matEndDate formControlName=\"to\" placeholder=\"{{ 'ADF_CLOUD_EDIT_PROCESS_FILTER.LABEL.END_DATE' | translate }}\">\n        </mat-date-range-input>\n        <mat-datepicker-toggle\n            matSuffix\n            [for]=\"picker\"\n            [attr.data-automation-id]=\"'adf-cloud-edit-process-property-date-range-' + processFilterProperty.key\"></mat-datepicker-toggle>\n        <mat-date-range-picker #picker (closed)=\"onDateRangeClosed()\"></mat-date-range-picker>\n    </mat-form-field>\n</ng-container>\n",
                styles: [".adf-cloud-date-range-picker{margin:0 10px}"]
            },] }
];
DateRangeFilterComponent.propDecorators = {
    processFilterProperty: [{ type: Input }],
    options: [{ type: Input }],
    dateChanged: [{ type: Output }],
    dateTypeChange: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1yYW5nZS1maWx0ZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Ii9ob21lL3RyYXZpcy9idWlsZC9BbGZyZXNjby9hbGZyZXNjby1uZzItY29tcG9uZW50cy9saWIvcHJvY2Vzcy1zZXJ2aWNlcy1jbG91ZC9zcmMvIiwic291cmNlcyI6WyJsaWIvY29tbW9uL2RhdGUtcmFuZ2UtZmlsdGVyL2RhdGUtcmFuZ2UtZmlsdGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7QUFFSCxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBR3ZFLE9BQU8sRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEQsT0FBTyxFQUFtQixtQkFBbUIsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQzVGLE9BQU8sTUFBTSxNQUFNLFlBQVksQ0FBQztBQU8vQixNQUFNLE9BQU8sd0JBQXdCO0lBTHRDO1FBY0ksZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBbUIsQ0FBQztRQUdsRCxtQkFBYyxHQUFHLElBQUksWUFBWSxFQUF1QixDQUFDO1FBR3pELHVCQUFrQixHQUEyQixFQUFFLENBQUM7UUFDaEQsa0JBQWEsR0FBRyxJQUFJLFNBQVMsQ0FBQztZQUMxQixJQUFJLEVBQUUsSUFBSSxXQUFXLEVBQUU7WUFDdkIsRUFBRSxFQUFFLElBQUksV0FBVyxFQUFFO1NBQ3hCLENBQUMsQ0FBQztJQTRHTixDQUFDO0lBMUdFLFFBQVE7UUFDSixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxDQUFDO1FBQzlFLE1BQU0saUJBQWlCLEdBQUcsSUFBSSxDQUFDLHdCQUF3QixFQUFFLENBQUM7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NkJBQTZCO2dCQUV2QywycURBQWlEOzthQUNwRDs7O29DQUdHLEtBQUs7c0JBR0wsS0FBSzswQkFHTCxNQUFNOzZCQUdOLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBFdmVudEVtaXR0ZXIsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0U2VsZWN0Q2hhbmdlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvc2VsZWN0JztcbmltcG9ydCB7IFByb2Nlc3NGaWx0ZXJQcm9wZXJ0aWVzLCBQcm9jZXNzRmlsdGVyT3B0aW9ucyB9IGZyb20gJy4uLy4uL3Byb2Nlc3MvcHJvY2Vzcy1maWx0ZXJzL21vZGVscy9wcm9jZXNzLWZpbHRlci1jbG91ZC5tb2RlbCc7XG5pbXBvcnQgeyBGb3JtR3JvdXAsIEZvcm1Db250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgRGF0ZVJhbmdlRmlsdGVyLCBEYXRlQ2xvdWRGaWx0ZXJUeXBlIH0gZnJvbSAnLi4vLi4vbW9kZWxzL2RhdGUtY2xvdWQtZmlsdGVyLm1vZGVsJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50LWVzNic7XG5cbkBDb21wb25lbnQoe1xuICAgICBzZWxlY3RvcjogJ2FkZi1jbG91ZC1kYXRlLXJhbmdlLWZpbHRlcicsXG4gICAgIHN0eWxlVXJsczogWycuL2RhdGUtcmFuZ2UtZmlsdGVyLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgIHRlbXBsYXRlVXJsOiAnLi9kYXRlLXJhbmdlLWZpbHRlci5jb21wb25lbnQuaHRtbCdcbiB9KVxuIGV4cG9ydCBjbGFzcyBEYXRlUmFuZ2VGaWx0ZXJDb21wb25lbnQge1xuXG4gICAgQElucHV0KClcbiAgICBwcm9jZXNzRmlsdGVyUHJvcGVydHk6IFByb2Nlc3NGaWx0ZXJQcm9wZXJ0aWVzO1xuXG4gICAgQElucHV0KClcbiAgICBvcHRpb25zOiBEYXRlQ2xvdWRGaWx0ZXJUeXBlW107XG5cbiAgICBAT3V0cHV0KClcbiAgICBkYXRlQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXI8RGF0ZVJhbmdlRmlsdGVyPigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgZGF0ZVR5cGVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPERhdGVDbG91ZEZpbHRlclR5cGU+KCk7XG5cbiAgICB0eXBlOiBEYXRlQ2xvdWRGaWx0ZXJUeXBlO1xuICAgIGZpbHRlcmVkUHJvcGVydGllczogUHJvY2Vzc0ZpbHRlck9wdGlvbnNbXSA9IFtdO1xuICAgIGRhdGVSYW5nZUZvcm0gPSBuZXcgRm9ybUdyb3VwKHtcbiAgICAgICAgZnJvbTogbmV3IEZvcm1Db250cm9sKCksXG4gICAgICAgIHRvOiBuZXcgRm9ybUNvbnRyb2woKVxuICAgIH0pO1xuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IHRoaXMub3B0aW9ucyA/IHRoaXMub3B0aW9ucyA6IHRoaXMuY3JlYXRlRGVmYXVsdFJhbmdlT3B0aW9ucygpO1xuICAgICAgICBjb25zdCBkZWZhdWx0UHJvcGVydGllcyA9IHRoaXMuY3JlYXRlRGVmYXVsdERhdGVPcHRpb25zKCk7XG4gICAgICAgIHRoaXMuZmlsdGVyZWRQcm9wZXJ0aWVzID0gZGVmYXVsdFByb3BlcnRpZXMuZmlsdGVyKChmaWx0ZXJQcm9wZXJ0eSkgPT4gdGhpcy5pc1ZhbGlkUHJvcGVydHkodGhpcy5vcHRpb25zLCBmaWx0ZXJQcm9wZXJ0eS52YWx1ZS50b1N0cmluZygpKSk7XG4gICAgICAgIGlmICh0aGlzLmhhc1ByZXNlbGVjdGVkVmFsdWVzKCkpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0UHJlc2VsZWN0ZWRWYWx1ZXMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uU2VsZWN0aW9uQ2hhbmdlKG9wdGlvbjogTWF0U2VsZWN0Q2hhbmdlKSB7XG4gICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbi52YWx1ZTtcbiAgICAgICAgaWYgKCF0aGlzLmlzRGF0ZVJhbmdlVHlwZSgpKSB7XG4gICAgICAgICAgICB0aGlzLmRhdGVUeXBlQ2hhbmdlLmVtaXQodGhpcy50eXBlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlzRGF0ZVJhbmdlVHlwZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gRGF0ZUNsb3VkRmlsdGVyVHlwZS5SQU5HRTtcbiAgICB9XG5cbiAgICBvbkRhdGVSYW5nZUNsb3NlZCgpIHtcbiAgICAgICAgY29uc3QgZGF0ZVJhbmdlID0ge1xuICAgICAgICAgICAgc3RhcnREYXRlOiBtb21lbnQodGhpcy5kYXRlUmFuZ2VGb3JtLmNvbnRyb2xzLmZyb20udmFsdWUpLnN0YXJ0T2YoJ2RheScpLnRvSVNPU3RyaW5nKHRydWUpLFxuICAgICAgICAgICAgZW5kRGF0ZTogbW9tZW50KHRoaXMuZGF0ZVJhbmdlRm9ybS5jb250cm9scy50by52YWx1ZSkuZW5kT2YoJ2RheScpLnRvSVNPU3RyaW5nKHRydWUpXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZGF0ZUNoYW5nZWQuZW1pdChkYXRlUmFuZ2UpO1xuICAgIH1cblxuICAgIHByaXZhdGUgaGFzUHJlc2VsZWN0ZWRWYWx1ZXMoKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMucHJvY2Vzc0ZpbHRlclByb3BlcnR5Py5hdHRyaWJ1dGVzICYmICEhdGhpcy5wcm9jZXNzRmlsdGVyUHJvcGVydHk/LnZhbHVlO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2V0UHJlc2VsZWN0ZWRWYWx1ZXMoKSB7XG4gICAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmdldEZpbHRlckF0dHJpYnV0ZSgnZnJvbScpO1xuICAgICAgICBjb25zdCB0byA9IHRoaXMuZ2V0RmlsdGVyQXR0cmlidXRlKCd0bycpO1xuICAgICAgICBjb25zdCB0eXBlID0gdGhpcy5nZXRGaWx0ZXJBdHRyaWJ1dGUoJ2RhdGVUeXBlJyk7XG5cbiAgICAgICAgdGhpcy5kYXRlUmFuZ2VGb3JtLmdldCgnZnJvbScpLnNldFZhbHVlKG1vbWVudCh0aGlzLmdldEZpbHRlclZhbHVlKGZyb20pKSk7XG4gICAgICAgIHRoaXMuZGF0ZVJhbmdlRm9ybS5nZXQoJ3RvJykuc2V0VmFsdWUobW9tZW50KHRoaXMuZ2V0RmlsdGVyVmFsdWUodG8pKSk7XG4gICAgICAgIHRoaXMudHlwZSA9IHRoaXMuZ2V0RmlsdGVyVmFsdWUodHlwZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRGaWx0ZXJBdHRyaWJ1dGUoa2V5OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRmlsdGVyUHJvcGVydHkuYXR0cmlidXRlc1trZXldO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0RmlsdGVyVmFsdWUoYXR0cmlidXRlOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc0ZpbHRlclByb3BlcnR5LnZhbHVlW2F0dHJpYnV0ZV07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc1ZhbGlkUHJvcGVydHkoZmlsdGVyUHJvcGVydGllczogc3RyaW5nW10sIGtleTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBmaWx0ZXJQcm9wZXJ0aWVzID8gZmlsdGVyUHJvcGVydGllcy5pbmRleE9mKGtleSkgPj0gMCA6IHRydWU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjcmVhdGVEZWZhdWx0UmFuZ2VPcHRpb25zKCk6IERhdGVDbG91ZEZpbHRlclR5cGVbXSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBEYXRlQ2xvdWRGaWx0ZXJUeXBlLk5PX0RBVEUsXG4gICAgICAgICAgICBEYXRlQ2xvdWRGaWx0ZXJUeXBlLlRPREFZLFxuICAgICAgICAgICAgRGF0ZUNsb3VkRmlsdGVyVHlwZS5XRUVLLFxuICAgICAgICAgICAgRGF0ZUNsb3VkRmlsdGVyVHlwZS5NT05USCxcbiAgICAgICAgICAgIERhdGVDbG91ZEZpbHRlclR5cGUuUVVBUlRFUixcbiAgICAgICAgICAgIERhdGVDbG91ZEZpbHRlclR5cGUuWUVBUixcbiAgICAgICAgICAgIERhdGVDbG91ZEZpbHRlclR5cGUuUkFOR0VcbiAgICAgICAgXTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNyZWF0ZURlZmF1bHREYXRlT3B0aW9ucygpOiBQcm9jZXNzRmlsdGVyT3B0aW9uc1tdIHtcbiAgICAgICAgcmV0dXJuICBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IERhdGVDbG91ZEZpbHRlclR5cGUuTk9fREFURSxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9DTE9VRF9FRElUX1BST0NFU1NfRklMVEVSLkxBQkVMLkRBVEVfUkFOR0UuTk9fREFURSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IERhdGVDbG91ZEZpbHRlclR5cGUuVE9EQVksXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfQ0xPVURfRURJVF9QUk9DRVNTX0ZJTFRFUi5MQUJFTC5EQVRFX1JBTkdFLlRPREFZJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogRGF0ZUNsb3VkRmlsdGVyVHlwZS5UT01PUlJPVyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9DTE9VRF9FRElUX1BST0NFU1NfRklMVEVSLkxBQkVMLkRBVEVfUkFOR0UuVE9NT1JST1cnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBEYXRlQ2xvdWRGaWx0ZXJUeXBlLk5FWFRfN19EQVlTLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX0NMT1VEX0VESVRfUFJPQ0VTU19GSUxURVIuTEFCRUwuREFURV9SQU5HRS5ORVhUXzdfREFZUydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IERhdGVDbG91ZEZpbHRlclR5cGUuV0VFSyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9DTE9VRF9FRElUX1BST0NFU1NfRklMVEVSLkxBQkVMLkRBVEVfUkFOR0UuV0VFSydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IERhdGVDbG91ZEZpbHRlclR5cGUuTU9OVEgsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfQ0xPVURfRURJVF9QUk9DRVNTX0ZJTFRFUi5MQUJFTC5EQVRFX1JBTkdFLk1PTlRIJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogRGF0ZUNsb3VkRmlsdGVyVHlwZS5RVUFSVEVSLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX0NMT1VEX0VESVRfUFJPQ0VTU19GSUxURVIuTEFCRUwuREFURV9SQU5HRS5RVUFSVEVSJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogRGF0ZUNsb3VkRmlsdGVyVHlwZS5ZRUFSLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX0NMT1VEX0VESVRfUFJPQ0VTU19GSUxURVIuTEFCRUwuREFURV9SQU5HRS5ZRUFSJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogRGF0ZUNsb3VkRmlsdGVyVHlwZS5SQU5HRSxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9DTE9VRF9FRElUX1BST0NFU1NfRklMVEVSLkxBQkVMLkRBVEVfUkFOR0UuUkFOR0UnXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG4gICAgfVxuIH1cbiJdfQ==