/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { __awaiter } from "tslib";
import { Component, EventEmitter, Input, Output, ViewChild, ViewEncapsulation, HostListener } from '@angular/core';
import { StartProcessCloudService } from '../services/start-process-cloud.service';
import { FormControl, Validators, FormBuilder } from '@angular/forms';
import { MatAutocompleteTrigger } from '@angular/material/autocomplete';
import { ProcessPayloadCloud } from '../models/process-payload-cloud.model';
import { debounceTime, takeUntil, switchMap, filter, distinctUntilChanged, tap } from 'rxjs/operators';
import { ProcessDefinitionCloud } from '../../../models/process-definition-cloud.model';
import { Subject } from 'rxjs';
import { ProcessNameCloudPipe } from '../../../pipes/process-name-cloud.pipe';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../services/start-process-cloud.service';
import * as ɵngcc2 from '@angular/forms';
import * as ɵngcc3 from '../../../pipes/process-name-cloud.pipe';
import * as ɵngcc4 from '@angular/material/card';
import * as ɵngcc5 from '@angular/common';
import * as ɵngcc6 from '@angular/material/form-field';
import * as ɵngcc7 from '@angular/material/input';
import * as ɵngcc8 from '@angular/material/autocomplete';
import * as ɵngcc9 from '@angular/material/core';
import * as ɵngcc10 from '@angular/material/button';
import * as ɵngcc11 from '@angular/material/icon';
import * as ɵngcc12 from '../../../form/components/form-cloud.component';
import * as ɵngcc13 from '../../../form/components/form-cloud-custom-outcomes.component';
import * as ɵngcc14 from '@angular/flex-layout/flex';
import * as ɵngcc15 from '@ngx-translate/core';

function StartProcessCloudComponent_mat_card_subtitle_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "mat-card-subtitle", 6);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 1, ctx_r0.errorMessageId), " ");
} }
function StartProcessCloudComponent_div_6_mat_option_11_Template(rf, ctx) { if (rf & 1) {
    const _r17 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "mat-option", 21);
    ɵngcc0.ɵɵlistener("click", function StartProcessCloudComponent_div_6_mat_option_11_Template_mat_option_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r17); const processDef_r15 = ctx.$implicit; const ctx_r16 = ɵngcc0.ɵɵnextContext(2); return ctx_r16.processDefinitionSelectionChanged(processDef_r15); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const processDef_r15 = ctx.$implicit;
    const ctx_r8 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("value", ctx_r8.getProcessDefinitionValue(processDef_r15));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ctx_r8.getProcessDefinitionValue(processDef_r15), " ");
} }
function StartProcessCloudComponent_div_6_button_12_Template(rf, ctx) { if (rf & 1) {
    const _r19 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 22);
    ɵngcc0.ɵɵlistener("click", function StartProcessCloudComponent_div_6_button_12_Template_button_click_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r19); const ctx_r18 = ɵngcc0.ɵɵnextContext(2); return ctx_r18.displayDropdown($event); });
    ɵngcc0.ɵɵelementStart(1, "mat-icon");
    ɵngcc0.ɵɵtext(2, "arrow_drop_down");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} }
function StartProcessCloudComponent_div_6_mat_error_13_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "mat-error", 23);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 1, "ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.ERROR.PROCESS_DEFINITION_REQUIRED"), " ");
} }
function StartProcessCloudComponent_div_6_mat_error_19_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "mat-error", 24);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 1, "ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.ERROR.PROCESS_NAME_REQUIRED"), " ");
} }
const _c0 = function (a0) { return { characters: a0 }; };
function StartProcessCloudComponent_div_6_mat_error_20_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "mat-error", 25);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r12 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind2(2, 1, "ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.ERROR.MAXIMUM_LENGTH", ɵngcc0.ɵɵpureFunction1(4, _c0, ctx_r12.maxNameLength)), " ");
} }
function StartProcessCloudComponent_div_6_mat_error_21_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "mat-error");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 1, "ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.ERROR.SPACE_VALIDATOR"), " ");
} }
function StartProcessCloudComponent_div_6_ng_container_22_ng_template_3_Template(rf, ctx) { }
function StartProcessCloudComponent_div_6_ng_container_22_Template(rf, ctx) { if (rf & 1) {
    const _r22 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelementStart(1, "adf-cloud-form", 26);
    ɵngcc0.ɵɵlistener("formContentClicked", function StartProcessCloudComponent_div_6_ng_container_22_Template_adf_cloud_form_formContentClicked_1_listener($event) { ɵngcc0.ɵɵrestoreView(_r22); const ctx_r21 = ɵngcc0.ɵɵnextContext(2); return ctx_r21.onFormContentClicked($event); })("formLoaded", function StartProcessCloudComponent_div_6_ng_container_22_Template_adf_cloud_form_formLoaded_1_listener($event) { ɵngcc0.ɵɵrestoreView(_r22); const ctx_r23 = ɵngcc0.ɵɵnextContext(2); return ctx_r23.onFormLoaded($event); });
    ɵngcc0.ɵɵelementStart(2, "adf-cloud-form-custom-outcomes");
    ɵngcc0.ɵɵtemplate(3, StartProcessCloudComponent_div_6_ng_container_22_ng_template_3_Template, 0, 0, "ng-template", 27);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r14 = ɵngcc0.ɵɵnextContext(2);
    const _r2 = ɵngcc0.ɵɵreference(8);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("appName", ctx_r14.appName)("appVersion", ctx_r14.processDefinitionCurrent.appVersion)("data", ctx_r14.values)("formId", ctx_r14.processDefinitionCurrent.formKey)("showSaveButton", false)("showCompleteButton", false)("showRefreshButton", false)("showValidationIcon", false)("showTitle", false);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", _r2);
} }
function StartProcessCloudComponent_div_6_Template(rf, ctx) { if (rf & 1) {
    const _r25 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵelementStart(1, "form", 7);
    ɵngcc0.ɵɵelementStart(2, "mat-form-field", 8);
    ɵngcc0.ɵɵelementStart(3, "mat-label");
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(6, "input", 9, 10);
    ɵngcc0.ɵɵelementStart(8, "div", 11);
    ɵngcc0.ɵɵelementStart(9, "mat-autocomplete", 12, 13);
    ɵngcc0.ɵɵlistener("optionSelected", function StartProcessCloudComponent_div_6_Template_mat_autocomplete_optionSelected_9_listener($event) { ɵngcc0.ɵɵrestoreView(_r25); const ctx_r24 = ɵngcc0.ɵɵnextContext(); return ctx_r24.setProcessDefinitionOnForm($event.option.value); });
    ɵngcc0.ɵɵtemplate(11, StartProcessCloudComponent_div_6_mat_option_11_Template, 2, 2, "mat-option", 14);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(12, StartProcessCloudComponent_div_6_button_12_Template, 3, 0, "button", 15);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(13, StartProcessCloudComponent_div_6_mat_error_13_Template, 3, 3, "mat-error", 16);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(14, "mat-form-field", 8);
    ɵngcc0.ɵɵelementStart(15, "mat-label");
    ɵngcc0.ɵɵtext(16);
    ɵngcc0.ɵɵpipe(17, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(18, "input", 17);
    ɵngcc0.ɵɵtemplate(19, StartProcessCloudComponent_div_6_mat_error_19_Template, 3, 3, "mat-error", 18);
    ɵngcc0.ɵɵtemplate(20, StartProcessCloudComponent_div_6_mat_error_20_Template, 3, 6, "mat-error", 19);
    ɵngcc0.ɵɵtemplate(21, StartProcessCloudComponent_div_6_mat_error_21_Template, 3, 3, "mat-error", 20);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(22, StartProcessCloudComponent_div_6_ng_container_22_Template, 4, 10, "ng-container", 3);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const _r7 = ɵngcc0.ɵɵreference(10);
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    const _r2 = ɵngcc0.ɵɵreference(8);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("formGroup", ctx_r1.processForm);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("floatLabel", "always");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(5, 15, "ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.FORM.LABEL.TYPE"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("matAutocomplete", _r7);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("displayWith", ctx_r1.displayProcessNameOnDropdown);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r1.filteredProcesses);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.showSelectProcessDropdown);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.processDefinition.hasError("required"));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("floatLabel", "always");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(17, 17, "ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.FORM.LABEL.NAME"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.processInstanceName.hasError("required"));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.processInstanceName.hasError("maxlength"));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.processInstanceName.hasError("pattern"));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.hasForm())("ngIfElse", _r2);
} }
function StartProcessCloudComponent_ng_template_7_Template(rf, ctx) { if (rf & 1) {
    const _r27 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 28);
    ɵngcc0.ɵɵelementStart(1, "button", 29);
    ɵngcc0.ɵɵlistener("click", function StartProcessCloudComponent_ng_template_7_Template_button_click_1_listener() { ɵngcc0.ɵɵrestoreView(_r27); const ctx_r26 = ɵngcc0.ɵɵnextContext(); return ctx_r26.cancelStartProcess(); });
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "uppercase");
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "button", 30);
    ɵngcc0.ɵɵlistener("click", function StartProcessCloudComponent_ng_template_7_Template_button_click_5_listener() { ɵngcc0.ɵɵrestoreView(_r27); const ctx_r28 = ɵngcc0.ɵɵnextContext(); return ctx_r28.startProcess(); });
    ɵngcc0.ɵɵtext(6);
    ɵngcc0.ɵɵpipe(7, "uppercase");
    ɵngcc0.ɵɵpipe(8, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 3, ɵngcc0.ɵɵpipeBind1(4, 5, "ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.FORM.ACTION.CANCEL")), " ");
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("disabled", ctx_r3.disableStartButton || !ctx_r3.isProcessFormValid());
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(7, 7, ɵngcc0.ɵɵpipeBind1(8, 9, "ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.FORM.ACTION.START")), " ");
} }
function StartProcessCloudComponent_ng_template_9_mat_card_content_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "mat-card-content");
    ɵngcc0.ɵɵelementStart(1, "mat-card-subtitle", 31);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "uppercase");
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 1, ɵngcc0.ɵɵpipeBind1(4, 3, "ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.NO_PROCESS_DEFINITIONS")), " ");
} }
function StartProcessCloudComponent_ng_template_9_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, StartProcessCloudComponent_ng_template_9_mat_card_content_0_Template, 5, 5, "mat-card-content", 20);
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngIf", ctx_r5.processDefinitionLoaded);
} }
export class StartProcessCloudComponent {
    constructor(startProcessCloudService, formBuilder, processNameCloudPipe) {
        this.startProcessCloudService = startProcessCloudService;
        this.formBuilder = formBuilder;
        this.processNameCloudPipe = processNameCloudPipe;
        this.appName = '';
        this.maxNameLength = StartProcessCloudComponent.MAX_NAME_LENGTH;
        this.name = '';
        this.showSelectProcessDropdown = true;
        this.success = new EventEmitter();
        this.cancel = new EventEmitter();
        this.error = new EventEmitter();
        this.formContentClicked = new EventEmitter();
        this.processDefinitionSelection = new EventEmitter();
        this.processDefinitionList = [];
        this.errorMessageId = '';
        this.processPayloadCloud = new ProcessPayloadCloud();
        this.filteredProcesses = [];
        this.isLoading = false;
        this.isFormCloudLoaded = false;
        this.disableStartButton = true;
        this.onDestroy$ = new Subject();
        this.processDefinitionLoaded = false;
    }
    ngOnInit() {
        this.processForm = this.formBuilder.group({
            processInstanceName: new FormControl('', [Validators.required, Validators.maxLength(this.getMaxNameLength()), Validators.pattern('^[^\\s]+(\\s+[^\\s]+)*$')]),
            processDefinition: new FormControl(this.processDefinitionName, [Validators.required, this.processDefinitionNameValidator()])
        });
        this.processDefinition.valueChanges
            .pipe(debounceTime(StartProcessCloudComponent.PROCESS_DEFINITION_DEBOUNCE))
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((processDefinitionName) => {
            this.selectProcessDefinitionByProcesDefinitionName(processDefinitionName);
        });
        this.processForm.valueChanges
            .pipe(debounceTime(StartProcessCloudComponent.PROCESS_FORM_DEBOUNCE), tap(() => this.disableStartButton = true), distinctUntilChanged(), filter(() => this.isProcessSelectionValid()), switchMap(() => this.generateProcessInstance())).pipe(takeUntil(this.onDestroy$))
            .subscribe((res) => {
            this.currentCreatedProcess = res;
            this.disableStartButton = false;
        });
        if (this.processDefinitionName) {
            this.processDefinition.setValue(this.processDefinitionName);
            this.processDefinition.markAsDirty();
            this.processDefinition.markAsTouched();
        }
    }
    ngOnChanges(changes) {
        if (changes['appName'] && changes['appName'].currentValue !== changes['appName'].previousValue) {
            this.appName = changes['appName'].currentValue;
            if (this.appName || this.appName === '') {
                this.loadProcessDefinitions();
            }
        }
    }
    onKeyDown(event) {
        event.cancelBubble = true;
    }
    hasForm() {
        return this.processDefinitionCurrent && !!this.processDefinitionCurrent.formKey;
    }
    onFormLoaded(form) {
        this.isFormCloudLoaded = true;
        this.formCloud = form;
    }
    isProcessSelectionValid() {
        return this.processForm.valid && this.isProcessPayloadValid();
    }
    getMaxNameLength() {
        return this.maxNameLength > StartProcessCloudComponent.MAX_NAME_LENGTH ?
            StartProcessCloudComponent.MAX_NAME_LENGTH : this.maxNameLength;
    }
    generateProcessInstance() {
        const createPayload = new ProcessPayloadCloud({
            name: this.processInstanceName.value,
            processDefinitionKey: this.processPayloadCloud.processDefinitionKey
        });
        if (this.currentCreatedProcess && this.processPayloadCloud.processDefinitionKey === this.currentCreatedProcess.processDefinitionKey) {
            return this.startProcessCloudService.updateProcess(this.appName, this.currentCreatedProcess.id, createPayload);
        }
        else {
            return this.startProcessCloudService.createProcess(this.appName, createPayload);
        }
    }
    selectProcessDefinitionByProcesDefinitionName(processDefinitionName) {
        this.filteredProcesses = this.getProcessDefinitionListByNameOrKey(processDefinitionName);
        if (this.isProcessFormValid() &&
            this.filteredProcesses && this.filteredProcesses.length === 1) {
            this.setProcessDefinitionOnForm(this.filteredProcesses[0].name);
        }
    }
    setProcessDefinitionOnForm(selectedProcessDefinitionName) {
        this.processDefinitionCurrent = this.filteredProcesses.find((process) => process.name === selectedProcessDefinitionName || process.key === selectedProcessDefinitionName);
        this.isFormCloudLoaded = false;
        this.processPayloadCloud.processDefinitionKey = this.processDefinitionCurrent.key;
    }
    getProcessDefinitionListByNameOrKey(processDefinitionName) {
        return this.processDefinitionList.filter((processDefinitionCloud) => {
            return !processDefinitionName || this.getProcessDefinition(processDefinitionCloud, processDefinitionName);
        });
    }
    getProcessIfExists(processDefinition) {
        let matchedProcess = this.processDefinitionList.find((option) => this.getProcessDefinition(option, processDefinition));
        if (!matchedProcess) {
            matchedProcess = new ProcessDefinitionCloud();
        }
        return matchedProcess;
    }
    getProcessDefinitionByName(processDefinitionName) {
        const matchedProcess = processDefinitionName ? this.getProcessIfExists(processDefinitionName) : this.processDefinitionList[0];
        return matchedProcess;
    }
    selectDefaultProcessDefinition() {
        const selectedProcess = this.getProcessDefinitionByName(this.processDefinitionName);
        if (selectedProcess) {
            this.processDefinition.setValue(selectedProcess.name);
            this.processDefinitionSelectionChanged(selectedProcess);
        }
    }
    loadProcessDefinitions() {
        this.resetErrorMessage();
        this.startProcessCloudService.getProcessDefinitions(this.appName)
            .pipe(tap(() => this.processDefinitionLoaded = true), takeUntil(this.onDestroy$))
            .subscribe((processDefinitionRepresentations) => {
            this.processDefinitionList = processDefinitionRepresentations;
            if (processDefinitionRepresentations.length === 1) {
                this.selectDefaultProcessDefinition();
            }
            else if (this.processDefinitionName) {
                this.processDefinition.setValue(this.processDefinitionName);
            }
        }, () => {
            this.errorMessageId = 'ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.ERROR.LOAD_PROCESS_DEFS';
        });
    }
    isValidName(name) {
        return !!name;
    }
    isProcessFormValid() {
        if (this.hasForm() && this.isFormCloudLoaded) {
            return this.formCloud.isValid || this.isLoading;
        }
        else {
            return this.processForm.valid || this.isLoading;
        }
    }
    isProcessPayloadValid() {
        return !!this.processPayloadCloud.processDefinitionKey;
    }
    getProcessDefinition(processDefinitionCloud, processDefinitionName) {
        return (this.isValidName(processDefinitionCloud.name) && processDefinitionCloud.name.toLowerCase().includes(processDefinitionName.toLowerCase())) ||
            (processDefinitionCloud.key && processDefinitionCloud.key.toLowerCase().includes(processDefinitionName.toLowerCase()));
    }
    isProcessDefinitionsEmpty() {
        return this.processDefinitionList.length === 0;
    }
    buildProcessCloudPayload() {
        this.processPayloadCloud.name = this.processInstanceName.value;
        if (this.variables) {
            this.processPayloadCloud.variables = this.variables;
        }
        if (this.hasForm()) {
            this.processPayloadCloud.variables = Object.assign(this.processPayloadCloud.variables, this.formCloud.values);
        }
    }
    startProcess() {
        this.isLoading = true;
        this.buildProcessCloudPayload();
        this.startProcessCloudService.startCreatedProcess(this.appName, this.currentCreatedProcess.id, this.processPayloadCloud)
            .subscribe((res) => {
            this.success.emit(res);
            this.isLoading = false;
        }, (err) => {
            this.errorMessageId = 'ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.ERROR.START';
            this.error.emit(err);
            this.isLoading = false;
        });
    }
    cancelStartProcess() {
        return __awaiter(this, void 0, void 0, function* () {
            if (this.currentCreatedProcess) {
                yield this.startProcessCloudService.deleteProcess(this.appName, this.currentCreatedProcess.id);
            }
            this.currentCreatedProcess = null;
            this.cancel.emit();
        });
    }
    resetErrorMessage() {
        this.errorMessageId = '';
    }
    resetProcessDefinitionList() {
        this.processDefinition.setValue('');
        this.filteredProcesses = this.processDefinitionList;
    }
    displayProcessNameOnDropdown(process) {
        if (process) {
            let processName = process;
            if (typeof process !== 'string') {
                processName = process.name;
            }
            return processName;
        }
    }
    displayDropdown(event) {
        event.stopPropagation();
        if (!this.inputAutocomplete.panelOpen) {
            this.resetProcessDefinitionList();
            this.inputAutocomplete.openPanel();
        }
        else {
            this.inputAutocomplete.closePanel();
        }
    }
    processDefinitionNameValidator() {
        return (control) => {
            const processDefinitionFieldValue = control.value;
            let processDefinitionNameError = false;
            if (processDefinitionFieldValue) {
                const processDefinition = this.getProcessIfExists(processDefinitionFieldValue);
                if (!processDefinition.key) {
                    processDefinitionNameError = true;
                }
            }
            return processDefinitionNameError ? { 'invalid name': true } : null;
        };
    }
    getProcessDefinitionValue(process) {
        return !!process.name ? process.name : process.key;
    }
    get processInstanceName() {
        return this.processForm.get('processInstanceName');
    }
    get processDefinition() {
        return this.processForm.get('processDefinition');
    }
    onFormContentClicked(content) {
        this.formContentClicked.emit(content);
    }
    processDefinitionSelectionChanged(processDefinition) {
        if (processDefinition) {
            const processInstanceDetails = { processDefinitionName: processDefinition.name };
            const defaultProcessName = this.processNameCloudPipe.transform(this.name, processInstanceDetails);
            this.processInstanceName.setValue(defaultProcessName);
            this.processInstanceName.markAsDirty();
            this.processInstanceName.markAsTouched();
            this.processDefinitionSelection.emit(processDefinition);
        }
    }
    ngOnDestroy() {
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
}
StartProcessCloudComponent.ɵfac = function StartProcessCloudComponent_Factory(t) { return new (t || StartProcessCloudComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.StartProcessCloudService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.FormBuilder), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.ProcessNameCloudPipe)); };
StartProcessCloudComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: StartProcessCloudComponent, selectors: [["adf-cloud-start-process"]], viewQuery: function StartProcessCloudComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(MatAutocompleteTrigger, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.inputAutocomplete = _t.first);
    } }, hostBindings: function StartProcessCloudComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("keydown", function StartProcessCloudComponent_keydown_HostBindingHandler($event) { return ctx.onKeyDown($event); });
    } }, inputs: { appName: "appName", maxNameLength: "maxNameLength", name: "name", showSelectProcessDropdown: "showSelectProcessDropdown", processDefinitionName: "processDefinitionName", variables: "variables", values: "values" }, outputs: { success: "success", cancel: "cancel", error: "error", formContentClicked: "formContentClicked", processDefinitionSelection: "processDefinitionSelection" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 11, vars: 6, consts: [[1, "adf-start-process"], [1, "adf-title"], ["id", "error-message", 4, "ngIf"], [4, "ngIf", "ngIfElse"], ["taskFormCloudButtons", ""], ["emptyProcessDefinitionsList", ""], ["id", "error-message"], [3, "formGroup"], [1, "adf-process-input-container", 3, "floatLabel"], ["matInput", "", "formControlName", "processDefinition", "id", "processDefinitionName", 3, "matAutocomplete"], ["inputAutocomplete", ""], [1, "adf-process-input-autocomplete"], ["id", "processDefinitionOptions", 3, "displayWith", "optionSelected"], ["auto", "matAutocomplete"], [3, "value", "click", 4, "ngFor", "ngForOf"], ["id", "adf-select-process-dropdown", "mat-icon-button", "", 3, "click", 4, "ngIf"], ["class", "adf-error-pb", 4, "ngIf"], ["matInput", "", "formControlName", "processInstanceName", "id", "processName"], ["id", "adf-start-process-required-error", 4, "ngIf"], ["id", "adf-start-process-maxlength-error", 4, "ngIf"], [4, "ngIf"], [3, "value", "click"], ["id", "adf-select-process-dropdown", "mat-icon-button", "", 3, "click"], [1, "adf-error-pb"], ["id", "adf-start-process-required-error"], ["id", "adf-start-process-maxlength-error"], [3, "appName", "appVersion", "data", "formId", "showSaveButton", "showCompleteButton", "showRefreshButton", "showValidationIcon", "showTitle", "formContentClicked", "formLoaded"], [3, "ngTemplateOutlet"], ["fxLayout", "row", "fxLayoutAlign", "end end"], ["mat-button", "", "id", "cancel_process", 3, "click"], ["color", "primary", "mat-button", "", "data-automation-id", "btn-start", "id", "button-start", 1, "btn-start", 3, "disabled", "click"], ["id", "no-process-message", 1, "error-message"]], template: function StartProcessCloudComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "mat-card", 0);
        ɵngcc0.ɵɵelementStart(1, "mat-card-title", 1);
        ɵngcc0.ɵɵtext(2);
        ɵngcc0.ɵɵpipe(3, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(4, "mat-card-content");
        ɵngcc0.ɵɵtemplate(5, StartProcessCloudComponent_mat_card_subtitle_5_Template, 3, 3, "mat-card-subtitle", 2);
        ɵngcc0.ɵɵtemplate(6, StartProcessCloudComponent_div_6_Template, 23, 19, "div", 3);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(7, StartProcessCloudComponent_ng_template_7_Template, 9, 11, "ng-template", null, 4, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵtemplate(9, StartProcessCloudComponent_ng_template_9_Template, 1, 1, "ng-template", null, 5, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        const _r4 = ɵngcc0.ɵɵreference(10);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate1("", ɵngcc0.ɵɵpipeBind1(3, 4, "ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.FORM.TITLE"), " ");
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngIf", ctx.errorMessageId);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.isProcessDefinitionsEmpty())("ngIfElse", _r4);
    } }, directives: [ɵngcc4.MatCard, ɵngcc4.MatCardTitle, ɵngcc4.MatCardContent, ɵngcc5.NgIf, ɵngcc4.MatCardSubtitle, ɵngcc2.ɵangular_packages_forms_forms_y, ɵngcc2.NgControlStatusGroup, ɵngcc2.FormGroupDirective, ɵngcc6.MatFormField, ɵngcc6.MatLabel, ɵngcc7.MatInput, ɵngcc2.DefaultValueAccessor, ɵngcc8.MatAutocompleteTrigger, ɵngcc2.NgControlStatus, ɵngcc2.FormControlName, ɵngcc8.MatAutocomplete, ɵngcc5.NgForOf, ɵngcc9.MatOption, ɵngcc10.MatButton, ɵngcc11.MatIcon, ɵngcc6.MatError, ɵngcc12.FormCloudComponent, ɵngcc13.FormCustomOutcomesComponent, ɵngcc5.NgTemplateOutlet, ɵngcc14.DefaultLayoutDirective, ɵngcc14.DefaultLayoutAlignDirective], pipes: [ɵngcc15.TranslatePipe, ɵngcc5.UpperCasePipe], styles: [".adf-start-process mat-form-field{width:100%}.adf-start-process .mat-form-field-label{color:var(--theme-colors-mat-grey-dark)}.adf-start-process mat-card-actions{text-align:right}.adf-start-process mat-card-actions .mat-button{text-transform:uppercase!important}.adf-title{padding-bottom:1.25em}.adf-process-input-container mat-form-field{width:100%}.adf-process-input-autocomplete{display:flex}.adf-process-input-autocomplete button{position:absolute;right:-14px;top:0}.adf-start-form-container .mat-card{box-shadow:none!important;padding:0!important}.adf-start-form-actions{text-align:right!important}"], encapsulation: 2 });
StartProcessCloudComponent.MAX_NAME_LENGTH = 255;
StartProcessCloudComponent.PROCESS_DEFINITION_DEBOUNCE = 300;
StartProcessCloudComponent.PROCESS_FORM_DEBOUNCE = 400;
StartProcessCloudComponent.ctorParameters = () => [
    { type: StartProcessCloudService },
    { type: FormBuilder },
    { type: ProcessNameCloudPipe }
];
StartProcessCloudComponent.propDecorators = {
    inputAutocomplete: [{ type: ViewChild, args: [MatAutocompleteTrigger,] }],
    appName: [{ type: Input }],
    maxNameLength: [{ type: Input }],
    name: [{ type: Input }],
    processDefinitionName: [{ type: Input }],
    variables: [{ type: Input }],
    values: [{ type: Input }],
    showSelectProcessDropdown: [{ type: Input }],
    success: [{ type: Output }],
    cancel: [{ type: Output }],
    error: [{ type: Output }],
    formContentClicked: [{ type: Output }],
    processDefinitionSelection: [{ type: Output }],
    onKeyDown: [{ type: HostListener, args: ['keydown', ['$event'],] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(StartProcessCloudComponent, [{
        type: Component,
        args: [{
                selector: 'adf-cloud-start-process',
                template: "<mat-card class=\"adf-start-process\">\n\n    <mat-card-title class=\"adf-title\">{{'ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.FORM.TITLE' | translate}}\n    </mat-card-title>\n\n    <mat-card-content>\n        <mat-card-subtitle id=\"error-message\" *ngIf=\"errorMessageId\">\n            {{ errorMessageId | translate }}\n        </mat-card-subtitle>\n\n        <div *ngIf=\"!isProcessDefinitionsEmpty(); else emptyProcessDefinitionsList\">\n            <form [formGroup]=\"processForm\">\n                <mat-form-field class=\"adf-process-input-container\"  [floatLabel]=\"'always'\">\n                    <mat-label>{{ 'ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.FORM.LABEL.TYPE' | translate }}</mat-label>\n                    <input\n                        #inputAutocomplete\n                        matInput\n                        formControlName=\"processDefinition\"\n                        [matAutocomplete]=\"auto\"\n                        id=\"processDefinitionName\">\n                    <div class=\"adf-process-input-autocomplete\">\n                        <mat-autocomplete #auto=\"matAutocomplete\" id=\"processDefinitionOptions\" [displayWith]=\"displayProcessNameOnDropdown\" (optionSelected)=\"setProcessDefinitionOnForm($event.option.value)\" >\n                            <mat-option *ngFor=\"let processDef of filteredProcesses\" [value]=\"getProcessDefinitionValue(processDef)\"\n                                        (click)=\"processDefinitionSelectionChanged(processDef)\">\n                                {{ getProcessDefinitionValue(processDef) }}\n                            </mat-option>\n                        </mat-autocomplete>\n                        <button id=\"adf-select-process-dropdown\" *ngIf=\"showSelectProcessDropdown\" mat-icon-button (click)=\"displayDropdown($event)\">\n                            <mat-icon>arrow_drop_down</mat-icon>\n                        </button>\n                    </div>\n                    <mat-error *ngIf=\"processDefinition.hasError('required')\" class=\"adf-error-pb\">\n                            {{ 'ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.ERROR.PROCESS_DEFINITION_REQUIRED' | translate }}\n                        </mat-error>\n                </mat-form-field>\n\n                <mat-form-field class=\"adf-process-input-container\"  [floatLabel]=\"'always'\">\n                    <mat-label>{{ 'ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.FORM.LABEL.NAME' | translate }}</mat-label>\n                    <input\n                        matInput\n                        formControlName=\"processInstanceName\"\n                        id=\"processName\">\n                    <mat-error id=\"adf-start-process-required-error\" *ngIf=\"processInstanceName.hasError('required')\">\n                        {{ 'ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.ERROR.PROCESS_NAME_REQUIRED' | translate }}\n                    </mat-error>\n                    <mat-error id=\"adf-start-process-maxlength-error\" *ngIf=\"processInstanceName.hasError('maxlength')\">\n                        {{ 'ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.ERROR.MAXIMUM_LENGTH' | translate : { characters : maxNameLength } }}\n                    </mat-error>\n                    <mat-error *ngIf=\"processInstanceName.hasError('pattern')\">\n                        {{ 'ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.ERROR.SPACE_VALIDATOR' | translate }}\n                    </mat-error>\n                </mat-form-field>\n            </form>\n\n            <ng-container *ngIf=\"hasForm() else taskFormCloudButtons\">\n                <adf-cloud-form\n                    [appName]=\"appName\"\n                    [appVersion]=\"processDefinitionCurrent.appVersion\"\n                    [data]=\"values\"\n                    [formId]=\"processDefinitionCurrent.formKey\"\n                    [showSaveButton]=\"false\"\n                    [showCompleteButton]=\"false\"\n                    [showRefreshButton]=\"false\"\n                    [showValidationIcon]=\"false\"\n                    [showTitle]=\"false\"\n                    (formContentClicked)=\"onFormContentClicked($event)\"\n                    (formLoaded)=\"onFormLoaded($event)\">\n                    <adf-cloud-form-custom-outcomes>\n                        <ng-template [ngTemplateOutlet]=\"taskFormCloudButtons\">\n                        </ng-template>\n                    </adf-cloud-form-custom-outcomes>\n                </adf-cloud-form>\n            </ng-container>\n        </div>\n\n    </mat-card-content>\n\n    <ng-template #taskFormCloudButtons>\n        <div fxLayout=\"row\" fxLayoutAlign=\"end end\">\n            <button mat-button (click)=\"cancelStartProcess()\" id=\"cancel_process\">\n                {{ 'ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.FORM.ACTION.CANCEL' | translate | uppercase}}\n            </button>\n            <button color=\"primary\" mat-button [disabled]=\"disableStartButton || !isProcessFormValid()\" (click)=\"startProcess()\"\n                data-automation-id=\"btn-start\" id=\"button-start\" class=\"btn-start\">\n                {{'ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.FORM.ACTION.START' | translate | uppercase}}\n            </button>\n        </div>\n    </ng-template>\n\n    <ng-template #emptyProcessDefinitionsList>\n        <mat-card-content *ngIf=\"processDefinitionLoaded\">\n            <mat-card-subtitle class=\"error-message\" id=\"no-process-message\">\n                {{ 'ADF_CLOUD_PROCESS_LIST.ADF_CLOUD_START_PROCESS.NO_PROCESS_DEFINITIONS' | translate | uppercase}}\n            </mat-card-subtitle>\n        </mat-card-content>\n    </ng-template>\n</mat-card>\n",
                encapsulation: ViewEncapsulation.None,
                styles: [".adf-start-process mat-form-field{width:100%}.adf-start-process .mat-form-field-label{color:var(--theme-colors-mat-grey-dark)}.adf-start-process mat-card-actions{text-align:right}.adf-start-process mat-card-actions .mat-button{text-transform:uppercase!important}.adf-title{padding-bottom:1.25em}.adf-process-input-container mat-form-field{width:100%}.adf-process-input-autocomplete{display:flex}.adf-process-input-autocomplete button{position:absolute;right:-14px;top:0}.adf-start-form-container .mat-card{box-shadow:none!important;padding:0!important}.adf-start-form-actions{text-align:right!important}"]
            }]
    }], function () { return [{ type: ɵngcc1.StartProcessCloudService }, { type: ɵngcc2.FormBuilder }, { type: ɵngcc3.ProcessNameCloudPipe }]; }, { appName: [{
            type: Input
        }], maxNameLength: [{
            type: Input
        }], name: [{
            type: Input
        }], showSelectProcessDropdown: [{
            type: Input
        }], success: [{
            type: Output
        }], cancel: [{
            type: Output
        }], error: [{
            type: Output
        }], formContentClicked: [{
            type: Output
        }], processDefinitionSelection: [{
            type: Output
        }], onKeyDown: [{
            type: HostListener,
            args: ['keydown', ['$event']]
        }], inputAutocomplete: [{
            type: ViewChild,
            args: [MatAutocompleteTrigger]
        }], processDefinitionName: [{
            type: Input
        }], variables: [{
            type: Input
        }], values: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhcnQtcHJvY2Vzcy1jbG91ZC5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9wcm9jZXNzLXNlcnZpY2VzLWNsb3VkL3NyYy9saWIvcHJvY2Vzcy9zdGFydC1wcm9jZXNzL2NvbXBvbmVudHMvc3RhcnQtcHJvY2Vzcy1jbG91ZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsT0FBTyxFQUNILFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUM5QixNQUFNLEVBQWlCLFNBQVMsRUFBRSxpQkFBaUIsRUFBYSxZQUFZLEVBQy9FLE1BQU0sZUFBZSxDQUFDO0FBR3ZCLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBQ25GLE9BQU8sRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUE4QixXQUFXLEVBQWUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUvRyxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUN4RSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUM1RSxPQUFPLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLG9CQUFvQixFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3ZHLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLGdEQUFnRCxDQUFDO0FBQ3hGLE9BQU8sRUFBRSxPQUFPLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFFM0MsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBTzlFLE1BQU0sT0FBTywwQkFBMEI7QUFBRyxJQXdFdEMsWUFBb0Isd0JBQWtELEVBQ2xELFdBQXdCLEVBQ3hCLG9CQUEwQztBQUNsRSxRQUh3Qiw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQTBCO0FBQUMsUUFDbkQsZ0JBQVcsR0FBWCxXQUFXLENBQWE7QUFBQyxRQUN6Qix5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCO0FBQUMsUUEvRC9ELFlBQU8sR0FBVyxFQUFFLENBQUM7QUFDekIsUUFHSSxrQkFBYSxHQUFXLDBCQUEwQixDQUFDLGVBQWUsQ0FBQztBQUN2RSxRQUdJLFNBQUksR0FBVyxFQUFFLENBQUM7QUFDdEIsUUFlSSw4QkFBeUIsR0FBWSxJQUFJLENBQUM7QUFDOUMsUUFHSSxZQUFPLEdBQUcsSUFBSSxZQUFZLEVBQXdCLENBQUM7QUFDdkQsUUFHSSxXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQXdCLENBQUM7QUFDdEQsUUFHSSxVQUFLLEdBQUcsSUFBSSxZQUFZLEVBQXdCLENBQUM7QUFDckQsUUFHSSx1QkFBa0IsR0FBbUMsSUFBSSxZQUFZLEVBQUUsQ0FBQztBQUM1RSxRQUdJLCtCQUEwQixHQUF5QyxJQUFJLFlBQVksRUFBMEIsQ0FBQztBQUNsSCxRQUNJLDBCQUFxQixHQUE2QixFQUFFLENBQUM7QUFDekQsUUFDSSxtQkFBYyxHQUFXLEVBQUUsQ0FBQztBQUNoQyxRQUNJLHdCQUFtQixHQUFHLElBQUksbUJBQW1CLEVBQUUsQ0FBQztBQUNwRCxRQUFJLHNCQUFpQixHQUE2QixFQUFFLENBQUM7QUFDckQsUUFBSSxjQUFTLEdBQUcsS0FBSyxDQUFDO0FBQ3RCLFFBQUksc0JBQWlCLEdBQUcsS0FBSyxDQUFDO0FBQzlCLFFBRUksdUJBQWtCLEdBQVksSUFBSSxDQUFDO0FBQ3ZDLFFBQ2MsZUFBVSxHQUFHLElBQUksT0FBTyxFQUFXLENBQUM7QUFDbEQsUUFBSSw0QkFBdUIsR0FBRyxLQUFLLENBQUM7QUFDcEMsSUFJSSxDQUFDO0FBQ0wsSUFDSSxRQUFRO0FBQ1osUUFBUSxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDO0FBQ2xELFlBQVksbUJBQW1CLEVBQUUsSUFBSSxXQUFXLENBQUMsRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEVBQUUsVUFBVSxDQUFDLE9BQU8sQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUM7QUFDekssWUFBWSxpQkFBaUIsRUFBRSxJQUFJLFdBQVcsQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyw4QkFBOEIsRUFBRSxDQUFDLENBQUM7QUFDeEksU0FBUyxDQUFDLENBQUM7QUFDWCxRQUNRLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZO0FBQzNDLGFBQWEsSUFBSSxDQUFDLFlBQVksQ0FBQywwQkFBMEIsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0FBQ3ZGLGFBQWEsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDN0MsYUFBYSxTQUFTLENBQUMsQ0FBQyxxQkFBcUIsRUFBRSxFQUFFO0FBQ2pELFlBQWdCLElBQUksQ0FBQyw2Q0FBNkMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQzFGLFFBQVksQ0FBQyxDQUFDLENBQUM7QUFDZixRQUNRLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWTtBQUNyQyxhQUFhLElBQUksQ0FDRCxZQUFZLENBQUMsMEJBQTBCLENBQUMscUJBQXFCLENBQUMsRUFDOUQsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsRUFDekMsb0JBQW9CLEVBQUUsRUFDdEIsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxDQUFDLEVBQzVDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQyxDQUNsRCxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQzlDLGFBQWEsU0FBUyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7QUFDL0IsWUFBZ0IsSUFBSSxDQUFDLHFCQUFxQixHQUFHLEdBQUcsQ0FBQztBQUNqRCxZQUFnQixJQUFJLENBQUMsa0JBQWtCLEdBQUcsS0FBSyxDQUFDO0FBQ2hELFFBQVksQ0FBQyxDQUFDLENBQUM7QUFDZixRQUNRLElBQUksSUFBSSxDQUFDLHFCQUFxQixFQUFFO0FBQ3hDLFlBQVksSUFBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUN4RSxZQUFZLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQztBQUNqRCxZQUFZLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxhQUFhLEVBQUUsQ0FBQztBQUNuRCxTQUFTO0FBQ1QsSUFBSSxDQUFDO0FBQ0wsSUFDSSxXQUFXLENBQUMsT0FBc0I7QUFDdEMsUUFBUSxJQUFJLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsWUFBWSxLQUFLLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxhQUFhLEVBQUU7QUFDeEcsWUFBWSxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxZQUFZLENBQUM7QUFDM0QsWUFDWSxJQUFJLElBQUksQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLE9BQU8sS0FBSyxFQUFFLEVBQUU7QUFDckQsZ0JBQWdCLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO0FBQzlDLGFBQWE7QUFDYixTQUFTO0FBQ1QsSUFBSSxDQUFDO0FBQ0wsSUFFSSxTQUFTLENBQUMsS0FBb0I7QUFDbEMsUUFBUSxLQUFLLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztBQUNsQyxJQUFJLENBQUM7QUFDTCxJQUNJLE9BQU87QUFBSyxRQUNSLE9BQU8sSUFBSSxDQUFDLHdCQUF3QixJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsT0FBTyxDQUFDO0FBQ3hGLElBQUksQ0FBQztBQUNMLElBQ0ksWUFBWSxDQUFDLElBQWU7QUFDaEMsUUFBUSxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDO0FBQ3RDLFFBQVEsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7QUFDOUIsSUFBSSxDQUFDO0FBQ0wsSUFDWSx1QkFBdUI7QUFBSyxRQUNoQyxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0FBQ3RFLElBQUksQ0FBQztBQUNMLElBQ1ksZ0JBQWdCO0FBQUssUUFDekIsT0FBTyxJQUFJLENBQUMsYUFBYSxHQUFHLDBCQUEwQixDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQ2hGLFlBQVksMEJBQTBCLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDO0FBQzVFLElBQUksQ0FBQztBQUNMLElBQ1ksdUJBQXVCO0FBQUssUUFDaEMsTUFBTSxhQUFhLEdBQXdCLElBQUksbUJBQW1CLENBQUM7QUFDM0UsWUFBWSxJQUFJLEVBQUUsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUs7QUFDaEQsWUFBWSxvQkFBb0IsRUFBRSxJQUFJLENBQUMsbUJBQW1CLENBQUMsb0JBQW9CO0FBQy9FLFNBQVMsQ0FBQyxDQUFDO0FBQ1gsUUFDUSxJQUFJLElBQUksQ0FBQyxxQkFBcUIsSUFBSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsb0JBQW9CLEtBQUssSUFBSSxDQUFDLHFCQUFxQixDQUFDLG9CQUFvQixFQUFFO0FBQzdJLFlBQVksT0FBTyxJQUFJLENBQUMsd0JBQXdCLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixDQUFDLEVBQUUsRUFBRSxhQUFhLENBQUMsQ0FBQztBQUMzSCxTQUFTO0FBQUMsYUFBSztBQUNmLFlBQVksT0FBTyxJQUFJLENBQUMsd0JBQXdCLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsYUFBYSxDQUFDLENBQUM7QUFDNUYsU0FBUztBQUNULElBQUksQ0FBQztBQUNMLElBQ1ksNkNBQTZDLENBQUMscUJBQTZCO0FBQUksUUFDbkYsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxtQ0FBbUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQ2pHLFFBQVEsSUFBSSxJQUFJLENBQUMsa0JBQWtCLEVBQUU7QUFDckMsWUFBWSxJQUFJLENBQUMsaUJBQWlCLElBQUksSUFBSSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7QUFDM0UsWUFBWSxJQUFJLENBQUMsMEJBQTBCLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzVFLFNBQVM7QUFDVCxJQUFJLENBQUM7QUFDTCxJQUNJLDBCQUEwQixDQUFDLDZCQUFxQztBQUNwRSxRQUFRLElBQUksQ0FBQyx3QkFBd0IsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBK0IsRUFBRSxFQUFFLENBQzVGLE9BQU8sQ0FBQyxJQUFJLEtBQUssNkJBQTZCLElBQUksT0FBTyxDQUFDLEdBQUcsS0FBSyw2QkFBNkIsQ0FBQyxDQUFDO0FBQzdHLFFBQ1EsSUFBSSxDQUFDLGlCQUFpQixHQUFHLEtBQUssQ0FBQztBQUN2QyxRQUFRLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUMsd0JBQXdCLENBQUMsR0FBRyxDQUFDO0FBQzFGLElBQUksQ0FBQztBQUNMLElBQ1ksbUNBQW1DLENBQUMscUJBQTZCO0FBQUksUUFDekUsT0FBTyxJQUFJLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDLENBQUMsc0JBQXNCLEVBQUUsRUFBRTtBQUM1RSxZQUFZLE9BQU8sQ0FBQyxxQkFBcUIsSUFBSSxJQUFJLENBQUMsb0JBQW9CLENBQUMsc0JBQXNCLEVBQUUscUJBQXFCLENBQUMsQ0FBQztBQUN0SCxRQUFRLENBQUMsQ0FBQyxDQUFDO0FBQ1gsSUFBSSxDQUFDO0FBQ0wsSUFDWSxrQkFBa0IsQ0FBQyxpQkFBeUI7QUFBSSxRQUNwRCxJQUFJLGNBQWMsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsTUFBTSxFQUFFLGlCQUFpQixDQUFDLENBQUMsQ0FBQztBQUMvSCxRQUFRLElBQUksQ0FBQyxjQUFjLEVBQUU7QUFDN0IsWUFBWSxjQUFjLEdBQUcsSUFBSSxzQkFBc0IsRUFBRSxDQUFDO0FBQzFELFNBQVM7QUFDVCxRQUNRLE9BQU8sY0FBYyxDQUFDO0FBQzlCLElBQUksQ0FBQztBQUNMLElBQ1ksMEJBQTBCLENBQUMscUJBQTZCO0FBQUksUUFDaEUsTUFBTSxjQUFjLEdBQUcscUJBQXFCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDdEksUUFBUSxPQUFPLGNBQWMsQ0FBQztBQUM5QixJQUFJLENBQUM7QUFDTCxJQUNZLDhCQUE4QjtBQUMxQyxRQUFRLE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUM1RixRQUFRLElBQUksZUFBZSxFQUFFO0FBQzdCLFlBQVksSUFBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDbEUsWUFBWSxJQUFJLENBQUMsaUNBQWlDLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDcEUsU0FBUztBQUNULElBQUksQ0FBQztBQUNMLElBQ1csc0JBQXNCO0FBQ2pDLFFBQVEsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7QUFDakMsUUFDUSxJQUFJLENBQUMsd0JBQXdCLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQztBQUN6RSxhQUFhLElBQUksQ0FDRCxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLHVCQUF1QixHQUFHLElBQUksQ0FBQyxFQUM5QyxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQzNDLGFBQWEsU0FBUyxDQUFDLENBQUMsZ0NBQTBELEVBQUUsRUFBRTtBQUN0RixZQUFvQixJQUFJLENBQUMscUJBQXFCLEdBQUcsZ0NBQWdDLENBQUM7QUFDbEYsWUFBb0IsSUFBSSxnQ0FBZ0MsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO0FBQ3ZFLGdCQUF3QixJQUFJLENBQUMsOEJBQThCLEVBQUUsQ0FBQztBQUM5RCxhQUFxQjtBQUFDLGlCQUFLLElBQUksSUFBSSxDQUFDLHFCQUFxQixFQUFFO0FBQzNELGdCQUF3QixJQUFJLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQ3BGLGFBQXFCO0FBQ3JCLFFBQWdCLENBQUMsRUFDRCxHQUFHLEVBQUU7QUFDckIsWUFBb0IsSUFBSSxDQUFDLGNBQWMsR0FBRyx3RUFBd0UsQ0FBQztBQUNuSCxRQUFnQixDQUFDLENBQUMsQ0FBQztBQUNuQixJQUFJLENBQUM7QUFDTCxJQUNZLFdBQVcsQ0FBQyxJQUFZO0FBQUksUUFDaEMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDO0FBQ3RCLElBQUksQ0FBQztBQUNMLElBQ0ksa0JBQWtCO0FBQUssUUFDbkIsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksSUFBSSxDQUFDLGlCQUFpQixFQUFFO0FBQ3RELFlBQVksT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDO0FBQzVELFNBQVM7QUFBQyxhQUFLO0FBQ2YsWUFBWSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUM7QUFDNUQsU0FBUztBQUNULElBQUksQ0FBQztBQUNMLElBQ1kscUJBQXFCO0FBQUssUUFDOUIsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLG9CQUFvQixDQUFDO0FBQy9ELElBQUksQ0FBQztBQUNMLElBQ1ksb0JBQW9CLENBQUMsc0JBQThDLEVBQUUscUJBQTZCO0FBQUksUUFDMUcsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLElBQUksc0JBQXNCLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDO0FBQ3pKLFlBQVksQ0FBQyxzQkFBc0IsQ0FBQyxHQUFHLElBQUksc0JBQXNCLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDbkksSUFBSSxDQUFDO0FBQ0wsSUFDSSx5QkFBeUI7QUFBSyxRQUMxQixPQUFPLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO0FBQ3ZELElBQUksQ0FBQztBQUNMLElBQ0ksd0JBQXdCO0FBQzVCLFFBQVEsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDO0FBQ3ZFLFFBQVEsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFO0FBQzVCLFlBQVksSUFBSSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO0FBQ2hFLFNBQVM7QUFDVCxRQUNRLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRSxFQUFFO0FBQzVCLFlBQVksSUFBSSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMxSCxTQUFTO0FBQ1QsSUFBSSxDQUFDO0FBQ0wsSUFDSSxZQUFZO0FBQ2hCLFFBQVEsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7QUFDOUIsUUFBUSxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztBQUN4QyxRQUFRLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUMxRCxJQUFJLENBQUMscUJBQXFCLENBQUMsRUFBRSxFQUM3QixJQUFJLENBQUMsbUJBQW1CLENBQUM7QUFDckMsYUFBYSxTQUFTLENBQ04sQ0FBQyxHQUFHLEVBQUUsRUFBRTtBQUN4QixZQUFvQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUMzQyxZQUFvQixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztBQUMzQyxRQUFnQixDQUFDLEVBQ0QsQ0FBQyxHQUFHLEVBQUUsRUFBRTtBQUN4QixZQUFvQixJQUFJLENBQUMsY0FBYyxHQUFHLDREQUE0RCxDQUFDO0FBQ3ZHLFlBQW9CLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ3pDLFlBQW9CLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO0FBQzNDLFFBQWdCLENBQUMsQ0FDSixDQUFDO0FBQ2QsSUFBSSxDQUFDO0FBQ0wsSUFDVSxrQkFBa0I7QUFDNUI7QUFDb0IsWUFEWixJQUFJLElBQUksQ0FBQyxxQkFBcUIsRUFBRTtBQUN4QyxnQkFBWSxNQUFNLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMscUJBQXFCLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDM0csYUFBUztBQUNULFlBQ1EsSUFBSSxDQUFDLHFCQUFxQixHQUFHLElBQUksQ0FBQztBQUMxQyxZQUFRLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDM0IsUUFBSSxDQUFDO0FBRUosS0FGSTtBQUNMLElBQ1ksaUJBQWlCO0FBQzdCLFFBQVEsSUFBSSxDQUFDLGNBQWMsR0FBRyxFQUFFLENBQUM7QUFDakMsSUFBSSxDQUFDO0FBQ0wsSUFDWSwwQkFBMEI7QUFDdEMsUUFBUSxJQUFJLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQzVDLFFBQVEsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQztBQUM1RCxJQUFJLENBQUM7QUFDTCxJQUNJLDRCQUE0QixDQUFDLE9BQVk7QUFDN0MsUUFBUSxJQUFJLE9BQU8sRUFBRTtBQUNyQixZQUFZLElBQUksV0FBVyxHQUFHLE9BQU8sQ0FBQztBQUN0QyxZQUFZLElBQUksT0FBTyxPQUFPLEtBQUssUUFBUSxFQUFFO0FBQzdDLGdCQUFnQixXQUFXLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztBQUMzQyxhQUFhO0FBQ2IsWUFBWSxPQUFPLFdBQVcsQ0FBQztBQUMvQixTQUFTO0FBQ1QsSUFBSSxDQUFDO0FBQ0wsSUFDSSxlQUFlLENBQUMsS0FBSztBQUN6QixRQUFRLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQztBQUNoQyxRQUFRLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsU0FBUyxFQUFFO0FBQy9DLFlBQVksSUFBSSxDQUFDLDBCQUEwQixFQUFFLENBQUM7QUFDOUMsWUFBWSxJQUFJLENBQUMsaUJBQWlCLENBQUMsU0FBUyxFQUFFLENBQUM7QUFDL0MsU0FBUztBQUFDLGFBQUs7QUFDZixZQUFZLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLEVBQUUsQ0FBQztBQUNoRCxTQUFTO0FBQ1QsSUFBSSxDQUFDO0FBQ0wsSUFDSSw4QkFBOEI7QUFBSyxRQUMvQixPQUFPLENBQUMsT0FBd0IsRUFBaUMsRUFBRTtBQUMzRSxZQUFZLE1BQU0sMkJBQTJCLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQztBQUM5RCxZQUFZLElBQUksMEJBQTBCLEdBQUcsS0FBSyxDQUFDO0FBQ25ELFlBQ1ksSUFBSSwyQkFBMkIsRUFBRTtBQUM3QyxnQkFBZ0IsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsMkJBQTJCLENBQUMsQ0FBQztBQUMvRixnQkFBZ0IsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRTtBQUM1QyxvQkFBb0IsMEJBQTBCLEdBQUcsSUFBSSxDQUFDO0FBQ3RELGlCQUFpQjtBQUNqQixhQUFhO0FBQ2IsWUFDWSxPQUFPLDBCQUEwQixDQUFDLENBQUMsQ0FBQyxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0FBQ2hGLFFBQVEsQ0FBQyxDQUFDO0FBQ1YsSUFBSSxDQUFDO0FBQ0wsSUFDSSx5QkFBeUIsQ0FBQyxPQUErQjtBQUFJLFFBQ3pELE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUM7QUFDM0QsSUFBSSxDQUFDO0FBQ0wsSUFDSSxJQUFJLG1CQUFtQjtBQUFLLFFBQ3hCLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUMzRCxJQUFJLENBQUM7QUFDTCxJQUNJLElBQUksaUJBQWlCO0FBQUssUUFDdEIsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0FBQ3pELElBQUksQ0FBQztBQUNMLElBQ0ksb0JBQW9CLENBQUMsT0FBeUI7QUFDbEQsUUFBUSxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQzlDLElBQUksQ0FBQztBQUNMLElBQ0ksaUNBQWlDLENBQUMsaUJBQXlDO0FBQy9FLFFBQVEsSUFBSSxpQkFBaUIsRUFBRTtBQUMvQixZQUFZLE1BQU0sc0JBQXNCLEdBQXlCLEVBQUUscUJBQXFCLEVBQUUsaUJBQWlCLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDbkgsWUFBWSxNQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO0FBQzlHLFlBQVksSUFBSSxDQUFDLG1CQUFtQixDQUFDLFFBQVEsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQ2xFLFlBQVksSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsRUFBRSxDQUFDO0FBQ25ELFlBQVksSUFBSSxDQUFDLG1CQUFtQixDQUFDLGFBQWEsRUFBRSxDQUFDO0FBQ3JELFlBQVksSUFBSSxDQUFDLDBCQUEwQixDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0FBQ3BFLFNBQVM7QUFDVCxJQUFJLENBQUM7QUFDTCxJQUNJLFdBQVc7QUFDZixRQUFRLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ25DLFFBQVEsSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztBQUNuQyxJQUFJLENBQUM7QUFDTDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzR6Q0FBQztBQXRXVSwwQ0FBZSxHQUFXLEdBQUcsQ0FBQztBQUM5QixzREFBMkIsR0FBVyxHQUFHLENBQUM7QUFDMUMsZ0RBQXFCLEdBQVcsR0FBRyxDQUFDLEFBSjFDO0FBQUM7RUFOTCxTQUFTLFNBQUMsa0JBQ1AsdENBS3NELFlBaEJqRCx3QkFBd0I7TUFXckIsRUFBRSxSQVh1QixZQUN5QixXQUFXO01BVWxDLGtCQUNuQyx4QkFYeUUsWUFRcEUsb0JBQW9CO0FBQUc7QUFBRztBQUNqQyxnQ0FZRyxTQUFTLFNBQUMsc0JBQXNCO0FBQ2hDLHNCQUdBLEtBQUs7QUFDUiw0QkFHRyxLQUFLO0FBQ1IsbUJBR0csS0FBSztBQUNSLG9DQUdHLEtBQUs7QUFDUix3QkFHRyxLQUFLO0FBQ1IscUJBR0csS0FBSztBQUNSLHdDQUdHLEtBQUs7QUFDUixzQkFHRyxNQUFNO0FBQ1QscUJBR0csTUFBTTtBQUNULG9CQUdHLE1BQU07QUFDVCxpQ0FHRyxNQUFNO0FBQ1QseUNBR0csTUFBTTtBQUNULHdCQWlFRyxZQUFZLFNBQUMsU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDO0FBQ25DOzs7Ozt5eUpBN0htRCxrQkFFbkQsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUksdW9CQUN4Qzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkEwSEs7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7XG4gICAgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkNoYW5nZXMsIE9uSW5pdCxcbiAgICBPdXRwdXQsIFNpbXBsZUNoYW5nZXMsIFZpZXdDaGlsZCwgVmlld0VuY2Fwc3VsYXRpb24sIE9uRGVzdHJveSwgSG9zdExpc3RlbmVyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBQcm9jZXNzSW5zdGFuY2VDbG91ZCB9IGZyb20gJy4uL21vZGVscy9wcm9jZXNzLWluc3RhbmNlLWNsb3VkLm1vZGVsJztcbmltcG9ydCB7IFN0YXJ0UHJvY2Vzc0Nsb3VkU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3N0YXJ0LXByb2Nlc3MtY2xvdWQuc2VydmljZSc7XG5pbXBvcnQgeyBGb3JtQ29udHJvbCwgVmFsaWRhdG9ycywgRm9ybUdyb3VwLCBBYnN0cmFjdENvbnRyb2wsIEZvcm1CdWlsZGVyLCBWYWxpZGF0b3JGbiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEZvcm1Nb2RlbCwgQ29udGVudExpbmtNb2RlbCB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQgeyBNYXRBdXRvY29tcGxldGVUcmlnZ2VyIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvYXV0b2NvbXBsZXRlJztcbmltcG9ydCB7IFByb2Nlc3NQYXlsb2FkQ2xvdWQgfSBmcm9tICcuLi9tb2RlbHMvcHJvY2Vzcy1wYXlsb2FkLWNsb3VkLm1vZGVsJztcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgdGFrZVVudGlsLCBzd2l0Y2hNYXAsIGZpbHRlciwgZGlzdGluY3RVbnRpbENoYW5nZWQsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFByb2Nlc3NEZWZpbml0aW9uQ2xvdWQgfSBmcm9tICcuLi8uLi8uLi9tb2RlbHMvcHJvY2Vzcy1kZWZpbml0aW9uLWNsb3VkLm1vZGVsJztcbmltcG9ydCB7IFN1YmplY3QsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFRhc2tWYXJpYWJsZUNsb3VkIH0gZnJvbSAnLi4vLi4vLi4vZm9ybS9tb2RlbHMvdGFzay12YXJpYWJsZS1jbG91ZC5tb2RlbCc7XG5pbXBvcnQgeyBQcm9jZXNzTmFtZUNsb3VkUGlwZSB9IGZyb20gJy4uLy4uLy4uL3BpcGVzL3Byb2Nlc3MtbmFtZS1jbG91ZC5waXBlJztcbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLWNsb3VkLXN0YXJ0LXByb2Nlc3MnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9zdGFydC1wcm9jZXNzLWNsb3VkLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9zdGFydC1wcm9jZXNzLWNsb3VkLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBTdGFydFByb2Nlc3NDbG91ZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgT25Jbml0LCBPbkRlc3Ryb3kge1xuXG4gICAgc3RhdGljIE1BWF9OQU1FX0xFTkdUSDogbnVtYmVyID0gMjU1O1xuICAgIHN0YXRpYyBQUk9DRVNTX0RFRklOSVRJT05fREVCT1VOQ0U6IG51bWJlciA9IDMwMDtcbiAgICBzdGF0aWMgUFJPQ0VTU19GT1JNX0RFQk9VTkNFOiBudW1iZXIgPSA0MDA7XG5cbiAgICBAVmlld0NoaWxkKE1hdEF1dG9jb21wbGV0ZVRyaWdnZXIpXG4gICAgaW5wdXRBdXRvY29tcGxldGU6IE1hdEF1dG9jb21wbGV0ZVRyaWdnZXI7XG5cbiAgICAvKiogKHJlcXVpcmVkKSBOYW1lIG9mIHRoZSBhcHAuICovXG4gICAgQElucHV0KClcbiAgICBhcHBOYW1lOiBzdHJpbmcgPSAnJztcblxuICAgIC8qKiBNYXhpbXVtIGxlbmd0aCBvZiB0aGUgcHJvY2VzcyBuYW1lLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgbWF4TmFtZUxlbmd0aDogbnVtYmVyID0gU3RhcnRQcm9jZXNzQ2xvdWRDb21wb25lbnQuTUFYX05BTUVfTEVOR1RIO1xuXG4gICAgLyoqIE5hbWUgb2YgdGhlIHByb2Nlc3MuICovXG4gICAgQElucHV0KClcbiAgICBuYW1lOiBzdHJpbmcgPSAnJztcblxuICAgIC8qKiBOYW1lIG9mIHRoZSBwcm9jZXNzIGRlZmluaXRpb24uICovXG4gICAgQElucHV0KClcbiAgICBwcm9jZXNzRGVmaW5pdGlvbk5hbWU6IHN0cmluZztcblxuICAgIC8qKiBWYXJpYWJsZXMgdG8gYXR0YWNoIHRvIHRoZSBwYXlsb2FkLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgdmFyaWFibGVzOiB7fTtcblxuICAgIC8qKiBQYXJhbWV0ZXIgdG8gcGFzcyBmb3JtIGZpZWxkIHZhbHVlcyBpbiB0aGUgc3RhcnQgZm9ybSBpZiBvbmUgaXMgYXNzb2NpYXRlZC4gKi9cbiAgICBASW5wdXQoKVxuICAgIHZhbHVlczogVGFza1ZhcmlhYmxlQ2xvdWRbXTtcblxuICAgIC8qKiBTaG93L2hpZGUgdGhlIHByb2Nlc3MgZHJvcGRvd24gbGlzdC4gKi9cbiAgICBASW5wdXQoKVxuICAgIHNob3dTZWxlY3RQcm9jZXNzRHJvcGRvd246IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgcHJvY2VzcyBpcyBzdWNjZXNzZnVsbHkgc3RhcnRlZC4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBzdWNjZXNzID0gbmV3IEV2ZW50RW1pdHRlcjxQcm9jZXNzSW5zdGFuY2VDbG91ZD4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIHN0YXJ0aW5nIHByb2Nlc3MgaXMgY2FuY2VsbGVkICovXG4gICAgQE91dHB1dCgpXG4gICAgY2FuY2VsID0gbmV3IEV2ZW50RW1pdHRlcjxQcm9jZXNzSW5zdGFuY2VDbG91ZD4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gYW4gZXJyb3Igb2NjdXJzLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIGVycm9yID0gbmV3IEV2ZW50RW1pdHRlcjxQcm9jZXNzSW5zdGFuY2VDbG91ZD4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gZm9ybSBjb250ZW50IGlzIGNsaWNrZWQuICovXG4gICAgQE91dHB1dCgpXG4gICAgZm9ybUNvbnRlbnRDbGlja2VkOiBFdmVudEVtaXR0ZXI8Q29udGVudExpbmtNb2RlbD4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHByb2Nlc3MgZGVmaW5pdGlvbiBzZWxlY3Rpb24gY2hhbmdlcy4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBwcm9jZXNzRGVmaW5pdGlvblNlbGVjdGlvbjogRXZlbnRFbWl0dGVyPFByb2Nlc3NEZWZpbml0aW9uQ2xvdWQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxQcm9jZXNzRGVmaW5pdGlvbkNsb3VkPigpO1xuXG4gICAgcHJvY2Vzc0RlZmluaXRpb25MaXN0OiBQcm9jZXNzRGVmaW5pdGlvbkNsb3VkW10gPSBbXTtcbiAgICBwcm9jZXNzRGVmaW5pdGlvbkN1cnJlbnQ6IFByb2Nlc3NEZWZpbml0aW9uQ2xvdWQ7XG4gICAgZXJyb3JNZXNzYWdlSWQ6IHN0cmluZyA9ICcnO1xuICAgIHByb2Nlc3NGb3JtOiBGb3JtR3JvdXA7XG4gICAgcHJvY2Vzc1BheWxvYWRDbG91ZCA9IG5ldyBQcm9jZXNzUGF5bG9hZENsb3VkKCk7XG4gICAgZmlsdGVyZWRQcm9jZXNzZXM6IFByb2Nlc3NEZWZpbml0aW9uQ2xvdWRbXSA9IFtdO1xuICAgIGlzTG9hZGluZyA9IGZhbHNlO1xuICAgIGlzRm9ybUNsb3VkTG9hZGVkID0gZmFsc2U7XG4gICAgZm9ybUNsb3VkOiBGb3JtTW9kZWw7XG4gICAgY3VycmVudENyZWF0ZWRQcm9jZXNzOiBQcm9jZXNzSW5zdGFuY2VDbG91ZDtcbiAgICBkaXNhYmxlU3RhcnRCdXR0b246IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgcHJvdGVjdGVkIG9uRGVzdHJveSQgPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xuICAgIHByb2Nlc3NEZWZpbml0aW9uTG9hZGVkID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHN0YXJ0UHJvY2Vzc0Nsb3VkU2VydmljZTogU3RhcnRQcm9jZXNzQ2xvdWRTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgcHJvY2Vzc05hbWVDbG91ZFBpcGU6IFByb2Nlc3NOYW1lQ2xvdWRQaXBlKSB7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMucHJvY2Vzc0Zvcm0gPSB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKHtcbiAgICAgICAgICAgIHByb2Nlc3NJbnN0YW5jZU5hbWU6IG5ldyBGb3JtQ29udHJvbCgnJywgW1ZhbGlkYXRvcnMucmVxdWlyZWQsIFZhbGlkYXRvcnMubWF4TGVuZ3RoKHRoaXMuZ2V0TWF4TmFtZUxlbmd0aCgpKSwgVmFsaWRhdG9ycy5wYXR0ZXJuKCdeW15cXFxcc10rKFxcXFxzK1teXFxcXHNdKykqJCcpXSksXG4gICAgICAgICAgICBwcm9jZXNzRGVmaW5pdGlvbjogbmV3IEZvcm1Db250cm9sKHRoaXMucHJvY2Vzc0RlZmluaXRpb25OYW1lLCBbVmFsaWRhdG9ycy5yZXF1aXJlZCwgdGhpcy5wcm9jZXNzRGVmaW5pdGlvbk5hbWVWYWxpZGF0b3IoKV0pXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMucHJvY2Vzc0RlZmluaXRpb24udmFsdWVDaGFuZ2VzXG4gICAgICAgICAgICAucGlwZShkZWJvdW5jZVRpbWUoU3RhcnRQcm9jZXNzQ2xvdWRDb21wb25lbnQuUFJPQ0VTU19ERUZJTklUSU9OX0RFQk9VTkNFKSlcbiAgICAgICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgocHJvY2Vzc0RlZmluaXRpb25OYW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RQcm9jZXNzRGVmaW5pdGlvbkJ5UHJvY2VzRGVmaW5pdGlvbk5hbWUocHJvY2Vzc0RlZmluaXRpb25OYW1lKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMucHJvY2Vzc0Zvcm0udmFsdWVDaGFuZ2VzXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBkZWJvdW5jZVRpbWUoU3RhcnRQcm9jZXNzQ2xvdWRDb21wb25lbnQuUFJPQ0VTU19GT1JNX0RFQk9VTkNFKSxcbiAgICAgICAgICAgICAgICB0YXAoKCkgPT4gdGhpcy5kaXNhYmxlU3RhcnRCdXR0b24gPSB0cnVlKSxcbiAgICAgICAgICAgICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpLFxuICAgICAgICAgICAgICAgIGZpbHRlcigoKSA9PiB0aGlzLmlzUHJvY2Vzc1NlbGVjdGlvblZhbGlkKCkpLFxuICAgICAgICAgICAgICAgIHN3aXRjaE1hcCgoKSA9PiB0aGlzLmdlbmVyYXRlUHJvY2Vzc0luc3RhbmNlKCkpXG4gICAgICAgICAgICApLnBpcGUodGFrZVVudGlsKHRoaXMub25EZXN0cm95JCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRDcmVhdGVkUHJvY2VzcyA9IHJlcztcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGVTdGFydEJ1dHRvbiA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHRoaXMucHJvY2Vzc0RlZmluaXRpb25OYW1lKSB7XG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NEZWZpbml0aW9uLnNldFZhbHVlKHRoaXMucHJvY2Vzc0RlZmluaXRpb25OYW1lKTtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0RlZmluaXRpb24ubWFya0FzRGlydHkoKTtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0RlZmluaXRpb24ubWFya0FzVG91Y2hlZCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgICAgICBpZiAoY2hhbmdlc1snYXBwTmFtZSddICYmIGNoYW5nZXNbJ2FwcE5hbWUnXS5jdXJyZW50VmFsdWUgIT09IGNoYW5nZXNbJ2FwcE5hbWUnXS5wcmV2aW91c1ZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLmFwcE5hbWUgPSBjaGFuZ2VzWydhcHBOYW1lJ10uY3VycmVudFZhbHVlO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5hcHBOYW1lIHx8IHRoaXMuYXBwTmFtZSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRQcm9jZXNzRGVmaW5pdGlvbnMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoJ2tleWRvd24nLCBbJyRldmVudCddKVxuICAgIG9uS2V5RG93bihldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgICAgICBldmVudC5jYW5jZWxCdWJibGUgPSB0cnVlO1xuICAgIH1cblxuICAgIGhhc0Zvcm0oKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NEZWZpbml0aW9uQ3VycmVudCAmJiAhIXRoaXMucHJvY2Vzc0RlZmluaXRpb25DdXJyZW50LmZvcm1LZXk7XG4gICAgfVxuXG4gICAgb25Gb3JtTG9hZGVkKGZvcm06IEZvcm1Nb2RlbCkge1xuICAgICAgICB0aGlzLmlzRm9ybUNsb3VkTG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5mb3JtQ2xvdWQgPSBmb3JtO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNQcm9jZXNzU2VsZWN0aW9uVmFsaWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NGb3JtLnZhbGlkICYmIHRoaXMuaXNQcm9jZXNzUGF5bG9hZFZhbGlkKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRNYXhOYW1lTGVuZ3RoKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLm1heE5hbWVMZW5ndGggPiBTdGFydFByb2Nlc3NDbG91ZENvbXBvbmVudC5NQVhfTkFNRV9MRU5HVEggP1xuICAgICAgICAgICAgU3RhcnRQcm9jZXNzQ2xvdWRDb21wb25lbnQuTUFYX05BTUVfTEVOR1RIIDogdGhpcy5tYXhOYW1lTGVuZ3RoO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2VuZXJhdGVQcm9jZXNzSW5zdGFuY2UoKTogT2JzZXJ2YWJsZTxQcm9jZXNzSW5zdGFuY2VDbG91ZD4ge1xuICAgICAgICBjb25zdCBjcmVhdGVQYXlsb2FkOiBQcm9jZXNzUGF5bG9hZENsb3VkID0gbmV3IFByb2Nlc3NQYXlsb2FkQ2xvdWQoe1xuICAgICAgICAgICAgbmFtZTogdGhpcy5wcm9jZXNzSW5zdGFuY2VOYW1lLnZhbHVlLFxuICAgICAgICAgICAgcHJvY2Vzc0RlZmluaXRpb25LZXk6IHRoaXMucHJvY2Vzc1BheWxvYWRDbG91ZC5wcm9jZXNzRGVmaW5pdGlvbktleVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAodGhpcy5jdXJyZW50Q3JlYXRlZFByb2Nlc3MgJiYgdGhpcy5wcm9jZXNzUGF5bG9hZENsb3VkLnByb2Nlc3NEZWZpbml0aW9uS2V5ID09PSB0aGlzLmN1cnJlbnRDcmVhdGVkUHJvY2Vzcy5wcm9jZXNzRGVmaW5pdGlvbktleSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhcnRQcm9jZXNzQ2xvdWRTZXJ2aWNlLnVwZGF0ZVByb2Nlc3ModGhpcy5hcHBOYW1lLCB0aGlzLmN1cnJlbnRDcmVhdGVkUHJvY2Vzcy5pZCwgY3JlYXRlUGF5bG9hZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zdGFydFByb2Nlc3NDbG91ZFNlcnZpY2UuY3JlYXRlUHJvY2Vzcyh0aGlzLmFwcE5hbWUsIGNyZWF0ZVBheWxvYWQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZWxlY3RQcm9jZXNzRGVmaW5pdGlvbkJ5UHJvY2VzRGVmaW5pdGlvbk5hbWUocHJvY2Vzc0RlZmluaXRpb25OYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5maWx0ZXJlZFByb2Nlc3NlcyA9IHRoaXMuZ2V0UHJvY2Vzc0RlZmluaXRpb25MaXN0QnlOYW1lT3JLZXkocHJvY2Vzc0RlZmluaXRpb25OYW1lKTtcbiAgICAgICAgaWYgKHRoaXMuaXNQcm9jZXNzRm9ybVZhbGlkKCkgJiZcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRQcm9jZXNzZXMgJiYgdGhpcy5maWx0ZXJlZFByb2Nlc3Nlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0UHJvY2Vzc0RlZmluaXRpb25PbkZvcm0odGhpcy5maWx0ZXJlZFByb2Nlc3Nlc1swXS5uYW1lKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNldFByb2Nlc3NEZWZpbml0aW9uT25Gb3JtKHNlbGVjdGVkUHJvY2Vzc0RlZmluaXRpb25OYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5wcm9jZXNzRGVmaW5pdGlvbkN1cnJlbnQgPSB0aGlzLmZpbHRlcmVkUHJvY2Vzc2VzLmZpbmQoKHByb2Nlc3M6IFByb2Nlc3NEZWZpbml0aW9uQ2xvdWQpID0+XG4gICAgICAgICAgICBwcm9jZXNzLm5hbWUgPT09IHNlbGVjdGVkUHJvY2Vzc0RlZmluaXRpb25OYW1lIHx8IHByb2Nlc3Mua2V5ID09PSBzZWxlY3RlZFByb2Nlc3NEZWZpbml0aW9uTmFtZSk7XG5cbiAgICAgICAgdGhpcy5pc0Zvcm1DbG91ZExvYWRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnByb2Nlc3NQYXlsb2FkQ2xvdWQucHJvY2Vzc0RlZmluaXRpb25LZXkgPSB0aGlzLnByb2Nlc3NEZWZpbml0aW9uQ3VycmVudC5rZXk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRQcm9jZXNzRGVmaW5pdGlvbkxpc3RCeU5hbWVPcktleShwcm9jZXNzRGVmaW5pdGlvbk5hbWU6IHN0cmluZyk6IFByb2Nlc3NEZWZpbml0aW9uQ2xvdWRbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NEZWZpbml0aW9uTGlzdC5maWx0ZXIoKHByb2Nlc3NEZWZpbml0aW9uQ2xvdWQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAhcHJvY2Vzc0RlZmluaXRpb25OYW1lIHx8IHRoaXMuZ2V0UHJvY2Vzc0RlZmluaXRpb24ocHJvY2Vzc0RlZmluaXRpb25DbG91ZCwgcHJvY2Vzc0RlZmluaXRpb25OYW1lKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRQcm9jZXNzSWZFeGlzdHMocHJvY2Vzc0RlZmluaXRpb246IHN0cmluZyk6IFByb2Nlc3NEZWZpbml0aW9uQ2xvdWQge1xuICAgICAgICBsZXQgbWF0Y2hlZFByb2Nlc3MgPSB0aGlzLnByb2Nlc3NEZWZpbml0aW9uTGlzdC5maW5kKChvcHRpb24pID0+IHRoaXMuZ2V0UHJvY2Vzc0RlZmluaXRpb24ob3B0aW9uLCBwcm9jZXNzRGVmaW5pdGlvbikpO1xuICAgICAgICBpZiAoIW1hdGNoZWRQcm9jZXNzKSB7XG4gICAgICAgICAgICBtYXRjaGVkUHJvY2VzcyA9IG5ldyBQcm9jZXNzRGVmaW5pdGlvbkNsb3VkKCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbWF0Y2hlZFByb2Nlc3M7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRQcm9jZXNzRGVmaW5pdGlvbkJ5TmFtZShwcm9jZXNzRGVmaW5pdGlvbk5hbWU6IHN0cmluZyk6IFByb2Nlc3NEZWZpbml0aW9uQ2xvdWQge1xuICAgICAgICBjb25zdCBtYXRjaGVkUHJvY2VzcyA9IHByb2Nlc3NEZWZpbml0aW9uTmFtZSA/IHRoaXMuZ2V0UHJvY2Vzc0lmRXhpc3RzKHByb2Nlc3NEZWZpbml0aW9uTmFtZSkgOiB0aGlzLnByb2Nlc3NEZWZpbml0aW9uTGlzdFswXTtcbiAgICAgICAgcmV0dXJuIG1hdGNoZWRQcm9jZXNzO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2VsZWN0RGVmYXVsdFByb2Nlc3NEZWZpbml0aW9uKCkge1xuICAgICAgICBjb25zdCBzZWxlY3RlZFByb2Nlc3MgPSB0aGlzLmdldFByb2Nlc3NEZWZpbml0aW9uQnlOYW1lKHRoaXMucHJvY2Vzc0RlZmluaXRpb25OYW1lKTtcbiAgICAgICAgaWYgKHNlbGVjdGVkUHJvY2Vzcykge1xuICAgICAgICAgICAgdGhpcy5wcm9jZXNzRGVmaW5pdGlvbi5zZXRWYWx1ZShzZWxlY3RlZFByb2Nlc3MubmFtZSk7XG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NEZWZpbml0aW9uU2VsZWN0aW9uQ2hhbmdlZChzZWxlY3RlZFByb2Nlc3MpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGxvYWRQcm9jZXNzRGVmaW5pdGlvbnMoKSB7XG4gICAgICAgIHRoaXMucmVzZXRFcnJvck1lc3NhZ2UoKTtcblxuICAgICAgICB0aGlzLnN0YXJ0UHJvY2Vzc0Nsb3VkU2VydmljZS5nZXRQcm9jZXNzRGVmaW5pdGlvbnModGhpcy5hcHBOYW1lKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgdGFwKCgpID0+IHRoaXMucHJvY2Vzc0RlZmluaXRpb25Mb2FkZWQgPSB0cnVlKSxcbiAgICAgICAgICAgICAgICB0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb25zOiBQcm9jZXNzRGVmaW5pdGlvbkNsb3VkW10pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzRGVmaW5pdGlvbkxpc3QgPSBwcm9jZXNzRGVmaW5pdGlvblJlcHJlc2VudGF0aW9ucztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NEZWZpbml0aW9uUmVwcmVzZW50YXRpb25zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3REZWZhdWx0UHJvY2Vzc0RlZmluaXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByb2Nlc3NEZWZpbml0aW9uTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzRGVmaW5pdGlvbi5zZXRWYWx1ZSh0aGlzLnByb2Nlc3NEZWZpbml0aW9uTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2VJZCA9ICdBREZfQ0xPVURfUFJPQ0VTU19MSVNULkFERl9DTE9VRF9TVEFSVF9QUk9DRVNTLkVSUk9SLkxPQURfUFJPQ0VTU19ERUZTJztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzVmFsaWROYW1lKG5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gISFuYW1lO1xuICAgIH1cblxuICAgIGlzUHJvY2Vzc0Zvcm1WYWxpZCgpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuaGFzRm9ybSgpICYmIHRoaXMuaXNGb3JtQ2xvdWRMb2FkZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZvcm1DbG91ZC5pc1ZhbGlkIHx8IHRoaXMuaXNMb2FkaW5nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc0Zvcm0udmFsaWQgfHwgdGhpcy5pc0xvYWRpbmc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGlzUHJvY2Vzc1BheWxvYWRWYWxpZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy5wcm9jZXNzUGF5bG9hZENsb3VkLnByb2Nlc3NEZWZpbml0aW9uS2V5O1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UHJvY2Vzc0RlZmluaXRpb24ocHJvY2Vzc0RlZmluaXRpb25DbG91ZDogUHJvY2Vzc0RlZmluaXRpb25DbG91ZCwgcHJvY2Vzc0RlZmluaXRpb25OYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmlzVmFsaWROYW1lKHByb2Nlc3NEZWZpbml0aW9uQ2xvdWQubmFtZSkgJiYgcHJvY2Vzc0RlZmluaXRpb25DbG91ZC5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocHJvY2Vzc0RlZmluaXRpb25OYW1lLnRvTG93ZXJDYXNlKCkpKSB8fFxuICAgICAgICAgICAgKHByb2Nlc3NEZWZpbml0aW9uQ2xvdWQua2V5ICYmIHByb2Nlc3NEZWZpbml0aW9uQ2xvdWQua2V5LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocHJvY2Vzc0RlZmluaXRpb25OYW1lLnRvTG93ZXJDYXNlKCkpKTtcbiAgICB9XG5cbiAgICBpc1Byb2Nlc3NEZWZpbml0aW9uc0VtcHR5KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRGVmaW5pdGlvbkxpc3QubGVuZ3RoID09PSAwO1xuICAgIH1cblxuICAgIGJ1aWxkUHJvY2Vzc0Nsb3VkUGF5bG9hZCgpIHtcbiAgICAgICAgdGhpcy5wcm9jZXNzUGF5bG9hZENsb3VkLm5hbWUgPSB0aGlzLnByb2Nlc3NJbnN0YW5jZU5hbWUudmFsdWU7XG4gICAgICAgIGlmICh0aGlzLnZhcmlhYmxlcykge1xuICAgICAgICAgICAgdGhpcy5wcm9jZXNzUGF5bG9hZENsb3VkLnZhcmlhYmxlcyA9IHRoaXMudmFyaWFibGVzO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaGFzRm9ybSgpKSB7XG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NQYXlsb2FkQ2xvdWQudmFyaWFibGVzID0gT2JqZWN0LmFzc2lnbih0aGlzLnByb2Nlc3NQYXlsb2FkQ2xvdWQudmFyaWFibGVzLCB0aGlzLmZvcm1DbG91ZC52YWx1ZXMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhcnRQcm9jZXNzKCkge1xuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuYnVpbGRQcm9jZXNzQ2xvdWRQYXlsb2FkKCk7XG4gICAgICAgIHRoaXMuc3RhcnRQcm9jZXNzQ2xvdWRTZXJ2aWNlLnN0YXJ0Q3JlYXRlZFByb2Nlc3ModGhpcy5hcHBOYW1lLFxuICAgICAgICAgICAgdGhpcy5jdXJyZW50Q3JlYXRlZFByb2Nlc3MuaWQsXG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NQYXlsb2FkQ2xvdWQpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgIChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWNjZXNzLmVtaXQocmVzKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2VJZCA9ICdBREZfQ0xPVURfUFJPQ0VTU19MSVNULkFERl9DTE9VRF9TVEFSVF9QUk9DRVNTLkVSUk9SLlNUQVJUJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvci5lbWl0KGVycik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBhc3luYyBjYW5jZWxTdGFydFByb2Nlc3MoKSB7XG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRDcmVhdGVkUHJvY2Vzcykge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5zdGFydFByb2Nlc3NDbG91ZFNlcnZpY2UuZGVsZXRlUHJvY2Vzcyh0aGlzLmFwcE5hbWUsIHRoaXMuY3VycmVudENyZWF0ZWRQcm9jZXNzLmlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY3VycmVudENyZWF0ZWRQcm9jZXNzID0gbnVsbDtcbiAgICAgICAgdGhpcy5jYW5jZWwuZW1pdCgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVzZXRFcnJvck1lc3NhZ2UoKSB7XG4gICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlSWQgPSAnJztcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlc2V0UHJvY2Vzc0RlZmluaXRpb25MaXN0KCkge1xuICAgICAgICB0aGlzLnByb2Nlc3NEZWZpbml0aW9uLnNldFZhbHVlKCcnKTtcbiAgICAgICAgdGhpcy5maWx0ZXJlZFByb2Nlc3NlcyA9IHRoaXMucHJvY2Vzc0RlZmluaXRpb25MaXN0O1xuICAgIH1cblxuICAgIGRpc3BsYXlQcm9jZXNzTmFtZU9uRHJvcGRvd24ocHJvY2VzczogYW55KSB7XG4gICAgICAgIGlmIChwcm9jZXNzKSB7XG4gICAgICAgICAgICBsZXQgcHJvY2Vzc05hbWUgPSBwcm9jZXNzO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBwcm9jZXNzICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHByb2Nlc3NOYW1lID0gcHJvY2Vzcy5uYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NOYW1lO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZGlzcGxheURyb3Bkb3duKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBpZiAoIXRoaXMuaW5wdXRBdXRvY29tcGxldGUucGFuZWxPcGVuKSB7XG4gICAgICAgICAgICB0aGlzLnJlc2V0UHJvY2Vzc0RlZmluaXRpb25MaXN0KCk7XG4gICAgICAgICAgICB0aGlzLmlucHV0QXV0b2NvbXBsZXRlLm9wZW5QYW5lbCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbnB1dEF1dG9jb21wbGV0ZS5jbG9zZVBhbmVsKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm9jZXNzRGVmaW5pdGlvbk5hbWVWYWxpZGF0b3IoKTogVmFsaWRhdG9yRm4ge1xuICAgICAgICByZXR1cm4gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IHsgW2tleTogc3RyaW5nXTogYW55IH0gfCBudWxsID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NEZWZpbml0aW9uRmllbGRWYWx1ZSA9IGNvbnRyb2wudmFsdWU7XG4gICAgICAgICAgICBsZXQgcHJvY2Vzc0RlZmluaXRpb25OYW1lRXJyb3IgPSBmYWxzZTtcblxuICAgICAgICAgICAgaWYgKHByb2Nlc3NEZWZpbml0aW9uRmllbGRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NEZWZpbml0aW9uID0gdGhpcy5nZXRQcm9jZXNzSWZFeGlzdHMocHJvY2Vzc0RlZmluaXRpb25GaWVsZFZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAoIXByb2Nlc3NEZWZpbml0aW9uLmtleSkge1xuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzRGVmaW5pdGlvbk5hbWVFcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcHJvY2Vzc0RlZmluaXRpb25OYW1lRXJyb3IgPyB7ICdpbnZhbGlkIG5hbWUnOiB0cnVlIH0gOiBudWxsO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGdldFByb2Nlc3NEZWZpbml0aW9uVmFsdWUocHJvY2VzczogUHJvY2Vzc0RlZmluaXRpb25DbG91ZCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiAhIXByb2Nlc3MubmFtZSA/IHByb2Nlc3MubmFtZSA6IHByb2Nlc3Mua2V5O1xuICAgIH1cblxuICAgIGdldCBwcm9jZXNzSW5zdGFuY2VOYW1lKCk6IEFic3RyYWN0Q29udHJvbCB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NGb3JtLmdldCgncHJvY2Vzc0luc3RhbmNlTmFtZScpO1xuICAgIH1cblxuICAgIGdldCBwcm9jZXNzRGVmaW5pdGlvbigpOiBBYnN0cmFjdENvbnRyb2wge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRm9ybS5nZXQoJ3Byb2Nlc3NEZWZpbml0aW9uJyk7XG4gICAgfVxuXG4gICAgb25Gb3JtQ29udGVudENsaWNrZWQoY29udGVudDogQ29udGVudExpbmtNb2RlbCkge1xuICAgICAgICB0aGlzLmZvcm1Db250ZW50Q2xpY2tlZC5lbWl0KGNvbnRlbnQpO1xuICAgIH1cblxuICAgIHByb2Nlc3NEZWZpbml0aW9uU2VsZWN0aW9uQ2hhbmdlZChwcm9jZXNzRGVmaW5pdGlvbjogUHJvY2Vzc0RlZmluaXRpb25DbG91ZCkge1xuICAgICAgICBpZiAocHJvY2Vzc0RlZmluaXRpb24pIHtcbiAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NJbnN0YW5jZURldGFpbHM6IFByb2Nlc3NJbnN0YW5jZUNsb3VkID0geyBwcm9jZXNzRGVmaW5pdGlvbk5hbWU6IHByb2Nlc3NEZWZpbml0aW9uLm5hbWUgfTtcbiAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRQcm9jZXNzTmFtZSA9IHRoaXMucHJvY2Vzc05hbWVDbG91ZFBpcGUudHJhbnNmb3JtKHRoaXMubmFtZSwgcHJvY2Vzc0luc3RhbmNlRGV0YWlscyk7XG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NJbnN0YW5jZU5hbWUuc2V0VmFsdWUoZGVmYXVsdFByb2Nlc3NOYW1lKTtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0luc3RhbmNlTmFtZS5tYXJrQXNEaXJ0eSgpO1xuICAgICAgICAgICAgdGhpcy5wcm9jZXNzSW5zdGFuY2VOYW1lLm1hcmtBc1RvdWNoZWQoKTtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0RlZmluaXRpb25TZWxlY3Rpb24uZW1pdChwcm9jZXNzRGVmaW5pdGlvbik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLm5leHQodHJ1ZSk7XG4gICAgICAgIHRoaXMub25EZXN0cm95JC5jb21wbGV0ZSgpO1xuICAgIH1cbn1cbiJdfQ==