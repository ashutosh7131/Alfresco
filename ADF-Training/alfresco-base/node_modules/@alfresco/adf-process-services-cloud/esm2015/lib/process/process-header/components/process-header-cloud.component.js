/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, Input, EventEmitter, ViewEncapsulation } from '@angular/core';
import { CardViewTextItemModel, TranslationService, AppConfigService, CardViewDateItemModel } from '@alfresco/adf-core';
import { ProcessCloudService } from '../../services/process-cloud.service';
import { takeUntil } from 'rxjs/operators';
import { Subject } from 'rxjs';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../../services/process-cloud.service';
import * as ɵngcc2 from '@alfresco/adf-core';
import * as ɵngcc3 from '@angular/common';
import * as ɵngcc4 from '@angular/material/card';

function ProcessHeaderCloudComponent_mat_card_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "mat-card");
    ɵngcc0.ɵɵelementStart(1, "mat-card-content");
    ɵngcc0.ɵɵelement(2, "adf-card-view", 1);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("properties", ctx_r0.properties);
} }
export class ProcessHeaderCloudComponent {
    constructor(processCloudService, translationService, appConfig) {
        this.processCloudService = processCloudService;
        this.translationService = translationService;
        this.appConfig = appConfig;
        this.appName = '';
        this.loaded = new EventEmitter();
        this.onDestroy$ = new Subject();
    }
    ngOnInit() {
        this.dateFormat = this.appConfig.get('dateValues.defaultDateFormat');
        this.dateLocale = this.appConfig.get('dateValues.defaultDateLocale');
        this.processCloudService.dataChangesDetected
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((processDetails) => this.onLoaded(processDetails));
    }
    ngOnChanges() {
        if ((this.appName || this.appName === '') && this.processInstanceId) {
            this.loadProcessInstanceDetails(this.appName, this.processInstanceId);
        }
    }
    loadProcessInstanceDetails(appName, processInstanceId) {
        this.processCloudService
            .getProcessInstanceById(appName, processInstanceId)
            .subscribe((result) => this.onLoaded(result));
    }
    onLoaded(processInstanceDetails) {
        this.processInstanceDetails = processInstanceDetails;
        this.refreshData();
        this.loaded.emit(processInstanceDetails);
    }
    refreshData() {
        if (this.processInstanceDetails) {
            const defaultProperties = this.initDefaultProperties();
            const filteredProperties = this.appConfig.get('adf-cloud-process-header.presets.properties');
            this.properties = defaultProperties.filter((cardItem) => this.isValidSelection(filteredProperties, cardItem));
        }
    }
    initDefaultProperties() {
        return [
            new CardViewTextItemModel({
                label: 'ADF_CLOUD_PROCESS_HEADER.PROPERTIES.ID',
                value: this.processInstanceDetails.id,
                key: 'id'
            }),
            new CardViewTextItemModel({
                label: 'ADF_CLOUD_PROCESS_HEADER.PROPERTIES.NAME',
                value: this.processInstanceDetails.name,
                key: 'name',
                default: this.translationService.instant('ADF_CLOUD_PROCESS_HEADER.PROPERTIES.NAME_DEFAULT')
            }),
            new CardViewTextItemModel({
                label: 'ADF_CLOUD_PROCESS_HEADER.PROPERTIES.STATUS',
                value: this.processInstanceDetails.status,
                key: 'status'
            }),
            new CardViewTextItemModel({
                label: 'ADF_CLOUD_PROCESS_HEADER.PROPERTIES.INITIATOR',
                value: this.processInstanceDetails.initiator,
                key: 'initiator'
            }),
            new CardViewDateItemModel({
                label: 'ADF_CLOUD_PROCESS_HEADER.PROPERTIES.START_DATE',
                value: this.processInstanceDetails.startDate,
                key: 'startDate',
                format: this.dateFormat,
                locale: this.dateLocale
            }),
            new CardViewDateItemModel({
                label: 'ADF_CLOUD_PROCESS_HEADER.PROPERTIES.LAST_MODIFIED',
                value: this.processInstanceDetails.lastModified,
                key: 'lastModified',
                format: this.dateFormat,
                locale: this.dateLocale
            }),
            new CardViewTextItemModel({
                label: 'ADF_CLOUD_PROCESS_HEADER.PROPERTIES.PARENT_ID',
                value: this.processInstanceDetails.parentId,
                key: 'parentId',
                default: this.translationService.instant('ADF_CLOUD_PROCESS_HEADER.PROPERTIES.NONE')
            }),
            new CardViewTextItemModel({
                label: 'ADF_CLOUD_PROCESS_HEADER.PROPERTIES.BUSINESS_KEY',
                value: this.processInstanceDetails.businessKey,
                key: 'businessKey',
                default: this.translationService.instant('ADF_CLOUD_PROCESS_HEADER.PROPERTIES.NONE')
            })
        ];
    }
    isValidSelection(filteredProperties, cardItem) {
        return filteredProperties ? filteredProperties.indexOf(cardItem.key) >= 0 : true;
    }
    ngOnDestroy() {
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
}
ProcessHeaderCloudComponent.ɵfac = function ProcessHeaderCloudComponent_Factory(t) { return new (t || ProcessHeaderCloudComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ProcessCloudService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.TranslationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.AppConfigService)); };
ProcessHeaderCloudComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ProcessHeaderCloudComponent, selectors: [["adf-cloud-process-header"]], hostAttrs: [1, "adf-cloud-process-header"], inputs: { appName: "appName", processInstanceId: "processInstanceId" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 1, vars: 1, consts: [[4, "ngIf"], [3, "properties"]], template: function ProcessHeaderCloudComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, ProcessHeaderCloudComponent_mat_card_0_Template, 3, 1, "mat-card", 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", ctx.processInstanceDetails);
    } }, directives: [ɵngcc3.NgIf, ɵngcc4.MatCard, ɵngcc4.MatCardContent, ɵngcc2.CardViewComponent], encapsulation: 2 });
ProcessHeaderCloudComponent.ctorParameters = () => [
    { type: ProcessCloudService },
    { type: TranslationService },
    { type: AppConfigService }
];
ProcessHeaderCloudComponent.propDecorators = {
    appName: [{ type: Input }],
    processInstanceId: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ProcessHeaderCloudComponent, [{
        type: Component,
        args: [{
                selector: 'adf-cloud-process-header',
                template: "<mat-card *ngIf=\"processInstanceDetails\">\n  <mat-card-content>\n    <adf-card-view [properties]=\"properties\"></adf-card-view>\n  </mat-card-content>\n</mat-card>",
                encapsulation: ViewEncapsulation.None,
                host: { class: 'adf-cloud-process-header' }
            }]
    }], function () { return [{ type: ɵngcc1.ProcessCloudService }, { type: ɵngcc2.TranslationService }, { type: ɵngcc2.AppConfigService }]; }, { appName: [{
            type: Input
        }], processInstanceId: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzcy1oZWFkZXItY2xvdWQuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9ob21lL3RyYXZpcy9idWlsZC9BbGZyZXNjby9hbGZyZXNjby1uZzItY29tcG9uZW50cy9saWIvcHJvY2Vzcy1zZXJ2aWNlcy1jbG91ZC9zcmMvbGliL3Byb2Nlc3MvcHJvY2Vzcy1oZWFkZXIvY29tcG9uZW50cy9wcm9jZXNzLWhlYWRlci1jbG91ZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUVILE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFnQyxZQUFZLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEgsT0FBTyxFQUFnQixxQkFBcUIsRUFBRSxrQkFBa0IsRUFBRSxnQkFBZ0IsRUFBRSxxQkFBcUIsRUFBeUIsTUFBTSxvQkFBb0IsQ0FBQztBQUU3SixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUMzRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBUS9CLE1BQU0sT0FBTywyQkFBMkI7QUFBRyxJQW9CdkMsWUFDWSxtQkFBd0MsRUFDeEMsa0JBQXNDLEVBQ3RDLFNBQTJCO0FBQzNDLFFBSGdCLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBcUI7QUFBQyxRQUN6Qyx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO0FBQUMsUUFDdkMsY0FBUyxHQUFULFNBQVMsQ0FBa0I7QUFBQyxRQW5CeEMsWUFBTyxHQUFXLEVBQUUsQ0FBQztBQUN6QixRQVdJLFdB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UixnQ0FHRyxLQUFLO0FBQ1Q7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBPbkRlc3Ryb3ksIEV2ZW50RW1pdHRlciwgVmlld0VuY2Fwc3VsYXRpb24gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENhcmRWaWV3SXRlbSwgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsLCBUcmFuc2xhdGlvblNlcnZpY2UsIEFwcENvbmZpZ1NlcnZpY2UsIENhcmRWaWV3RGF0ZUl0ZW1Nb2RlbCwgQ2FyZFZpZXdCYXNlSXRlbU1vZGVsIH0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IFByb2Nlc3NJbnN0YW5jZUNsb3VkIH0gZnJvbSAnLi4vLi4vc3RhcnQtcHJvY2Vzcy9tb2RlbHMvcHJvY2Vzcy1pbnN0YW5jZS1jbG91ZC5tb2RlbCc7XG5pbXBvcnQgeyBQcm9jZXNzQ2xvdWRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcHJvY2Vzcy1jbG91ZC5zZXJ2aWNlJztcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhZGYtY2xvdWQtcHJvY2Vzcy1oZWFkZXInLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9wcm9jZXNzLWhlYWRlci1jbG91ZC5jb21wb25lbnQuaHRtbCcsXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgICBob3N0OiB7IGNsYXNzOiAnYWRmLWNsb3VkLXByb2Nlc3MtaGVhZGVyJyB9XG59KVxuZXhwb3J0IGNsYXNzIFByb2Nlc3NIZWFkZXJDbG91ZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgT25Jbml0LCBPbkRlc3Ryb3kge1xuXG4gICAgLyoqIChSZXF1aXJlZCkgVGhlIG5hbWUgb2YgdGhlIGFwcGxpY2F0aW9uLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgYXBwTmFtZTogc3RyaW5nID0gJyc7XG5cbiAgICAvKiogKFJlcXVpcmVkKSBUaGUgaWQgb2YgdGhlIHByb2Nlc3MgaW5zdGFuY2UuICovXG4gICAgQElucHV0KClcbiAgICBwcm9jZXNzSW5zdGFuY2VJZDogc3RyaW5nO1xuXG4gICAgcHJvY2Vzc0luc3RhbmNlRGV0YWlsczogUHJvY2Vzc0luc3RhbmNlQ2xvdWQ7XG4gICAgcHJvcGVydGllczogQ2FyZFZpZXdJdGVtW107XG4gICAgZGF0ZUZvcm1hdDogc3RyaW5nO1xuICAgIGRhdGVMb2NhbGU6IHN0cmluZztcblxuICAgIC8qKiBHZXRzIGVtaXR0ZWQgZWFjaCB0aW1lIGEgbmV3IHByb2Nlc3MgaW5zdGFuY2UgZGV0YWlscyBhcmUgbG9hZGVkLiAqL1xuICAgIGxvYWRlZCA9IG5ldyBFdmVudEVtaXR0ZXI8UHJvY2Vzc0luc3RhbmNlQ2xvdWQ+KCk7XG5cbiAgICBwcml2YXRlIG9uRGVzdHJveSQgPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgcHJvY2Vzc0Nsb3VkU2VydmljZTogUHJvY2Vzc0Nsb3VkU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSB0cmFuc2xhdGlvblNlcnZpY2U6IFRyYW5zbGF0aW9uU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBhcHBDb25maWc6IEFwcENvbmZpZ1NlcnZpY2UpIHtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5kYXRlRm9ybWF0ID0gdGhpcy5hcHBDb25maWcuZ2V0KCdkYXRlVmFsdWVzLmRlZmF1bHREYXRlRm9ybWF0Jyk7XG4gICAgICAgIHRoaXMuZGF0ZUxvY2FsZSA9IHRoaXMuYXBwQ29uZmlnLmdldCgnZGF0ZVZhbHVlcy5kZWZhdWx0RGF0ZUxvY2FsZScpO1xuXG4gICAgICAgIHRoaXMucHJvY2Vzc0Nsb3VkU2VydmljZS5kYXRhQ2hhbmdlc0RldGVjdGVkXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHByb2Nlc3NEZXRhaWxzKSA9PiB0aGlzLm9uTG9hZGVkKHByb2Nlc3NEZXRhaWxzKSk7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoKSB7XG4gICAgICAgIGlmICgodGhpcy5hcHBOYW1lIHx8IHRoaXMuYXBwTmFtZSA9PT0gJycpICYmIHRoaXMucHJvY2Vzc0luc3RhbmNlSWQpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZFByb2Nlc3NJbnN0YW5jZURldGFpbHModGhpcy5hcHBOYW1lLCB0aGlzLnByb2Nlc3NJbnN0YW5jZUlkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgbG9hZFByb2Nlc3NJbnN0YW5jZURldGFpbHMoYXBwTmFtZTogc3RyaW5nLCBwcm9jZXNzSW5zdGFuY2VJZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMucHJvY2Vzc0Nsb3VkU2VydmljZVxuICAgICAgICAgICAgLmdldFByb2Nlc3NJbnN0YW5jZUJ5SWQoYXBwTmFtZSwgcHJvY2Vzc0luc3RhbmNlSWQpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKChyZXN1bHQpID0+IHRoaXMub25Mb2FkZWQocmVzdWx0KSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkxvYWRlZChwcm9jZXNzSW5zdGFuY2VEZXRhaWxzOiBQcm9jZXNzSW5zdGFuY2VDbG91ZCkge1xuICAgICAgICB0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMgPSBwcm9jZXNzSW5zdGFuY2VEZXRhaWxzO1xuICAgICAgICB0aGlzLnJlZnJlc2hEYXRhKCk7XG5cbiAgICAgICAgdGhpcy5sb2FkZWQuZW1pdChwcm9jZXNzSW5zdGFuY2VEZXRhaWxzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWZyZXNoIHRoZSBjYXJkIGRhdGFcbiAgICAgKi9cbiAgICByZWZyZXNoRGF0YSgpIHtcbiAgICAgICAgaWYgKHRoaXMucHJvY2Vzc0luc3RhbmNlRGV0YWlscykge1xuICAgICAgICAgICAgY29uc3QgZGVmYXVsdFByb3BlcnRpZXMgPSB0aGlzLmluaXREZWZhdWx0UHJvcGVydGllcygpO1xuICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRQcm9wZXJ0aWVzID0gdGhpcy5hcHBDb25maWcuZ2V0PHN0cmluZ1tdPignYWRmLWNsb3VkLXByb2Nlc3MtaGVhZGVyLnByZXNldHMucHJvcGVydGllcycpO1xuICAgICAgICAgICAgdGhpcy5wcm9wZXJ0aWVzID0gZGVmYXVsdFByb3BlcnRpZXMuZmlsdGVyKChjYXJkSXRlbSkgPT4gdGhpcy5pc1ZhbGlkU2VsZWN0aW9uKGZpbHRlcmVkUHJvcGVydGllcywgY2FyZEl0ZW0pKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaW5pdERlZmF1bHRQcm9wZXJ0aWVzKCk6IGFueVtdIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIG5ldyBDYXJkVmlld1RleHRJdGVtTW9kZWwoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9DTE9VRF9QUk9DRVNTX0hFQURFUi5QUk9QRVJUSUVTLklEJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMucHJvY2Vzc0luc3RhbmNlRGV0YWlscy5pZCxcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnaWQnXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfQ0xPVURfUFJPQ0VTU19IRUFERVIuUFJPUEVSVElFUy5OQU1FJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMucHJvY2Vzc0luc3RhbmNlRGV0YWlscy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICduYW1lJyxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudCgnQURGX0NMT1VEX1BST0NFU1NfSEVBREVSLlBST1BFUlRJRVMuTkFNRV9ERUZBVUxUJylcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIG5ldyBDYXJkVmlld1RleHRJdGVtTW9kZWwoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9DTE9VRF9QUk9DRVNTX0hFQURFUi5QUk9QRVJUSUVTLlNUQVRVUycsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdzdGF0dXMnXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfQ0xPVURfUFJPQ0VTU19IRUFERVIuUFJPUEVSVElFUy5JTklUSUFUT1InLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5wcm9jZXNzSW5zdGFuY2VEZXRhaWxzLmluaXRpYXRvcixcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnaW5pdGlhdG9yJ1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3RGF0ZUl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX0NMT1VEX1BST0NFU1NfSEVBREVSLlBST1BFUlRJRVMuU1RBUlRfREFURScsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnByb2Nlc3NJbnN0YW5jZURldGFpbHMuc3RhcnREYXRlLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdzdGFydERhdGUnLFxuICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IHRoaXMuZGF0ZUZvcm1hdCxcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxlOiB0aGlzLmRhdGVMb2NhbGVcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIG5ldyBDYXJkVmlld0RhdGVJdGVtTW9kZWwoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9DTE9VRF9QUk9DRVNTX0hFQURFUi5QUk9QRVJUSUVTLkxBU1RfTU9ESUZJRUQnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5wcm9jZXNzSW5zdGFuY2VEZXRhaWxzLmxhc3RNb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnbGFzdE1vZGlmaWVkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiB0aGlzLmRhdGVGb3JtYXQsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsZTogdGhpcy5kYXRlTG9jYWxlXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfQ0xPVURfUFJPQ0VTU19IRUFERVIuUFJPUEVSVElFUy5QQVJFTlRfSUQnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5wcm9jZXNzSW5zdGFuY2VEZXRhaWxzLnBhcmVudElkLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdwYXJlbnRJZCcsXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmluc3RhbnQoJ0FERl9DTE9VRF9QUk9DRVNTX0hFQURFUi5QUk9QRVJUSUVTLk5PTkUnKVxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3VGV4dEl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX0NMT1VEX1BST0NFU1NfSEVBREVSLlBST1BFUlRJRVMuQlVTSU5FU1NfS0VZJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMucHJvY2Vzc0luc3RhbmNlRGV0YWlscy5idXNpbmVzc0tleSxcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnYnVzaW5lc3NLZXknLFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS5pbnN0YW50KCdBREZfQ0xPVURfUFJPQ0VTU19IRUFERVIuUFJPUEVSVElFUy5OT05FJylcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICBdO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNWYWxpZFNlbGVjdGlvbihmaWx0ZXJlZFByb3BlcnRpZXM6IHN0cmluZ1tdLCBjYXJkSXRlbTogQ2FyZFZpZXdCYXNlSXRlbU1vZGVsKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBmaWx0ZXJlZFByb3BlcnRpZXMgPyBmaWx0ZXJlZFByb3BlcnRpZXMuaW5kZXhPZihjYXJkSXRlbS5rZXkpID49IDAgOiB0cnVlO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLm9uRGVzdHJveSQubmV4dCh0cnVlKTtcbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLmNvbXBsZXRlKCk7XG4gICAgfVxufVxuIl19