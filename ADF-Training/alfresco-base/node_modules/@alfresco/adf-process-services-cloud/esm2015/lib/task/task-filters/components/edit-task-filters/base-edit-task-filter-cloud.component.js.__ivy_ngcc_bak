/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Directive, Input, Output, EventEmitter } from '@angular/core';
import { TaskCloudService } from './../../../services/task-cloud.service';
import { AppsProcessCloudService } from './../../../../app/services/apps-process-cloud.service';
import { DateCloudFilterType } from '../../../../models/date-cloud-filter.model';
import moment from 'moment';
import { FormBuilder } from '@angular/forms';
import { debounceTime, filter, finalize, switchMap, takeUntil } from 'rxjs/operators';
import { Subject } from 'rxjs';
import { DateAdapter } from '@angular/material/core';
import { TranslationService, UserPreferencesService, UserPreferenceValues } from '@alfresco/adf-core';
import { TaskFilterDialogCloudComponent } from '../task-filter-dialog/task-filter-dialog-cloud.component';
import { MatDialog } from '@angular/material/dialog';
export class BaseEditTaskFilterCloudComponent {
    constructor(formBuilder, dateAdapter, userPreferencesService, appsProcessCloudService, taskCloudService, dialog, translateService) {
        this.formBuilder = formBuilder;
        this.dateAdapter = dateAdapter;
        this.userPreferencesService = userPreferencesService;
        this.appsProcessCloudService = appsProcessCloudService;
        this.taskCloudService = taskCloudService;
        this.dialog = dialog;
        this.translateService = translateService;
        this.appName = '';
        this.showTitle = true;
        this.showTaskFilterName = true;
        this.filterProperties = [];
        this.role = '';
        this.showFilterActions = true;
        this.actions = BaseEditTaskFilterCloudComponent.DEFAULT_ACTIONS;
        this.sortProperties = [];
        this.action = new EventEmitter();
        this.applicationNames = [];
        this.processDefinitionNames = [];
        this.formHasBeenChanged = false;
        this.taskFilterProperties = [];
        this.taskFilterActions = [];
        this.toggleFilterActions = false;
        this.sortDirections = [
            { value: 'ASC', label: 'ADF_CLOUD_TASK_FILTERS.DIRECTION.ASCENDING' },
            { value: 'DESC', label: 'ADF_CLOUD_TASK_FILTERS.DIRECTION.DESCENDING' }
        ];
        this.allProcessDefinitionNamesOption = {
            value: '',
            label: 'ADF_CLOUD_TASK_FILTERS.STATUS.ALL'
        };
        this.filterChange = new EventEmitter();
        this.onDestroy$ = new Subject();
        this.isLoading = false;
    }
    ngOnInit() {
        this.userPreferencesService
            .select(UserPreferenceValues.Locale)
            .pipe(takeUntil(this.onDestroy$))
            .subscribe(locale => this.dateAdapter.setLocale(locale));
    }
    ngOnChanges(changes) {
        const id = changes['id'];
        if (id && id.currentValue !== id.previousValue) {
            this.retrieveTaskFilterAndBuildForm();
        }
    }
    ngOnDestroy() {
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
    createFilterActions() {
        return [
            {
                actionType: BaseEditTaskFilterCloudComponent.ACTION_SAVE,
                icon: 'adf:save',
                tooltip: 'ADF_CLOUD_EDIT_TASK_FILTER.TOOL_TIP.SAVE'
            },
            {
                actionType: BaseEditTaskFilterCloudComponent.ACTION_SAVE_AS,
                icon: 'adf:save-as',
                tooltip: 'ADF_CLOUD_EDIT_TASK_FILTER.TOOL_TIP.SAVE_AS'
            },
            {
                actionType: BaseEditTaskFilterCloudComponent.ACTION_DELETE,
                icon: 'delete',
                tooltip: 'ADF_CLOUD_EDIT_TASK_FILTER.TOOL_TIP.DELETE'
            }
        ];
    }
    hasFormChanged(action) {
        if (action.actionType === BaseEditTaskFilterCloudComponent.ACTION_SAVE) {
            return !this.formHasBeenChanged;
        }
        if (action.actionType === BaseEditTaskFilterCloudComponent.ACTION_SAVE_AS) {
            return !this.formHasBeenChanged;
        }
        if (action.actionType === BaseEditTaskFilterCloudComponent.ACTION_DELETE) {
            return false;
        }
        return false;
    }
    onExpand() {
        this.toggleFilterActions = true;
    }
    onClose() {
        this.toggleFilterActions = false;
    }
    isDisabledAction(action) {
        return this.isDisabledForDefaultFilters(action) ? true : this.hasFormChanged(action);
    }
    deepCompare(left, right) {
        return JSON.stringify(left).toLowerCase() === JSON.stringify(right).toLowerCase();
    }
    getSanitizeFilterName(filterName) {
        const nameWithHyphen = this.replaceSpaceWithHyphen(filterName.trim());
        return nameWithHyphen.toLowerCase();
    }
    replaceSpaceWithHyphen(name) {
        const regExt = new RegExp(' ', 'g');
        return name.replace(regExt, '-');
    }
    executeFilterActions(action) {
        if (action.actionType === BaseEditTaskFilterCloudComponent.ACTION_SAVE) {
            this.save(action);
        }
        else if (action.actionType === BaseEditTaskFilterCloudComponent.ACTION_SAVE_AS) {
            this.saveAs(action);
        }
        else if (action.actionType === BaseEditTaskFilterCloudComponent.ACTION_DELETE) {
            this.delete(action);
        }
    }
    getRunningApplications() {
        this.appsProcessCloudService
            .getDeployedApplicationsByStatus(BaseEditTaskFilterCloudComponent.APP_RUNNING_STATUS, this.role)
            .subscribe((applications) => {
            if (applications && applications.length > 0) {
                applications.map((application) => {
                    this.applicationNames.push({ label: application.name, value: application.name });
                });
            }
        });
    }
    getProcessDefinitions() {
        this.taskCloudService.getProcessDefinitions(this.appName)
            .subscribe((processDefinitions) => {
            if (processDefinitions && processDefinitions.length > 0) {
                this.processDefinitionNames.push(this.allProcessDefinitionNamesOption);
                processDefinitions.map((processDefinition) => {
                    this.processDefinitionNames.push({ label: processDefinition.name, value: processDefinition.name });
                });
            }
        });
    }
    checkMandatoryActions() {
        if (this.actions === undefined || this.actions.length === 0) {
            this.actions = BaseEditTaskFilterCloudComponent.DEFAULT_ACTIONS;
        }
    }
    isValidAction(actions, action) {
        return actions ? actions.indexOf(action.actionType) >= 0 : true;
    }
    isFormValid() {
        return this.editTaskFilterForm.valid;
    }
    getPropertyController(property) {
        return this.editTaskFilterForm.get(property.key);
    }
    onDateChanged(newDateValue, dateProperty) {
        if (newDateValue) {
            const momentDate = moment(newDateValue, BaseEditTaskFilterCloudComponent.FORMAT_DATE, true);
            const controller = this.getPropertyController(dateProperty);
            if (momentDate.isValid()) {
                controller.setValue(momentDate.toISOString(true));
                controller.setErrors(null);
            }
            else {
                controller.setErrors({ invalid: true });
            }
        }
    }
    onDateRangeFilterChanged(dateRange, property) {
        var _a, _b;
        this.editTaskFilterForm.get((_a = property.attributes) === null || _a === void 0 ? void 0 : _a.from).setValue(dateRange.startDate ? dateRange.startDate : null);
        this.editTaskFilterForm.get((_b = property.attributes) === null || _b === void 0 ? void 0 : _b.to).setValue(dateRange.endDate ? dateRange.endDate : null);
        this.editTaskFilterForm.get(property.attributes.dateType).setValue(DateCloudFilterType.RANGE);
    }
    onChangedUser(users, userProperty) {
        let selectedUsers;
        if (userProperty.selectionMode === 'single') {
            selectedUsers = users[0];
        }
        else {
            selectedUsers = users;
        }
        this.getPropertyController(userProperty).setValue(selectedUsers);
    }
    onAssignedChange(assignedValue) {
        this.editTaskFilterForm.get('candidateGroups').setValue([]);
        this.editTaskFilterForm.get('assignee').setValue(assignedValue === null || assignedValue === void 0 ? void 0 : assignedValue.username);
    }
    onAssignedGroupsChange(groups) {
        this.editTaskFilterForm.get('assignee').setValue(null);
        this.editTaskFilterForm.get('candidateGroups').setValue(groups);
    }
    hasError(property) {
        const controller = this.getPropertyController(property);
        return controller.errors && controller.errors.invalid;
    }
    hasLastModifiedProperty() {
        return this.filterProperties.indexOf(BaseEditTaskFilterCloudComponent.LAST_MODIFIED) >= 0;
    }
    get createSortProperties() {
        this.checkMandatorySortProperties();
        return this.sortProperties.map((property) => {
            return { label: property, value: property };
        });
    }
    createAndFilterActions() {
        this.checkMandatoryActions();
        return this.createFilterActions().filter(action => this.isValidAction(this.actions, action));
    }
    isValidProperty(filterProperties, key) {
        return filterProperties ? filterProperties.indexOf(key) >= 0 : true;
    }
    checkForProperty(property) {
        return this.filterProperties ? this.filterProperties.indexOf(property) >= 0 : false;
    }
    hasSortProperty() {
        return this.filterProperties.indexOf(BaseEditTaskFilterCloudComponent.SORT) >= 0;
    }
    removeOrderProperty(filteredProperties) {
        if (filteredProperties && filteredProperties.length > 0) {
            return filteredProperties.filter(property => property.key !== BaseEditTaskFilterCloudComponent.ORDER);
        }
        return [];
    }
    createAndFilterProperties() {
        this.checkMandatoryFilterProperties();
        if (this.checkForProperty(BaseEditTaskFilterCloudComponent.APPLICATION_NAME)) {
            this.applicationNames = [];
            this.getRunningApplications();
        }
        if (this.checkForProperty(BaseEditTaskFilterCloudComponent.PROCESS_DEFINITION_NAME)) {
            this.processDefinitionNames = [];
            this.getProcessDefinitions();
        }
        const defaultProperties = this.createTaskFilterProperties();
        let filteredProperties = defaultProperties.filter((filterProperty) => this.isValidProperty(this.filterProperties, filterProperty.key));
        if (!this.hasSortProperty()) {
            filteredProperties = this.removeOrderProperty(filteredProperties);
        }
        return filteredProperties;
    }
    onFilterChange() {
        this.editTaskFilterForm.valueChanges
            .pipe(debounceTime(500), filter(() => this.isFormValid()), takeUntil(this.onDestroy$))
            .subscribe((formValues) => {
            this.assignNewFilter(formValues);
        });
    }
    getFormControlsConfig(taskFilterProperties) {
        const properties = taskFilterProperties.map((property) => {
            if (!!property.attributes) {
                return this.getAttributesControlConfig(property);
            }
            else {
                return { [property.key]: property.value };
            }
        });
        return properties.reduce(((result, current) => Object.assign(result, current)), {});
    }
    getAttributesControlConfig(property) {
        return Object.values(property.attributes).reduce((result, key) => {
            result[key] = property.value[key];
            return result;
        }, {});
    }
    buildForm(taskFilterProperties) {
        this.formHasBeenChanged = false;
        this.editTaskFilterForm = this.formBuilder.group(this.getFormControlsConfig(taskFilterProperties));
        this.onFilterChange();
    }
    onDateTypeChange(dateType, property) {
        this.editTaskFilterForm.get(property.attributes.dateType).setValue(dateType);
    }
    retrieveTaskFilterAndBuildForm() {
        this.isLoading = true;
        this.getTaskFilterById(this.appName, this.id)
            .pipe(finalize(() => this.isLoading = false), takeUntil(this.onDestroy$))
            .subscribe(response => {
            this.taskFilter = response;
            this.taskFilterProperties = this.createAndFilterProperties();
            this.taskFilterActions = this.createAndFilterActions();
            this.buildForm(this.taskFilterProperties);
        });
    }
    delete(deleteAction) {
        this.deleteFilter(this.taskFilter)
            .pipe(filter((filters) => {
            deleteAction.filter = this.taskFilter;
            this.action.emit(deleteAction);
            return filters.length === 0;
        }), switchMap(() => this.restoreDefaultTaskFilters()), takeUntil(this.onDestroy$))
            .subscribe(() => { });
    }
    save(saveAction) {
        this.updateFilter(this.changedTaskFilter)
            .pipe(takeUntil(this.onDestroy$))
            .subscribe(() => {
            saveAction.filter = this.changedTaskFilter;
            this.action.emit(saveAction);
            this.formHasBeenChanged = this.deepCompare(this.changedTaskFilter, this.taskFilter);
        });
    }
    saveAs(saveAsAction) {
        var _a;
        const dialogRef = this.dialog.open(TaskFilterDialogCloudComponent, {
            data: {
                name: this.translateService.instant((_a = this.taskFilter) === null || _a === void 0 ? void 0 : _a.name)
            },
            height: 'auto',
            minWidth: '30%'
        });
        dialogRef.afterClosed().subscribe((result) => {
            if (result && result.action === TaskFilterDialogCloudComponent.ACTION_SAVE) {
                const filterId = Math.random().toString(36).substr(2, 9);
                const filterKey = this.getSanitizeFilterName(result.name);
                const newFilter = {
                    name: result.name,
                    icon: result.icon,
                    id: filterId,
                    key: 'custom-' + filterKey
                };
                const resultFilter = Object.assign({}, this.changedTaskFilter, newFilter);
                this.addFilter(resultFilter).subscribe(() => {
                    saveAsAction.filter = resultFilter;
                    this.action.emit(saveAsAction);
                });
            }
        });
    }
    checkMandatoryFilterProperties() {
        if (this.filterProperties === undefined || this.filterProperties.length === 0) {
            this.filterProperties = this.getDefaultFilterProperties();
        }
    }
    checkMandatorySortProperties() {
        if (this.sortProperties === undefined || this.sortProperties.length === 0) {
            this.sortProperties = this.getDefaultSortProperties();
        }
    }
}
BaseEditTaskFilterCloudComponent.ACTION_SAVE = 'save';
BaseEditTaskFilterCloudComponent.ACTION_SAVE_AS = 'saveAs';
BaseEditTaskFilterCloudComponent.ACTION_DELETE = 'delete';
BaseEditTaskFilterCloudComponent.APP_RUNNING_STATUS = 'RUNNING';
BaseEditTaskFilterCloudComponent.APPLICATION_NAME = 'appName';
BaseEditTaskFilterCloudComponent.PROCESS_DEFINITION_NAME = 'processDefinitionName';
BaseEditTaskFilterCloudComponent.LAST_MODIFIED = 'lastModified';
BaseEditTaskFilterCloudComponent.SORT = 'sort';
BaseEditTaskFilterCloudComponent.ORDER = 'order';
BaseEditTaskFilterCloudComponent.DEFAULT_ACTIONS = ['save', 'saveAs', 'delete'];
BaseEditTaskFilterCloudComponent.FORMAT_DATE = 'DD/MM/YYYY';
BaseEditTaskFilterCloudComponent.ACTIONS_DISABLED_BY_DEFAULT = [
    BaseEditTaskFilterCloudComponent.ACTION_SAVE,
    BaseEditTaskFilterCloudComponent.ACTION_DELETE
];
BaseEditTaskFilterCloudComponent.decorators = [
    { type: Directive }
];
BaseEditTaskFilterCloudComponent.ctorParameters = () => [
    { type: FormBuilder },
    { type: DateAdapter },
    { type: UserPreferencesService },
    { type: AppsProcessCloudService },
    { type: TaskCloudService },
    { type: MatDialog },
    { type: TranslationService }
];
BaseEditTaskFilterCloudComponent.propDecorators = {
    appName: [{ type: Input }],
    id: [{ type: Input }],
    showTitle: [{ type: Input }],
    showTaskFilterName: [{ type: Input }],
    filterProperties: [{ type: Input }],
    role: [{ type: Input }],
    showFilterActions: [{ type: Input }],
    actions: [{ type: Input }],
    sortProperties: [{ type: Input }],
    action: [{ type: Output }],
    filterChange: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS1lZGl0LXRhc2stZmlsdGVyLWNsb3VkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL3Byb2Nlc3Mtc2VydmljZXMtY2xvdWQvc3JjLyIsInNvdXJjZXMiOlsibGliL3Rhc2svdGFzay1maWx0ZXJzL2NvbXBvbmVudHMvZWRpdC10YXNrLWZpbHRlcnMvYmFzZS1lZGl0LXRhc2stZmlsdGVyLWNsb3VkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7QUFFSCxPQUFPLEVBQStDLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVwSCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUMxRSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSx1REFBdUQsQ0FBQztBQUNoRyxPQUFPLEVBQUUsbUJBQW1CLEVBQW1CLE1BQU0sNENBQTRDLENBQUM7QUFDbEcsT0FBTyxNQUFrQixNQUFNLFFBQVEsQ0FBQztBQUN4QyxPQUFPLEVBQW1CLFdBQVcsRUFBYSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEYsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDckQsT0FBTyxFQUF5QyxrQkFBa0IsRUFBRSxzQkFBc0IsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzdJLE9BQU8sRUFBRSw4QkFBOEIsRUFBRSxNQUFNLDBEQUEwRCxDQUFDO0FBQzFHLE9BQU8sRUFBRSxTQUFT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TCxLQUFLO3FCQUlMLE1BQU07MkJBd0JOLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIE9uSW5pdCwgT25EZXN0cm95LCBEaXJlY3RpdmUsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRmlsdGVyT3B0aW9ucywgVGFza0ZpbHRlckFjdGlvbiwgVGFza0ZpbHRlclByb3BlcnRpZXMgfSBmcm9tICcuLi8uLi9tb2RlbHMvZmlsdGVyLWNsb3VkLm1vZGVsJztcbmltcG9ydCB7IFRhc2tDbG91ZFNlcnZpY2UgfSBmcm9tICcuLy4uLy4uLy4uL3NlcnZpY2VzL3Rhc2stY2xvdWQuc2VydmljZSc7XG5pbXBvcnQgeyBBcHBzUHJvY2Vzc0Nsb3VkU2VydmljZSB9IGZyb20gJy4vLi4vLi4vLi4vLi4vYXBwL3NlcnZpY2VzL2FwcHMtcHJvY2Vzcy1jbG91ZC5zZXJ2aWNlJztcbmltcG9ydCB7IERhdGVDbG91ZEZpbHRlclR5cGUsIERhdGVSYW5nZUZpbHRlciB9IGZyb20gJy4uLy4uLy4uLy4uL21vZGVscy9kYXRlLWNsb3VkLWZpbHRlci5tb2RlbCc7XG5pbXBvcnQgbW9tZW50LCB7IE1vbWVudCB9IGZyb20gJ21vbWVudCc7XG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIEZvcm1CdWlsZGVyLCBGb3JtR3JvdXAgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUsIGZpbHRlciwgZmluYWxpemUsIHN3aXRjaE1hcCwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgRGF0ZUFkYXB0ZXIgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9jb3JlJztcbmltcG9ydCB7IElkZW50aXR5R3JvdXBNb2RlbCwgSWRlbnRpdHlVc2VyTW9kZWwsIFRyYW5zbGF0aW9uU2VydmljZSwgVXNlclByZWZlcmVuY2VzU2VydmljZSwgVXNlclByZWZlcmVuY2VWYWx1ZXMgfSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgVGFza0ZpbHRlckRpYWxvZ0Nsb3VkQ29tcG9uZW50IH0gZnJvbSAnLi4vdGFzay1maWx0ZXItZGlhbG9nL3Rhc2stZmlsdGVyLWRpYWxvZy1jbG91ZC5jb21wb25lbnQnO1xuaW1wb3J0IHsgTWF0RGlhbG9nIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZGlhbG9nJztcblxuZXhwb3J0IGludGVyZmFjZSBEcm9wZG93bk9wdGlvbiB7XG4gICAgdmFsdWU6IHN0cmluZztcbiAgICBsYWJlbDogc3RyaW5nO1xufVxuXG5ARGlyZWN0aXZlKClcbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogZGlyZWN0aXZlLWNsYXNzLXN1ZmZpeFxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEJhc2VFZGl0VGFza0ZpbHRlckNsb3VkQ29tcG9uZW50PFQ+IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG5cbiAgICBwdWJsaWMgc3RhdGljIEFDVElPTl9TQVZFID0gJ3NhdmUnO1xuICAgIHB1YmxpYyBzdGF0aWMgQUNUSU9OX1NBVkVfQVMgPSAnc2F2ZUFzJztcbiAgICBwdWJsaWMgc3RhdGljIEFDVElPTl9ERUxFVEUgPSAnZGVsZXRlJztcbiAgICBwdWJsaWMgc3RhdGljIEFQUF9SVU5OSU5HX1NUQVRVUzogc3RyaW5nID0gJ1JVTk5JTkcnO1xuICAgIHB1YmxpYyBzdGF0aWMgQVBQTElDQVRJT05fTkFNRTogc3RyaW5nID0gJ2FwcE5hbWUnO1xuICAgIHB1YmxpYyBzdGF0aWMgUFJPQ0VTU19ERUZJTklUSU9OX05BTUU6IHN0cmluZyA9ICdwcm9jZXNzRGVmaW5pdGlvbk5hbWUnO1xuICAgIHB1YmxpYyBzdGF0aWMgTEFTVF9NT0RJRklFRDogc3RyaW5nID0gJ2xhc3RNb2RpZmllZCc7XG4gICAgcHVibGljIHN0YXRpYyBTT1JUOiBzdHJpbmcgPSAnc29ydCc7XG4gICAgcHVibGljIHN0YXRpYyBPUkRFUjogc3RyaW5nID0gJ29yZGVyJztcbiAgICBwdWJsaWMgc3RhdGljIERFRkFVTFRfQUNUSU9OUyA9IFsnc2F2ZScsICdzYXZlQXMnLCAnZGVsZXRlJ107XG4gICAgcHVibGljIHN0YXRpYyBGT1JNQVRfREFURTogc3RyaW5nID0gJ0REL01NL1lZWVknO1xuICAgIHB1YmxpYyBzdGF0aWMgQUNUSU9OU19ESVNBQkxFRF9CWV9ERUZBVUxUID0gW1xuICAgICAgICBCYXNlRWRpdFRhc2tGaWx0ZXJDbG91ZENvbXBvbmVudC5BQ1RJT05fU0FWRSxcbiAgICAgICAgQmFzZUVkaXRUYXNrRmlsdGVyQ2xvdWRDb21wb25lbnQuQUNUSU9OX0RFTEVURVxuICAgIF07XG5cbiAgICAvKiogKHJlcXVpcmVkKSBOYW1lIG9mIHRoZSBhcHAuICovXG4gICAgQElucHV0KClcbiAgICBhcHBOYW1lOiBzdHJpbmcgPSAnJztcblxuICAgIC8qKiAocmVxdWlyZWQpIElEIG9mIHRoZSB0YXNrIGZpbHRlci4gKi9cbiAgICBASW5wdXQoKVxuICAgIGlkOiBzdHJpbmc7XG5cbiAgICAvKiogVG9nZ2xlcyB0aGUgdGl0bGUuICovXG4gICAgQElucHV0KClcbiAgICBzaG93VGl0bGUgPSB0cnVlO1xuXG4gICAgLyoqIFRvZ2dsZXMgZGlzcGxheSBvZiB0YXNrIGZpbHRlciBuYW1lICovXG4gICAgQElucHV0KClcbiAgICBzaG93VGFza0ZpbHRlck5hbWUgPSB0cnVlO1xuXG4gICAgLyoqIExpc3Qgb2YgdGFzayBmaWx0ZXIgcHJvcGVydGllcyB0byBkaXNwbGF5LiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZmlsdGVyUHJvcGVydGllczogc3RyaW5nW10gPSBbXTtcblxuICAgIC8qKiB1c2VyIHJvbGUuICovXG4gICAgQElucHV0KClcbiAgICByb2xlOiBzdHJpbmcgPSAnJztcblxuICAgIC8qKiBUb2dnbGVzIHRoZSBmaWx0ZXIgYWN0aW9ucy4gKi9cbiAgICBASW5wdXQoKVxuICAgIHNob3dGaWx0ZXJBY3Rpb25zID0gdHJ1ZTtcblxuICAgIC8qKiBMaXN0IG9mIHRhc2sgZmlsdGVyIGFjdGlvbnMuICovXG4gICAgQElucHV0KClcbiAgICBhY3Rpb25zOiBzdHJpbmdbXSA9IEJhc2VFZGl0VGFza0ZpbHRlckNsb3VkQ29tcG9uZW50LkRFRkFVTFRfQUNUSU9OUztcblxuICAgIC8qKiBMaXN0IG9mIHNvcnQgcHJvcGVydGllcyB0byBkaXNwbGF5LiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc29ydFByb3BlcnRpZXM6IHN0cmluZ1tdID0gW107XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGEgZmlsdGVyIGFjdGlvbiBvY2N1cnMgKGkuZSBTYXZlLCBTYXZlIEFzLCBEZWxldGUpLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIGFjdGlvbiA9IG5ldyBFdmVudEVtaXR0ZXI8VGFza0ZpbHRlckFjdGlvbj4oKTtcblxuICAgIHByb3RlY3RlZCBhcHBsaWNhdGlvbk5hbWVzOiBEcm9wZG93bk9wdGlvbltdID0gW107XG4gICAgcHJvdGVjdGVkIHByb2Nlc3NEZWZpbml0aW9uTmFtZXM6IERyb3Bkb3duT3B0aW9uW10gPSBbXTtcbiAgICBwcm90ZWN0ZWQgZm9ybUhhc0JlZW5DaGFuZ2VkID0gZmFsc2U7XG5cbiAgICBlZGl0VGFza0ZpbHRlckZvcm06IEZvcm1Hcm91cDtcbiAgICB0YXNrRmlsdGVyUHJvcGVydGllczogVGFza0ZpbHRlclByb3BlcnRpZXNbXSA9IFtdO1xuICAgIHRhc2tGaWx0ZXJBY3Rpb25zOiBUYXNrRmlsdGVyQWN0aW9uW10gPSBbXTtcbiAgICB0b2dnbGVGaWx0ZXJBY3Rpb25zOiBib29sZWFuID0gZmFsc2U7XG4gICAgc29ydERpcmVjdGlvbnM6IERyb3Bkb3duT3B0aW9uW10gPSBbXG4gICAgICAgIHsgdmFsdWU6ICdBU0MnLCBsYWJlbDogJ0FERl9DTE9VRF9UQVNLX0ZJTFRFUlMuRElSRUNUSU9OLkFTQ0VORElORycgfSxcbiAgICAgICAgeyB2YWx1ZTogJ0RFU0MnLCBsYWJlbDogJ0FERl9DTE9VRF9UQVNLX0ZJTFRFUlMuRElSRUNUSU9OLkRFU0NFTkRJTkcnIH1cbiAgICBdO1xuICAgIGFsbFByb2Nlc3NEZWZpbml0aW9uTmFtZXNPcHRpb246IERyb3Bkb3duT3B0aW9uID0ge1xuICAgICAgICB2YWx1ZTogJycsXG4gICAgICAgIGxhYmVsOiAnQURGX0NMT1VEX1RBU0tfRklMVEVSUy5TVEFUVVMuQUxMJ1xuICAgIH07XG5cbiAgICB0YXNrRmlsdGVyOiBUO1xuICAgIGNoYW5nZWRUYXNrRmlsdGVyOiBUO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBhIHRhc2sgZmlsdGVyIHByb3BlcnR5IGNoYW5nZXMuICovXG4gICAgQE91dHB1dCgpXG4gICAgZmlsdGVyQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxUPigpO1xuXG4gICAgcHJvdGVjdGVkIG9uRGVzdHJveSQgPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xuICAgIGlzTG9hZGluZzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByb3RlY3RlZCBmb3JtQnVpbGRlcjogRm9ybUJ1aWxkZXIsXG4gICAgICAgIHByb3RlY3RlZCBkYXRlQWRhcHRlcjogRGF0ZUFkYXB0ZXI8TW9tZW50PixcbiAgICAgICAgcHJvdGVjdGVkIHVzZXJQcmVmZXJlbmNlc1NlcnZpY2U6IFVzZXJQcmVmZXJlbmNlc1NlcnZpY2UsXG4gICAgICAgIHByb3RlY3RlZCBhcHBzUHJvY2Vzc0Nsb3VkU2VydmljZTogQXBwc1Byb2Nlc3NDbG91ZFNlcnZpY2UsXG4gICAgICAgIHByb3RlY3RlZCB0YXNrQ2xvdWRTZXJ2aWNlOiBUYXNrQ2xvdWRTZXJ2aWNlLFxuICAgICAgICBwcm90ZWN0ZWQgZGlhbG9nOiBNYXREaWFsb2csXG4gICAgICAgIHByb3RlY3RlZCB0cmFuc2xhdGVTZXJ2aWNlOiBUcmFuc2xhdGlvblNlcnZpY2UpIHtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy51c2VyUHJlZmVyZW5jZXNTZXJ2aWNlXG4gICAgICAgICAgICAuc2VsZWN0KFVzZXJQcmVmZXJlbmNlVmFsdWVzLkxvY2FsZSlcbiAgICAgICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpKVxuICAgICAgICAgICAgLnN1YnNjcmliZShsb2NhbGUgPT4gdGhpcy5kYXRlQWRhcHRlci5zZXRMb2NhbGUobG9jYWxlKSk7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgICAgICBjb25zdCBpZCA9IGNoYW5nZXNbJ2lkJ107XG4gICAgICAgIGlmIChpZCAmJiBpZC5jdXJyZW50VmFsdWUgIT09IGlkLnByZXZpb3VzVmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMucmV0cmlldmVUYXNrRmlsdGVyQW5kQnVpbGRGb3JtKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLm5leHQodHJ1ZSk7XG4gICAgICAgIHRoaXMub25EZXN0cm95JC5jb21wbGV0ZSgpO1xuICAgIH1cblxuICAgIGNyZWF0ZUZpbHRlckFjdGlvbnMoKTogVGFza0ZpbHRlckFjdGlvbltdIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlOiBCYXNlRWRpdFRhc2tGaWx0ZXJDbG91ZENvbXBvbmVudC5BQ1RJT05fU0FWRSxcbiAgICAgICAgICAgICAgICBpY29uOiAnYWRmOnNhdmUnLFxuICAgICAgICAgICAgICAgIHRvb2x0aXA6ICdBREZfQ0xPVURfRURJVF9UQVNLX0ZJTFRFUi5UT09MX1RJUC5TQVZFJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlOiBCYXNlRWRpdFRhc2tGaWx0ZXJDbG91ZENvbXBvbmVudC5BQ1RJT05fU0FWRV9BUyxcbiAgICAgICAgICAgICAgICBpY29uOiAnYWRmOnNhdmUtYXMnLFxuICAgICAgICAgICAgICAgIHRvb2x0aXA6ICdBREZfQ0xPVURfRURJVF9UQVNLX0ZJTFRFUi5UT09MX1RJUC5TQVZFX0FTJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlOiBCYXNlRWRpdFRhc2tGaWx0ZXJDbG91ZENvbXBvbmVudC5BQ1RJT05fREVMRVRFLFxuICAgICAgICAgICAgICAgIGljb246ICdkZWxldGUnLFxuICAgICAgICAgICAgICAgIHRvb2x0aXA6ICdBREZfQ0xPVURfRURJVF9UQVNLX0ZJTFRFUi5UT09MX1RJUC5ERUxFVEUnXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG4gICAgfVxuXG4gICAgaGFzRm9ybUNoYW5nZWQoYWN0aW9uOiBUYXNrRmlsdGVyQWN0aW9uKTogYm9vbGVhbiB7XG4gICAgICAgIGlmIChhY3Rpb24uYWN0aW9uVHlwZSA9PT0gQmFzZUVkaXRUYXNrRmlsdGVyQ2xvdWRDb21wb25lbnQuQUNUSU9OX1NBVkUpIHtcbiAgICAgICAgICAgIHJldHVybiAhdGhpcy5mb3JtSGFzQmVlbkNoYW5nZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFjdGlvbi5hY3Rpb25UeXBlID09PSBCYXNlRWRpdFRhc2tGaWx0ZXJDbG91ZENvbXBvbmVudC5BQ1RJT05fU0FWRV9BUykge1xuICAgICAgICAgICAgcmV0dXJuICF0aGlzLmZvcm1IYXNCZWVuQ2hhbmdlZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWN0aW9uLmFjdGlvblR5cGUgPT09IEJhc2VFZGl0VGFza0ZpbHRlckNsb3VkQ29tcG9uZW50LkFDVElPTl9ERUxFVEUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBvbkV4cGFuZCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy50b2dnbGVGaWx0ZXJBY3Rpb25zID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBvbkNsb3NlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnRvZ2dsZUZpbHRlckFjdGlvbnMgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBpc0Rpc2FibGVkQWN0aW9uKGFjdGlvbjogVGFza0ZpbHRlckFjdGlvbik6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5pc0Rpc2FibGVkRm9yRGVmYXVsdEZpbHRlcnMoYWN0aW9uKSA/IHRydWUgOiB0aGlzLmhhc0Zvcm1DaGFuZ2VkKGFjdGlvbik7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGRlZXBDb21wYXJlKGxlZnQ6IGFueSwgcmlnaHQ6IGFueSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobGVmdCkudG9Mb3dlckNhc2UoKSA9PT0gSlNPTi5zdHJpbmdpZnkocmlnaHQpLnRvTG93ZXJDYXNlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIGZpbHRlciBuYW1lXG4gICAgICogQHBhcmFtIGZpbHRlck5hbWVcbiAgICAgKi9cbiAgICBnZXRTYW5pdGl6ZUZpbHRlck5hbWUoZmlsdGVyTmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgbmFtZVdpdGhIeXBoZW4gPSB0aGlzLnJlcGxhY2VTcGFjZVdpdGhIeXBoZW4oZmlsdGVyTmFtZS50cmltKCkpO1xuICAgICAgICByZXR1cm4gbmFtZVdpdGhIeXBoZW4udG9Mb3dlckNhc2UoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlcGxhY2VTcGFjZVdpdGhIeXBoZW4obmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgcmVnRXh0ID0gbmV3IFJlZ0V4cCgnICcsICdnJyk7XG4gICAgICAgIHJldHVybiBuYW1lLnJlcGxhY2UocmVnRXh0LCAnLScpO1xuICAgIH1cblxuICAgIGV4ZWN1dGVGaWx0ZXJBY3Rpb25zKGFjdGlvbjogVGFza0ZpbHRlckFjdGlvbik6IHZvaWQge1xuICAgICAgICBpZiAoYWN0aW9uLmFjdGlvblR5cGUgPT09IEJhc2VFZGl0VGFza0ZpbHRlckNsb3VkQ29tcG9uZW50LkFDVElPTl9TQVZFKSB7XG4gICAgICAgICAgICB0aGlzLnNhdmUoYWN0aW9uKTtcbiAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24uYWN0aW9uVHlwZSA9PT0gQmFzZUVkaXRUYXNrRmlsdGVyQ2xvdWRDb21wb25lbnQuQUNUSU9OX1NBVkVfQVMpIHtcbiAgICAgICAgICAgIHRoaXMuc2F2ZUFzKGFjdGlvbik7XG4gICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLmFjdGlvblR5cGUgPT09IEJhc2VFZGl0VGFza0ZpbHRlckNsb3VkQ29tcG9uZW50LkFDVElPTl9ERUxFVEUpIHtcbiAgICAgICAgICAgIHRoaXMuZGVsZXRlKGFjdGlvbik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRSdW5uaW5nQXBwbGljYXRpb25zKCkge1xuICAgICAgICB0aGlzLmFwcHNQcm9jZXNzQ2xvdWRTZXJ2aWNlXG4gICAgICAgICAgICAuZ2V0RGVwbG95ZWRBcHBsaWNhdGlvbnNCeVN0YXR1cyhCYXNlRWRpdFRhc2tGaWx0ZXJDbG91ZENvbXBvbmVudC5BUFBfUlVOTklOR19TVEFUVVMsIHRoaXMucm9sZSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKGFwcGxpY2F0aW9ucykgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChhcHBsaWNhdGlvbnMgJiYgYXBwbGljYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgYXBwbGljYXRpb25zLm1hcCgoYXBwbGljYXRpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbGljYXRpb25OYW1lcy5wdXNoKHsgbGFiZWw6IGFwcGxpY2F0aW9uLm5hbWUsIHZhbHVlOiBhcHBsaWNhdGlvbi5uYW1lIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXRQcm9jZXNzRGVmaW5pdGlvbnMoKSB7XG4gICAgICAgIHRoaXMudGFza0Nsb3VkU2VydmljZS5nZXRQcm9jZXNzRGVmaW5pdGlvbnModGhpcy5hcHBOYW1lKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgocHJvY2Vzc0RlZmluaXRpb25zKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NEZWZpbml0aW9ucyAmJiBwcm9jZXNzRGVmaW5pdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NEZWZpbml0aW9uTmFtZXMucHVzaCh0aGlzLmFsbFByb2Nlc3NEZWZpbml0aW9uTmFtZXNPcHRpb24pO1xuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzRGVmaW5pdGlvbnMubWFwKChwcm9jZXNzRGVmaW5pdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzRGVmaW5pdGlvbk5hbWVzLnB1c2goeyBsYWJlbDogcHJvY2Vzc0RlZmluaXRpb24ubmFtZSwgdmFsdWU6IHByb2Nlc3NEZWZpbml0aW9uLm5hbWUgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNoZWNrTWFuZGF0b3J5QWN0aW9ucygpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuYWN0aW9ucyA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuYWN0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aW9ucyA9IEJhc2VFZGl0VGFza0ZpbHRlckNsb3VkQ29tcG9uZW50LkRFRkFVTFRfQUNUSU9OUztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaXNWYWxpZEFjdGlvbihhY3Rpb25zOiBzdHJpbmdbXSwgYWN0aW9uOiBhbnkpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGFjdGlvbnMgPyBhY3Rpb25zLmluZGV4T2YoYWN0aW9uLmFjdGlvblR5cGUpID49IDAgOiB0cnVlO1xuICAgIH1cblxuICAgIGlzRm9ybVZhbGlkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5lZGl0VGFza0ZpbHRlckZvcm0udmFsaWQ7XG4gICAgfVxuXG4gICAgZ2V0UHJvcGVydHlDb250cm9sbGVyKHByb3BlcnR5OiBUYXNrRmlsdGVyUHJvcGVydGllcyk6IEFic3RyYWN0Q29udHJvbCB7XG4gICAgICAgIHJldHVybiB0aGlzLmVkaXRUYXNrRmlsdGVyRm9ybS5nZXQocHJvcGVydHkua2V5KTtcbiAgICB9XG5cbiAgICBvbkRhdGVDaGFuZ2VkKG5ld0RhdGVWYWx1ZTogYW55LCBkYXRlUHJvcGVydHk6IFRhc2tGaWx0ZXJQcm9wZXJ0aWVzKSB7XG4gICAgICAgIGlmIChuZXdEYXRlVmFsdWUpIHtcbiAgICAgICAgICAgIGNvbnN0IG1vbWVudERhdGUgPSBtb21lbnQobmV3RGF0ZVZhbHVlLCBCYXNlRWRpdFRhc2tGaWx0ZXJDbG91ZENvbXBvbmVudC5GT1JNQVRfREFURSwgdHJ1ZSk7XG4gICAgICAgICAgICBjb25zdCBjb250cm9sbGVyID0gdGhpcy5nZXRQcm9wZXJ0eUNvbnRyb2xsZXIoZGF0ZVByb3BlcnR5KTtcblxuICAgICAgICAgICAgaWYgKG1vbWVudERhdGUuaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlci5zZXRWYWx1ZShtb21lbnREYXRlLnRvSVNPU3RyaW5nKHRydWUpKTtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyLnNldEVycm9ycyhudWxsKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlci5zZXRFcnJvcnMoeyBpbnZhbGlkOiB0cnVlIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25EYXRlUmFuZ2VGaWx0ZXJDaGFuZ2VkKGRhdGVSYW5nZTogRGF0ZVJhbmdlRmlsdGVyLCBwcm9wZXJ0eTogVGFza0ZpbHRlclByb3BlcnRpZXMpIHtcbiAgICAgICAgdGhpcy5lZGl0VGFza0ZpbHRlckZvcm0uZ2V0KHByb3BlcnR5LmF0dHJpYnV0ZXM/LmZyb20pLnNldFZhbHVlKFxuICAgICAgICAgICAgZGF0ZVJhbmdlLnN0YXJ0RGF0ZSA/IGRhdGVSYW5nZS5zdGFydERhdGUgOiBudWxsXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuZWRpdFRhc2tGaWx0ZXJGb3JtLmdldChwcm9wZXJ0eS5hdHRyaWJ1dGVzPy50bykuc2V0VmFsdWUoXG4gICAgICAgICAgICBkYXRlUmFuZ2UuZW5kRGF0ZSA/IGRhdGVSYW5nZS5lbmREYXRlIDogbnVsbFxuICAgICAgICApO1xuICAgICAgICB0aGlzLmVkaXRUYXNrRmlsdGVyRm9ybS5nZXQocHJvcGVydHkuYXR0cmlidXRlcy5kYXRlVHlwZSkuc2V0VmFsdWUoRGF0ZUNsb3VkRmlsdGVyVHlwZS5SQU5HRSk7XG4gICAgfVxuXG4gICAgb25DaGFuZ2VkVXNlcih1c2VyczogSWRlbnRpdHlVc2VyTW9kZWxbXSwgdXNlclByb3BlcnR5OiBUYXNrRmlsdGVyUHJvcGVydGllcykge1xuICAgICAgICBsZXQgc2VsZWN0ZWRVc2VycztcbiAgICAgICAgaWYgKHVzZXJQcm9wZXJ0eS5zZWxlY3Rpb25Nb2RlID09PSAnc2luZ2xlJykge1xuICAgICAgICAgICAgc2VsZWN0ZWRVc2VycyA9IHVzZXJzWzBdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2VsZWN0ZWRVc2VycyA9IHVzZXJzO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZ2V0UHJvcGVydHlDb250cm9sbGVyKHVzZXJQcm9wZXJ0eSkuc2V0VmFsdWUoc2VsZWN0ZWRVc2Vycyk7XG4gICAgfVxuXG4gICAgb25Bc3NpZ25lZENoYW5nZShhc3NpZ25lZFZhbHVlOiBJZGVudGl0eVVzZXJNb2RlbCkge1xuICAgICAgICB0aGlzLmVkaXRUYXNrRmlsdGVyRm9ybS5nZXQoJ2NhbmRpZGF0ZUdyb3VwcycpLnNldFZhbHVlKFtdKTtcbiAgICAgICAgdGhpcy5lZGl0VGFza0ZpbHRlckZvcm0uZ2V0KCdhc3NpZ25lZScpLnNldFZhbHVlKGFzc2lnbmVkVmFsdWU/LnVzZXJuYW1lKTtcbiAgICB9XG5cbiAgICBvbkFzc2lnbmVkR3JvdXBzQ2hhbmdlKGdyb3VwczogSWRlbnRpdHlHcm91cE1vZGVsW10pIHtcbiAgICAgICAgdGhpcy5lZGl0VGFza0ZpbHRlckZvcm0uZ2V0KCdhc3NpZ25lZScpLnNldFZhbHVlKG51bGwpO1xuICAgICAgICB0aGlzLmVkaXRUYXNrRmlsdGVyRm9ybS5nZXQoJ2NhbmRpZGF0ZUdyb3VwcycpLnNldFZhbHVlKGdyb3Vwcyk7XG4gICAgfVxuXG4gICAgaGFzRXJyb3IocHJvcGVydHk6IFRhc2tGaWx0ZXJQcm9wZXJ0aWVzKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGNvbnRyb2xsZXIgPSB0aGlzLmdldFByb3BlcnR5Q29udHJvbGxlcihwcm9wZXJ0eSk7XG4gICAgICAgIHJldHVybiBjb250cm9sbGVyLmVycm9ycyAmJiBjb250cm9sbGVyLmVycm9ycy5pbnZhbGlkO1xuICAgIH1cblxuICAgIGhhc0xhc3RNb2RpZmllZFByb3BlcnR5KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJQcm9wZXJ0aWVzLmluZGV4T2YoQmFzZUVkaXRUYXNrRmlsdGVyQ2xvdWRDb21wb25lbnQuTEFTVF9NT0RJRklFRCkgPj0gMDtcbiAgICB9XG5cbiAgICBnZXQgY3JlYXRlU29ydFByb3BlcnRpZXMoKTogRmlsdGVyT3B0aW9uc1tdIHtcbiAgICAgICAgdGhpcy5jaGVja01hbmRhdG9yeVNvcnRQcm9wZXJ0aWVzKCk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuc29ydFByb3BlcnRpZXMubWFwKChwcm9wZXJ0eTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4geyBsYWJlbDogcHJvcGVydHksIHZhbHVlOiBwcm9wZXJ0eSB9O1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjcmVhdGVBbmRGaWx0ZXJBY3Rpb25zKCk6IFRhc2tGaWx0ZXJBY3Rpb25bXSB7XG4gICAgICAgIHRoaXMuY2hlY2tNYW5kYXRvcnlBY3Rpb25zKCk7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUZpbHRlckFjdGlvbnMoKS5maWx0ZXIoYWN0aW9uID0+IHRoaXMuaXNWYWxpZEFjdGlvbih0aGlzLmFjdGlvbnMsIGFjdGlvbikpO1xuICAgIH1cblxuICAgIGlzVmFsaWRQcm9wZXJ0eShmaWx0ZXJQcm9wZXJ0aWVzOiBzdHJpbmdbXSwga2V5OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGZpbHRlclByb3BlcnRpZXMgPyBmaWx0ZXJQcm9wZXJ0aWVzLmluZGV4T2Yoa2V5KSA+PSAwIDogdHJ1ZTtcbiAgICB9XG5cbiAgICBjaGVja0ZvclByb3BlcnR5KHByb3BlcnR5OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyUHJvcGVydGllcyA/IHRoaXMuZmlsdGVyUHJvcGVydGllcy5pbmRleE9mKHByb3BlcnR5KSA+PSAwIDogZmFsc2U7XG4gICAgfVxuXG4gICAgaGFzU29ydFByb3BlcnR5KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJQcm9wZXJ0aWVzLmluZGV4T2YoQmFzZUVkaXRUYXNrRmlsdGVyQ2xvdWRDb21wb25lbnQuU09SVCkgPj0gMDtcbiAgICB9XG5cbiAgICByZW1vdmVPcmRlclByb3BlcnR5KGZpbHRlcmVkUHJvcGVydGllczogVGFza0ZpbHRlclByb3BlcnRpZXNbXSk6IFRhc2tGaWx0ZXJQcm9wZXJ0aWVzW10ge1xuICAgICAgICBpZiAoZmlsdGVyZWRQcm9wZXJ0aWVzICYmIGZpbHRlcmVkUHJvcGVydGllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmlsdGVyZWRQcm9wZXJ0aWVzLmZpbHRlcihwcm9wZXJ0eSA9PiBwcm9wZXJ0eS5rZXkgIT09IEJhc2VFZGl0VGFza0ZpbHRlckNsb3VkQ29tcG9uZW50Lk9SREVSKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgY3JlYXRlQW5kRmlsdGVyUHJvcGVydGllcygpIHtcbiAgICAgICAgdGhpcy5jaGVja01hbmRhdG9yeUZpbHRlclByb3BlcnRpZXMoKTtcblxuICAgICAgICBpZiAodGhpcy5jaGVja0ZvclByb3BlcnR5KEJhc2VFZGl0VGFza0ZpbHRlckNsb3VkQ29tcG9uZW50LkFQUExJQ0FUSU9OX05BTUUpKSB7XG4gICAgICAgICAgICB0aGlzLmFwcGxpY2F0aW9uTmFtZXMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuZ2V0UnVubmluZ0FwcGxpY2F0aW9ucygpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNoZWNrRm9yUHJvcGVydHkoQmFzZUVkaXRUYXNrRmlsdGVyQ2xvdWRDb21wb25lbnQuUFJPQ0VTU19ERUZJTklUSU9OX05BTUUpKSB7XG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NEZWZpbml0aW9uTmFtZXMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuZ2V0UHJvY2Vzc0RlZmluaXRpb25zKCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBkZWZhdWx0UHJvcGVydGllcyA9IHRoaXMuY3JlYXRlVGFza0ZpbHRlclByb3BlcnRpZXMoKTtcbiAgICAgICAgbGV0IGZpbHRlcmVkUHJvcGVydGllcyA9IGRlZmF1bHRQcm9wZXJ0aWVzLmZpbHRlcigoZmlsdGVyUHJvcGVydHkpID0+IHRoaXMuaXNWYWxpZFByb3BlcnR5KHRoaXMuZmlsdGVyUHJvcGVydGllcywgZmlsdGVyUHJvcGVydHkua2V5KSk7XG5cbiAgICAgICAgaWYgKCF0aGlzLmhhc1NvcnRQcm9wZXJ0eSgpKSB7XG4gICAgICAgICAgICBmaWx0ZXJlZFByb3BlcnRpZXMgPSB0aGlzLnJlbW92ZU9yZGVyUHJvcGVydHkoZmlsdGVyZWRQcm9wZXJ0aWVzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmaWx0ZXJlZFByb3BlcnRpZXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgZm9yIGVkaXQgdGFzayBmaWx0ZXIgZm9ybSBjaGFuZ2VzXG4gICAgICovXG4gICAgb25GaWx0ZXJDaGFuZ2UoKSB7XG4gICAgICAgIHRoaXMuZWRpdFRhc2tGaWx0ZXJGb3JtLnZhbHVlQ2hhbmdlc1xuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgZGVib3VuY2VUaW1lKDUwMCksXG4gICAgICAgICAgICAgICAgZmlsdGVyKCgpID0+IHRoaXMuaXNGb3JtVmFsaWQoKSksXG4gICAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMub25EZXN0cm95JClcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKGZvcm1WYWx1ZXMpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2lnbk5ld0ZpbHRlcihmb3JtVmFsdWVzKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldEZvcm1Db250cm9sc0NvbmZpZyh0YXNrRmlsdGVyUHJvcGVydGllczogVGFza0ZpbHRlclByb3BlcnRpZXNbXSk6IGFueSB7XG4gICAgICAgIGNvbnN0IHByb3BlcnRpZXMgPSB0YXNrRmlsdGVyUHJvcGVydGllcy5tYXAoKHByb3BlcnR5KSA9PiB7XG4gICAgICAgICAgICBpZiAoISFwcm9wZXJ0eS5hdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlc0NvbnRyb2xDb25maWcocHJvcGVydHkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBbcHJvcGVydHkua2V5XTogcHJvcGVydHkudmFsdWUgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBwcm9wZXJ0aWVzLnJlZHVjZSgoKHJlc3VsdCwgY3VycmVudCkgPT4gT2JqZWN0LmFzc2lnbihyZXN1bHQsIGN1cnJlbnQpKSwge30pO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0QXR0cmlidXRlc0NvbnRyb2xDb25maWcocHJvcGVydHk6IFRhc2tGaWx0ZXJQcm9wZXJ0aWVzKSB7XG4gICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKHByb3BlcnR5LmF0dHJpYnV0ZXMpLnJlZHVjZSgocmVzdWx0LCBrZXkpID0+IHtcbiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gcHJvcGVydHkudmFsdWVba2V5XTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0sIHt9KTtcbiAgICB9XG5cbiAgICBidWlsZEZvcm0odGFza0ZpbHRlclByb3BlcnRpZXM6IFRhc2tGaWx0ZXJQcm9wZXJ0aWVzW10pIHtcbiAgICAgICAgdGhpcy5mb3JtSGFzQmVlbkNoYW5nZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5lZGl0VGFza0ZpbHRlckZvcm0gPSB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKHRoaXMuZ2V0Rm9ybUNvbnRyb2xzQ29uZmlnKHRhc2tGaWx0ZXJQcm9wZXJ0aWVzKSk7XG4gICAgICAgIHRoaXMub25GaWx0ZXJDaGFuZ2UoKTtcbiAgICB9XG5cbiAgICBvbkRhdGVUeXBlQ2hhbmdlKGRhdGVUeXBlOiBEYXRlQ2xvdWRGaWx0ZXJUeXBlLCBwcm9wZXJ0eTogVGFza0ZpbHRlclByb3BlcnRpZXMpIHtcbiAgICAgICAgdGhpcy5lZGl0VGFza0ZpbHRlckZvcm0uZ2V0KHByb3BlcnR5LmF0dHJpYnV0ZXMuZGF0ZVR5cGUpLnNldFZhbHVlKGRhdGVUeXBlKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgcmV0cmlldmVUYXNrRmlsdGVyQW5kQnVpbGRGb3JtKCkge1xuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG5cbiAgICAgICAgdGhpcy5nZXRUYXNrRmlsdGVyQnlJZCh0aGlzLmFwcE5hbWUsIHRoaXMuaWQpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBmaW5hbGl6ZSgoKSA9PiB0aGlzLmlzTG9hZGluZyA9IGZhbHNlKSxcbiAgICAgICAgICAgICAgICB0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLnN1YnNjcmliZShyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy50YXNrRmlsdGVyID0gcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgdGhpcy50YXNrRmlsdGVyUHJvcGVydGllcyA9IHRoaXMuY3JlYXRlQW5kRmlsdGVyUHJvcGVydGllcygpO1xuICAgICAgICAgICAgICAgIHRoaXMudGFza0ZpbHRlckFjdGlvbnMgPSB0aGlzLmNyZWF0ZUFuZEZpbHRlckFjdGlvbnMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJ1aWxkRm9ybSh0aGlzLnRhc2tGaWx0ZXJQcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGRlbGV0ZShkZWxldGVBY3Rpb246IFRhc2tGaWx0ZXJBY3Rpb24pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kZWxldGVGaWx0ZXIodGhpcy50YXNrRmlsdGVyKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgZmlsdGVyKChmaWx0ZXJzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZUFjdGlvbi5maWx0ZXIgPSB0aGlzLnRhc2tGaWx0ZXI7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uLmVtaXQoZGVsZXRlQWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlcnMubGVuZ3RoID09PSAwO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIHN3aXRjaE1hcCgoKSA9PiB0aGlzLnJlc3RvcmVEZWZhdWx0VGFza0ZpbHRlcnMoKSksXG4gICAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMub25EZXN0cm95JCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHsgfSk7XG4gICAgfVxuXG4gICAgc2F2ZShzYXZlQWN0aW9uOiBUYXNrRmlsdGVyQWN0aW9uKTogdm9pZCB7XG4gICAgICAgIHRoaXMudXBkYXRlRmlsdGVyKHRoaXMuY2hhbmdlZFRhc2tGaWx0ZXIpXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNhdmVBY3Rpb24uZmlsdGVyID0gdGhpcy5jaGFuZ2VkVGFza0ZpbHRlcjtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGlvbi5lbWl0KHNhdmVBY3Rpb24pO1xuICAgICAgICAgICAgICAgIHRoaXMuZm9ybUhhc0JlZW5DaGFuZ2VkID0gdGhpcy5kZWVwQ29tcGFyZSh0aGlzLmNoYW5nZWRUYXNrRmlsdGVyLCB0aGlzLnRhc2tGaWx0ZXIpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2F2ZUFzKHNhdmVBc0FjdGlvbjogVGFza0ZpbHRlckFjdGlvbik6IHZvaWQge1xuICAgICAgICBjb25zdCBkaWFsb2dSZWYgPSB0aGlzLmRpYWxvZy5vcGVuKFRhc2tGaWx0ZXJEaWFsb2dDbG91ZENvbXBvbmVudCwge1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMudHJhbnNsYXRlU2VydmljZS5pbnN0YW50KCh0aGlzLnRhc2tGaWx0ZXIgYXMgYW55KT8ubmFtZSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoZWlnaHQ6ICdhdXRvJyxcbiAgICAgICAgICAgIG1pbldpZHRoOiAnMzAlJ1xuICAgICAgICB9KTtcbiAgICAgICAgZGlhbG9nUmVmLmFmdGVyQ2xvc2VkKCkuc3Vic2NyaWJlKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmFjdGlvbiA9PT0gVGFza0ZpbHRlckRpYWxvZ0Nsb3VkQ29tcG9uZW50LkFDVElPTl9TQVZFKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsdGVySWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsdGVyS2V5ID0gdGhpcy5nZXRTYW5pdGl6ZUZpbHRlck5hbWUocmVzdWx0Lm5hbWUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0ZpbHRlciA9IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogcmVzdWx0Lm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGljb246IHJlc3VsdC5pY29uLFxuICAgICAgICAgICAgICAgICAgICBpZDogZmlsdGVySWQsXG4gICAgICAgICAgICAgICAgICAgIGtleTogJ2N1c3RvbS0nICsgZmlsdGVyS2V5XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHRGaWx0ZXI6IFQgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmNoYW5nZWRUYXNrRmlsdGVyLCBuZXdGaWx0ZXIpO1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkRmlsdGVyKHJlc3VsdEZpbHRlcikuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc2F2ZUFzQWN0aW9uLmZpbHRlciA9IHJlc3VsdEZpbHRlcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb24uZW1pdChzYXZlQXNBY3Rpb24pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjaGVja01hbmRhdG9yeUZpbHRlclByb3BlcnRpZXMoKSB7XG4gICAgICAgIGlmICh0aGlzLmZpbHRlclByb3BlcnRpZXMgPT09IHVuZGVmaW5lZCB8fCB0aGlzLmZpbHRlclByb3BlcnRpZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmZpbHRlclByb3BlcnRpZXMgPSB0aGlzLmdldERlZmF1bHRGaWx0ZXJQcm9wZXJ0aWVzKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjaGVja01hbmRhdG9yeVNvcnRQcm9wZXJ0aWVzKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5zb3J0UHJvcGVydGllcyA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuc29ydFByb3BlcnRpZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnNvcnRQcm9wZXJ0aWVzID0gdGhpcy5nZXREZWZhdWx0U29ydFByb3BlcnRpZXMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFic3RyYWN0IGdldERlZmF1bHRGaWx0ZXJQcm9wZXJ0aWVzKCk6IHN0cmluZ1tdO1xuICAgIGFic3RyYWN0IGdldERlZmF1bHRTb3J0UHJvcGVydGllcygpOiBzdHJpbmdbXTtcbiAgICBhYnN0cmFjdCBpc0Rpc2FibGVkRm9yRGVmYXVsdEZpbHRlcnMoYWN0aW9uOiBUYXNrRmlsdGVyQWN0aW9uKTogYm9vbGVhbjtcbiAgICBhYnN0cmFjdCBjcmVhdGVUYXNrRmlsdGVyUHJvcGVydGllcygpOiBUYXNrRmlsdGVyUHJvcGVydGllc1tdO1xuICAgIHByb3RlY3RlZCBhYnN0cmFjdCBnZXRUYXNrRmlsdGVyQnlJZChhcHBOYW1lOiBzdHJpbmcsIGlkOiBzdHJpbmcpO1xuICAgIGFic3RyYWN0IGFzc2lnbk5ld0ZpbHRlcihmb3JtVmFsdWVzKTogdm9pZDtcblxuICAgIHByb3RlY3RlZCBhYnN0cmFjdCByZXN0b3JlRGVmYXVsdFRhc2tGaWx0ZXJzKCk6IE9ic2VydmFibGU8VFtdPjtcbiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgYWRkRmlsdGVyKGZpbHRlclRvQWRkOiBUKTogT2JzZXJ2YWJsZTxhbnk+O1xuICAgIHByb3RlY3RlZCBhYnN0cmFjdCBkZWxldGVGaWx0ZXIoZmlsdGVyVG9EZWxldGU6IFQpOiBPYnNlcnZhYmxlPFRbXT47XG4gICAgcHJvdGVjdGVkIGFic3RyYWN0IHVwZGF0ZUZpbHRlcihmaWx0ZXJUb1VwZGF0ZTogVCk6IE9ic2VydmFibGU8YW55Pjtcbn1cbiJdfQ==