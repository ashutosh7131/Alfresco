/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, Input, EventEmitter, Output, ViewEncapsulation } from '@angular/core';
import { takeUntil, concatMap, catchError, finalize } from 'rxjs/operators';
import { Subject, of, forkJoin } from 'rxjs';
import { CardViewDateItemModel, CardViewTextItemModel, CardViewArrayItemModel, TranslationService, AppConfigService, CardViewUpdateService, CardViewDatetimeItemModel, CardViewSelectItemModel } from '@alfresco/adf-core';
import { TaskCloudService } from '../../services/task-cloud.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../../services/task-cloud.service';
import * as ɵngcc2 from '@alfresco/adf-core';
import * as ɵngcc3 from '@angular/common';
import * as ɵngcc4 from '@angular/material/card';
import * as ɵngcc5 from '@angular/material/progress-spinner';

function TaskHeaderCloudComponent_h3_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "h3", 4);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ctx_r0.taskDetails == null ? null : ctx_r0.taskDetails.name);
} }
function TaskHeaderCloudComponent_mat_card_2_adf_card_view_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "adf-card-view", 7);
} if (rf & 2) {
    const ctx_r4 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("displayNoneOption", false)("properties", ctx_r4.properties)("editable", ctx_r4.isTaskEditable())("displayClearAction", ctx_r4.displayDateClearAction);
} }
function TaskHeaderCloudComponent_mat_card_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "mat-card", 5);
    ɵngcc0.ɵɵelementStart(1, "mat-card-content");
    ɵngcc0.ɵɵtemplate(2, TaskHeaderCloudComponent_mat_card_2_adf_card_view_2_Template, 1, 4, "adf-card-view", 6);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    const _r2 = ɵngcc0.ɵɵreference(4);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r1.isLoading)("ngIfElse", _r2);
} }
function TaskHeaderCloudComponent_ng_template_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 8);
    ɵngcc0.ɵɵelement(1, "mat-spinner");
    ɵngcc0.ɵɵelementEnd();
} }
export class TaskHeaderCloudComponent {
    constructor(taskCloudService, translationService, appConfig, cardViewUpdateService) {
        this.taskCloudService = taskCloudService;
        this.translationService = translationService;
        this.appConfig = appConfig;
        this.cardViewUpdateService = cardViewUpdateService;
        this.appName = '';
        this.showTitle = true;
        this.claim = new EventEmitter();
        this.unclaim = new EventEmitter();
        this.error = new EventEmitter();
        this.taskDetails = {};
        this.candidateUsers = [];
        this.candidateGroups = [];
        this.inEdit = false;
        this.displayDateClearAction = false;
        this.isLoading = true;
        this.onDestroy$ = new Subject();
        this.dateFormat = this.appConfig.get('dateValues.defaultDateFormat');
        this.dateLocale = this.appConfig.get('dateValues.defaultDateLocale');
        this.dateTimeFormat = this.appConfig.get('dateValue.defaultDateTimeFormat');
    }
    ngOnInit() {
        this.taskCloudService.dataChangesDetected$
            .pipe(takeUntil(this.onDestroy$))
            .subscribe(() => {
            this.loadTaskDetailsById(this.appName, this.taskId);
        });
        this.cardViewUpdateService.itemUpdated$
            .pipe(takeUntil(this.onDestroy$))
            .subscribe(this.updateTaskDetails.bind(this));
    }
    ngOnChanges() {
        this.taskDetails = {};
        if ((this.appName || this.appName === '') && this.taskId) {
            this.loadTaskDetailsById(this.appName, this.taskId);
        }
        else {
            this.error.emit('App Name and Task Id are mandatory');
        }
    }
    loadTaskDetailsById(appName, taskId) {
        this.isLoading = true;
        this.taskCloudService.getTaskById(appName, taskId).pipe(concatMap((task) => forkJoin(of(task), this.taskCloudService.getCandidateUsers(this.appName, this.taskId), this.taskCloudService.getCandidateGroups(this.appName, this.taskId))), finalize(() => (this.isLoading = false))).subscribe(([taskDetails, candidateUsers, candidateGroups]) => {
            this.taskDetails = taskDetails;
            this.candidateGroups = candidateGroups.map((user) => ({ icon: 'group', value: user }));
            this.candidateUsers = candidateUsers.map((group) => ({ icon: 'person', value: group }));
            if (this.taskDetails.parentTaskId) {
                this.loadParentName(`${this.taskDetails.parentTaskId}`);
            }
            else {
                this.refreshData();
            }
        }, (err) => {
            this.error.emit(err);
        });
    }
    initDefaultProperties() {
        return [
            new CardViewTextItemModel({
                label: 'ADF_CLOUD_TASK_HEADER.PROPERTIES.ASSIGNEE',
                value: this.taskDetails.assignee,
                key: 'assignee',
                clickable: this.isAssigneePropertyClickable(),
                default: this.translationService.instant('ADF_CLOUD_TASK_HEADER.PROPERTIES.ASSIGNEE_DEFAULT'),
                icon: 'create'
            }),
            new CardViewTextItemModel({
                label: 'ADF_CLOUD_TASK_HEADER.PROPERTIES.STATUS',
                value: this.taskDetails.status,
                key: 'status'
            }),
            new CardViewSelectItemModel({
                label: 'ADF_CLOUD_TASK_HEADER.PROPERTIES.PRIORITY',
                value: this.taskDetails.priority.toString(),
                key: 'priority',
                editable: true,
                displayNoneOption: false,
                options$: of(this.taskCloudService.priorities)
            }),
            new CardViewDatetimeItemModel({
                label: 'ADF_CLOUD_TASK_HEADER.PROPERTIES.DUE_DATE',
                value: this.taskDetails.dueDate,
                key: 'dueDate',
                default: this.translationService.instant('ADF_CLOUD_TASK_HEADER.PROPERTIES.DUE_DATE_DEFAULT'),
                editable: true,
                format: this.dateTimeFormat,
                locale: this.dateLocale
            }),
            new CardViewTextItemModel({
                label: 'ADF_CLOUD_TASK_HEADER.PROPERTIES.CATEGORY',
                value: this.taskDetails.category,
                key: 'category',
                default: this.translationService.instant('ADF_CLOUD_TASK_HEADER.PROPERTIES.CATEGORY_DEFAULT')
            }),
            new CardViewDateItemModel({
                label: 'ADF_CLOUD_TASK_HEADER.PROPERTIES.CREATED',
                value: this.taskDetails.createdDate,
                key: 'created',
                format: this.dateFormat,
                locale: this.dateLocale
            }),
            new CardViewTextItemModel({
                label: 'ADF_CLOUD_TASK_HEADER.PROPERTIES.PARENT_NAME',
                value: this.parentTaskName,
                default: this.translationService.instant('ADF_CLOUD_TASK_HEADER.PROPERTIES.PARENT_NAME_DEFAULT'),
                key: 'parentName',
                clickable: true
            }),
            new CardViewTextItemModel({
                label: 'ADF_CLOUD_TASK_HEADER.PROPERTIES.PARENT_TASK_ID',
                value: this.taskDetails.parentTaskId,
                key: 'parentTaskId',
                clickable: true
            }),
            new CardViewDateItemModel({
                label: 'ADF_CLOUD_TASK_HEADER.PROPERTIES.END_DATE',
                value: this.taskDetails.completedDate,
                key: 'endDate',
                format: this.dateFormat,
                locale: this.dateLocale
            }),
            new CardViewTextItemModel({
                label: 'ADF_CLOUD_TASK_HEADER.PROPERTIES.ID',
                value: this.taskDetails.id,
                key: 'id'
            }),
            new CardViewTextItemModel({
                label: 'ADF_CLOUD_TASK_HEADER.PROPERTIES.DESCRIPTION',
                value: this.taskDetails.description,
                key: 'description',
                default: this.translationService.instant('ADF_CLOUD_TASK_HEADER.PROPERTIES.DESCRIPTION_DEFAULT'),
                multiline: true,
                editable: true
            }),
            new CardViewArrayItemModel({
                label: 'ADF_CLOUD_TASK_HEADER.PROPERTIES.CANDIDATE_USERS',
                value: of(this.candidateUsers),
                key: 'candidateUsers',
                icon: 'edit',
                clickable: false,
                default: this.translationService.instant('ADF_CLOUD_TASK_HEADER.PROPERTIES.CANDIDATE_USERS_DEFAULT'),
                noOfItemsToDisplay: 2
            }),
            new CardViewArrayItemModel({
                label: 'ADF_CLOUD_TASK_HEADER.PROPERTIES.CANDIDATE_GROUPS',
                value: of(this.candidateGroups),
                key: 'candidateGroups',
                icon: 'edit',
                clickable: false,
                default: this.translationService.instant('ADF_CLOUD_TASK_HEADER.PROPERTIES.CANDIDATE_GROUPS_DEFAULT'),
                noOfItemsToDisplay: 2
            })
        ];
    }
    refreshData() {
        if (this.taskDetails) {
            const defaultProperties = this.initDefaultProperties();
            const filteredProperties = this.appConfig.get('adf-cloud-task-header.presets.properties');
            this.properties = defaultProperties.filter((cardItem) => this.isValidSelection(filteredProperties, cardItem));
        }
    }
    updateTaskDetails(updateNotification) {
        this.taskCloudService.updateTask(this.appName, this.taskId, updateNotification.changed)
            .pipe(catchError(() => {
            this.cardViewUpdateService.updateElement(updateNotification.target);
            return of(null);
        }))
            .subscribe((taskDetails) => {
            if (taskDetails) {
                this.taskDetails = taskDetails;
            }
        });
    }
    loadParentName(taskId) {
        this.taskCloudService.getTaskById(this.appName, taskId)
            .subscribe((taskDetails) => {
            this.parentTaskName = taskDetails.name;
            this.refreshData();
        });
    }
    isCompleted() {
        return this.taskDetails && this.taskDetails.status === 'COMPLETED';
    }
    hasAssignee() {
        return !!this.taskDetails.assignee ? true : false;
    }
    isTaskValid() {
        return (this.appName || this.appName === '') && !!this.taskId;
    }
    isTaskAssigned() {
        return this.taskDetails.assignee !== undefined;
    }
    isTaskEditable() {
        return this.taskCloudService.isTaskEditable(this.taskDetails);
    }
    isAssigneePropertyClickable() {
        return this.taskCloudService.isAssigneePropertyClickable(this.taskDetails, this.candidateUsers, []);
    }
    isValidSelection(filteredProperties, cardItem) {
        return filteredProperties ? filteredProperties.indexOf(cardItem.key) >= 0 : true;
    }
    ngOnDestroy() {
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
}
TaskHeaderCloudComponent.ɵfac = function TaskHeaderCloudComponent_Factory(t) { return new (t || TaskHeaderCloudComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.TaskCloudService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.TranslationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.AppConfigService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.CardViewUpdateService)); };
TaskHeaderCloudComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: TaskHeaderCloudComponent, selectors: [["adf-cloud-task-header"]], inputs: { appName: "appName", showTitle: "showTitle", taskId: "taskId" }, outputs: { claim: "claim", unclaim: "unclaim", error: "error" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 5, vars: 2, consts: [["class", "adf-task-title", 4, "ngIf"], [1, "adf-task-header-container"], ["class", "adf-card-container", 4, "ngIf"], ["loadingTemplate", ""], [1, "adf-task-title"], [1, "adf-card-container"], [3, "displayNoneOption", "properties", "editable", "displayClearAction", 4, "ngIf", "ngIfElse"], [3, "displayNoneOption", "properties", "editable", "displayClearAction"], [1, "adf-task-header-loading"]], template: function TaskHeaderCloudComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, TaskHeaderCloudComponent_h3_0_Template, 2, 1, "h3", 0);
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵtemplate(2, TaskHeaderCloudComponent_mat_card_2_Template, 3, 2, "mat-card", 2);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(3, TaskHeaderCloudComponent_ng_template_3_Template, 2, 0, "ng-template", null, 3, ɵngcc0.ɵɵtemplateRefExtractor);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", ctx.showTitle);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.isTaskValid());
    } }, directives: [ɵngcc3.NgIf, ɵngcc4.MatCard, ɵngcc4.MatCardContent, ɵngcc2.CardViewComponent, ɵngcc5.MatSpinner], styles: [".adf-controls{display:flex;justify-content:space-between}.adf-edit-controls{display:flex;justify-content:flex-end;margin-left:auto}.adf-save-edit-mode,.adf-switch-to-edit-mode{color:var(--theme-primary-color)}.adf-cancel-edit-mode,.adf-claim-controls{color:#838383}@media screen and (max-width:959px){adf-card-view .adf-property-value{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}}.adf-task-header-loading{display:flex;justify-content:center}"], encapsulation: 2 });
TaskHeaderCloudComponent.ctorParameters = () => [
    { type: TaskCloudService },
    { type: TranslationService },
    { type: AppConfigService },
    { type: CardViewUpdateService }
];
TaskHeaderCloudComponent.propDecorators = {
    appName: [{ type: Input }],
    taskId: [{ type: Input }],
    showTitle: [{ type: Input }],
    claim: [{ type: Output }],
    unclaim: [{ type: Output }],
    error: [{ type: Output }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(TaskHeaderCloudComponent, [{
        type: Component,
        args: [{
                selector: 'adf-cloud-task-header',
                template: "<h3 *ngIf=\"showTitle\" class=\"adf-task-title\">{{ taskDetails?.name }}</h3>\n\n<div class=\"adf-task-header-container\">\n    <mat-card *ngIf=\"isTaskValid()\" class=\"adf-card-container\">\n        <mat-card-content>\n            <adf-card-view\n                *ngIf=\"!isLoading; else loadingTemplate\"\n                [displayNoneOption]=\"false\"\n                [properties]=\"properties\"\n                [editable]=\"isTaskEditable()\"\n                [displayClearAction]=\"displayDateClearAction\">\n            </adf-card-view>\n        </mat-card-content>\n    </mat-card>\n</div>\n\n<ng-template #loadingTemplate>\n    <div class=\"adf-task-header-loading\">\n        <mat-spinner></mat-spinner>\n    </div>\n</ng-template>\n",
                encapsulation: ViewEncapsulation.None,
                styles: [".adf-controls{display:flex;justify-content:space-between}.adf-edit-controls{display:flex;justify-content:flex-end;margin-left:auto}.adf-save-edit-mode,.adf-switch-to-edit-mode{color:var(--theme-primary-color)}.adf-cancel-edit-mode,.adf-claim-controls{color:#838383}@media screen and (max-width:959px){adf-card-view .adf-property-value{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}}.adf-task-header-loading{display:flex;justify-content:center}"]
            }]
    }], function () { return [{ type: ɵngcc1.TaskCloudService }, { type: ɵngcc2.TranslationService }, { type: ɵngcc2.AppConfigService }, { type: ɵngcc2.CardViewUpdateService }]; }, { appName: [{
            type: Input
        }], showTitle: [{
            type: Input
        }], claim: [{
            type: Output
        }], unclaim: [{
            type: Output
        }], error: [{
            type: Output
        }], taskId: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFzay1oZWFkZXItY2xvdWQuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9ob21lL3RyYXZpcy9idWlsZC9BbGZyZXNjby9hbGZyZXNjby1uZzItY29tcG9uZW50cy9saWIvcHJvY2Vzcy1zZXJ2aWNlcy1jbG91ZC9zcmMvbGliL3Rhc2svdGFzay1oZWFkZXIvY29tcG9uZW50cy90YXNrLWhlYWRlci1jbG91ZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUVILE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQWdDLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hILE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM1RSxPQUFPLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDN0MsT0FBTyxFQUNILHFCQUFxQixFQUVyQixxQkFBcUIsRUFFckIsc0JBQXNCLEVBQ3RCLGtCQUFrQixFQUNsQixnQkFBZ0IsRUFFaEIscUJBQXFCLEVBQ3JCLHlCQUF5QixFQUV6Qix1QkFBdUIsRUFDMUIsTUFBTSxvQkFBb0IsQ0FBQztBQUU1QixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVFyRSxNQUFNLE9BQU8sd0JBQXdCO0FBQUcsSUF3Q3BDLFlBQ1ksZ0JBQWtDLEVBQ2xDLGtCQUFzQyxFQUN0QyxTQUEyQixFQUMzQixxQkFBNEM7QUFDekQsUUFKYSxxQkFB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b0RBalRDLFNBQVMsU0FBQyxrQkFDUCxRQUFRLEVBQUUsdUJBQXVCLGtCQUNqQzs4aUJBQWlELGtCQUVqRCxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTs7Ozs7eUNBQ3hDOzs7OztpbUJBQ0k7QUFBQztBQUFrRCxZQVIvQyxnQkFBZ0I7QUFBSSxZQVR6QixrQkFBa0I7QUFDcEIsWUFBRSxnQkFBZ0I7QUFDbEIsWUFDRSxxQkFBcUI7QUFDeEI7QUFBRztBQUNhLHNCQWVaLEtBQUs7QUFDUixxQkFHRyxLQUFLO0FBQ1Isd0JBR0csS0FBSztBQUNSLG9CQUdHLE1BQU07QUFDVCxzQkFHRyxNQUFNO0FBQ1Qsb0JBR0csTUFBTTtBQUNWOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcywgT25Jbml0LCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgdGFrZVVudGlsLCBjb25jYXRNYXAsIGNhdGNoRXJyb3IsIGZpbmFsaXplIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgU3ViamVjdCwgb2YsIGZvcmtKb2luIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQge1xuICAgIENhcmRWaWV3RGF0ZUl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld0l0ZW0sXG4gICAgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsLFxuICAgIENhcmRWaWV3QmFzZUl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld0FycmF5SXRlbU1vZGVsLFxuICAgIFRyYW5zbGF0aW9uU2VydmljZSxcbiAgICBBcHBDb25maWdTZXJ2aWNlLFxuICAgIFVwZGF0ZU5vdGlmaWNhdGlvbixcbiAgICBDYXJkVmlld1VwZGF0ZVNlcnZpY2UsXG4gICAgQ2FyZFZpZXdEYXRldGltZUl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld0FycmF5SXRlbSxcbiAgICBDYXJkVmlld1NlbGVjdEl0ZW1Nb2RlbFxufSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgVGFza0RldGFpbHNDbG91ZE1vZGVsIH0gZnJvbSAnLi4vLi4vc3RhcnQtdGFzay9tb2RlbHMvdGFzay1kZXRhaWxzLWNsb3VkLm1vZGVsJztcbmltcG9ydCB7IFRhc2tDbG91ZFNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy90YXNrLWNsb3VkLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi1jbG91ZC10YXNrLWhlYWRlcicsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3Rhc2staGVhZGVyLWNsb3VkLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi90YXNrLWhlYWRlci1jbG91ZC5jb21wb25lbnQuc2NzcyddLFxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgVGFza0hlYWRlckNsb3VkQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcyB7XG5cbiAgICAvKiogKFJlcXVpcmVkKSBUaGUgbmFtZSBvZiB0aGUgYXBwbGljYXRpb24uICovXG4gICAgQElucHV0KClcbiAgICBhcHBOYW1lOiBzdHJpbmcgPSAnJztcblxuICAgIC8qKiAoUmVxdWlyZWQpIFRoZSBpZCBvZiB0aGUgdGFzay4gKi9cbiAgICBASW5wdXQoKVxuICAgIHRhc2tJZDogc3RyaW5nO1xuXG4gICAgLyoqIFNob3cvSGlkZSB0aGUgdGFzayB0aXRsZSAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd1RpdGxlOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIHRhc2sgaXMgY2xhaW1lZC4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBjbGFpbTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIHRhc2sgaXMgdW5jbGFpbWVkIChpZSwgcmVxdWV1ZWQpLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHVuY2xhaW06IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSBnaXZlbiB0YXNrIGhhcyBlcnJvcnMuICovXG4gICAgQE91dHB1dCgpXG4gICAgZXJyb3I6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICB0YXNrRGV0YWlsczogVGFza0RldGFpbHNDbG91ZE1vZGVsID0ge307XG4gICAgY2FuZGlkYXRlVXNlcnM6IENhcmRWaWV3QXJyYXlJdGVtW10gPSBbXTtcbiAgICBjYW5kaWRhdGVHcm91cHM6IENhcmRWaWV3QXJyYXlJdGVtW10gPSBbXTtcbiAgICBwcm9wZXJ0aWVzOiBDYXJkVmlld0l0ZW1bXTtcbiAgICBpbkVkaXQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBwYXJlbnRUYXNrTmFtZTogc3RyaW5nO1xuICAgIGRhdGVGb3JtYXQ6IHN0cmluZztcbiAgICBkYXRlVGltZUZvcm1hdDogc3RyaW5nO1xuICAgIGRhdGVMb2NhbGU6IHN0cmluZztcbiAgICBkaXNwbGF5RGF0ZUNsZWFyQWN0aW9uID0gZmFsc2U7XG4gICAgaXNMb2FkaW5nID0gdHJ1ZTtcblxuICAgIHByaXZhdGUgb25EZXN0cm95JCA9IG5ldyBTdWJqZWN0PGJvb2xlYW4+KCk7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSB0YXNrQ2xvdWRTZXJ2aWNlOiBUYXNrQ2xvdWRTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHRyYW5zbGF0aW9uU2VydmljZTogVHJhbnNsYXRpb25TZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGFwcENvbmZpZzogQXBwQ29uZmlnU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBjYXJkVmlld1VwZGF0ZVNlcnZpY2U6IENhcmRWaWV3VXBkYXRlU2VydmljZVxuICAgICkge1xuICAgICAgICB0aGlzLmRhdGVGb3JtYXQgPSB0aGlzLmFwcENvbmZpZy5nZXQoJ2RhdGVWYWx1ZXMuZGVmYXVsdERhdGVGb3JtYXQnKTtcbiAgICAgICAgdGhpcy5kYXRlTG9jYWxlID0gdGhpcy5hcHBDb25maWcuZ2V0KCdkYXRlVmFsdWVzLmRlZmF1bHREYXRlTG9jYWxlJyk7XG4gICAgICAgIHRoaXMuZGF0ZVRpbWVGb3JtYXQgPSB0aGlzLmFwcENvbmZpZy5nZXQoJ2RhdGVWYWx1ZS5kZWZhdWx0RGF0ZVRpbWVGb3JtYXQnKTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy50YXNrQ2xvdWRTZXJ2aWNlLmRhdGFDaGFuZ2VzRGV0ZWN0ZWQkXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5sb2FkVGFza0RldGFpbHNCeUlkKHRoaXMuYXBwTmFtZSwgdGhpcy50YXNrSWQpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmNhcmRWaWV3VXBkYXRlU2VydmljZS5pdGVtVXBkYXRlZCRcbiAgICAgICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpKVxuICAgICAgICAgICAgLnN1YnNjcmliZSh0aGlzLnVwZGF0ZVRhc2tEZXRhaWxzLmJpbmQodGhpcylcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcygpIHtcbiAgICAgICAgdGhpcy50YXNrRGV0YWlscyA9IHt9O1xuICAgICAgICBpZiAoKHRoaXMuYXBwTmFtZSB8fCB0aGlzLmFwcE5hbWUgPT09ICcnKSAmJiB0aGlzLnRhc2tJZCkge1xuICAgICAgICAgICAgdGhpcy5sb2FkVGFza0RldGFpbHNCeUlkKHRoaXMuYXBwTmFtZSwgdGhpcy50YXNrSWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5lcnJvci5lbWl0KCdBcHAgTmFtZSBhbmQgVGFzayBJZCBhcmUgbWFuZGF0b3J5Jyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsb2FkVGFza0RldGFpbHNCeUlkKGFwcE5hbWU6IHN0cmluZywgdGFza0lkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLnRhc2tDbG91ZFNlcnZpY2UuZ2V0VGFza0J5SWQoYXBwTmFtZSwgdGFza0lkKS5waXBlKFxuICAgICAgICAgICAgY29uY2F0TWFwKCh0YXNrKSA9PlxuICAgICAgICAgICAgICAgIGZvcmtKb2luKFxuICAgICAgICAgICAgICAgICAgICBvZih0YXNrKSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50YXNrQ2xvdWRTZXJ2aWNlLmdldENhbmRpZGF0ZVVzZXJzKHRoaXMuYXBwTmFtZSwgdGhpcy50YXNrSWQpLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRhc2tDbG91ZFNlcnZpY2UuZ2V0Q2FuZGlkYXRlR3JvdXBzKHRoaXMuYXBwTmFtZSwgdGhpcy50YXNrSWQpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGZpbmFsaXplKCgpID0+ICh0aGlzLmlzTG9hZGluZyA9IGZhbHNlKSlcbiAgICAgICAgKS5zdWJzY3JpYmUoKFt0YXNrRGV0YWlscywgY2FuZGlkYXRlVXNlcnMsIGNhbmRpZGF0ZUdyb3Vwc10pID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnRhc2tEZXRhaWxzID0gdGFza0RldGFpbHM7XG4gICAgICAgICAgICAgICAgdGhpcy5jYW5kaWRhdGVHcm91cHMgPSBjYW5kaWRhdGVHcm91cHMubWFwKCh1c2VyKSA9PiA8Q2FyZFZpZXdBcnJheUl0ZW0+IHsgaWNvbjogJ2dyb3VwJywgdmFsdWU6IHVzZXIgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jYW5kaWRhdGVVc2VycyA9IGNhbmRpZGF0ZVVzZXJzLm1hcCgoZ3JvdXApID0+IDxDYXJkVmlld0FycmF5SXRlbT4geyBpY29uOiAncGVyc29uJywgdmFsdWU6IGdyb3VwIH0pO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRhc2tEZXRhaWxzLnBhcmVudFRhc2tJZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRQYXJlbnROYW1lKGAke3RoaXMudGFza0RldGFpbHMucGFyZW50VGFza0lkfWApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaERhdGEoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IuZW1pdChlcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpbml0RGVmYXVsdFByb3BlcnRpZXMoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfQ0xPVURfVEFTS19IRUFERVIuUFJPUEVSVElFUy5BU1NJR05FRScsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnRhc2tEZXRhaWxzLmFzc2lnbmVlLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdhc3NpZ25lZScsXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrYWJsZTogdGhpcy5pc0Fzc2lnbmVlUHJvcGVydHlDbGlja2FibGUoKSxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudCgnQURGX0NMT1VEX1RBU0tfSEVBREVSLlBST1BFUlRJRVMuQVNTSUdORUVfREVGQVVMVCcpLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnY3JlYXRlJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfQ0xPVURfVEFTS19IRUFERVIuUFJPUEVSVElFUy5TVEFUVVMnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy50YXNrRGV0YWlscy5zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIGtleTogJ3N0YXR1cydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3U2VsZWN0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfQ0xPVURfVEFTS19IRUFERVIuUFJPUEVSVElFUy5QUklPUklUWScsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnRhc2tEZXRhaWxzLnByaW9yaXR5LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGtleTogJ3ByaW9yaXR5JyxcbiAgICAgICAgICAgICAgICAgICAgZWRpdGFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOb25lT3B0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyQ6IG9mKHRoaXMudGFza0Nsb3VkU2VydmljZS5wcmlvcml0aWVzKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdEYXRldGltZUl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX0NMT1VEX1RBU0tfSEVBREVSLlBST1BFUlRJRVMuRFVFX0RBVEUnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy50YXNrRGV0YWlscy5kdWVEYXRlLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdkdWVEYXRlJyxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudCgnQURGX0NMT1VEX1RBU0tfSEVBREVSLlBST1BFUlRJRVMuRFVFX0RBVEVfREVGQVVMVCcpLFxuICAgICAgICAgICAgICAgICAgICBlZGl0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiB0aGlzLmRhdGVUaW1lRm9ybWF0LFxuICAgICAgICAgICAgICAgICAgICBsb2NhbGU6IHRoaXMuZGF0ZUxvY2FsZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfQ0xPVURfVEFTS19IRUFERVIuUFJPUEVSVElFUy5DQVRFR09SWScsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnRhc2tEZXRhaWxzLmNhdGVnb3J5LFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdjYXRlZ29yeScsXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmluc3RhbnQoJ0FERl9DTE9VRF9UQVNLX0hFQURFUi5QUk9QRVJUSUVTLkNBVEVHT1JZX0RFRkFVTFQnKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdEYXRlSXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfQ0xPVURfVEFTS19IRUFERVIuUFJPUEVSVElFUy5DUkVBVEVEJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudGFza0RldGFpbHMuY3JlYXRlZERhdGUsXG4gICAgICAgICAgICAgICAgICAgIGtleTogJ2NyZWF0ZWQnLFxuICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IHRoaXMuZGF0ZUZvcm1hdCxcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxlOiB0aGlzLmRhdGVMb2NhbGVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3VGV4dEl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX0NMT1VEX1RBU0tfSEVBREVSLlBST1BFUlRJRVMuUEFSRU5UX05BTUUnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5wYXJlbnRUYXNrTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudCgnQURGX0NMT1VEX1RBU0tfSEVBREVSLlBST1BFUlRJRVMuUEFSRU5UX05BTUVfREVGQVVMVCcpLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdwYXJlbnROYW1lJyxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2thYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIG5ldyBDYXJkVmlld1RleHRJdGVtTW9kZWwoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9DTE9VRF9UQVNLX0hFQURFUi5QUk9QRVJUSUVTLlBBUkVOVF9UQVNLX0lEJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudGFza0RldGFpbHMucGFyZW50VGFza0lkLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdwYXJlbnRUYXNrSWQnLFxuICAgICAgICAgICAgICAgICAgICBjbGlja2FibGU6IHRydWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgbmV3IENhcmRWaWV3RGF0ZUl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX0NMT1VEX1RBU0tfSEVBREVSLlBST1BFUlRJRVMuRU5EX0RBVEUnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy50YXNrRGV0YWlscy5jb21wbGV0ZWREYXRlLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdlbmREYXRlJyxcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiB0aGlzLmRhdGVGb3JtYXQsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsZTogdGhpcy5kYXRlTG9jYWxlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIG5ldyBDYXJkVmlld1RleHRJdGVtTW9kZWwoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0FERl9DTE9VRF9UQVNLX0hFQURFUi5QUk9QRVJUSUVTLklEJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudGFza0RldGFpbHMuaWQsXG4gICAgICAgICAgICAgICAgICAgIGtleTogJ2lkJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfQ0xPVURfVEFTS19IRUFERVIuUFJPUEVSVElFUy5ERVNDUklQVElPTicsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnRhc2tEZXRhaWxzLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdkZXNjcmlwdGlvbicsXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmluc3RhbnQoJ0FERl9DTE9VRF9UQVNLX0hFQURFUi5QUk9QRVJUSUVTLkRFU0NSSVBUSU9OX0RFRkFVTFQnKSxcbiAgICAgICAgICAgICAgICAgICAgbXVsdGlsaW5lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBlZGl0YWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBuZXcgQ2FyZFZpZXdBcnJheUl0ZW1Nb2RlbChcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQURGX0NMT1VEX1RBU0tfSEVBREVSLlBST1BFUlRJRVMuQ0FORElEQVRFX1VTRVJTJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9mKHRoaXMuY2FuZGlkYXRlVXNlcnMpLFxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdjYW5kaWRhdGVVc2VycycsXG4gICAgICAgICAgICAgICAgICAgIGljb246ICdlZGl0JyxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2thYmxlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudCgnQURGX0NMT1VEX1RBU0tfSEVBREVSLlBST1BFUlRJRVMuQ0FORElEQVRFX1VTRVJTX0RFRkFVTFQnKSxcbiAgICAgICAgICAgICAgICAgICAgbm9PZkl0ZW1zVG9EaXNwbGF5OiAyXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIG5ldyBDYXJkVmlld0FycmF5SXRlbU1vZGVsKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBREZfQ0xPVURfVEFTS19IRUFERVIuUFJPUEVSVElFUy5DQU5ESURBVEVfR1JPVVBTJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9mKHRoaXMuY2FuZGlkYXRlR3JvdXBzKSxcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnY2FuZGlkYXRlR3JvdXBzJyxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ2VkaXQnLFxuICAgICAgICAgICAgICAgICAgICBjbGlja2FibGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS5pbnN0YW50KCdBREZfQ0xPVURfVEFTS19IRUFERVIuUFJPUEVSVElFUy5DQU5ESURBVEVfR1JPVVBTX0RFRkFVTFQnKSxcbiAgICAgICAgICAgICAgICAgICAgbm9PZkl0ZW1zVG9EaXNwbGF5OiAyXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKVxuICAgICAgICBdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlZnJlc2ggdGhlIGNhcmQgZGF0YVxuICAgICAqL1xuICAgIHJlZnJlc2hEYXRhKCkge1xuICAgICAgICBpZiAodGhpcy50YXNrRGV0YWlscykge1xuICAgICAgICAgICAgY29uc3QgZGVmYXVsdFByb3BlcnRpZXMgPSB0aGlzLmluaXREZWZhdWx0UHJvcGVydGllcygpO1xuICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRQcm9wZXJ0aWVzOiBzdHJpbmdbXSA9IHRoaXMuYXBwQ29uZmlnLmdldCgnYWRmLWNsb3VkLXRhc2staGVhZGVyLnByZXNldHMucHJvcGVydGllcycpO1xuICAgICAgICAgICAgdGhpcy5wcm9wZXJ0aWVzID0gZGVmYXVsdFByb3BlcnRpZXMuZmlsdGVyKChjYXJkSXRlbSkgPT4gdGhpcy5pc1ZhbGlkU2VsZWN0aW9uKGZpbHRlcmVkUHJvcGVydGllcywgY2FyZEl0ZW0pKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNhdmUgYSB0YXNrIGRldGFpbCBhbmQgdXBkYXRlIGl0IGFmdGVyIGEgc3VjY2Vzc2Z1bCByZXNwb25zZVxuICAgICAqXG4gICAgICogQHBhcmFtIHVwZGF0ZU5vdGlmaWNhdGlvblxuICAgICAqL1xuICAgIHByaXZhdGUgdXBkYXRlVGFza0RldGFpbHModXBkYXRlTm90aWZpY2F0aW9uOiBVcGRhdGVOb3RpZmljYXRpb24pIHtcbiAgICAgICAgdGhpcy50YXNrQ2xvdWRTZXJ2aWNlLnVwZGF0ZVRhc2sodGhpcy5hcHBOYW1lLCB0aGlzLnRhc2tJZCwgdXBkYXRlTm90aWZpY2F0aW9uLmNoYW5nZWQpXG4gICAgICAgICAgICAucGlwZShjYXRjaEVycm9yKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNhcmRWaWV3VXBkYXRlU2VydmljZS51cGRhdGVFbGVtZW50KHVwZGF0ZU5vdGlmaWNhdGlvbi50YXJnZXQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBvZihudWxsKTtcbiAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgodGFza0RldGFpbHMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhc2tEZXRhaWxzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRhc2tEZXRhaWxzID0gdGFza0RldGFpbHM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGxvYWRQYXJlbnROYW1lKHRhc2tJZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMudGFza0Nsb3VkU2VydmljZS5nZXRUYXNrQnlJZCh0aGlzLmFwcE5hbWUsIHRhc2tJZClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgKHRhc2tEZXRhaWxzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50VGFza05hbWUgPSB0YXNrRGV0YWlscy5uYW1lO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2hEYXRhKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBpc0NvbXBsZXRlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGFza0RldGFpbHMgJiYgdGhpcy50YXNrRGV0YWlscy5zdGF0dXMgPT09ICdDT01QTEVURUQnO1xuICAgIH1cblxuICAgIGhhc0Fzc2lnbmVlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gISF0aGlzLnRhc2tEZXRhaWxzLmFzc2lnbmVlID8gdHJ1ZSA6IGZhbHNlO1xuICAgIH1cblxuICAgIGlzVGFza1ZhbGlkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKHRoaXMuYXBwTmFtZSB8fCB0aGlzLmFwcE5hbWUgPT09ICcnKSAmJiAhIXRoaXMudGFza0lkO1xuICAgIH1cblxuICAgIGlzVGFza0Fzc2lnbmVkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy50YXNrRGV0YWlscy5hc3NpZ25lZSAhPT0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGlzVGFza0VkaXRhYmxlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy50YXNrQ2xvdWRTZXJ2aWNlLmlzVGFza0VkaXRhYmxlKHRoaXMudGFza0RldGFpbHMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGFzIHBlciBbQUNBLTM5NjBdIGl0IHJlcXVpcmVkIGFuIGVtcHR5IGFycmF5IGFyZ3VtZW50IGZvciBub3dcbiAgICAgKiBFbXB0eSBhcnJheSB3aWxsIGJlIHJlcGxhY2VkIHdpdGggY2FuZGlkYXRlR3JvdXBzIGluIGZlYXR1cmVcbiAgICAgKi9cbiAgICBpc0Fzc2lnbmVlUHJvcGVydHlDbGlja2FibGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tDbG91ZFNlcnZpY2UuaXNBc3NpZ25lZVByb3BlcnR5Q2xpY2thYmxlKHRoaXMudGFza0RldGFpbHMsIHRoaXMuY2FuZGlkYXRlVXNlcnMsIFtdKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzVmFsaWRTZWxlY3Rpb24oZmlsdGVyZWRQcm9wZXJ0aWVzOiBzdHJpbmdbXSwgY2FyZEl0ZW06IENhcmRWaWV3QmFzZUl0ZW1Nb2RlbCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gZmlsdGVyZWRQcm9wZXJ0aWVzID8gZmlsdGVyZWRQcm9wZXJ0aWVzLmluZGV4T2YoY2FyZEl0ZW0ua2V5KSA+PSAwIDogdHJ1ZTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLm5leHQodHJ1ZSk7XG4gICAgICAgIHRoaXMub25EZXN0cm95JC5jb21wbGV0ZSgpO1xuICAgIH1cbn1cbiJdfQ==