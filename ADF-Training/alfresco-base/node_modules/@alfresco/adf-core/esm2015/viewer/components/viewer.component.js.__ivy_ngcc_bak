/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { __awaiter } from "tslib";
import { Component, ContentChild, EventEmitter, HostListener, ElementRef, Input, Output, TemplateRef, ViewEncapsulation, ChangeDetectorRef } from '@angular/core';
import { SharedlinksApi, VersionsApi, NodesApi, ContentApi } from '@alfresco/js-api';
import { BaseEvent } from '../../events';
import { AlfrescoApiService } from '../../services/alfresco-api.service';
import { LogService } from '../../services/log.service';
import { ViewerMoreActionsComponent } from './viewer-more-actions.component';
import { ViewerOpenWithComponent } from './viewer-open-with.component';
import { ViewerSidebarComponent } from './viewer-sidebar.component';
import { ViewerToolbarComponent } from './viewer-toolbar.component';
import { fromEvent, Subject } from 'rxjs';
import { ViewUtilService } from '../services/view-util.service';
import { AppExtensionService } from '@alfresco/adf-extensions';
import { filter, skipWhile, takeUntil } from 'rxjs/operators';
import { MatDialog } from '@angular/material/dialog';
import { ContentService } from '../../services/content.service';
import { UploadService } from '../../services/upload.service';
import { FileModel } from '../../models';
export class ViewerComponent {
    constructor(apiService, viewUtilService, logService, extensionService, contentService, uploadService, el, dialog, cdr) {
        this.apiService = apiService;
        this.viewUtilService = viewUtilService;
        this.logService = logService;
        this.extensionService = extensionService;
        this.contentService = contentService;
        this.uploadService = uploadService;
        this.el = el;
        this.dialog = dialog;
        this.cdr = cdr;
        this.urlFile = '';
        this.urlFileViewer = null;
        this.nodeId = null;
        this.versionId = null;
        this.sharedLinkId = null;
        this.overlayMode = false;
        this.showViewer = true;
        this.showToolbar = true;
        this.allowGoBack = true;
        this.allowDownload = true;
        this.allowPrint = false;
        this.allowFullScreen = true;
        this.allowNavigate = false;
        this.canNavigateBefore = true;
        this.canNavigateNext = true;
        this.allowLeftSidebar = false;
        this.allowRightSidebar = false;
        this.allowThumbnails = true;
        this.showRightSidebar = false;
        this.showLeftSidebar = false;
        this.sidebarRightTemplate = null;
        this.sidebarLeftTemplate = null;
        this.thumbnailsTemplate = null;
        this.maxRetries = 30;
        this.goBack = new EventEmitter();
        this.print = new EventEmitter();
        this.showViewerChange = new EventEmitter();
        this.extensionChange = new EventEmitter();
        this.navigateBefore = new EventEmitter();
        this.navigateNext = new EventEmitter();
        this.invalidSharedLink = new EventEmitter();
        this.TRY_TIMEOUT = 10000;
        this.viewerType = 'unknown';
        this.isLoading = false;
        this.extensionTemplates = [];
        this.sidebarRightTemplateContext = { node: null };
        this.sidebarLeftTemplateContext = { node: null };
        this.readOnly = true;
        this.cacheTypeForContent = '';
        this.extensions = {
            image: ['png', 'jpg', 'jpeg', 'gif', 'bpm', 'svg'],
            media: ['wav', 'mp4', 'mp3', 'webm', 'ogg'],
            text: ['txt', 'xml', 'html', 'json', 'ts', 'css', 'md'],
            pdf: ['pdf']
        };
        this.mimeTypes = {
            text: ['text/plain', 'text/csv', 'text/xml', 'text/html', 'application/x-javascript'],
            pdf: ['application/pdf'],
            image: ['image/png', 'image/jpeg', 'image/gif', 'image/bmp', 'image/svg+xml'],
            media: ['video/mp4', 'video/webm', 'video/ogg', 'audio/mpeg', 'audio/mp3', 'audio/ogg', 'audio/wav']
        };
        this.onDestroy$ = new Subject();
        this.shouldCloseViewer = true;
        this.keyDown$ = fromEvent(document, 'keydown');
        viewUtilService.maxRetries = this.maxRetries;
    }
    get viewerExtensions() {
        return this.extensionService.getViewerExtensions();
    }
    get externalExtensions() {
        return this.viewerExtensions.map(ext => ext.fileExtension);
    }
    get externalViewer() {
        if (!this._externalViewer) {
            this._externalViewer = this.viewerExtensions.find(ext => ext.fileExtension === '*');
        }
        return this._externalViewer;
    }
    get sharedLinksApi() {
        var _a;
        this._sharedLinksApi = (_a = this._sharedLinksApi) !== null && _a !== void 0 ? _a : new SharedlinksApi(this.apiService.getInstance());
        return this._sharedLinksApi;
    }
    get versionsApi() {
        var _a;
        this._versionsApi = (_a = this._versionsApi) !== null && _a !== void 0 ? _a : new VersionsApi(this.apiService.getInstance());
        return this._versionsApi;
    }
    get nodesApi() {
        var _a;
        this._nodesApi = (_a = this._nodesApi) !== null && _a !== void 0 ? _a : new NodesApi(this.apiService.getInstance());
        return this._nodesApi;
    }
    get contentApi() {
        var _a;
        this._contentApi = (_a = this._contentApi) !== null && _a !== void 0 ? _a : new ContentApi(this.apiService.getInstance());
        return this._contentApi;
    }
    isSourceDefined() {
        return !!(this.urlFile || this.blobFile || this.nodeId || this.sharedLinkId);
    }
    ngOnInit() {
        this.apiService.nodeUpdated.pipe(filter((node) => {
            return node && node.id === this.nodeId &&
                (node.name !== this.fileName ||
                    this.getNodeVersionProperty(this.nodeEntry.entry) !== this.getNodeVersionProperty(node));
        }), takeUntil(this.onDestroy$)).subscribe((node) => this.onNodeUpdated(node));
        this.viewUtilService.viewerTypeChange.pipe(takeUntil(this.onDestroy$)).subscribe((type) => {
            this.viewerType = type;
        });
        this.viewUtilService.urlFileContentChange.pipe(takeUntil(this.onDestroy$)).subscribe((content) => {
            this.urlFileContent = content;
        });
        this.closeOverlayManager();
        this.cacheTypeForContent = '';
    }
    getNodeVersionProperty(node) {
        var _a;
        return (_a = node === null || node === void 0 ? void 0 : node.properties['cm:versionLabel']) !== null && _a !== void 0 ? _a : '';
    }
    ngOnDestroy() {
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
    onNodeUpdated(node) {
        if (node && node.id === this.nodeId) {
            this.cacheTypeForContent = 'no-cache';
            this.generateCacheBusterNumber();
            this.isLoading = true;
            this.setUpNodeFile(node).then(() => {
                this.isLoading = false;
            });
        }
    }
    ngOnChanges() {
        if (this.showViewer) {
            if (!this.isSourceDefined()) {
                throw new Error('A content source attribute value is missing.');
            }
            this.isLoading = true;
            if (this.blobFile) {
                this.setUpBlobData();
                this.isLoading = false;
            }
            else if (this.urlFile) {
                this.setUpUrlFile();
                this.isLoading = false;
            }
            else if (this.nodeId) {
                this.setupNode();
            }
            else if (this.sharedLinkId) {
                this.setupSharedLink();
            }
        }
    }
    setupSharedLink() {
        this.allowGoBack = false;
        this.sharedLinksApi.getSharedLink(this.sharedLinkId).then((sharedLinkEntry) => {
            this.setUpSharedLinkFile(sharedLinkEntry);
            this.isLoading = false;
        }, () => {
            this.isLoading = false;
            this.logService.error('This sharedLink does not exist');
            this.invalidSharedLink.next();
        });
    }
    setupNode() {
        this.nodesApi.getNode(this.nodeId, { include: ['allowableOperations'] }).then((node) => {
            this.nodeEntry = node;
            if (this.versionId) {
                this.versionsApi.getVersion(this.nodeId, this.versionId).then((version) => {
                    this.versionEntry = version;
                    this.setUpNodeFile(node.entry, version.entry).then(() => {
                        this.isLoading = false;
                    });
                });
            }
            else {
                this.setUpNodeFile(node.entry).then(() => {
                    this.isLoading = false;
                    this.cdr.detectChanges();
                });
            }
        }, () => {
            this.isLoading = false;
            this.logService.error('This node does not exist');
        });
    }
    setUpBlobData() {
        this.fileTitle = this.getDisplayName('Unknown');
        this.mimeType = this.blobFile.type;
        this.viewerType = this.getViewerTypeByMimeType(this.mimeType);
        this.allowDownload = false;
        this.extensionChange.emit(this.mimeType);
        this.scrollTop();
    }
    setUpUrlFile() {
        const filenameFromUrl = this.getFilenameFromUrl(this.urlFile);
        this.fileTitle = this.getDisplayName(filenameFromUrl);
        this.extension = this.getFileExtension(filenameFromUrl);
        this.urlFileContent = this.urlFile;
        this.fileName = this.displayName;
        this.viewerType = this.urlFileViewer || this.getViewerType(this.extension, this.mimeType);
        this.extensionChange.emit(this.extension);
        this.scrollTop();
    }
    setUpNodeFile(nodeData, versionData) {
        var _a, _b, _c, _d;
        return __awaiter(this, void 0, void 0, function* () {
            this.readOnly = !this.contentService.hasAllowableOperations(nodeData, 'update');
            if (versionData && versionData.content) {
                this.mimeType = versionData.content.mimeType;
            }
            else if (nodeData.content) {
                this.mimeType = nodeData.content.mimeType;
            }
            this.fileTitle = this.getDisplayName(versionData ? versionData.name : nodeData.name);
            const currentFileVersion = ((_b = (_a = this.nodeEntry) === null || _a === void 0 ? void 0 : _a.entry) === null || _b === void 0 ? void 0 : _b.properties) && this.nodeEntry.entry.properties['cm:versionLabel'] ?
                encodeURI((_d = (_c = this.nodeEntry) === null || _c === void 0 ? void 0 : _c.entry) === null || _d === void 0 ? void 0 : _d.properties['cm:versionLabel']) : encodeURI('1.0');
            this.urlFileContent = versionData ? this.contentApi.getVersionContentUrl(this.nodeId, versionData.id) :
                this.contentApi.getContentUrl(this.nodeId);
            this.urlFileContent = this.cacheBusterNumber ? this.urlFileContent + '&' + currentFileVersion + '&' + this.cacheBusterNumber :
                this.urlFileContent + '&' + currentFileVersion;
            this.extension = this.getFileExtension(versionData ? versionData.name : nodeData.name);
            this.fileName = versionData ? versionData.name : nodeData.name;
            this.viewerType = this.getViewerType(this.extension, this.mimeType);
            if (this.viewerType === 'unknown') {
                if (versionData) {
                    yield this.viewUtilService.displayNodeRendition(nodeData.id, versionData.id);
                }
                else {
                    yield this.viewUtilService.displayNodeRendition(nodeData.id);
                }
            }
            this.extensionChange.emit(this.extension);
            this.sidebarRightTemplateContext.node = nodeData;
            this.sidebarLeftTemplateContext.node = nodeData;
            this.scrollTop();
        });
    }
    getViewerType(extension, mimeType) {
        let viewerType = this.getViewerTypeByExtension(extension);
        if (viewerType === 'unknown') {
            viewerType = this.getViewerTypeByMimeType(mimeType);
        }
        return viewerType;
    }
    setUpSharedLinkFile(details) {
        this.mimeType = details.entry.content.mimeType;
        this.fileTitle = this.getDisplayName(details.entry.name);
        this.extension = this.getFileExtension(details.entry.name);
        this.fileName = details.entry.name;
        this.urlFileContent = this.contentApi.getSharedLinkContentUrl(this.sharedLinkId, false);
        this.viewerType = this.getViewerType(this.extension, this.mimeType);
        if (this.viewerType === 'unknown') {
            this.displaySharedLinkRendition(this.sharedLinkId);
        }
        this.extensionChange.emit(this.extension);
    }
    toggleSidebar() {
        this.showRightSidebar = !this.showRightSidebar;
        if (this.showRightSidebar && this.nodeId) {
            this.nodesApi.getNode(this.nodeId, { include: ['allowableOperations'] })
                .then((nodeEntry) => {
                this.sidebarRightTemplateContext.node = nodeEntry.entry;
            });
        }
    }
    toggleLeftSidebar() {
        this.showLeftSidebar = !this.showLeftSidebar;
        if (this.showRightSidebar && this.nodeId) {
            this.nodesApi.getNode(this.nodeId, { include: ['allowableOperations'] })
                .then((nodeEntry) => {
                this.sidebarLeftTemplateContext.node = nodeEntry.entry;
            });
        }
    }
    getDisplayName(name) {
        return this.displayName || name;
    }
    scrollTop() {
        window.scrollTo(0, 1);
    }
    getViewerTypeByMimeType(mimeType) {
        if (mimeType) {
            mimeType = mimeType.toLowerCase();
            const editorTypes = Object.keys(this.mimeTypes);
            for (const type of editorTypes) {
                if (this.mimeTypes[type].indexOf(mimeType) >= 0) {
                    return type;
                }
            }
        }
        return 'unknown';
    }
    getViewerTypeByExtension(extension) {
        if (extension) {
            extension = extension.toLowerCase();
        }
        if (this.isExternalViewer()) {
            return 'external';
        }
        if (this.isCustomViewerExtension(extension)) {
            return 'custom';
        }
        if (this.extensions.image.indexOf(extension) >= 0) {
            return 'image';
        }
        if (this.extensions.media.indexOf(extension) >= 0) {
            return 'media';
        }
        if (this.extensions.text.indexOf(extension) >= 0) {
            return 'text';
        }
        if (this.extensions.pdf.indexOf(extension) >= 0) {
            return 'pdf';
        }
        return 'unknown';
    }
    onBackButtonClick() {
        this.close();
    }
    onNavigateBeforeClick(event) {
        this.navigateBefore.next(event);
    }
    onNavigateNextClick(event) {
        this.navigateNext.next(event);
    }
    close() {
        if (this.otherMenu) {
            this.otherMenu.hidden = false;
        }
        this.showViewer = false;
        this.showViewerChange.emit(this.showViewer);
    }
    getFilenameFromUrl(url) {
        const anchor = url.indexOf('#');
        const query = url.indexOf('?');
        const end = Math.min(anchor > 0 ? anchor : url.length, query > 0 ? query : url.length);
        return url.substring(url.lastIndexOf('/', end) + 1, end);
    }
    getFileExtension(fileName) {
        if (fileName) {
            const match = fileName.match(/\.([^\./\?\#]+)($|\?|\#)/);
            return match ? match[1] : null;
        }
        return null;
    }
    isExternalViewer() {
        return !!this.viewerExtensions.find(ext => ext.fileExtension === '*');
    }
    isCustomViewerExtension(extension) {
        const extensions = this.externalExtensions || [];
        if (extension && extensions.length > 0) {
            extension = extension.toLowerCase();
            return extensions.flat().indexOf(extension) >= 0;
        }
        return false;
    }
    handleKeyboardEvent(event) {
        if (event && event.defaultPrevented) {
            return;
        }
        const key = event.keyCode;
        if (key === 37 && this.canNavigateBefore) {
            event.preventDefault();
            this.onNavigateBeforeClick(event);
        }
        if (key === 39 && this.canNavigateNext) {
            event.preventDefault();
            this.onNavigateNextClick(event);
        }
        if (key === 70 && event.ctrlKey) {
            event.preventDefault();
            this.enterFullScreen();
        }
    }
    printContent() {
        if (this.allowPrint) {
            const args = new BaseEvent();
            this.print.next(args);
            if (!args.defaultPrevented) {
                this.viewUtilService.printFileGeneric(this.nodeId, this.mimeType);
            }
        }
    }
    enterFullScreen() {
        if (this.allowFullScreen) {
            const container = this.el.nativeElement.querySelector('.adf-viewer__fullscreen-container');
            if (container) {
                if (container.requestFullscreen) {
                    container.requestFullscreen();
                }
                else if (container.webkitRequestFullscreen) {
                    container.webkitRequestFullscreen();
                }
                else if (container.mozRequestFullScreen) {
                    container.mozRequestFullScreen();
                }
                else if (container.msRequestFullscreen) {
                    container.msRequestFullscreen();
                }
            }
        }
    }
    displaySharedLinkRendition(sharedId) {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                const rendition = yield this.sharedLinksApi.getSharedLinkRendition(sharedId, 'pdf');
                if (rendition.entry.status.toString() === 'CREATED') {
                    this.viewerType = 'pdf';
                    this.urlFileContent = this.contentApi.getSharedLinkRenditionUrl(sharedId, 'pdf');
                }
            }
            catch (error) {
                this.logService.error(error);
                try {
                    const rendition = yield this.sharedLinksApi.getSharedLinkRendition(sharedId, 'imgpreview');
                    if (rendition.entry.status.toString() === 'CREATED') {
                        this.viewerType = 'image';
                        this.urlFileContent = this.contentApi.getSharedLinkRenditionUrl(sharedId, 'imgpreview');
                    }
                }
                catch (error) {
                    this.logService.error(error);
                }
            }
        });
    }
    checkExtensions(extensionAllowed) {
        if (typeof extensionAllowed === 'string') {
            return this.extension.toLowerCase() === extensionAllowed.toLowerCase();
        }
        else if (extensionAllowed.length > 0) {
            return extensionAllowed.find((currentExtension) => {
                return this.extension.toLowerCase() === currentExtension.toLowerCase();
            });
        }
    }
    onSubmitFile(newImageBlob) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p;
        if (((_b = (_a = this === null || this === void 0 ? void 0 : this.nodeEntry) === null || _a === void 0 ? void 0 : _a.entry) === null || _b === void 0 ? void 0 : _b.id) && !this.readOnly) {
            const newImageFile = new File([newImageBlob], (_d = (_c = this === null || this === void 0 ? void 0 : this.nodeEntry) === null || _c === void 0 ? void 0 : _c.entry) === null || _d === void 0 ? void 0 : _d.name, { type: (_g = (_f = (_e = this === null || this === void 0 ? void 0 : this.nodeEntry) === null || _e === void 0 ? void 0 : _e.entry) === null || _f === void 0 ? void 0 : _f.content) === null || _g === void 0 ? void 0 : _g.mimeType });
            const newFile = new FileModel(newImageFile, {
                majorVersion: false,
                newVersion: true,
                parentId: (_j = (_h = this === null || this === void 0 ? void 0 : this.nodeEntry) === null || _h === void 0 ? void 0 : _h.entry) === null || _j === void 0 ? void 0 : _j.parentId,
                nodeType: (_m = (_l = (_k = this === null || this === void 0 ? void 0 : this.nodeEntry) === null || _k === void 0 ? void 0 : _k.entry) === null || _l === void 0 ? void 0 : _l.content) === null || _m === void 0 ? void 0 : _m.mimeType
            }, (_p = (_o = this === null || this === void 0 ? void 0 : this.nodeEntry) === null || _o === void 0 ? void 0 : _o.entry) === null || _p === void 0 ? void 0 : _p.id);
            this.uploadService.addToQueue(...[newFile]);
            this.uploadService.uploadFilesInTheQueue();
        }
    }
    onUnsupportedFile() {
        this.viewerType = 'unknown';
    }
    closeOverlayManager() {
        this.dialog.afterOpened.pipe(skipWhile(() => !this.overlayMode), takeUntil(this.onDestroy$)).subscribe(() => this.shouldCloseViewer = false);
        this.dialog.afterAllClosed.pipe(skipWhile(() => !this.overlayMode), takeUntil(this.onDestroy$)).subscribe(() => this.shouldCloseViewer = true);
        this.keyDown$.pipe(skipWhile(() => !this.overlayMode), filter((e) => e.keyCode === 27), takeUntil(this.onDestroy$)).subscribe((event) => {
            event.preventDefault();
            if (this.shouldCloseViewer) {
                this.close();
            }
        });
    }
    generateCacheBusterNumber() {
        this.cacheBusterNumber = Date.now();
    }
}
ViewerComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-viewer',
                template: "<div *ngIf=\"showViewer\"\n     class=\"adf-viewer-container\"\n     [class.adf-viewer-overlay-container]=\"overlayMode\"\n     [class.adf-viewer-inline-container]=\"!overlayMode\">\n\n    <div class=\"adf-viewer-content\"\n         fxLayout=\"column\"\n         [cdkTrapFocus]=\"overlayMode\"\n         cdkTrapFocusAutoCapture>\n        <ng-content select=\"adf-viewer-toolbar\"></ng-content>\n        <ng-container *ngIf=\"showToolbar && !toolbar\">\n            <adf-toolbar id=\"adf-viewer-toolbar\" class=\"adf-viewer-toolbar\">\n                <adf-toolbar-title>\n\n                    <ng-container *ngIf=\"allowLeftSidebar\">\n                        <button mat-icon-button\n                                [attr.aria-expanded]=\"showLeftSidebar\"\n                                [attr.aria-label]=\"'ADF_VIEWER.ACTIONS.INFO' | translate\"\n                                title=\"{{ 'ADF_VIEWER.ACTIONS.INFO' | translate }}\"\n                                data-automation-id=\"adf-toolbar-left-sidebar\"\n                                [color]=\"showLeftSidebar ? 'accent' : null\"\n                                (click)=\"toggleLeftSidebar()\">\n                            <mat-icon>info_outline</mat-icon>\n                        </button>\n                    </ng-container>\n\n                    <button *ngIf=\"allowGoBack\"\n                            class=\"adf-viewer-close-button\"\n                            data-automation-id=\"adf-toolbar-back\"\n                            [attr.aria-label]=\"'ADF_VIEWER.ACTIONS.CLOSE' | translate\"\n                            mat-icon-button\n                            title=\"{{ 'ADF_VIEWER.ACTIONS.CLOSE' | translate }}\"\n                            (click)=\"onBackButtonClick()\">\n                        <mat-icon>close</mat-icon>\n                    </button>\n                </adf-toolbar-title>\n\n                <div fxFlex=\"1 1 auto\"\n                     class=\"adf-viewer__file-title\">\n                    <button *ngIf=\"allowNavigate && canNavigateBefore\"\n                            data-automation-id=\"adf-toolbar-pref-file\"\n                            mat-icon-button\n                            [attr.aria-label]=\"'ADF_VIEWER.ACTIONS.PREV_FILE' | translate\"\n                            title=\"{{ 'ADF_VIEWER.ACTIONS.PREV_FILE' | translate }}\"\n                            (click)=\"onNavigateBeforeClick($event)\">\n                        <mat-icon>navigate_before</mat-icon>\n                    </button>\n                    <img class=\"adf-viewer__mimeicon\"\n                         [alt]=\"mimeType\"\n                         [src]=\"mimeType | adfMimeTypeIcon\"\n                         data-automation-id=\"adf-file-thumbnail\">\n                    <span class=\"adf-viewer__display-name\"\n                          id=\"adf-viewer-display-name\">{{ fileTitle }}</span>\n                    <button *ngIf=\"allowNavigate && canNavigateNext\"\n                            data-automation-id=\"adf-toolbar-next-file\"\n                            mat-icon-button\n                            [attr.aria-label]=\"'ADF_VIEWER.ACTIONS.NEXT_FILE' | translate\"\n                            title=\"{{ 'ADF_VIEWER.ACTIONS.NEXT_FILE' | translate }}\"\n                            (click)=\"onNavigateNextClick($event)\">\n                        <mat-icon>navigate_next</mat-icon>\n                    </button>\n                </div>\n\n                <ng-content select=\"adf-viewer-toolbar-actions\"></ng-content>\n\n                <ng-container *ngIf=\"mnuOpenWith\"\n                              data-automation-id='adf-toolbar-custom-btn'>\n                    <button id=\"adf-viewer-openwith\"\n                            mat-button\n                            [matMenuTriggerFor]=\"mnuOpenWith\"\n                            data-automation-id=\"adf-toolbar-open-with\">\n                        <span>{{ 'ADF_VIEWER.ACTIONS.OPEN_WITH' | translate }}</span>\n                        <mat-icon>arrow_drop_down</mat-icon>\n                    </button>\n                    <mat-menu #mnuOpenWith=\"matMenu\"\n                              [overlapTrigger]=\"false\">\n                        <ng-content select=\"adf-viewer-open-with\"></ng-content>\n                    </mat-menu>\n                </ng-container>\n\n                <adf-toolbar-divider></adf-toolbar-divider>\n\n                <button id=\"adf-viewer-download\"\n                        *ngIf=\"allowDownload\"\n                        mat-icon-button\n                        [attr.aria-label]=\"'ADF_VIEWER.ACTIONS.DOWNLOAD' | translate\"\n                        title=\"{{ 'ADF_VIEWER.ACTIONS.DOWNLOAD' | translate }}\"\n                        data-automation-id=\"adf-toolbar-download\"\n                        [adfNodeDownload]=\"nodeEntry\"\n                        [version]=\"versionEntry\">\n                    <mat-icon>file_download</mat-icon>\n                </button>\n\n                <button id=\"adf-viewer-print\"\n                        *ngIf=\"allowPrint\"\n                        mat-icon-button\n                        [attr.aria-label]=\"'ADF_VIEWER.ACTIONS.PRINT' | translate\"\n                        title=\"{{ 'ADF_VIEWER.ACTIONS.PRINT' | translate }}\"\n                        data-automation-id=\"adf-toolbar-print\"\n                        (click)=\"printContent()\">\n                    <mat-icon>print</mat-icon>\n                </button>\n\n                <button id=\"adf-viewer-fullscreen\"\n                        *ngIf=\"viewerType !== 'media' && allowFullScreen\"\n                        mat-icon-button\n                        [attr.aria-label]=\"'ADF_VIEWER.ACTIONS.FULLSCREEN' | translate\"\n                        title=\"{{ 'ADF_VIEWER.ACTIONS.FULLSCREEN' | translate }}\"\n                        data-automation-id=\"adf-toolbar-fullscreen\"\n                        (click)=\"enterFullScreen()\">\n                    <mat-icon>fullscreen</mat-icon>\n                </button>\n\n                <ng-container *ngIf=\"allowRightSidebar\">\n                    <adf-toolbar-divider></adf-toolbar-divider>\n\n                    <button mat-icon-button\n                            [attr.aria-expanded]=\"showRightSidebar\"\n                            [attr.aria-label]=\"'ADF_VIEWER.ACTIONS.INFO' | translate\"\n                            title=\"{{ 'ADF_VIEWER.ACTIONS.INFO' | translate }}\"\n                            data-automation-id=\"adf-toolbar-sidebar\"\n                            [color]=\"showRightSidebar ? 'accent' : null\"\n                            (click)=\"toggleSidebar()\">\n                        <mat-icon>info_outline</mat-icon>\n                    </button>\n\n                </ng-container>\n\n                <ng-container *ngIf=\"mnuMoreActions\">\n                    <button id=\"adf-viewer-moreactions\"\n                            mat-icon-button\n                            [matMenuTriggerFor]=\"mnuMoreActions\"\n                            [attr.aria-label]=\"'ADF_VIEWER.ACTIONS.MORE_ACTIONS' | translate\"\n                            title=\"{{ 'ADF_VIEWER.ACTIONS.MORE_ACTIONS' | translate }}\"\n                            data-automation-id=\"adf-toolbar-more-actions\">\n                        <mat-icon>more_vert</mat-icon>\n                    </button>\n                    <mat-menu #mnuMoreActions=\"matMenu\"\n                              [overlapTrigger]=\"false\">\n                        <ng-content select=\"adf-viewer-more-actions\"></ng-content>\n                    </mat-menu>\n                </ng-container>\n\n            </adf-toolbar>\n        </ng-container>\n\n        <div fxLayout=\"row\"\n             fxFlex=\"1 1 auto\">\n            <ng-container *ngIf=\"allowRightSidebar && showRightSidebar\">\n                <div class=\"adf-viewer__sidebar\"\n                     [ngClass]=\"'adf-viewer__sidebar__right'\"\n                     fxFlexOrder=\"4\"\n                     id=\"adf-right-sidebar\">\n                    <ng-container *ngIf=\"sidebarRightTemplate\">\n                        <ng-container *ngTemplateOutlet=\"sidebarRightTemplate;context:sidebarRightTemplateContext\">\n                        </ng-container>\n                    </ng-container>\n                    <ng-content *ngIf=\"!sidebarRightTemplate\"\n                                select=\"adf-viewer-sidebar\"></ng-content>\n                </div>\n            </ng-container>\n\n            <ng-container *ngIf=\"allowLeftSidebar && showLeftSidebar\">\n                <div class=\"adf-viewer__sidebar\"\n                     [ngClass]=\"'adf-viewer__sidebar__left'\"\n                     fxFlexOrder=\"1\"\n                     id=\"adf-left-sidebar\">\n                    <ng-container *ngIf=\"sidebarLeftTemplate\">\n                        <ng-container *ngTemplateOutlet=\"sidebarLeftTemplate;context:sidebarLeftTemplateContext\">\n                        </ng-container>\n                    </ng-container>\n                    <ng-content *ngIf=\"!sidebarLeftTemplate\"\n                                select=\"adf-viewer-sidebar\"></ng-content>\n                </div>\n            </ng-container>\n\n            <div *ngIf=\"isLoading\"\n                 class=\"adf-viewer-main\"\n                 fxFlexOrder=\"1\"\n                 fxFlex=\"1 1 auto\">\n                <div class=\"adf-viewer-layout-content adf-viewer__fullscreen-container\">\n                    <div class=\"adf-viewer-content-container\">\n                        <ng-container *ngIf=\"isLoading\">\n                            <div class=\"adf-viewer__loading-screen\"\n                                 fxFlex=\"1 1 auto\">\n                                <h2>{{ 'ADF_VIEWER.LOADING' | translate }}</h2>\n                                <div>\n                                    <mat-spinner></mat-spinner>\n                                </div>\n                            </div>\n                        </ng-container>\n\n                    </div>\n                </div>\n            </div>\n\n            <div *ngIf=\"!isLoading\"\n                 class=\"adf-viewer-main\"\n                 fxFlexOrder=\"1\"\n                 fxFlex=\"1 1 auto\">\n                <div class=\"adf-viewer-layout-content adf-viewer__fullscreen-container\">\n                    <div class=\"adf-viewer-content-container\" [ngSwitch]=\"viewerType\">\n                        <ng-container *ngSwitchCase=\"'external'\">\n                            <adf-preview-extension\n                                *ngIf=\"!!externalViewer\"\n                                [id]=\"externalViewer.component\"\n                                [node]=\"nodeEntry?.entry\"\n                                [url]=\"urlFileContent\"\n                                [extension]=\"externalViewer.fileExtension\"\n                                [attr.data-automation-id]=\"externalViewer.component\">\n                            </adf-preview-extension>\n                        </ng-container>\n\n                        <ng-container *ngSwitchCase=\"'pdf'\">\n                            <adf-pdf-viewer (close)=\"onBackButtonClick()\"\n                                            [thumbnailsTemplate]=\"thumbnailsTemplate\"\n                                            [allowThumbnails]=\"allowThumbnails\"\n                                            [blobFile]=\"blobFile\"\n                                            [urlFile]=\"urlFileContent\"\n                                            [nameFile]=\"displayName\"\n                                            [cacheType]=\"cacheTypeForContent\"\n                                            (error)=\"onUnsupportedFile()\"></adf-pdf-viewer>\n                        </ng-container>\n\n                        <ng-container *ngSwitchCase=\"'image'\">\n                            <adf-img-viewer [urlFile]=\"urlFileContent\"\n                                            [nameFile]=\"displayName\"\n                                            [blobFile]=\"blobFile\"\n                                            [readOnly]=\"readOnly\"\n                                            (error)=\"onUnsupportedFile()\"\n                                            (submit)=\"onSubmitFile($event)\"\n                            ></adf-img-viewer>\n                        </ng-container>\n\n                        <ng-container *ngSwitchCase=\"'media'\">\n                            <adf-media-player id=\"adf-mdedia-player\"\n                                              [urlFile]=\"urlFileContent\"\n                                              [nodeId]=\"nodeEntry?.entry?.id\"\n                                              [mimeType]=\"mimeType\"\n                                              [blobFile]=\"blobFile\"\n                                              [nameFile]=\"displayName\"\n                                              (error)=\"onUnsupportedFile()\"></adf-media-player>\n                        </ng-container>\n\n                        <ng-container *ngSwitchCase=\"'text'\">\n                            <adf-txt-viewer [urlFile]=\"urlFileContent\"\n                                            [blobFile]=\"blobFile\"></adf-txt-viewer>\n                        </ng-container>\n\n                        <ng-container *ngSwitchCase=\"'in_creation'\">\n                            <div class=\"adf-viewer__loading-screen\"\n                                 fxFlex=\"1 1 auto\">\n                                <h2>{{ 'ADF_VIEWER.LOADING' | translate }}</h2>\n                                <div>\n                                    <mat-spinner></mat-spinner>\n                                </div>\n                            </div>\n                        </ng-container>\n\n                        <ng-container *ngSwitchCase=\"'custom'\">\n                            <ng-container *ngFor=\"let ext of viewerExtensions\">\n                                <adf-preview-extension *ngIf=\"checkExtensions(ext.fileExtension)\"\n                                                       [id]=\"ext.component\"\n                                                       [node]=\"nodeEntry.entry\"\n                                                       [url]=\"urlFileContent\"\n                                                       [extension]=\"extension\"\n                                                       [attr.data-automation-id]=\"ext.component\">\n                                </adf-preview-extension>\n                            </ng-container>\n\n                            <span class=\"adf-viewer-custom-content\"\n                                  *ngFor=\"let extensionTemplate of extensionTemplates\">\n                                <ng-template *ngIf=\"extensionTemplate.isVisible\"\n                                             [ngTemplateOutlet]=\"extensionTemplate.template\"\n                                             [ngTemplateOutletContext]=\"{ urlFileContent: urlFileContent, extension:extension }\">\n                                </ng-template>\n                            </span>\n                        </ng-container>\n\n                        <ng-container *ngSwitchDefault>\n                            <adf-viewer-unknown-format></adf-viewer-unknown-format>\n                        </ng-container>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n    </div>\n</div>\n",
                host: { 'class': 'adf-viewer' },
                encapsulation: ViewEncapsulation.None,
                styles: [".adf-full-screen,.adf-viewer-container .adf-viewer-content,.adf-viewer-container .adf-viewer-layout,.adf-viewer-container .adf-viewer-layout-content,.adf-viewer-inline-container{background-color:var(--theme-card-bg-color);height:100%;width:100%}.adf-viewer{height:100%;position:absolute;width:100%}.adf-viewer .mat-toolbar{color:var(--theme-text-color)}.adf-viewer .mat-toolbar .adf-toolbar-title{width:auto}.adf-viewer-main{width:0}.adf-viewer__mimeicon{height:18px;vertical-align:middle;width:18px}.adf-viewer-toolbar .mat-toolbar{background-color:var(--theme-card-bg-bold-color)}.adf-viewer__file-title{text-align:center}.adf-viewer__display-name{color:var(--theme-text-fg-color);display:inline-block;font-size:16px;font-stretch:normal;font-style:normal;font-weight:400;letter-spacing:-.4px;line-height:1.5;max-width:400px;opacity:.87;overflow:hidden;text-overflow:ellipsis;vertical-align:middle}.adf-viewer-container .adf-viewer-layout-content{background-color:var(--theme-background-color);display:flex;flex:1;flex-direction:row;flex-wrap:wrap;overflow-x:hidden;overflow-y:hidden;position:relative;z-index:1}.adf-viewer-container .adf-viewer-layout-content>div{align-items:stretch;display:flex;flex-flow:row wrap;height:100%;margin:0 auto}.adf-viewer-container .adf-viewer-layout{display:flex;flex-direction:row;overflow-x:hidden;overflow-y:auto;position:relative}.adf-viewer-container .adf-viewer-content{flex:1}.adf-viewer-container .adf-viewer-content>div{height:0}.adf-viewer-overlay-container .adf-viewer-content{left:0;position:fixed;top:0;z-index:1000}.adf-viewer-content-container{display:flex;justify-content:center}.adf-viewer-custom-content{width:100vw}.adf-viewer-unknown-content,.adf-viewer__loading-screen{align-items:center;display:flex}.adf-viewer__loading-screen{flex-direction:column;height:85vh;justify-content:center}.adf-viewer__loading-screen .mat-spinner{margin:0 auto}.adf-viewer__sidebar{background-color:var(--theme-background-color);box-shadow:0 2px 4px 0 var(--theme-text-fg-shadow-color);display:block;overflow:auto;padding:0;width:350px}.adf-viewer__sidebar__right{border-left:1px solid var(--theme-border-color)}.adf-viewer__sidebar__left{border-right:1px solid var(--theme-border-color)}.adf-viewer__thumbnails{background:#e6e6e6;display:flex;flex-direction:column;padding:0;width:180px}.adf-viewer__thumbnails .adf-info-drawer-layout{background:#e6e6e6;display:flex;flex:1;flex-direction:column}.adf-viewer__thumbnails .adf-info-drawer-layout-header{margin-bottom:0}.adf-viewer__thumbnails .adf-info-drawer-layout-content{height:100%;overflow:hidden;padding:0}.adf-viewer__thumbnails .adf-info-drawer-content{height:100%}.adf-viewer__thumbnails .adf-info-drawer-layout-content>:last-child{height:100%;overflow:hidden}.adf-viewer__toolbar-page-scale{border:1px solid var(--theme-border-color);cursor:default;font-size:14px;height:24px;line-height:24px;margin-left:4px;margin-right:4px;text-align:center;width:79px}"]
            },] }
];
ViewerComponent.ctorParameters = () => [
    { type: AlfrescoApiService },
    { type: ViewUtilService },
    { type: LogService },
    { type: AppExtensionService },
    { type: ContentService },
    { type: UploadService },
    { type: ElementRef },
    { type: MatDialog },
    { type: ChangeDetectorRef }
];
ViewerComponent.propDecorators = {
    toolbar: [{ type: ContentChild, args: [ViewerToolbarComponent,] }],
    sidebar: [{ type: ContentChild, args: [ViewerSidebarComponent,] }],
    mnuOpenWith: [{ type: ContentChild, args: [ViewerOpenWithComponent,] }],
    mnuMoreActions: [{ type: ContentChild, args: [ViewerMoreActionsComponent,] }],
    urlFile: [{ type: Input }],
    urlFileViewer: [{ type: Input }],
    blobFile: [{ type: Input }],
    nodeId: [{ type: Input }],
    versionId: [{ type: Input }],
    sharedLinkId: [{ type: Input }],
    overlayMode: [{ type: Input }],
    showViewer: [{ type: Input }],
    showToolbar: [{ type: Input }],
    displayName: [{ type: Input }],
    allowGoBack: [{ type: Input }],
    allowDownload: [{ type: Input }],
    allowPrint: [{ type: Input }],
    allowFullScreen: [{ type: Input }],
    allowNavigate: [{ type: Input }],
    canNavigateBefore: [{ type: Input }],
    canNavigateNext: [{ type: Input }],
    allowLeftSidebar: [{ type: Input }],
    allowRightSidebar: [{ type: Input }],
    allowThumbnails: [{ type: Input }],
    showRightSidebar: [{ type: Input }],
    showLeftSidebar: [{ type: Input }],
    sidebarRightTemplate: [{ type: Input }],
    sidebarLeftTemplate: [{ type: Input }],
    thumbnailsTemplate: [{ type: Input }],
    mimeType: [{ type: Input }],
    fileName: [{ type: Input }],
    maxRetries: [{ type: Input }],
    goBack: [{ type: Output }],
    print: [{ type: Output }],
    showViewerChange: [{ type: Output }],
    extensionChange: [{ type: Output }],
    navigateBefore: [{ type: Output }],
    navigateNext: [{ type: Output }],
    invalidSharedLink: [{ type: Output }],
    handleKeyboardEvent: [{ type: HostListener, args: ['document:keyup', ['$event'],] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlld2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL2NvcmUvIiwic291cmNlcyI6WyJ2aWV3ZXIvY29tcG9uZW50cy92aWV3ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRzs7QUFFSCxPQUFPLEVBQ0gsU0FBUyxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLFVBQVUsRUFDL0QsS0FBSyxFQUFhLE1BQU0sRUFBRSxXQUFXLEVBQ3JDLGlCQUFpQixFQUFxQixpQkFBaUIsRUFDMUQsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQU9ILGNBQWMsRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFDcEQsTUFBTSxrQkFBa0IsQ0FBQztBQUMxQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ3pDLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBQ3pFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUM3RSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUN2RSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUNwRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUNwRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMxQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDaEUsT0FBTyxFQUFFLG1CQUFtQixFQUFzQixNQUFNLDBCQUEwQixDQUFDO0FBQ25GLE9BQU8sRUFBRSxNQUFN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Qzs7O1lBckJRLGtCQUFrQjtZQU9sQixlQUFlO1lBTmYsVUFBVTtZQU9WLG1CQUFtQjtZQUduQixjQUFjO1lBQ2QsYUFBYTtZQTFCbUMsVUFBVTtZQXdCMUQsU0FBUztZQXRCd0IsaUJBQWlCOzs7c0JBb0N0RCxZQUFZLFNBQUMsc0JBQXNCO3NCQUduQyxZQUFZLFNBQUMsc0JBQXNCOzBCQUduQyxZQUFZLFNBQUMsdUJBQXVCOzZCQUdwQyxZQUFZLFNBQUMsMEJBQTBCO3NCQU12QyxLQUFLOzRCQU1MLEtBQUs7dUJBSUwsS0FBSztxQkFJTCxLQUFLO3dCQUlMLEtBQUs7MkJBSUwsS0FBSzswQkFNTCxLQUFLO3lCQUlMLEtBQUs7MEJBSUwsS0FBSzswQkFJTCxLQUFLOzBCQUtMLEtBQUs7NEJBSUwsS0FBSzt5QkFJTCxLQUFLOzhCQUlMLEtBQUs7NEJBTUwsS0FBSztnQ0FJTCxLQUFLOzhCQUlMLEtBQUs7K0JBSUwsS0FBSztnQ0FJTCxLQUFLOzhCQUlMLEtBQUs7K0JBSUwsS0FBSzs4QkFJTCxLQUFLO21DQUlMLEtBQUs7a0NBSUwsS0FBSztpQ0FJTCxLQUFLO3VCQUlMLEtBQUs7dUJBSUwsS0FBSzt5QkFNTCxLQUFLO3FCQUlMLE1BQU07b0JBSU4sTUFBTTsrQkFJTixNQUFNOzhCQUlOLE1BQU07NkJBSU4sTUFBTTsyQkFJTixNQUFNO2dDQUlOLE1BQU07a0NBMmJOLFlBQVksU0FBQyxnQkFBZ0IsRUFBRSxDQUFDLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7XG4gICAgQ29tcG9uZW50LCBDb250ZW50Q2hpbGQsIEV2ZW50RW1pdHRlciwgSG9zdExpc3RlbmVyLCBFbGVtZW50UmVmLFxuICAgIElucHV0LCBPbkNoYW5nZXMsIE91dHB1dCwgVGVtcGxhdGVSZWYsXG4gICAgVmlld0VuY2Fwc3VsYXRpb24sIE9uSW5pdCwgT25EZXN0cm95LCBDaGFuZ2VEZXRlY3RvclJlZlxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gICAgU2hhcmVkTGlua0VudHJ5LFxuICAgIE5vZGUsXG4gICAgVmVyc2lvbixcbiAgICBSZW5kaXRpb25FbnRyeSxcbiAgICBOb2RlRW50cnksXG4gICAgVmVyc2lvbkVudHJ5LFxuICAgIFNoYXJlZGxpbmtzQXBpLCBWZXJzaW9uc0FwaSwgTm9kZXNBcGksIENvbnRlbnRBcGlcbn0gZnJvbSAnQGFsZnJlc2NvL2pzLWFwaSc7XG5pbXBvcnQgeyBCYXNlRXZlbnQgfSBmcm9tICcuLi8uLi9ldmVudHMnO1xuaW1wb3J0IHsgQWxmcmVzY29BcGlTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvYWxmcmVzY28tYXBpLnNlcnZpY2UnO1xuaW1wb3J0IHsgTG9nU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2xvZy5zZXJ2aWNlJztcbmltcG9ydCB7IFZpZXdlck1vcmVBY3Rpb25zQ29tcG9uZW50IH0gZnJvbSAnLi92aWV3ZXItbW9yZS1hY3Rpb25zLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBWaWV3ZXJPcGVuV2l0aENvbXBvbmVudCB9IGZyb20gJy4vdmlld2VyLW9wZW4td2l0aC5jb21wb25lbnQnO1xuaW1wb3J0IHsgVmlld2VyU2lkZWJhckNvbXBvbmVudCB9IGZyb20gJy4vdmlld2VyLXNpZGViYXIuY29tcG9uZW50JztcbmltcG9ydCB7IFZpZXdlclRvb2xiYXJDb21wb25lbnQgfSBmcm9tICcuL3ZpZXdlci10b29sYmFyLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBmcm9tRXZlbnQsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFZpZXdVdGlsU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3ZpZXctdXRpbC5zZXJ2aWNlJztcbmltcG9ydCB7IEFwcEV4dGVuc2lvblNlcnZpY2UsIFZpZXdlckV4dGVuc2lvblJlZiB9IGZyb20gJ0BhbGZyZXNjby9hZGYtZXh0ZW5zaW9ucyc7XG5pbXBvcnQgeyBmaWx0ZXIsIHNraXBXaGlsZSwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgTWF0RGlhbG9nIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZGlhbG9nJztcbmltcG9ydCB7IENvbnRlbnRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvY29udGVudC5zZXJ2aWNlJztcbmltcG9ydCB7IFVwbG9hZFNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy91cGxvYWQuc2VydmljZSc7XG5pbXBvcnQgeyBGaWxlTW9kZWwgfSBmcm9tICcuLi8uLi9tb2RlbHMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi12aWV3ZXInLFxuICAgIHRlbXBsYXRlVXJsOiAnLi92aWV3ZXIuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3ZpZXdlci5jb21wb25lbnQuc2NzcyddLFxuICAgIGhvc3Q6IHsgJ2NsYXNzJzogJ2FkZi12aWV3ZXInIH0sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBWaWV3ZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMsIE9uSW5pdCwgT25EZXN0cm95IHtcblxuICAgIEBDb250ZW50Q2hpbGQoVmlld2VyVG9vbGJhckNvbXBvbmVudClcbiAgICB0b29sYmFyOiBWaWV3ZXJUb29sYmFyQ29tcG9uZW50O1xuXG4gICAgQENvbnRlbnRDaGlsZChWaWV3ZXJTaWRlYmFyQ29tcG9uZW50KVxuICAgIHNpZGViYXI6IFZpZXdlclNpZGViYXJDb21wb25lbnQ7XG5cbiAgICBAQ29udGVudENoaWxkKFZpZXdlck9wZW5XaXRoQ29tcG9uZW50KVxuICAgIG1udU9wZW5XaXRoOiBWaWV3ZXJPcGVuV2l0aENvbXBvbmVudDtcblxuICAgIEBDb250ZW50Q2hpbGQoVmlld2VyTW9yZUFjdGlvbnNDb21wb25lbnQpXG4gICAgbW51TW9yZUFjdGlvbnM6IFZpZXdlck1vcmVBY3Rpb25zQ29tcG9uZW50O1xuXG4gICAgLyoqIElmIHlvdSB3YW50IHRvIGxvYWQgYW4gZXh0ZXJuYWwgZmlsZSB0aGF0IGRvZXMgbm90IGNvbWUgZnJvbSBBQ1MgeW91XG4gICAgICogY2FuIHVzZSB0aGlzIFVSTCB0byBzcGVjaWZ5IHdoZXJlIHRvIGxvYWQgdGhlIGZpbGUgZnJvbS5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHVybEZpbGUgPSAnJztcblxuICAgIC8qKiBWaWV3ZXIgdG8gdXNlIHdpdGggdGhlIGB1cmxGaWxlYCBhZGRyZXNzIChgcGRmYCwgYGltYWdlYCwgYG1lZGlhYCwgYHRleHRgKS5cbiAgICAgKiBVc2VkIHdoZW4gYHVybEZpbGVgIGhhcyBubyBmaWxlbmFtZSBhbmQgZXh0ZW5zaW9uLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgdXJsRmlsZVZpZXdlcjogc3RyaW5nID0gbnVsbDtcblxuICAgIC8qKiBMb2FkcyBhIEJsb2IgRmlsZSAqL1xuICAgIEBJbnB1dCgpXG4gICAgYmxvYkZpbGU6IEJsb2I7XG5cbiAgICAvKiogTm9kZSBJZCBvZiB0aGUgZmlsZSB0byBsb2FkLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgbm9kZUlkOiBzdHJpbmcgPSBudWxsO1xuXG4gICAgLyoqIFZlcnNpb24gSWQgb2YgdGhlIGZpbGUgdG8gbG9hZC4gKi9cbiAgICBASW5wdXQoKVxuICAgIHZlcnNpb25JZDogc3RyaW5nID0gbnVsbDtcblxuICAgIC8qKiBTaGFyZWQgbGluayBpZCAodG8gZGlzcGxheSBzaGFyZWQgZmlsZSkuICovXG4gICAgQElucHV0KClcbiAgICBzaGFyZWRMaW5rSWQ6IHN0cmluZyA9IG51bGw7XG5cbiAgICAvKiogSWYgYHRydWVgIHRoZW4gc2hvdyB0aGUgVmlld2VyIGFzIGEgZnVsbCBwYWdlIG92ZXIgdGhlIGN1cnJlbnQgY29udGVudC5cbiAgICAgKiBPdGhlcndpc2UgZml0IGluc2lkZSB0aGUgcGFyZW50IGRpdi5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIG92ZXJsYXlNb2RlID0gZmFsc2U7XG5cbiAgICAvKiogSGlkZSBvciBzaG93IHRoZSB2aWV3ZXIgKi9cbiAgICBASW5wdXQoKVxuICAgIHNob3dWaWV3ZXIgPSB0cnVlO1xuXG4gICAgLyoqIEhpZGUgb3Igc2hvdyB0aGUgdG9vbGJhciAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd1Rvb2xiYXIgPSB0cnVlO1xuXG4gICAgLyoqIFNwZWNpZmllcyB0aGUgbmFtZSBvZiB0aGUgZmlsZSB3aGVuIGl0IGlzIG5vdCBhdmFpbGFibGUgZnJvbSB0aGUgVVJMLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZGlzcGxheU5hbWU6IHN0cmluZztcblxuICAgIC8qKiBAZGVwcmVjYXRlZCAzLjIuMCAqL1xuICAgIC8qKiBBbGxvd3MgYGJhY2tgIG5hdmlnYXRpb24gKi9cbiAgICBASW5wdXQoKVxuICAgIGFsbG93R29CYWNrID0gdHJ1ZTtcblxuICAgIC8qKiBUb2dnbGVzIGRvd25sb2FkaW5nLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgYWxsb3dEb3dubG9hZCA9IHRydWU7XG5cbiAgICAvKiogVG9nZ2xlcyBwcmludGluZy4gKi9cbiAgICBASW5wdXQoKVxuICAgIGFsbG93UHJpbnQgPSBmYWxzZTtcblxuICAgIC8qKiBUb2dnbGVzIHRoZSAnRnVsbCBTY3JlZW4nIGZlYXR1cmUuICovXG4gICAgQElucHV0KClcbiAgICBhbGxvd0Z1bGxTY3JlZW4gPSB0cnVlO1xuXG4gICAgLyoqIFRvZ2dsZXMgYmVmb3JlL25leHQgbmF2aWdhdGlvbi4gWW91IGNhbiB1c2UgdGhlIGFycm93IGJ1dHRvbnMgdG8gbmF2aWdhdGVcbiAgICAgKiBiZXR3ZWVuIGRvY3VtZW50cyBpbiB0aGUgY29sbGVjdGlvbi5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIGFsbG93TmF2aWdhdGUgPSBmYWxzZTtcblxuICAgIC8qKiBUb2dnbGVzIHRoZSBcImJlZm9yZVwiIChcIjxcIikgYnV0dG9uLiBSZXF1aXJlcyBgYWxsb3dOYXZpZ2F0ZWAgdG8gYmUgZW5hYmxlZC4gKi9cbiAgICBASW5wdXQoKVxuICAgIGNhbk5hdmlnYXRlQmVmb3JlID0gdHJ1ZTtcblxuICAgIC8qKiBUb2dnbGVzIHRoZSBuZXh0IChcIj5cIikgYnV0dG9uLiBSZXF1aXJlcyBgYWxsb3dOYXZpZ2F0ZWAgdG8gYmUgZW5hYmxlZC4gKi9cbiAgICBASW5wdXQoKVxuICAgIGNhbk5hdmlnYXRlTmV4dCA9IHRydWU7XG5cbiAgICAvKiogQWxsb3cgdGhlIGxlZnQgdGhlIHNpZGViYXIuICovXG4gICAgQElucHV0KClcbiAgICBhbGxvd0xlZnRTaWRlYmFyID0gZmFsc2U7XG5cbiAgICAvKiogQWxsb3cgdGhlIHJpZ2h0IHNpZGViYXIuICovXG4gICAgQElucHV0KClcbiAgICBhbGxvd1JpZ2h0U2lkZWJhciA9IGZhbHNlO1xuXG4gICAgLyoqIFRvZ2dsZXMgUERGIHRodW1ibmFpbHMuICovXG4gICAgQElucHV0KClcbiAgICBhbGxvd1RodW1ibmFpbHMgPSB0cnVlO1xuXG4gICAgLyoqIFRvZ2dsZXMgcmlnaHQgc2lkZWJhciB2aXNpYmlsaXR5LiBSZXF1aXJlcyBgYWxsb3dSaWdodFNpZGViYXJgIHRvIGJlIHNldCB0byBgdHJ1ZWAuICovXG4gICAgQElucHV0KClcbiAgICBzaG93UmlnaHRTaWRlYmFyID0gZmFsc2U7XG5cbiAgICAvKiogVG9nZ2xlcyBsZWZ0IHNpZGViYXIgdmlzaWJpbGl0eS4gUmVxdWlyZXMgYGFsbG93TGVmdFNpZGViYXJgIHRvIGJlIHNldCB0byBgdHJ1ZWAuICovXG4gICAgQElucHV0KClcbiAgICBzaG93TGVmdFNpZGViYXIgPSBmYWxzZTtcblxuICAgIC8qKiBUaGUgdGVtcGxhdGUgZm9yIHRoZSByaWdodCBzaWRlYmFyLiBUaGUgdGVtcGxhdGUgY29udGV4dCBjb250YWlucyB0aGUgbG9hZGVkIG5vZGUgZGF0YS4gKi9cbiAgICBASW5wdXQoKVxuICAgIHNpZGViYXJSaWdodFRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+ID0gbnVsbDtcblxuICAgIC8qKiBUaGUgdGVtcGxhdGUgZm9yIHRoZSBsZWZ0IHNpZGViYXIuIFRoZSB0ZW1wbGF0ZSBjb250ZXh0IGNvbnRhaW5zIHRoZSBsb2FkZWQgbm9kZSBkYXRhLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2lkZWJhckxlZnRUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PiA9IG51bGw7XG5cbiAgICAvKiogVGhlIHRlbXBsYXRlIGZvciB0aGUgcGRmIHRodW1ibmFpbHMuICovXG4gICAgQElucHV0KClcbiAgICB0aHVtYm5haWxzVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT4gPSBudWxsO1xuXG4gICAgLyoqIE1JTUUgdHlwZSBvZiB0aGUgZmlsZSBjb250ZW50ICh3aGVuIG5vdCBkZXRlcm1pbmVkIGJ5IHRoZSBmaWxlbmFtZSBleHRlbnNpb24pLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgbWltZVR5cGU6IHN0cmluZztcblxuICAgIC8qKiBDb250ZW50IGZpbGVuYW1lLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZmlsZU5hbWU6IHN0cmluZztcblxuICAgIC8qKiBOdW1iZXIgb2YgdGltZXMgdGhlIFZpZXdlciB3aWxsIHJldHJ5IGZldGNoaW5nIGNvbnRlbnQgUmVuZGl0aW9uLlxuICAgICAqIFRoZXJlIGlzIGEgZGVsYXkgb2YgYXQgbGVhc3Qgb25lIHNlY29uZCBiZXR3ZWVuIGF0dGVtcHRzLlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgbWF4UmV0cmllcyA9IDMwO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB1c2VyIGNsaWNrcyB0aGUgJ0JhY2snIGJ1dHRvbi4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBnb0JhY2sgPSBuZXcgRXZlbnRFbWl0dGVyPEJhc2VFdmVudDxhbnk+PigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB1c2VyIGNsaWNrcyB0aGUgJ1ByaW50JyBidXR0b24uICovXG4gICAgQE91dHB1dCgpXG4gICAgcHJpbnQgPSBuZXcgRXZlbnRFbWl0dGVyPEJhc2VFdmVudDxhbnk+PigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgdmlld2VyIGlzIHNob3duIG9yIGhpZGRlbi4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBzaG93Vmlld2VyQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgZmlsZW5hbWUgZXh0ZW5zaW9uIGNoYW5nZXMuICovXG4gICAgQE91dHB1dCgpXG4gICAgZXh0ZW5zaW9uQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHVzZXIgY2xpY2tzICdOYXZpZ2F0ZSBCZWZvcmUnIChcIjxcIikgYnV0dG9uLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIG5hdmlnYXRlQmVmb3JlID0gbmV3IEV2ZW50RW1pdHRlcjxNb3VzZUV2ZW50IHwgS2V5Ym9hcmRFdmVudD4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdXNlciBjbGlja3MgJ05hdmlnYXRlIE5leHQnIChcIj5cIikgYnV0dG9uLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIG5hdmlnYXRlTmV4dCA9IG5ldyBFdmVudEVtaXR0ZXI8TW91c2VFdmVudCB8IEtleWJvYXJkRXZlbnQ+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIHRoZSBzaGFyZWQgbGluayB1c2VkIGlzIG5vdCB2YWxpZC4gKi9cbiAgICBAT3V0cHV0KClcbiAgICBpbnZhbGlkU2hhcmVkTGluayA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIFRSWV9USU1FT1VUOiBudW1iZXIgPSAxMDAwMDtcblxuICAgIHZpZXdlclR5cGUgPSAndW5rbm93bic7XG4gICAgaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgbm9kZUVudHJ5OiBOb2RlRW50cnk7XG4gICAgdmVyc2lvbkVudHJ5OiBWZXJzaW9uRW50cnk7XG5cbiAgICBleHRlbnNpb25UZW1wbGF0ZXM6IHsgdGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT4sIGlzVmlzaWJsZTogYm9vbGVhbiB9W10gPSBbXTtcbiAgICB1cmxGaWxlQ29udGVudDogc3RyaW5nO1xuICAgIG90aGVyTWVudTogYW55O1xuICAgIGV4dGVuc2lvbjogc3RyaW5nO1xuICAgIHNpZGViYXJSaWdodFRlbXBsYXRlQ29udGV4dDogeyBub2RlOiBOb2RlIH0gPSB7IG5vZGU6IG51bGwgfTtcbiAgICBzaWRlYmFyTGVmdFRlbXBsYXRlQ29udGV4dDogeyBub2RlOiBOb2RlIH0gPSB7IG5vZGU6IG51bGwgfTtcbiAgICBmaWxlVGl0bGU6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBsaXN0IG9mIHRoZSBhY3RpdmUgVmlld2VyIGNvbnRlbnQgZXh0ZW5zaW9ucy5cbiAgICAgKi9cbiAgICBnZXQgdmlld2VyRXh0ZW5zaW9ucygpOiBWaWV3ZXJFeHRlbnNpb25SZWZbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLmV4dGVuc2lvblNlcnZpY2UuZ2V0Vmlld2VyRXh0ZW5zaW9ucygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFByb3ZpZGVzIGEgbGlzdCBvZiBmaWxlIGV4dGVuc2lvbnMgc3VwcG9ydGVkIGJ5IGV4dGVybmFsIHBsdWdpbnMuXG4gICAgICovXG4gICAgZ2V0IGV4dGVybmFsRXh0ZW5zaW9ucygpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdlckV4dGVuc2lvbnMubWFwKGV4dCA9PiBleHQuZmlsZUV4dGVuc2lvbik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfZXh0ZXJuYWxWaWV3ZXI6IFZpZXdlckV4dGVuc2lvblJlZjtcbiAgICBnZXQgZXh0ZXJuYWxWaWV3ZXIoKTogVmlld2VyRXh0ZW5zaW9uUmVmIHtcbiAgICAgICAgaWYgKCF0aGlzLl9leHRlcm5hbFZpZXdlcikge1xuICAgICAgICAgICAgdGhpcy5fZXh0ZXJuYWxWaWV3ZXIgPSB0aGlzLnZpZXdlckV4dGVuc2lvbnMuZmluZChleHQgPT4gZXh0LmZpbGVFeHRlbnNpb24gPT09ICcqJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5fZXh0ZXJuYWxWaWV3ZXI7XG4gICAgfVxuXG4gICAgcmVhZE9ubHkgPSB0cnVlO1xuXG4gICAgcHJpdmF0ZSBjYWNoZUJ1c3Rlck51bWJlcjogbnVtYmVyO1xuICAgIGNhY2hlVHlwZUZvckNvbnRlbnQgPSAnJztcblxuICAgIC8vIEV4dGVuc2lvbnMgdGhhdCBhcmUgc3VwcG9ydGVkIGJ5IHRoZSBWaWV3ZXIgd2l0aG91dCBjb252ZXJzaW9uXG4gICAgcHJpdmF0ZSBleHRlbnNpb25zID0ge1xuICAgICAgICBpbWFnZTogWydwbmcnLCAnanBnJywgJ2pwZWcnLCAnZ2lmJywgJ2JwbScsICdzdmcnXSxcbiAgICAgICAgbWVkaWE6IFsnd2F2JywgJ21wNCcsICdtcDMnLCAnd2VibScsICdvZ2cnXSxcbiAgICAgICAgdGV4dDogWyd0eHQnLCAneG1sJywgJ2h0bWwnLCAnanNvbicsICd0cycsICdjc3MnLCAnbWQnXSxcbiAgICAgICAgcGRmOiBbJ3BkZiddXG4gICAgfTtcblxuICAgIC8vIE1pbWUgdHlwZXMgdGhhdCBhcmUgc3VwcG9ydGVkIGJ5IHRoZSBWaWV3ZXIgd2l0aG91dCBjb252ZXJzaW9uXG4gICAgcHJpdmF0ZSBtaW1lVHlwZXMgPSB7XG4gICAgICAgIHRleHQ6IFsndGV4dC9wbGFpbicsICd0ZXh0L2NzdicsICd0ZXh0L3htbCcsICd0ZXh0L2h0bWwnLCAnYXBwbGljYXRpb24veC1qYXZhc2NyaXB0J10sXG4gICAgICAgIHBkZjogWydhcHBsaWNhdGlvbi9wZGYnXSxcbiAgICAgICAgaW1hZ2U6IFsnaW1hZ2UvcG5nJywgJ2ltYWdlL2pwZWcnLCAnaW1hZ2UvZ2lmJywgJ2ltYWdlL2JtcCcsICdpbWFnZS9zdmcreG1sJ10sXG4gICAgICAgIG1lZGlhOiBbJ3ZpZGVvL21wNCcsICd2aWRlby93ZWJtJywgJ3ZpZGVvL29nZycsICdhdWRpby9tcGVnJywgJ2F1ZGlvL21wMycsICdhdWRpby9vZ2cnLCAnYXVkaW8vd2F2J11cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcbiAgICBwcml2YXRlIHNob3VsZENsb3NlVmlld2VyID0gdHJ1ZTtcbiAgICBwcml2YXRlIGtleURvd24kID0gZnJvbUV2ZW50PEtleWJvYXJkRXZlbnQ+KGRvY3VtZW50LCAna2V5ZG93bicpO1xuXG4gICAgX3NoYXJlZExpbmtzQXBpOiBTaGFyZWRsaW5rc0FwaTtcbiAgICBnZXQgc2hhcmVkTGlua3NBcGkoKTogU2hhcmVkbGlua3NBcGkge1xuICAgICAgICB0aGlzLl9zaGFyZWRMaW5rc0FwaSA9IHRoaXMuX3NoYXJlZExpbmtzQXBpID8/IG5ldyBTaGFyZWRsaW5rc0FwaSh0aGlzLmFwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9zaGFyZWRMaW5rc0FwaTtcbiAgICB9XG5cbiAgICBfdmVyc2lvbnNBcGk6IFZlcnNpb25zQXBpO1xuICAgIGdldCB2ZXJzaW9uc0FwaSgpOiBWZXJzaW9uc0FwaSB7XG4gICAgICAgIHRoaXMuX3ZlcnNpb25zQXBpID0gdGhpcy5fdmVyc2lvbnNBcGkgPz8gbmV3IFZlcnNpb25zQXBpKHRoaXMuYXBpU2VydmljZS5nZXRJbnN0YW5jZSgpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZlcnNpb25zQXBpO1xuICAgIH1cblxuICAgIF9ub2Rlc0FwaTogTm9kZXNBcGk7XG4gICAgZ2V0IG5vZGVzQXBpKCk6IE5vZGVzQXBpIHtcbiAgICAgICAgdGhpcy5fbm9kZXNBcGkgPSB0aGlzLl9ub2Rlc0FwaSA/PyBuZXcgTm9kZXNBcGkodGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5fbm9kZXNBcGk7XG4gICAgfVxuXG4gICAgX2NvbnRlbnRBcGk6IENvbnRlbnRBcGk7XG4gICAgZ2V0IGNvbnRlbnRBcGkoKTogQ29udGVudEFwaSB7XG4gICAgICAgIHRoaXMuX2NvbnRlbnRBcGkgPSB0aGlzLl9jb250ZW50QXBpID8/IG5ldyBDb250ZW50QXBpKHRoaXMuYXBpU2VydmljZS5nZXRJbnN0YW5jZSgpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRlbnRBcGk7XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBhcGlTZXJ2aWNlOiBBbGZyZXNjb0FwaVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB2aWV3VXRpbFNlcnZpY2U6IFZpZXdVdGlsU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBleHRlbnNpb25TZXJ2aWNlOiBBcHBFeHRlbnNpb25TZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgY29udGVudFNlcnZpY2U6IENvbnRlbnRTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgdXBsb2FkU2VydmljZTogVXBsb2FkU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmLFxuICAgICAgICAgICAgICAgIHB1YmxpYyBkaWFsb2c6IE1hdERpYWxvZyxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICAgICAgdmlld1V0aWxTZXJ2aWNlLm1heFJldHJpZXMgPSB0aGlzLm1heFJldHJpZXM7XG4gICAgfVxuXG4gICAgaXNTb3VyY2VEZWZpbmVkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gISEodGhpcy51cmxGaWxlIHx8IHRoaXMuYmxvYkZpbGUgfHwgdGhpcy5ub2RlSWQgfHwgdGhpcy5zaGFyZWRMaW5rSWQpO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLmFwaVNlcnZpY2Uubm9kZVVwZGF0ZWQucGlwZShcbiAgICAgICAgICAgIGZpbHRlcigobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBub2RlICYmIG5vZGUuaWQgPT09IHRoaXMubm9kZUlkICYmXG4gICAgICAgICAgICAgICAgICAgIChub2RlLm5hbWUgIT09IHRoaXMuZmlsZU5hbWUgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Tm9kZVZlcnNpb25Qcm9wZXJ0eSh0aGlzLm5vZGVFbnRyeS5lbnRyeSkgIT09IHRoaXMuZ2V0Tm9kZVZlcnNpb25Qcm9wZXJ0eShub2RlKSk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpXG4gICAgICAgICkuc3Vic2NyaWJlKChub2RlKSA9PiB0aGlzLm9uTm9kZVVwZGF0ZWQobm9kZSkpO1xuXG4gICAgICAgIHRoaXMudmlld1V0aWxTZXJ2aWNlLnZpZXdlclR5cGVDaGFuZ2UucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSkuc3Vic2NyaWJlKCh0eXBlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIHRoaXMudmlld2VyVHlwZSA9IHR5cGU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMudmlld1V0aWxTZXJ2aWNlLnVybEZpbGVDb250ZW50Q2hhbmdlLnBpcGUodGFrZVVudGlsKHRoaXMub25EZXN0cm95JCkpLnN1YnNjcmliZSgoY29udGVudDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnVybEZpbGVDb250ZW50ID0gY29udGVudDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5jbG9zZU92ZXJsYXlNYW5hZ2VyKCk7XG4gICAgICAgIHRoaXMuY2FjaGVUeXBlRm9yQ29udGVudCA9ICcnO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0Tm9kZVZlcnNpb25Qcm9wZXJ0eShub2RlOiBOb2RlKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIG5vZGU/LnByb3BlcnRpZXNbJ2NtOnZlcnNpb25MYWJlbCddID8/ICcnO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLm9uRGVzdHJveSQubmV4dCh0cnVlKTtcbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLmNvbXBsZXRlKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbk5vZGVVcGRhdGVkKG5vZGU6IE5vZGUpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5pZCA9PT0gdGhpcy5ub2RlSWQpIHtcbiAgICAgICAgICAgIHRoaXMuY2FjaGVUeXBlRm9yQ29udGVudCA9ICduby1jYWNoZSc7XG4gICAgICAgICAgICB0aGlzLmdlbmVyYXRlQ2FjaGVCdXN0ZXJOdW1iZXIoKTtcbiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuc2V0VXBOb2RlRmlsZShub2RlKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcygpIHtcbiAgICAgICAgaWYgKHRoaXMuc2hvd1ZpZXdlcikge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzU291cmNlRGVmaW5lZCgpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBIGNvbnRlbnQgc291cmNlIGF0dHJpYnV0ZSB2YWx1ZSBpcyBtaXNzaW5nLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5ibG9iRmlsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0VXBCbG9iRGF0YSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudXJsRmlsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0VXBVcmxGaWxlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5ub2RlSWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldHVwTm9kZSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNoYXJlZExpbmtJZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0dXBTaGFyZWRMaW5rKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHNldHVwU2hhcmVkTGluaygpIHtcbiAgICAgICAgdGhpcy5hbGxvd0dvQmFjayA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuc2hhcmVkTGlua3NBcGkuZ2V0U2hhcmVkTGluayh0aGlzLnNoYXJlZExpbmtJZCkudGhlbihcbiAgICAgICAgICAgIChzaGFyZWRMaW5rRW50cnk6IFNoYXJlZExpbmtFbnRyeSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0VXBTaGFyZWRMaW5rRmlsZShzaGFyZWRMaW5rRW50cnkpO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKCdUaGlzIHNoYXJlZExpbmsgZG9lcyBub3QgZXhpc3QnKTtcbiAgICAgICAgICAgICAgICB0aGlzLmludmFsaWRTaGFyZWRMaW5rLm5leHQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2V0dXBOb2RlKCkge1xuICAgICAgICB0aGlzLm5vZGVzQXBpLmdldE5vZGUodGhpcy5ub2RlSWQsIHsgaW5jbHVkZTogWydhbGxvd2FibGVPcGVyYXRpb25zJ10gfSkudGhlbihcbiAgICAgICAgICAgIChub2RlOiBOb2RlRW50cnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGVFbnRyeSA9IG5vZGU7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudmVyc2lvbklkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmVyc2lvbnNBcGkuZ2V0VmVyc2lvbih0aGlzLm5vZGVJZCwgdGhpcy52ZXJzaW9uSWQpLnRoZW4oXG4gICAgICAgICAgICAgICAgICAgICAgICAodmVyc2lvbjogVmVyc2lvbkVudHJ5KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52ZXJzaW9uRW50cnkgPSB2ZXJzaW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0VXBOb2RlRmlsZShub2RlLmVudHJ5LCB2ZXJzaW9uLmVudHJ5KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFVwTm9kZUZpbGUobm9kZS5lbnRyeSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKCdUaGlzIG5vZGUgZG9lcyBub3QgZXhpc3QnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldFVwQmxvYkRhdGEoKSB7XG4gICAgICAgIHRoaXMuZmlsZVRpdGxlID0gdGhpcy5nZXREaXNwbGF5TmFtZSgnVW5rbm93bicpO1xuICAgICAgICB0aGlzLm1pbWVUeXBlID0gdGhpcy5ibG9iRmlsZS50eXBlO1xuICAgICAgICB0aGlzLnZpZXdlclR5cGUgPSB0aGlzLmdldFZpZXdlclR5cGVCeU1pbWVUeXBlKHRoaXMubWltZVR5cGUpO1xuXG4gICAgICAgIHRoaXMuYWxsb3dEb3dubG9hZCA9IGZhbHNlO1xuICAgICAgICAvLyBUT0RPOiB3cmFwIGJsb2IgaW50byB0aGUgZGF0YSB1cmwgYW5kIGFsbG93IGRvd25sb2FkaW5nXG5cbiAgICAgICAgdGhpcy5leHRlbnNpb25DaGFuZ2UuZW1pdCh0aGlzLm1pbWVUeXBlKTtcbiAgICAgICAgdGhpcy5zY3JvbGxUb3AoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldFVwVXJsRmlsZSgpIHtcbiAgICAgICAgY29uc3QgZmlsZW5hbWVGcm9tVXJsID0gdGhpcy5nZXRGaWxlbmFtZUZyb21VcmwodGhpcy51cmxGaWxlKTtcbiAgICAgICAgdGhpcy5maWxlVGl0bGUgPSB0aGlzLmdldERpc3BsYXlOYW1lKGZpbGVuYW1lRnJvbVVybCk7XG4gICAgICAgIHRoaXMuZXh0ZW5zaW9uID0gdGhpcy5nZXRGaWxlRXh0ZW5zaW9uKGZpbGVuYW1lRnJvbVVybCk7XG4gICAgICAgIHRoaXMudXJsRmlsZUNvbnRlbnQgPSB0aGlzLnVybEZpbGU7XG4gICAgICAgIHRoaXMuZmlsZU5hbWUgPSB0aGlzLmRpc3BsYXlOYW1lO1xuICAgICAgICB0aGlzLnZpZXdlclR5cGUgPSB0aGlzLnVybEZpbGVWaWV3ZXIgfHwgdGhpcy5nZXRWaWV3ZXJUeXBlKHRoaXMuZXh0ZW5zaW9uLCB0aGlzLm1pbWVUeXBlKTtcblxuICAgICAgICB0aGlzLmV4dGVuc2lvbkNoYW5nZS5lbWl0KHRoaXMuZXh0ZW5zaW9uKTtcbiAgICAgICAgdGhpcy5zY3JvbGxUb3AoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIHNldFVwTm9kZUZpbGUobm9kZURhdGE6IE5vZGUsIHZlcnNpb25EYXRhPzogVmVyc2lvbik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICB0aGlzLnJlYWRPbmx5ID0gIXRoaXMuY29udGVudFNlcnZpY2UuaGFzQWxsb3dhYmxlT3BlcmF0aW9ucyhub2RlRGF0YSwgJ3VwZGF0ZScpO1xuXG4gICAgICAgIGlmICh2ZXJzaW9uRGF0YSAmJiB2ZXJzaW9uRGF0YS5jb250ZW50KSB7XG4gICAgICAgICAgICB0aGlzLm1pbWVUeXBlID0gdmVyc2lvbkRhdGEuY29udGVudC5taW1lVHlwZTtcbiAgICAgICAgfSBlbHNlIGlmIChub2RlRGF0YS5jb250ZW50KSB7XG4gICAgICAgICAgICB0aGlzLm1pbWVUeXBlID0gbm9kZURhdGEuY29udGVudC5taW1lVHlwZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZmlsZVRpdGxlID0gdGhpcy5nZXREaXNwbGF5TmFtZSh2ZXJzaW9uRGF0YSA/IHZlcnNpb25EYXRhLm5hbWUgOiBub2RlRGF0YS5uYW1lKTtcblxuICAgICAgICBjb25zdCBjdXJyZW50RmlsZVZlcnNpb24gPSB0aGlzLm5vZGVFbnRyeT8uZW50cnk/LnByb3BlcnRpZXMgJiYgdGhpcy5ub2RlRW50cnkuZW50cnkucHJvcGVydGllc1snY206dmVyc2lvbkxhYmVsJ10gP1xuICAgICAgICAgICAgZW5jb2RlVVJJKHRoaXMubm9kZUVudHJ5Py5lbnRyeT8ucHJvcGVydGllc1snY206dmVyc2lvbkxhYmVsJ10pIDogZW5jb2RlVVJJKCcxLjAnKTtcblxuICAgICAgICB0aGlzLnVybEZpbGVDb250ZW50ID0gdmVyc2lvbkRhdGEgPyB0aGlzLmNvbnRlbnRBcGkuZ2V0VmVyc2lvbkNvbnRlbnRVcmwodGhpcy5ub2RlSWQsIHZlcnNpb25EYXRhLmlkKSA6XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRBcGkuZ2V0Q29udGVudFVybCh0aGlzLm5vZGVJZCk7XG4gICAgICAgIHRoaXMudXJsRmlsZUNvbnRlbnQgPSB0aGlzLmNhY2hlQnVzdGVyTnVtYmVyID8gdGhpcy51cmxGaWxlQ29udGVudCArICcmJyArIGN1cnJlbnRGaWxlVmVyc2lvbiArICcmJyArIHRoaXMuY2FjaGVCdXN0ZXJOdW1iZXIgOlxuICAgICAgICAgICAgdGhpcy51cmxGaWxlQ29udGVudCArICcmJyArIGN1cnJlbnRGaWxlVmVyc2lvbjtcblxuICAgICAgICB0aGlzLmV4dGVuc2lvbiA9IHRoaXMuZ2V0RmlsZUV4dGVuc2lvbih2ZXJzaW9uRGF0YSA/IHZlcnNpb25EYXRhLm5hbWUgOiBub2RlRGF0YS5uYW1lKTtcbiAgICAgICAgdGhpcy5maWxlTmFtZSA9IHZlcnNpb25EYXRhID8gdmVyc2lvbkRhdGEubmFtZSA6IG5vZGVEYXRhLm5hbWU7XG4gICAgICAgIHRoaXMudmlld2VyVHlwZSA9IHRoaXMuZ2V0Vmlld2VyVHlwZSh0aGlzLmV4dGVuc2lvbiwgdGhpcy5taW1lVHlwZSk7XG5cbiAgICAgICAgaWYgKHRoaXMudmlld2VyVHlwZSA9PT0gJ3Vua25vd24nKSB7XG4gICAgICAgICAgICBpZiAodmVyc2lvbkRhdGEpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnZpZXdVdGlsU2VydmljZS5kaXNwbGF5Tm9kZVJlbmRpdGlvbihub2RlRGF0YS5pZCwgdmVyc2lvbkRhdGEuaWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnZpZXdVdGlsU2VydmljZS5kaXNwbGF5Tm9kZVJlbmRpdGlvbihub2RlRGF0YS5pZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmV4dGVuc2lvbkNoYW5nZS5lbWl0KHRoaXMuZXh0ZW5zaW9uKTtcbiAgICAgICAgdGhpcy5zaWRlYmFyUmlnaHRUZW1wbGF0ZUNvbnRleHQubm9kZSA9IG5vZGVEYXRhO1xuICAgICAgICB0aGlzLnNpZGViYXJMZWZ0VGVtcGxhdGVDb250ZXh0Lm5vZGUgPSBub2RlRGF0YTtcbiAgICAgICAgdGhpcy5zY3JvbGxUb3AoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFZpZXdlclR5cGUoZXh0ZW5zaW9uOiBzdHJpbmcsIG1pbWVUeXBlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBsZXQgdmlld2VyVHlwZSA9IHRoaXMuZ2V0Vmlld2VyVHlwZUJ5RXh0ZW5zaW9uKGV4dGVuc2lvbik7XG5cbiAgICAgICAgaWYgKHZpZXdlclR5cGUgPT09ICd1bmtub3duJykge1xuICAgICAgICAgICAgdmlld2VyVHlwZSA9IHRoaXMuZ2V0Vmlld2VyVHlwZUJ5TWltZVR5cGUobWltZVR5cGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZpZXdlclR5cGU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRVcFNoYXJlZExpbmtGaWxlKGRldGFpbHM6IGFueSkge1xuICAgICAgICB0aGlzLm1pbWVUeXBlID0gZGV0YWlscy5lbnRyeS5jb250ZW50Lm1pbWVUeXBlO1xuICAgICAgICB0aGlzLmZpbGVUaXRsZSA9IHRoaXMuZ2V0RGlzcGxheU5hbWUoZGV0YWlscy5lbnRyeS5uYW1lKTtcbiAgICAgICAgdGhpcy5leHRlbnNpb24gPSB0aGlzLmdldEZpbGVFeHRlbnNpb24oZGV0YWlscy5lbnRyeS5uYW1lKTtcbiAgICAgICAgdGhpcy5maWxlTmFtZSA9IGRldGFpbHMuZW50cnkubmFtZTtcbiAgICAgICAgdGhpcy51cmxGaWxlQ29udGVudCA9IHRoaXMuY29udGVudEFwaS5nZXRTaGFyZWRMaW5rQ29udGVudFVybCh0aGlzLnNoYXJlZExpbmtJZCwgZmFsc2UpO1xuICAgICAgICB0aGlzLnZpZXdlclR5cGUgPSB0aGlzLmdldFZpZXdlclR5cGUodGhpcy5leHRlbnNpb24sIHRoaXMubWltZVR5cGUpO1xuXG4gICAgICAgIGlmICh0aGlzLnZpZXdlclR5cGUgPT09ICd1bmtub3duJykge1xuICAgICAgICAgICAgdGhpcy5kaXNwbGF5U2hhcmVkTGlua1JlbmRpdGlvbih0aGlzLnNoYXJlZExpbmtJZCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmV4dGVuc2lvbkNoYW5nZS5lbWl0KHRoaXMuZXh0ZW5zaW9uKTtcbiAgICB9XG5cbiAgICB0b2dnbGVTaWRlYmFyKCkge1xuICAgICAgICB0aGlzLnNob3dSaWdodFNpZGViYXIgPSAhdGhpcy5zaG93UmlnaHRTaWRlYmFyO1xuICAgICAgICBpZiAodGhpcy5zaG93UmlnaHRTaWRlYmFyICYmIHRoaXMubm9kZUlkKSB7XG4gICAgICAgICAgICB0aGlzLm5vZGVzQXBpLmdldE5vZGUodGhpcy5ub2RlSWQsIHsgaW5jbHVkZTogWydhbGxvd2FibGVPcGVyYXRpb25zJ10gfSlcbiAgICAgICAgICAgICAgICAudGhlbigobm9kZUVudHJ5OiBOb2RlRW50cnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaWRlYmFyUmlnaHRUZW1wbGF0ZUNvbnRleHQubm9kZSA9IG5vZGVFbnRyeS5lbnRyeTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHRvZ2dsZUxlZnRTaWRlYmFyKCkge1xuICAgICAgICB0aGlzLnNob3dMZWZ0U2lkZWJhciA9ICF0aGlzLnNob3dMZWZ0U2lkZWJhcjtcbiAgICAgICAgaWYgKHRoaXMuc2hvd1JpZ2h0U2lkZWJhciAmJiB0aGlzLm5vZGVJZCkge1xuICAgICAgICAgICAgdGhpcy5ub2Rlc0FwaS5nZXROb2RlKHRoaXMubm9kZUlkLCB7IGluY2x1ZGU6IFsnYWxsb3dhYmxlT3BlcmF0aW9ucyddIH0pXG4gICAgICAgICAgICAgICAgLnRoZW4oKG5vZGVFbnRyeTogTm9kZUVudHJ5KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2lkZWJhckxlZnRUZW1wbGF0ZUNvbnRleHQubm9kZSA9IG5vZGVFbnRyeS5lbnRyeTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0RGlzcGxheU5hbWUobmFtZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5kaXNwbGF5TmFtZSB8fCBuYW1lO1xuICAgIH1cblxuICAgIHNjcm9sbFRvcCgpIHtcbiAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDEpO1xuICAgIH1cblxuICAgIGdldFZpZXdlclR5cGVCeU1pbWVUeXBlKG1pbWVUeXBlOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKG1pbWVUeXBlKSB7XG4gICAgICAgICAgICBtaW1lVHlwZSA9IG1pbWVUeXBlLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgICAgIGNvbnN0IGVkaXRvclR5cGVzID0gT2JqZWN0LmtleXModGhpcy5taW1lVHlwZXMpO1xuICAgICAgICAgICAgZm9yIChjb25zdCB0eXBlIG9mIGVkaXRvclR5cGVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubWltZVR5cGVzW3R5cGVdLmluZGV4T2YobWltZVR5cGUpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR5cGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAndW5rbm93bic7XG4gICAgfVxuXG4gICAgZ2V0Vmlld2VyVHlwZUJ5RXh0ZW5zaW9uKGV4dGVuc2lvbjogc3RyaW5nKSB7XG4gICAgICAgIGlmIChleHRlbnNpb24pIHtcbiAgICAgICAgICAgIGV4dGVuc2lvbiA9IGV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNFeHRlcm5hbFZpZXdlcigpKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2V4dGVybmFsJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzQ3VzdG9tVmlld2VyRXh0ZW5zaW9uKGV4dGVuc2lvbikpIHtcbiAgICAgICAgICAgIHJldHVybiAnY3VzdG9tJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmV4dGVuc2lvbnMuaW1hZ2UuaW5kZXhPZihleHRlbnNpb24pID49IDApIHtcbiAgICAgICAgICAgIHJldHVybiAnaW1hZ2UnO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZXh0ZW5zaW9ucy5tZWRpYS5pbmRleE9mKGV4dGVuc2lvbikgPj0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICdtZWRpYSc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5leHRlbnNpb25zLnRleHQuaW5kZXhPZihleHRlbnNpb24pID49IDApIHtcbiAgICAgICAgICAgIHJldHVybiAndGV4dCc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5leHRlbnNpb25zLnBkZi5pbmRleE9mKGV4dGVuc2lvbikgPj0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICdwZGYnO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICd1bmtub3duJztcbiAgICB9XG5cbiAgICBvbkJhY2tCdXR0b25DbGljaygpIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cblxuICAgIG9uTmF2aWdhdGVCZWZvcmVDbGljayhldmVudDogTW91c2VFdmVudCB8IEtleWJvYXJkRXZlbnQpIHtcbiAgICAgICAgdGhpcy5uYXZpZ2F0ZUJlZm9yZS5uZXh0KGV2ZW50KTtcbiAgICB9XG5cbiAgICBvbk5hdmlnYXRlTmV4dENsaWNrKGV2ZW50OiBNb3VzZUV2ZW50IHwgS2V5Ym9hcmRFdmVudCkge1xuICAgICAgICB0aGlzLm5hdmlnYXRlTmV4dC5uZXh0KGV2ZW50KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBjbG9zZSB0aGUgdmlld2VyXG4gICAgICovXG4gICAgY2xvc2UoKSB7XG4gICAgICAgIGlmICh0aGlzLm90aGVyTWVudSkge1xuICAgICAgICAgICAgdGhpcy5vdGhlck1lbnUuaGlkZGVuID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zaG93Vmlld2VyID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2hvd1ZpZXdlckNoYW5nZS5lbWl0KHRoaXMuc2hvd1ZpZXdlcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogZ2V0IEZpbGUgbmFtZSBmcm9tIHVybFxuICAgICAqXG4gICAgICogQHBhcmFtICB1cmwgLSB1cmwgZmlsZVxuICAgICAqL1xuICAgIGdldEZpbGVuYW1lRnJvbVVybCh1cmw6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IGFuY2hvciA9IHVybC5pbmRleE9mKCcjJyk7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gdXJsLmluZGV4T2YoJz8nKTtcbiAgICAgICAgY29uc3QgZW5kID0gTWF0aC5taW4oXG4gICAgICAgICAgICBhbmNob3IgPiAwID8gYW5jaG9yIDogdXJsLmxlbmd0aCxcbiAgICAgICAgICAgIHF1ZXJ5ID4gMCA/IHF1ZXJ5IDogdXJsLmxlbmd0aCk7XG4gICAgICAgIHJldHVybiB1cmwuc3Vic3RyaW5nKHVybC5sYXN0SW5kZXhPZignLycsIGVuZCkgKyAxLCBlbmQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBmaWxlIGV4dGVuc2lvbiBmcm9tIHRoZSBzdHJpbmcuXG4gICAgICogU3VwcG9ydHMgdGhlIFVSTCBmb3JtYXRzIGxpa2U6XG4gICAgICogaHR0cDovL2xvY2FsaG9zdC90ZXN0LmpwZz9jYWNoZT0xMDAwXG4gICAgICogaHR0cDovL2xvY2FsaG9zdC90ZXN0LmpwZyNjYWNoZT0xMDAwXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZmlsZU5hbWUgLSBmaWxlIG5hbWVcbiAgICAgKi9cbiAgICBnZXRGaWxlRXh0ZW5zaW9uKGZpbGVOYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBpZiAoZmlsZU5hbWUpIHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gZmlsZU5hbWUubWF0Y2goL1xcLihbXlxcLi9cXD9cXCNdKykoJHxcXD98XFwjKS8pO1xuICAgICAgICAgICAgcmV0dXJuIG1hdGNoID8gbWF0Y2hbMV0gOiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNFeHRlcm5hbFZpZXdlcigpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy52aWV3ZXJFeHRlbnNpb25zLmZpbmQoZXh0ID0+IGV4dC5maWxlRXh0ZW5zaW9uID09PSAnKicpO1xuICAgIH1cblxuICAgIGlzQ3VzdG9tVmlld2VyRXh0ZW5zaW9uKGV4dGVuc2lvbjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGV4dGVuc2lvbnMgPSB0aGlzLmV4dGVybmFsRXh0ZW5zaW9ucyB8fCBbXTtcblxuICAgICAgICBpZiAoZXh0ZW5zaW9uICYmIGV4dGVuc2lvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZXh0ZW5zaW9uID0gZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICByZXR1cm4gZXh0ZW5zaW9ucy5mbGF0KCkuaW5kZXhPZihleHRlbnNpb24pID49IDA7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogS2V5Ym9hcmQgZXZlbnQgbGlzdGVuZXJcbiAgICAgKiBAcGFyYW0gIGV2ZW50XG4gICAgICovXG4gICAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6a2V5dXAnLCBbJyRldmVudCddKVxuICAgIGhhbmRsZUtleWJvYXJkRXZlbnQoZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGtleSA9IGV2ZW50LmtleUNvZGU7XG5cbiAgICAgICAgLy8gTGVmdCBhcnJvd1xuICAgICAgICBpZiAoa2V5ID09PSAzNyAmJiB0aGlzLmNhbk5hdmlnYXRlQmVmb3JlKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5vbk5hdmlnYXRlQmVmb3JlQ2xpY2soZXZlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmlnaHQgYXJyb3dcbiAgICAgICAgaWYgKGtleSA9PT0gMzkgJiYgdGhpcy5jYW5OYXZpZ2F0ZU5leHQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGlzLm9uTmF2aWdhdGVOZXh0Q2xpY2soZXZlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ3RybCtGXG4gICAgICAgIGlmIChrZXkgPT09IDcwICYmIGV2ZW50LmN0cmxLZXkpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGlzLmVudGVyRnVsbFNjcmVlbigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpbnRDb250ZW50KCkge1xuICAgICAgICBpZiAodGhpcy5hbGxvd1ByaW50KSB7XG4gICAgICAgICAgICBjb25zdCBhcmdzID0gbmV3IEJhc2VFdmVudCgpO1xuICAgICAgICAgICAgdGhpcy5wcmludC5uZXh0KGFyZ3MpO1xuXG4gICAgICAgICAgICBpZiAoIWFyZ3MuZGVmYXVsdFByZXZlbnRlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMudmlld1V0aWxTZXJ2aWNlLnByaW50RmlsZUdlbmVyaWModGhpcy5ub2RlSWQsIHRoaXMubWltZVR5cGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcnMgZnVsbCBzY3JlZW4gbW9kZSB3aXRoIGEgbWFpbiBjb250ZW50IGFyZWEgZGlzcGxheWVkLlxuICAgICAqL1xuICAgIGVudGVyRnVsbFNjcmVlbigpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuYWxsb3dGdWxsU2NyZWVuKSB7XG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmFkZi12aWV3ZXJfX2Z1bGxzY3JlZW4tY29udGFpbmVyJyk7XG4gICAgICAgICAgICBpZiAoY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5lci5yZXF1ZXN0RnVsbHNjcmVlbikge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIucmVxdWVzdEZ1bGxzY3JlZW4oKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRhaW5lci53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbikge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4oKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRhaW5lci5tb3pSZXF1ZXN0RnVsbFNjcmVlbikge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIubW96UmVxdWVzdEZ1bGxTY3JlZW4oKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRhaW5lci5tc1JlcXVlc3RGdWxsc2NyZWVuKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5tc1JlcXVlc3RGdWxsc2NyZWVuKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBkaXNwbGF5U2hhcmVkTGlua1JlbmRpdGlvbihzaGFyZWRJZDogc3RyaW5nKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZW5kaXRpb246IFJlbmRpdGlvbkVudHJ5ID0gYXdhaXQgdGhpcy5zaGFyZWRMaW5rc0FwaS5nZXRTaGFyZWRMaW5rUmVuZGl0aW9uKHNoYXJlZElkLCAncGRmJyk7XG4gICAgICAgICAgICBpZiAocmVuZGl0aW9uLmVudHJ5LnN0YXR1cy50b1N0cmluZygpID09PSAnQ1JFQVRFRCcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXdlclR5cGUgPSAncGRmJztcbiAgICAgICAgICAgICAgICB0aGlzLnVybEZpbGVDb250ZW50ID0gdGhpcy5jb250ZW50QXBpLmdldFNoYXJlZExpbmtSZW5kaXRpb25Vcmwoc2hhcmVkSWQsICdwZGYnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRpdGlvbjogUmVuZGl0aW9uRW50cnkgPSBhd2FpdCB0aGlzLnNoYXJlZExpbmtzQXBpLmdldFNoYXJlZExpbmtSZW5kaXRpb24oc2hhcmVkSWQsICdpbWdwcmV2aWV3Jyk7XG4gICAgICAgICAgICAgICAgaWYgKHJlbmRpdGlvbi5lbnRyeS5zdGF0dXMudG9TdHJpbmcoKSA9PT0gJ0NSRUFURUQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmlld2VyVHlwZSA9ICdpbWFnZSc7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXJsRmlsZUNvbnRlbnQgPSB0aGlzLmNvbnRlbnRBcGkuZ2V0U2hhcmVkTGlua1JlbmRpdGlvblVybChzaGFyZWRJZCwgJ2ltZ3ByZXZpZXcnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nU2VydmljZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjaGVja0V4dGVuc2lvbnMoZXh0ZW5zaW9uQWxsb3dlZCkge1xuICAgICAgICBpZiAodHlwZW9mIGV4dGVuc2lvbkFsbG93ZWQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5leHRlbnNpb24udG9Mb3dlckNhc2UoKSA9PT0gZXh0ZW5zaW9uQWxsb3dlZC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9IGVsc2UgaWYgKGV4dGVuc2lvbkFsbG93ZWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGV4dGVuc2lvbkFsbG93ZWQuZmluZCgoY3VycmVudEV4dGVuc2lvbikgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpID09PSBjdXJyZW50RXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgb25TdWJtaXRGaWxlKG5ld0ltYWdlQmxvYjogQmxvYikge1xuICAgICAgICBpZiAodGhpcz8ubm9kZUVudHJ5Py5lbnRyeT8uaWQgJiYgIXRoaXMucmVhZE9ubHkpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0ltYWdlRmlsZTogRmlsZSA9IG5ldyBGaWxlKFtuZXdJbWFnZUJsb2JdLCB0aGlzPy5ub2RlRW50cnk/LmVudHJ5Py5uYW1lLCB7IHR5cGU6IHRoaXM/Lm5vZGVFbnRyeT8uZW50cnk/LmNvbnRlbnQ/Lm1pbWVUeXBlIH0pO1xuICAgICAgICAgICAgY29uc3QgbmV3RmlsZSA9IG5ldyBGaWxlTW9kZWwoXG4gICAgICAgICAgICAgICAgbmV3SW1hZ2VGaWxlLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbWFqb3JWZXJzaW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgbmV3VmVyc2lvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50SWQ6IHRoaXM/Lm5vZGVFbnRyeT8uZW50cnk/LnBhcmVudElkLFxuICAgICAgICAgICAgICAgICAgICBub2RlVHlwZTogdGhpcz8ubm9kZUVudHJ5Py5lbnRyeT8uY29udGVudD8ubWltZVR5cGVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRoaXM/Lm5vZGVFbnRyeT8uZW50cnk/LmlkXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLmFkZFRvUXVldWUoLi4uW25ld0ZpbGVdKTtcbiAgICAgICAgICAgIHRoaXMudXBsb2FkU2VydmljZS51cGxvYWRGaWxlc0luVGhlUXVldWUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uVW5zdXBwb3J0ZWRGaWxlKCkge1xuICAgICAgICB0aGlzLnZpZXdlclR5cGUgPSAndW5rbm93bic7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjbG9zZU92ZXJsYXlNYW5hZ2VyKCkge1xuICAgICAgICB0aGlzLmRpYWxvZy5hZnRlck9wZW5lZC5waXBlKFxuICAgICAgICAgICAgc2tpcFdoaWxlKCgpID0+ICF0aGlzLm92ZXJsYXlNb2RlKSxcbiAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpXG4gICAgICAgICkuc3Vic2NyaWJlKCgpID0+IHRoaXMuc2hvdWxkQ2xvc2VWaWV3ZXIgPSBmYWxzZSk7XG5cbiAgICAgICAgdGhpcy5kaWFsb2cuYWZ0ZXJBbGxDbG9zZWQucGlwZShcbiAgICAgICAgICAgIHNraXBXaGlsZSgoKSA9PiAhdGhpcy5vdmVybGF5TW9kZSksXG4gICAgICAgICAgICB0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKVxuICAgICAgICApLnN1YnNjcmliZSgoKSA9PiB0aGlzLnNob3VsZENsb3NlVmlld2VyID0gdHJ1ZSk7XG5cbiAgICAgICAgdGhpcy5rZXlEb3duJC5waXBlKFxuICAgICAgICAgICAgc2tpcFdoaWxlKCgpID0+ICF0aGlzLm92ZXJsYXlNb2RlKSxcbiAgICAgICAgICAgIGZpbHRlcigoZTogS2V5Ym9hcmRFdmVudCkgPT4gZS5rZXlDb2RlID09PSAyNyksXG4gICAgICAgICAgICB0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKVxuICAgICAgICApLnN1YnNjcmliZSgoZXZlbnQ6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnNob3VsZENsb3NlVmlld2VyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdlbmVyYXRlQ2FjaGVCdXN0ZXJOdW1iZXIoKSB7XG4gICAgICAgIHRoaXMuY2FjaGVCdXN0ZXJOdW1iZXIgPSBEYXRlLm5vdygpO1xuICAgIH1cbn1cbiJdfQ==