/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { FormOutcomeModel } from './widgets';
import { EventEmitter, Input, Output, Directive } from '@angular/core';
import * as ɵngcc0 from '@angular/core';
export class FormBaseComponent {
    constructor() {
        this.showTitle = true;
        this.showCompleteButton = true;
        this.disableCompleteButton = false;
        this.disableSaveButton = false;
        this.disableStartProcessButton = false;
        this.showSaveButton = true;
        this.readOnly = false;
        this.showRefreshButton = true;
        this.showValidationIcon = true;
        this.formError = new EventEmitter();
        this.executeOutcome = new EventEmitter();
        this.error = new EventEmitter();
    }
    getParsedFormDefinition() {
        return this;
    }
    hasForm() {
        return !!this.form;
    }
    isTitleEnabled() {
        let titleEnabled = false;
        if (this.showTitle && this.form) {
            titleEnabled = true;
        }
        return titleEnabled;
    }
    getColorForOutcome(outcomeName) {
        return outcomeName === FormBaseComponent.COMPLETE_OUTCOME_NAME ? FormBaseComponent.COMPLETE_BUTTON_COLOR : null;
    }
    isOutcomeButtonEnabled(outcome) {
        if (this.form.readOnly) {
            return false;
        }
        if (outcome) {
            if (outcome.name === FormOutcomeModel.SAVE_ACTION) {
                return !this.disableSaveButton;
            }
            if (outcome.name === FormOutcomeModel.COMPLETE_ACTION) {
                return this.disableCompleteButton ? false : this.form.isValid;
            }
            if (outcome.name === FormOutcomeModel.START_PROCESS_ACTION) {
                return this.disableStartProcessButton ? false : this.form.isValid;
            }
            return this.form.isValid;
        }
        return false;
    }
    isOutcomeButtonVisible(outcome, isFormReadOnly) {
        if (outcome && outcome.name) {
            if (outcome.name === FormOutcomeModel.COMPLETE_ACTION) {
                return this.showCompleteButton;
            }
            if (isFormReadOnly) {
                return outcome.isSelected;
            }
            if (outcome.name === FormOutcomeModel.SAVE_ACTION) {
                return this.showSaveButton;
            }
            if (outcome.name === FormOutcomeModel.START_PROCESS_ACTION) {
                return false;
            }
            return true;
        }
        return false;
    }
    onOutcomeClicked(outcome) {
        if (!this.readOnly && outcome && this.form) {
            if (!this.onExecuteOutcome(outcome)) {
                return false;
            }
            if (outcome.isSystem) {
                if (outcome.id === FormBaseComponent.SAVE_OUTCOME_ID) {
                    this.saveTaskForm();
                    return true;
                }
                if (outcome.id === FormBaseComponent.COMPLETE_OUTCOME_ID) {
                    this.completeTaskForm();
                    return true;
                }
                if (outcome.id === FormBaseComponent.START_PROCESS_OUTCOME_ID) {
                    this.completeTaskForm();
                    return true;
                }
                if (outcome.id === FormBaseComponent.CUSTOM_OUTCOME_ID) {
                    this.onTaskSaved(this.form);
                    this.storeFormAsMetadata();
                    return true;
                }
            }
            else {
                if (outcome.name) {
                    this.onTaskSaved(this.form);
                    this.completeTaskForm(outcome.name);
                    return true;
                }
            }
        }
        return false;
    }
    handleError(err) {
        this.error.emit(err);
    }
}
FormBaseComponent.ɵfac = function FormBaseComponent_Factory(t) { return new (t || FormBaseComponent)(); };
FormBaseComponent.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: FormBaseComponent, inputs: { showTitle: "showTitle", showCompleteButton: "showCompleteButton", disableCompleteButton: "disableCompleteButton", disableSaveButton: "disableSaveButton", disableStartProcessButton: "disableStartProcessButton", showSaveButton: "showSaveButton", readOnly: "readOnly", showRefreshButton: "showRefreshButton", showValidationIcon: "showValidationIcon", path: "path", nameNode: "nameNode", fieldValidators: "fieldValidators" }, outputs: { formError: "formError", executeOutcome: "executeOutcome", error: "error" } });
FormBaseComponent.SAVE_OUTCOME_ID = '$save';
FormBaseComponent.COMPLETE_OUTCOME_ID = '$complete';
FormBaseComponent.START_PROCESS_OUTCOME_ID = '$startProcess';
FormBaseComponent.CUSTOM_OUTCOME_ID = '$custom';
FormBaseComponent.COMPLETE_BUTTON_COLOR = 'primary';
FormBaseComponent.COMPLETE_OUTCOME_NAME = 'COMPLETE';
FormBaseComponent.propDecorators = {
    path: [{ type: Input }],
    nameNode: [{ type: Input }],
    showTitle: [{ type: Input }],
    showCompleteButton: [{ type: Input }],
    disableCompleteButton: [{ type: Input }],
    disableSaveButton: [{ type: Input }],
    disableStartProcessButton: [{ type: Input }],
    showSaveButton: [{ type: Input }],
    readOnly: [{ type: Input }],
    showRefreshButton: [{ type: Input }],
    showValidationIcon: [{ type: Input }],
    fieldValidators: [{ type: Input }],
    formError: [{ type: Output }],
    executeOutcome: [{ type: Output }],
    error: [{ type: Output }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(FormBaseComponent, [{
        type: Directive
    }], function () { return []; }, { showTitle: [{
            type: Input
        }], showCompleteButton: [{
            type: Input
        }], disableCompleteButton: [{
            type: Input
        }], disableSaveButton: [{
            type: Input
        }], disableStartProcessButton: [{
            type: Input
        }], showSaveButton: [{
            type: Input
        }], readOnly: [{
            type: Input
        }], showRefreshButton: [{
            type: Input
        }], showValidationIcon: [{
            type: Input
        }], formError: [{
            type: Output
        }], executeOutcome: [{
            type: Output
        }], error: [{
            type: Output
        }], path: [{
            type: Input
        }], nameNode: [{
            type: Input
        }], fieldValidators: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1iYXNlLmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL2NvcmUvZm9ybS9jb21wb25lbnRzL2Zvcm0tYmFzZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUVILE9BQU8sRUFBRSxnQkFBZ0IsRUFBbUUsTUFBTSxXQUFXLENBQUM7QUFDOUcsT0FBTyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7QUFLdkUsTUFBTSxPQUFnQixpQkFBaUI7QUFDdkMsSUFIQTtBQUNHLFFBb0JDLGNBQVMsR0FBWSxJQUFJLENBQUM7QUFDOUIsUUFHSSx1QkFBa0IsR0FBWSxJQUFJLENBQUM7QUFDdkMsUUFHSSwwQkFBcUIsR0FBWSxLQUFLLENBQUM7QUFDM0MsUUFHSSxzQkFBaUIsR0FBWSxLQUFLLENBQUM7QUFDdkMsUUFHSSw4QkFBeUIsR0FBWSxLQUFLLENBQUM7QUFDL0MsUUFHSSxtQkFBYyxHQUFZLElBQUksQ0FBQztBQUNuQyxRQUdJLGFBQVEsR0FBWSxLQUFLLENBQUM7QUFDOUIsUUFHSSxzQkFBaUIsR0FBWSxJQUFJLENBQUM7QUFDdEMsUUFHSSx1QkFBa0IsR0FBWSxJQUFJLENBQUM7QUFDdkMsUUFPSSxjQUFTLEdBQW1DLElBQUksWUFBWSxFQUFvQixDQUFDO0FBQ3JGLFFBS0ksbUJBQWMsR0FBbUMsSUFBSSxZQUFZLEVBQW9CLENBQUM7QUFDMUYsUUFLSSxVQUFLLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7QUFDdkQsSUFzSEEsQ0FBQztBQUNELElBcEhJ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QixDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUN4RCxvQkFBb0IsT0FBTyxJQUFJLENBQUM7QUFDaEMsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYixTQUFTO0FBQ1QsUUFDUSxPQUFPLEtBQUssQ0FBQztBQUNyQixJQUFJLENBQUM7QUFDTCxJQUNJLFdBQVcsQ0FBQyxHQUFRO0FBQUksUUFDcEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDN0IsSUFBSSxDQUFDO0FBQ0w7O3NsQkFDQTtBQXJMVyxpQ0FBZSxHQUFXLE9BQU8sQ0FBQztBQUNsQyxxQ0FBbUIsR0FBVyxXQUFXLENBQUM7QUFDMUMsMENBQXdCLEdBQVcsZUFBZSxDQUFDO0FBQ25ELG1DQUFpQixHQUFXLFNBQVMsQ0FBQztBQUN0Qyx1Q0FBcUIsR0FBaUIsU0FBUyxDQUFDO0FBQ2hELHVDQUFxQixHQUFXLFVBQVUsQ0FBQyxBQVJwRDtBQUFDO1FBREYsU0FBUyxqQkFDOEIsbUJBV25DLEtBQUs7QUFDUix1QkFHRyxLQUFLO0FBQ1Isd0JBR0csS0FBSztBQUNSLGlDQUdHLEtBQUs7QUFDUixvQ0FHRyxLQUFLO0FBQ1IsZ0NBR0csS0FBSztBQUNSLHdDQUdHLEtBQUs7QUFDUiw2QkFHRyxLQUFLO0FBQ1IsdUJBR0csS0FBSztBQUNSLGdDQUdHLEtBQUs7QUFDUixpQ0FHRyxLQUFLO0FBQ1IsOEJBR0csS0FBSztBQUNSLHdCQUdHLE1BQU07QUFDVCw2QkFLRyxNQUFNO0FBQ1Qsb0JBS0csTUFBTTtBQUNWOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEZvcm1PdXRjb21lTW9kZWwsIEZvcm1GaWVsZFZhbGlkYXRvciwgRm9ybUZpZWxkTW9kZWwsIEZvcm1PdXRjb21lRXZlbnQsIEZvcm1Nb2RlbCB9IGZyb20gJy4vd2lkZ2V0cyc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIERpcmVjdGl2ZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVGhlbWVQYWxldHRlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvY29yZSc7XG5cbkBEaXJlY3RpdmUoKVxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBkaXJlY3RpdmUtY2xhc3Mtc3VmZml4XG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRm9ybUJhc2VDb21wb25lbnQge1xuXG4gICAgc3RhdGljIFNBVkVfT1VUQ09NRV9JRDogc3RyaW5nID0gJyRzYXZlJztcbiAgICBzdGF0aWMgQ09NUExFVEVfT1VUQ09NRV9JRDogc3RyaW5nID0gJyRjb21wbGV0ZSc7XG4gICAgc3RhdGljIFNUQVJUX1BST0NFU1NfT1VUQ09NRV9JRDogc3RyaW5nID0gJyRzdGFydFByb2Nlc3MnO1xuICAgIHN0YXRpYyBDVVNUT01fT1VUQ09NRV9JRDogc3RyaW5nID0gJyRjdXN0b20nO1xuICAgIHN0YXRpYyBDT01QTEVURV9CVVRUT05fQ09MT1I6IFRoZW1lUGFsZXR0ZSA9ICdwcmltYXJ5JztcbiAgICBzdGF0aWMgQ09NUExFVEVfT1VUQ09NRV9OQU1FOiBzdHJpbmcgPSAnQ09NUExFVEUnO1xuXG4gICAgLyoqIFBhdGggb2YgdGhlIGZvbGRlciB3aGVyZSB0aGUgbWV0YWRhdGEgd2lsbCBiZSBzdG9yZWQuICovXG4gICAgQElucHV0KClcbiAgICBwYXRoOiBzdHJpbmc7XG5cbiAgICAvKiogTmFtZSB0byBhc3NpZ24gdG8gdGhlIG5ldyBub2RlIHdoZXJlIHRoZSBtZXRhZGF0YSBhcmUgc3RvcmVkLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgbmFtZU5vZGU6IHN0cmluZztcblxuICAgIC8qKiBUb2dnbGUgcmVuZGVyaW5nIG9mIHRoZSBmb3JtIHRpdGxlLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd1RpdGxlOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBUb2dnbGUgcmVuZGVyaW5nIG9mIHRoZSBgQ29tcGxldGVgIG91dGNvbWUgYnV0dG9uLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd0NvbXBsZXRlQnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBJZiB0cnVlIHRoZW4gdGhlIGBDb21wbGV0ZWAgb3V0Y29tZSBidXR0b24gaXMgc2hvd24gYnV0IGl0IHdpbGwgYmUgZGlzYWJsZWQuICovXG4gICAgQElucHV0KClcbiAgICBkaXNhYmxlQ29tcGxldGVCdXR0b246IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIC8qKiBJZiB0cnVlIHRoZW4gdGhlIGBTYXZlYCBvdXRjb21lIGJ1dHRvbiBpcyBzaG93biBidXQgd2lsbCBiZSBkaXNhYmxlZC4gKi9cbiAgICBASW5wdXQoKVxuICAgIGRpc2FibGVTYXZlQnV0dG9uOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKiogSWYgdHJ1ZSB0aGVuIHRoZSBgU3RhcnQgUHJvY2Vzc2Agb3V0Y29tZSBidXR0b24gaXMgc2hvd24gYnV0IGl0IHdpbGwgYmUgZGlzYWJsZWQuICovXG4gICAgQElucHV0KClcbiAgICBkaXNhYmxlU3RhcnRQcm9jZXNzQnV0dG9uOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKiogVG9nZ2xlIHJlbmRlcmluZyBvZiB0aGUgYFNhdmVgIG91dGNvbWUgYnV0dG9uLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd1NhdmVCdXR0b246IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIFRvZ2dsZSByZWFkb25seSBzdGF0ZSBvZiB0aGUgZm9ybS4gRm9yY2VzIGFsbCBmb3JtIHdpZGdldHMgdG8gcmVuZGVyIGFzIHJlYWRvbmx5IGlmIGVuYWJsZWQuICovXG4gICAgQElucHV0KClcbiAgICByZWFkT25seTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqIFRvZ2dsZSByZW5kZXJpbmcgb2YgdGhlIGBSZWZyZXNoYCBidXR0b24uICovXG4gICAgQElucHV0KClcbiAgICBzaG93UmVmcmVzaEJ1dHRvbjogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvKiogVG9nZ2xlIHJlbmRlcmluZyBvZiB0aGUgdmFsaWRhdGlvbiBpY29uIG5leHQgdG8gdGhlIGZvcm0gdGl0bGUuICovXG4gICAgQElucHV0KClcbiAgICBzaG93VmFsaWRhdGlvbkljb246IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIENvbnRhaW5zIGEgbGlzdCBvZiBmb3JtIGZpZWxkIHZhbGlkYXRvciBpbnN0YW5jZXMuICovXG4gICAgQElucHV0KClcbiAgICBmaWVsZFZhbGlkYXRvcnM6IEZvcm1GaWVsZFZhbGlkYXRvcltdO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgc3VwcGxpZWQgZm9ybSB2YWx1ZXMgaGF2ZSBhIHZhbGlkYXRpb24gZXJyb3IuICovXG4gICAgQE91dHB1dCgpXG4gICAgZm9ybUVycm9yOiBFdmVudEVtaXR0ZXI8Rm9ybUZpZWxkTW9kZWxbXT4gPSBuZXcgRXZlbnRFbWl0dGVyPEZvcm1GaWVsZE1vZGVsW10+KCk7XG5cbiAgICAvKiogRW1pdHRlZCB3aGVuIGFueSBvdXRjb21lIGlzIGV4ZWN1dGVkLiBEZWZhdWx0IGJlaGF2aW91ciBjYW4gYmUgcHJldmVudGVkXG4gICAgICogdmlhIGBldmVudC5wcmV2ZW50RGVmYXVsdCgpYC5cbiAgICAgKi9cbiAgICBAT3V0cHV0KClcbiAgICBleGVjdXRlT3V0Y29tZTogRXZlbnRFbWl0dGVyPEZvcm1PdXRjb21lRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxGb3JtT3V0Y29tZUV2ZW50PigpO1xuXG4gICAgLyoqXG4gICAgICogRW1pdHRlZCB3aGVuIGFueSBlcnJvciBvY2N1cnMuXG4gICAgICovXG4gICAgQE91dHB1dCgpXG4gICAgZXJyb3I6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICBmb3JtOiBGb3JtTW9kZWw7XG5cbiAgICBnZXRQYXJzZWRGb3JtRGVmaW5pdGlvbigpOiBGb3JtQmFzZUNvbXBvbmVudCB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGhhc0Zvcm0oKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuZm9ybTtcbiAgICB9XG5cbiAgICBpc1RpdGxlRW5hYmxlZCgpOiBib29sZWFuIHtcbiAgICAgICAgbGV0IHRpdGxlRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5zaG93VGl0bGUgJiYgdGhpcy5mb3JtKSB7XG4gICAgICAgICAgICB0aXRsZUVuYWJsZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aXRsZUVuYWJsZWQ7XG4gICAgfVxuXG4gICAgZ2V0Q29sb3JGb3JPdXRjb21lKG91dGNvbWVOYW1lOiBzdHJpbmcpOiBUaGVtZVBhbGV0dGUge1xuICAgICAgICByZXR1cm4gb3V0Y29tZU5hbWUgPT09IEZvcm1CYXNlQ29tcG9uZW50LkNPTVBMRVRFX09VVENPTUVfTkFNRSA/IEZvcm1CYXNlQ29tcG9uZW50LkNPTVBMRVRFX0JVVFRPTl9DT0xPUiA6IG51bGw7XG4gICAgfVxuXG4gICAgaXNPdXRjb21lQnV0dG9uRW5hYmxlZChvdXRjb21lOiBGb3JtT3V0Y29tZU1vZGVsKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLmZvcm0ucmVhZE9ubHkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvdXRjb21lKSB7XG4gICAgICAgICAgICBpZiAob3V0Y29tZS5uYW1lID09PSBGb3JtT3V0Y29tZU1vZGVsLlNBVkVfQUNUSU9OKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICF0aGlzLmRpc2FibGVTYXZlQnV0dG9uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG91dGNvbWUubmFtZSA9PT0gRm9ybU91dGNvbWVNb2RlbC5DT01QTEVURV9BQ1RJT04pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaXNhYmxlQ29tcGxldGVCdXR0b24gPyBmYWxzZSA6IHRoaXMuZm9ybS5pc1ZhbGlkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG91dGNvbWUubmFtZSA9PT0gRm9ybU91dGNvbWVNb2RlbC5TVEFSVF9QUk9DRVNTX0FDVElPTikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRpc2FibGVTdGFydFByb2Nlc3NCdXR0b24gPyBmYWxzZSA6IHRoaXMuZm9ybS5pc1ZhbGlkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZm9ybS5pc1ZhbGlkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpc091dGNvbWVCdXR0b25WaXNpYmxlKG91dGNvbWU6IEZvcm1PdXRjb21lTW9kZWwsIGlzRm9ybVJlYWRPbmx5OiBib29sZWFuKTogYm9vbGVhbiB7XG4gICAgICAgIGlmIChvdXRjb21lICYmIG91dGNvbWUubmFtZSkge1xuICAgICAgICAgICAgaWYgKG91dGNvbWUubmFtZSA9PT0gRm9ybU91dGNvbWVNb2RlbC5DT01QTEVURV9BQ1RJT04pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zaG93Q29tcGxldGVCdXR0b247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXNGb3JtUmVhZE9ubHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb3V0Y29tZS5pc1NlbGVjdGVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG91dGNvbWUubmFtZSA9PT0gRm9ybU91dGNvbWVNb2RlbC5TQVZFX0FDVElPTikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNob3dTYXZlQnV0dG9uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG91dGNvbWUubmFtZSA9PT0gRm9ybU91dGNvbWVNb2RlbC5TVEFSVF9QUk9DRVNTX0FDVElPTikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbnZva2VkIHdoZW4gdXNlciBjbGlja3Mgb3V0Y29tZSBidXR0b24uXG4gICAgICogQHBhcmFtIG91dGNvbWUgRm9ybSBvdXRjb21lIG1vZGVsXG4gICAgICovXG4gICAgb25PdXRjb21lQ2xpY2tlZChvdXRjb21lOiBGb3JtT3V0Y29tZU1vZGVsKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICghdGhpcy5yZWFkT25seSAmJiBvdXRjb21lICYmIHRoaXMuZm9ybSkge1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMub25FeGVjdXRlT3V0Y29tZShvdXRjb21lKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG91dGNvbWUuaXNTeXN0ZW0pIHtcbiAgICAgICAgICAgICAgICBpZiAob3V0Y29tZS5pZCA9PT0gRm9ybUJhc2VDb21wb25lbnQuU0FWRV9PVVRDT01FX0lEKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZVRhc2tGb3JtKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChvdXRjb21lLmlkID09PSBGb3JtQmFzZUNvbXBvbmVudC5DT01QTEVURV9PVVRDT01FX0lEKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGVUYXNrRm9ybSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAob3V0Y29tZS5pZCA9PT0gRm9ybUJhc2VDb21wb25lbnQuU1RBUlRfUFJPQ0VTU19PVVRDT01FX0lEKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGVUYXNrRm9ybSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAob3V0Y29tZS5pZCA9PT0gRm9ybUJhc2VDb21wb25lbnQuQ1VTVE9NX09VVENPTUVfSUQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vblRhc2tTYXZlZCh0aGlzLmZvcm0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3JlRm9ybUFzTWV0YWRhdGEoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBOb3RlOiBBY3Rpdml0aSBpcyB1c2luZyBOQU1FIGZpZWxkIHJhdGhlciB0aGFuIElEIGZvciBvdXRjb21lc1xuICAgICAgICAgICAgICAgIGlmIChvdXRjb21lLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vblRhc2tTYXZlZCh0aGlzLmZvcm0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlVGFza0Zvcm0ob3V0Y29tZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGhhbmRsZUVycm9yKGVycjogYW55KTogYW55IHtcbiAgICAgICAgdGhpcy5lcnJvci5lbWl0KGVycik7XG4gICAgfVxuXG4gICAgYWJzdHJhY3Qgb25SZWZyZXNoQ2xpY2tlZCgpOiB2b2lkO1xuICAgIGFic3RyYWN0IHNhdmVUYXNrRm9ybSgpOiB2b2lkO1xuICAgIGFic3RyYWN0IGNvbXBsZXRlVGFza0Zvcm0ob3V0Y29tZT86IHN0cmluZyk6IHZvaWQ7XG5cbiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qgb25UYXNrU2F2ZWQoZm9ybTogRm9ybU1vZGVsKTogdm9pZDtcbiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qgc3RvcmVGb3JtQXNNZXRhZGF0YSgpOiB2b2lkO1xuICAgIHByb3RlY3RlZCBhYnN0cmFjdCBvbkV4ZWN1dGVPdXRjb21lKG91dGNvbWU6IEZvcm1PdXRjb21lTW9kZWwpOiBib29sZWFuO1xufVxuIl19