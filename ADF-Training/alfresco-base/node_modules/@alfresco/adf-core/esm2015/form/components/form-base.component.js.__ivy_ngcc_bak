/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { FormOutcomeModel } from './widgets';
import { EventEmitter, Input, Output, Directive } from '@angular/core';
export class FormBaseComponent {
    constructor() {
        this.showTitle = true;
        this.showCompleteButton = true;
        this.disableCompleteButton = false;
        this.disableSaveButton = false;
        this.disableStartProcessButton = false;
        this.showSaveButton = true;
        this.readOnly = false;
        this.showRefreshButton = true;
        this.showValidationIcon = true;
        this.formError = new EventEmitter();
        this.executeOutcome = new EventEmitter();
        this.error = new EventEmitter();
    }
    getParsedFormDefinition() {
        return this;
    }
    hasForm() {
        return !!this.form;
    }
    isTitleEnabled() {
        let titleEnabled = false;
        if (this.showTitle && this.form) {
            titleEnabled = true;
        }
        return titleEnabled;
    }
    getColorForOutcome(outcomeName) {
        return outcomeName === FormBaseComponent.COMPLETE_OUTCOME_NAME ? FormBaseComponent.COMPLETE_BUTTON_COLOR : null;
    }
    isOutcomeButtonEnabled(outcome) {
        if (this.form.readOnly) {
            return false;
        }
        if (outcome) {
            if (outcome.name === FormOutcomeModel.SAVE_ACTION) {
                return !this.disableSaveButton;
            }
            if (outcome.name === FormOutcomeModel.COMPLETE_ACTION) {
                return this.disableCompleteButton ? false : this.form.isValid;
            }
            if (outcome.name === FormOutcomeModel.START_PROCESS_ACTION) {
                return this.disableStartProcessButton ? false : this.form.isValid;
            }
            return this.form.isValid;
        }
        return false;
    }
    isOutcomeButtonVisible(outcome, isFormReadOnly) {
        if (outcome && outcome.name) {
            if (outcome.name === FormOutcomeModel.COMPLETE_ACTION) {
                return this.showCompleteButton;
            }
            if (isFormReadOnly) {
                return outcome.isSelected;
            }
            if (outcome.name === FormOutcomeModel.SAVE_ACTION) {
                return this.showSaveButton;
            }
            if (outcome.name === FormOutcomeModel.START_PROCESS_ACTION) {
                return false;
            }
            return true;
        }
        return false;
    }
    onOutcomeClicked(outcome) {
        if (!this.readOnly && outcome && this.form) {
            if (!this.onExecuteOutcome(outcome)) {
                return false;
            }
            if (outcome.isSystem) {
                if (outcome.id === FormBaseComponent.SAVE_OUTCOME_ID) {
                    this.saveTaskForm();
                    return true;
                }
                if (outcome.id === FormBaseComponent.COMPLETE_OUTCOME_ID) {
                    this.completeTaskForm();
                    return true;
                }
                if (outcome.id === FormBaseComponent.START_PROCESS_OUTCOME_ID) {
                    this.completeTaskForm();
                    return true;
                }
                if (outcome.id === FormBaseComponent.CUSTOM_OUTCOME_ID) {
                    this.onTaskSaved(this.form);
                    this.storeFormAsMetadata();
                    return true;
                }
            }
            else {
                if (outcome.name) {
                    this.onTaskSaved(this.form);
                    this.completeTaskForm(outcome.name);
                    return true;
                }
            }
        }
        return false;
    }
    handleError(err) {
        this.error.emit(err);
    }
}
FormBaseComponent.SAVE_OUTCOME_ID = '$save';
FormBaseComponent.COMPLETE_OUTCOME_ID = '$complete';
FormBaseComponent.START_PROCESS_OUTCOME_ID = '$startProcess';
FormBaseComponent.CUSTOM_OUTCOME_ID = '$custom';
FormBaseComponent.COMPLETE_BUTTON_COLOR = 'primary';
FormBaseComponent.COMPLETE_OUTCOME_NAME = 'COMPLETE';
FormBaseComponent.decorators = [
    { type: Directive }
];
FormBaseComponent.propDecorators = {
    path: [{ type: Input }],
    nameNode: [{ type: Input }],
    showTitle: [{ type: Input }],
    showCompleteButton: [{ type: Input }],
    disableCompleteButton: [{ type: Input }],
    disableSaveButton: [{ type: Input }],
    disableStartProcessButton: [{ type: Input }],
    showSaveButton: [{ type: Input }],
    readOnly: [{ type: Input }],
    showRefreshButton: [{ type: Input }],
    showValidationIcon: [{ type: Input }],
    fieldValidators: [{ type: Input }],
    formError: [{ type: Output }],
    executeOutcome: [{ type: Output }],
    error: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1iYXNlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL2NvcmUvIiwic291cmNlcyI6WyJmb3JtL2NvbXBvbmVudHMvZm9ybS1iYXNlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7QUFFSCxPQUFPLEVBQUUsZ0JBQWdCLEVBQW1FLE1BQU0sV0FBVyxDQUFDO0FBQzlHLE9BQU8sRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFLdkUsTUFBTSxPQUFnQixpQkFBaUI7SUFGdkM7UUFxQkksY0FBUyxHQUFZLElBQUksQ0FBQztRQUkxQix1QkFBa0IsR0FBWSxJQUFJLENBQUM7UUFJbkMsMEJBQXFCLEdBQVksS0FBSyxDQUFDO1FBSXZDLHNCQUFpQixHQUFZLEtBQUssQ0FBQztRQUluQyw4QkFBeUIsR0FBWSxLQUFLLENBQUM7UUFJM0MsbUJBQWMsR0FBWSxJQUFJLENBQUM7UUFJL0IsYUFBUSxHQUFZLEtBQUssQ0FBQztRQUkxQixzQkFBaUIsR0FBWSxJQUFJLENBQUM7UUFJbEMsdUJBQWtCLEdBQVksSUFBSSxDQUFDO1FBUW5DLGNBQVMsR0FBbUMsSUFBSSxZQUFZLEVBQW9CLENBQUM7UUFNakYsbUJBQWMsR0FBbUMsSUFBSSxZQUFZLEVBQW9CLENBQUM7UUFNdEYsVUFBSyxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO0lBdUh2RCxDQUFDO0lBbkhHLHVCQUF1QjtRQUNuQixPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBRUQsT0FBTztRQUNILE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDdkIsQ0FBQztJQUVELGNBQWM7UUFDVixJQUFJLFlBQVksR0FBRyxLQUFLLENBQUM7UUFDekIsSUFBSSxJQUFJ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ZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBGb3JtT3V0Y29tZU1vZGVsLCBGb3JtRmllbGRWYWxpZGF0b3IsIEZvcm1GaWVsZE1vZGVsLCBGb3JtT3V0Y29tZUV2ZW50LCBGb3JtTW9kZWwgfSBmcm9tICcuL3dpZGdldHMnO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0LCBEaXJlY3RpdmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFRoZW1lUGFsZXR0ZSB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2NvcmUnO1xuXG5ARGlyZWN0aXZlKClcbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogZGlyZWN0aXZlLWNsYXNzLXN1ZmZpeFxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEZvcm1CYXNlQ29tcG9uZW50IHtcblxuICAgIHN0YXRpYyBTQVZFX09VVENPTUVfSUQ6IHN0cmluZyA9ICckc2F2ZSc7XG4gICAgc3RhdGljIENPTVBMRVRFX09VVENPTUVfSUQ6IHN0cmluZyA9ICckY29tcGxldGUnO1xuICAgIHN0YXRpYyBTVEFSVF9QUk9DRVNTX09VVENPTUVfSUQ6IHN0cmluZyA9ICckc3RhcnRQcm9jZXNzJztcbiAgICBzdGF0aWMgQ1VTVE9NX09VVENPTUVfSUQ6IHN0cmluZyA9ICckY3VzdG9tJztcbiAgICBzdGF0aWMgQ09NUExFVEVfQlVUVE9OX0NPTE9SOiBUaGVtZVBhbGV0dGUgPSAncHJpbWFyeSc7XG4gICAgc3RhdGljIENPTVBMRVRFX09VVENPTUVfTkFNRTogc3RyaW5nID0gJ0NPTVBMRVRFJztcblxuICAgIC8qKiBQYXRoIG9mIHRoZSBmb2xkZXIgd2hlcmUgdGhlIG1ldGFkYXRhIHdpbGwgYmUgc3RvcmVkLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgcGF0aDogc3RyaW5nO1xuXG4gICAgLyoqIE5hbWUgdG8gYXNzaWduIHRvIHRoZSBuZXcgbm9kZSB3aGVyZSB0aGUgbWV0YWRhdGEgYXJlIHN0b3JlZC4gKi9cbiAgICBASW5wdXQoKVxuICAgIG5hbWVOb2RlOiBzdHJpbmc7XG5cbiAgICAvKiogVG9nZ2xlIHJlbmRlcmluZyBvZiB0aGUgZm9ybSB0aXRsZS4gKi9cbiAgICBASW5wdXQoKVxuICAgIHNob3dUaXRsZTogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvKiogVG9nZ2xlIHJlbmRlcmluZyBvZiB0aGUgYENvbXBsZXRlYCBvdXRjb21lIGJ1dHRvbi4gKi9cbiAgICBASW5wdXQoKVxuICAgIHNob3dDb21wbGV0ZUJ1dHRvbjogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvKiogSWYgdHJ1ZSB0aGVuIHRoZSBgQ29tcGxldGVgIG91dGNvbWUgYnV0dG9uIGlzIHNob3duIGJ1dCBpdCB3aWxsIGJlIGRpc2FibGVkLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZGlzYWJsZUNvbXBsZXRlQnV0dG9uOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKiogSWYgdHJ1ZSB0aGVuIHRoZSBgU2F2ZWAgb3V0Y29tZSBidXR0b24gaXMgc2hvd24gYnV0IHdpbGwgYmUgZGlzYWJsZWQuICovXG4gICAgQElucHV0KClcbiAgICBkaXNhYmxlU2F2ZUJ1dHRvbjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqIElmIHRydWUgdGhlbiB0aGUgYFN0YXJ0IFByb2Nlc3NgIG91dGNvbWUgYnV0dG9uIGlzIHNob3duIGJ1dCBpdCB3aWxsIGJlIGRpc2FibGVkLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZGlzYWJsZVN0YXJ0UHJvY2Vzc0J1dHRvbjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqIFRvZ2dsZSByZW5kZXJpbmcgb2YgdGhlIGBTYXZlYCBvdXRjb21lIGJ1dHRvbi4gKi9cbiAgICBASW5wdXQoKVxuICAgIHNob3dTYXZlQnV0dG9uOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBUb2dnbGUgcmVhZG9ubHkgc3RhdGUgb2YgdGhlIGZvcm0uIEZvcmNlcyBhbGwgZm9ybSB3aWRnZXRzIHRvIHJlbmRlciBhcyByZWFkb25seSBpZiBlbmFibGVkLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgcmVhZE9ubHk6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIC8qKiBUb2dnbGUgcmVuZGVyaW5nIG9mIHRoZSBgUmVmcmVzaGAgYnV0dG9uLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd1JlZnJlc2hCdXR0b246IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIFRvZ2dsZSByZW5kZXJpbmcgb2YgdGhlIHZhbGlkYXRpb24gaWNvbiBuZXh0IHRvIHRoZSBmb3JtIHRpdGxlLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2hvd1ZhbGlkYXRpb25JY29uOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIC8qKiBDb250YWlucyBhIGxpc3Qgb2YgZm9ybSBmaWVsZCB2YWxpZGF0b3IgaW5zdGFuY2VzLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgZmllbGRWYWxpZGF0b3JzOiBGb3JtRmllbGRWYWxpZGF0b3JbXTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIHN1cHBsaWVkIGZvcm0gdmFsdWVzIGhhdmUgYSB2YWxpZGF0aW9uIGVycm9yLiAqL1xuICAgIEBPdXRwdXQoKVxuICAgIGZvcm1FcnJvcjogRXZlbnRFbWl0dGVyPEZvcm1GaWVsZE1vZGVsW10+ID0gbmV3IEV2ZW50RW1pdHRlcjxGb3JtRmllbGRNb2RlbFtdPigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiBhbnkgb3V0Y29tZSBpcyBleGVjdXRlZC4gRGVmYXVsdCBiZWhhdmlvdXIgY2FuIGJlIHByZXZlbnRlZFxuICAgICAqIHZpYSBgZXZlbnQucHJldmVudERlZmF1bHQoKWAuXG4gICAgICovXG4gICAgQE91dHB1dCgpXG4gICAgZXhlY3V0ZU91dGNvbWU6IEV2ZW50RW1pdHRlcjxGb3JtT3V0Y29tZUV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8Rm9ybU91dGNvbWVFdmVudD4oKTtcblxuICAgIC8qKlxuICAgICAqIEVtaXR0ZWQgd2hlbiBhbnkgZXJyb3Igb2NjdXJzLlxuICAgICAqL1xuICAgIEBPdXRwdXQoKVxuICAgIGVycm9yOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgZm9ybTogRm9ybU1vZGVsO1xuXG4gICAgZ2V0UGFyc2VkRm9ybURlZmluaXRpb24oKTogRm9ybUJhc2VDb21wb25lbnQge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBoYXNGb3JtKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gISF0aGlzLmZvcm07XG4gICAgfVxuXG4gICAgaXNUaXRsZUVuYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIGxldCB0aXRsZUVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuc2hvd1RpdGxlICYmIHRoaXMuZm9ybSkge1xuICAgICAgICAgICAgdGl0bGVFbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGl0bGVFbmFibGVkO1xuICAgIH1cblxuICAgIGdldENvbG9yRm9yT3V0Y29tZShvdXRjb21lTmFtZTogc3RyaW5nKTogVGhlbWVQYWxldHRlIHtcbiAgICAgICAgcmV0dXJuIG91dGNvbWVOYW1lID09PSBGb3JtQmFzZUNvbXBvbmVudC5DT01QTEVURV9PVVRDT01FX05BTUUgPyBGb3JtQmFzZUNvbXBvbmVudC5DT01QTEVURV9CVVRUT05fQ09MT1IgOiBudWxsO1xuICAgIH1cblxuICAgIGlzT3V0Y29tZUJ1dHRvbkVuYWJsZWQob3V0Y29tZTogRm9ybU91dGNvbWVNb2RlbCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodGhpcy5mb3JtLnJlYWRPbmx5KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3V0Y29tZSkge1xuICAgICAgICAgICAgaWYgKG91dGNvbWUubmFtZSA9PT0gRm9ybU91dGNvbWVNb2RlbC5TQVZFX0FDVElPTikge1xuICAgICAgICAgICAgICAgIHJldHVybiAhdGhpcy5kaXNhYmxlU2F2ZUJ1dHRvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvdXRjb21lLm5hbWUgPT09IEZvcm1PdXRjb21lTW9kZWwuQ09NUExFVEVfQUNUSU9OKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlzYWJsZUNvbXBsZXRlQnV0dG9uID8gZmFsc2UgOiB0aGlzLmZvcm0uaXNWYWxpZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvdXRjb21lLm5hbWUgPT09IEZvcm1PdXRjb21lTW9kZWwuU1RBUlRfUFJPQ0VTU19BQ1RJT04pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaXNhYmxlU3RhcnRQcm9jZXNzQnV0dG9uID8gZmFsc2UgOiB0aGlzLmZvcm0uaXNWYWxpZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZvcm0uaXNWYWxpZDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaXNPdXRjb21lQnV0dG9uVmlzaWJsZShvdXRjb21lOiBGb3JtT3V0Y29tZU1vZGVsLCBpc0Zvcm1SZWFkT25seTogYm9vbGVhbik6IGJvb2xlYW4ge1xuICAgICAgICBpZiAob3V0Y29tZSAmJiBvdXRjb21lLm5hbWUpIHtcbiAgICAgICAgICAgIGlmIChvdXRjb21lLm5hbWUgPT09IEZvcm1PdXRjb21lTW9kZWwuQ09NUExFVEVfQUNUSU9OKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2hvd0NvbXBsZXRlQnV0dG9uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzRm9ybVJlYWRPbmx5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG91dGNvbWUuaXNTZWxlY3RlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvdXRjb21lLm5hbWUgPT09IEZvcm1PdXRjb21lTW9kZWwuU0FWRV9BQ1RJT04pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zaG93U2F2ZUJ1dHRvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvdXRjb21lLm5hbWUgPT09IEZvcm1PdXRjb21lTW9kZWwuU1RBUlRfUFJPQ0VTU19BQ1RJT04pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW52b2tlZCB3aGVuIHVzZXIgY2xpY2tzIG91dGNvbWUgYnV0dG9uLlxuICAgICAqIEBwYXJhbSBvdXRjb21lIEZvcm0gb3V0Y29tZSBtb2RlbFxuICAgICAqL1xuICAgIG9uT3V0Y29tZUNsaWNrZWQob3V0Y29tZTogRm9ybU91dGNvbWVNb2RlbCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAoIXRoaXMucmVhZE9ubHkgJiYgb3V0Y29tZSAmJiB0aGlzLmZvcm0pIHtcblxuICAgICAgICAgICAgaWYgKCF0aGlzLm9uRXhlY3V0ZU91dGNvbWUob3V0Y29tZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvdXRjb21lLmlzU3lzdGVtKSB7XG4gICAgICAgICAgICAgICAgaWYgKG91dGNvbWUuaWQgPT09IEZvcm1CYXNlQ29tcG9uZW50LlNBVkVfT1VUQ09NRV9JRCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVUYXNrRm9ybSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAob3V0Y29tZS5pZCA9PT0gRm9ybUJhc2VDb21wb25lbnQuQ09NUExFVEVfT1VUQ09NRV9JRCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlVGFza0Zvcm0oKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG91dGNvbWUuaWQgPT09IEZvcm1CYXNlQ29tcG9uZW50LlNUQVJUX1BST0NFU1NfT1VUQ09NRV9JRCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlVGFza0Zvcm0oKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG91dGNvbWUuaWQgPT09IEZvcm1CYXNlQ29tcG9uZW50LkNVU1RPTV9PVVRDT01FX0lEKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25UYXNrU2F2ZWQodGhpcy5mb3JtKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9yZUZvcm1Bc01ldGFkYXRhKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gTm90ZTogQWN0aXZpdGkgaXMgdXNpbmcgTkFNRSBmaWVsZCByYXRoZXIgdGhhbiBJRCBmb3Igb3V0Y29tZXNcbiAgICAgICAgICAgICAgICBpZiAob3V0Y29tZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25UYXNrU2F2ZWQodGhpcy5mb3JtKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZVRhc2tGb3JtKG91dGNvbWUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBoYW5kbGVFcnJvcihlcnI6IGFueSk6IGFueSB7XG4gICAgICAgIHRoaXMuZXJyb3IuZW1pdChlcnIpO1xuICAgIH1cblxuICAgIGFic3RyYWN0IG9uUmVmcmVzaENsaWNrZWQoKTogdm9pZDtcbiAgICBhYnN0cmFjdCBzYXZlVGFza0Zvcm0oKTogdm9pZDtcbiAgICBhYnN0cmFjdCBjb21wbGV0ZVRhc2tGb3JtKG91dGNvbWU/OiBzdHJpbmcpOiB2b2lkO1xuXG4gICAgcHJvdGVjdGVkIGFic3RyYWN0IG9uVGFza1NhdmVkKGZvcm06IEZvcm1Nb2RlbCk6IHZvaWQ7XG4gICAgcHJvdGVjdGVkIGFic3RyYWN0IHN0b3JlRm9ybUFzTWV0YWRhdGEoKTogdm9pZDtcbiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qgb25FeGVjdXRlT3V0Y29tZShvdXRjb21lOiBGb3JtT3V0Y29tZU1vZGVsKTogYm9vbGVhbjtcbn1cbiJdfQ==