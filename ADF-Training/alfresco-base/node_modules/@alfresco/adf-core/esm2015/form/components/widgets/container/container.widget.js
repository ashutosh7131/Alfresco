/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, ViewEncapsulation } from '@angular/core';
import { FormService } from './../../../services/form.service';
import { WidgetComponent } from './../widget.component';
import { ContainerWidgetComponentModel } from './container.widget.model';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './../../../services/form.service';

function ContainerWidgetComponent_button_2_Template(rf, ctx) { if (rf & 1) {
    const _r5 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 6);
    ɵngcc0.ɵɵlistener("click", function ContainerWidgetComponent_button_2_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r5); const ctx_r4 = ɵngcc0.ɵɵnextContext(); return ctx_r4.onExpanderClicked(); });
    ɵngcc0.ɵɵelementStart(1, "mat-icon");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate((ctx_r0.content == null ? null : ctx_r0.content.isExpanded) ? "expand_more" : "expand_less");
} }
function ContainerWidgetComponent_div_6_div_1_div_1_adf_form_field_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "adf-form-field", 12);
} if (rf & 2) {
    const field_r8 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵproperty("field", field_r8);
} }
const _c0 = function (a0) { return { "grid-area": a0 }; };
function ContainerWidgetComponent_div_6_div_1_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 10);
    ɵngcc0.ɵɵtemplate(1, ContainerWidgetComponent_div_6_div_1_div_1_adf_form_field_1_Template, 1, 1, "adf-form-field", 11);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const field_r8 = ctx.$implicit;
    ɵngcc0.ɵɵproperty("ngStyle", ɵngcc0.ɵɵpureFunction1(2, _c0, "auto / auto / span " + ((field_r8 == null ? null : field_r8.rowspan) || 1) + " / span " + ((field_r8 == null ? null : field_r8.colspan) || 1)));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", field_r8);
} }
const _c1 = function (a0) { return { "grid-template-columns": a0 }; };
function ContainerWidgetComponent_div_6_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 8);
    ɵngcc0.ɵɵtemplate(1, ContainerWidgetComponent_div_6_div_1_div_1_Template, 2, 4, "div", 9);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r6 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("ngStyle", ɵngcc0.ɵɵpureFunction1(2, _c1, "repeat(" + ctx_r6.numberOfColumns + ", 1fr)"));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r6.fields);
} }
function ContainerWidgetComponent_div_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵtemplate(1, ContainerWidgetComponent_div_6_div_1_Template, 2, 4, "div", 7);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.content == null ? null : ctx_r1.content.isExpanded);
} }
function ContainerWidgetComponent_ng_template_7_section_0_div_1_div_1_adf_form_field_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "adf-form-field", 12);
} if (rf & 2) {
    const field_r15 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵproperty("field", field_r15);
} }
function ContainerWidgetComponent_ng_template_7_section_0_div_1_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 18);
    ɵngcc0.ɵɵtemplate(1, ContainerWidgetComponent_ng_template_7_section_0_div_1_div_1_adf_form_field_1_Template, 1, 1, "adf-form-field", 11);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const field_r15 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", field_r15);
} }
function ContainerWidgetComponent_ng_template_7_section_0_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 16);
    ɵngcc0.ɵɵtemplate(1, ContainerWidgetComponent_ng_template_7_section_0_div_1_div_1_Template, 2, 1, "div", 17);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const column_r13 = ctx.$implicit;
    const ctx_r12 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵstyleProp("width", ctx_r12.getColumnWith(ctx_r12.field), "%");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", column_r13 == null ? null : column_r13.fields);
} }
function ContainerWidgetComponent_ng_template_7_section_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "section", 14);
    ɵngcc0.ɵɵtemplate(1, ContainerWidgetComponent_ng_template_7_section_0_div_1_Template, 2, 3, "div", 15);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r11 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r11.content == null ? null : ctx_r11.content.columns);
} }
function ContainerWidgetComponent_ng_template_7_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ContainerWidgetComponent_ng_template_7_section_0_Template, 2, 1, "section", 13);
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.content == null ? null : ctx_r3.content.isExpanded);
} }
export class ContainerWidgetComponent extends WidgetComponent {
    constructor(formService) {
        super(formService);
        this.formService = formService;
    }
    onExpanderClicked() {
        if (this.content && this.content.isCollapsible()) {
            this.content.isExpanded = !this.content.isExpanded;
        }
    }
    ngOnInit() {
        if (this.field) {
            this.content = new ContainerWidgetComponentModel(this.field);
            this.getNumberOfColumnsFromTheBiggestBetweenJsonAndColumnsLengthOrOne();
            this.fields = this.getFields();
        }
    }
    getNumberOfColumnsFromTheBiggestBetweenJsonAndColumnsLengthOrOne() {
        var _a, _b, _c, _d;
        this.numberOfColumns = (((_a = this.content.json) === null || _a === void 0 ? void 0 : _a.numberOfColumns) || 1) > (((_b = this.content.columns) === null || _b === void 0 ? void 0 : _b.length) || 1) ?
            (((_c = this.content.json) === null || _c === void 0 ? void 0 : _c.numberOfColumns) || 1) :
            (((_d = this.content.columns) === null || _d === void 0 ? void 0 : _d.length) || 1);
    }
    getFields() {
        var _a;
        const serialisedFormFields = [];
        const maxColumnFieldsSize = this.getMaxColumnFieldSize();
        for (let rowIndex = 0; rowIndex < maxColumnFieldsSize; rowIndex++) {
            (_a = this.content) === null || _a === void 0 ? void 0 : _a.columns.flatMap((currentColumn) => {
                var _a;
                if (!!(currentColumn === null || currentColumn === void 0 ? void 0 : currentColumn.fields[rowIndex])) {
                    serialisedFormFields.push(currentColumn === null || currentColumn === void 0 ? void 0 : currentColumn.fields[rowIndex]);
                }
                else {
                    const firstRowElementColSpan = (_a = currentColumn === null || currentColumn === void 0 ? void 0 : currentColumn.fields[0]) === null || _a === void 0 ? void 0 : _a.colspan;
                    if (!!firstRowElementColSpan && rowIndex > 0) {
                        for (let i = 0; i < firstRowElementColSpan; i++) {
                            serialisedFormFields.push(null);
                        }
                    }
                }
            });
        }
        return serialisedFormFields;
    }
    getMaxColumnFieldSize() {
        var _a, _b, _c, _d, _e, _f;
        let maxFieldSize = 0;
        if (((_b = (_a = this.content) === null || _a === void 0 ? void 0 : _a.columns) === null || _b === void 0 ? void 0 : _b.length) > 0) {
            maxFieldSize = (_f = (_e = (_d = (_c = this.content) === null || _c === void 0 ? void 0 : _c.columns) === null || _d === void 0 ? void 0 : _d.reduce((prevColumn, currentColumn) => {
                var _a;
                return currentColumn.fields.length > ((_a = prevColumn === null || prevColumn === void 0 ? void 0 : prevColumn.fields) === null || _a === void 0 ? void 0 : _a.length) ? currentColumn : prevColumn;
            })) === null || _e === void 0 ? void 0 : _e.fields) === null || _f === void 0 ? void 0 : _f.length;
        }
        return maxFieldSize;
    }
    getColumnWith(field) {
        const colspan = field ? field.colspan : 1;
        return (100 / this.content.json.numberOfColumns) * colspan + '';
    }
}
ContainerWidgetComponent.ɵfac = function ContainerWidgetComponent_Factory(t) { return new (t || ContainerWidgetComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.FormService)); };
ContainerWidgetComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ContainerWidgetComponent, selectors: [["container-widget"]], hostBindings: function ContainerWidgetComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function ContainerWidgetComponent_click_HostBindingHandler($event) { return ctx.event($event); })("blur", function ContainerWidgetComponent_blur_HostBindingHandler($event) { return ctx.event($event); })("change", function ContainerWidgetComponent_change_HostBindingHandler($event) { return ctx.event($event); })("focus", function ContainerWidgetComponent_focus_HostBindingHandler($event) { return ctx.event($event); })("focusin", function ContainerWidgetComponent_focusin_HostBindingHandler($event) { return ctx.event($event); })("focusout", function ContainerWidgetComponent_focusout_HostBindingHandler($event) { return ctx.event($event); })("input", function ContainerWidgetComponent_input_HostBindingHandler($event) { return ctx.event($event); })("invalid", function ContainerWidgetComponent_invalid_HostBindingHandler($event) { return ctx.event($event); })("select", function ContainerWidgetComponent_select_HostBindingHandler($event) { return ctx.event($event); });
    } }, features: [ɵngcc0.ɵɵInheritDefinitionFeature], decls: 9, vars: 9, consts: [[1, "adf-container-widget__header", 3, "hidden"], ["id", "container-header", 1, "adf-container-widget__header-text"], ["mat-icon-button", "", "class", "mdl-button--icon", 3, "click", 4, "ngIf"], ["id", "container-header-label", 3, "click"], [4, "ngIf", "ngIfElse"], ["fixingTemplate", ""], ["mat-icon-button", "", 1, "mdl-button--icon", 3, "click"], ["class", "adf-grid-list", 3, "ngStyle", 4, "ngIf"], [1, "adf-grid-list", 3, "ngStyle"], ["class", "adf-grid-list-item", 3, "ngStyle", 4, "ngFor", "ngForOf"], [1, "adf-grid-list-item", 3, "ngStyle"], [3, "field", 4, "ngIf"], [3, "field"], ["class", "adf-grid-list-column-view", 4, "ngIf"], [1, "adf-grid-list-column-view"], ["class", "adf-grid-list-single-column", 3, "width", 4, "ngFor", "ngForOf"], [1, "adf-grid-list-single-column"], ["class", "adf-grid-list-column-view-item", 4, "ngFor", "ngForOf"], [1, "adf-grid-list-column-view-item"]], template: function ContainerWidgetComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "h4", 1);
        ɵngcc0.ɵɵtemplate(2, ContainerWidgetComponent_button_2_Template, 3, 1, "button", 2);
        ɵngcc0.ɵɵelementStart(3, "span", 3);
        ɵngcc0.ɵɵlistener("click", function ContainerWidgetComponent_Template_span_click_3_listener() { return ctx.onExpanderClicked(); });
        ɵngcc0.ɵɵtext(4);
        ɵngcc0.ɵɵpipe(5, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(6, ContainerWidgetComponent_div_6_Template, 2, 1, "div", 4);
        ɵngcc0.ɵɵtemplate(7, ContainerWidgetComponent_ng_template_7_Template, 1, 1, "ng-template", null, 5, ɵngcc0.ɵɵtemplateRefExtractor);
    } if (rf & 2) {
        const _r2 = ɵngcc0.ɵɵreference(8);
        ɵngcc0.ɵɵproperty("hidden", !(ctx.content == null ? null : ctx.content.isGroup()));
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵclassProp("adf-collapsible", ctx.content == null ? null : ctx.content.isCollapsible());
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.content == null ? null : ctx.content.isCollapsible());
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(5, 7, ctx.content.name));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.field == null ? null : ctx.field.form == null ? null : ctx.field.form.enableFixedSpace)("ngIfElse", _r2);
    } }, styles: [".adf-hidden{display:none}.adf-container-widget__header-text{-moz-user-select:none;-ms-user-select:none;-webkit-touch-callout:none;-webkit-user-select:none;border-bottom:1px solid rgba(0,0,0,.87);cursor:default;padding-bottom:10px;user-select:none}.adf-container-widget__header-text.adf-collapsible{cursor:pointer}.adf-field-list{height:100%;list-style-type:none;padding:0;width:100%}container-widget .adf-grid-list-column-view{align-items:flex-start;display:flex;margin-right:-1%}container-widget .adf-grid-list-single-column{align-items:flex-start;display:flex;flex:1 1 auto;flex-direction:column}container-widget .adf-grid-list-column-view-item{box-sizing:border-box;flex-grow:1;padding-left:1%;padding-right:1%;width:100%}container-widget .adf-grid-list{display:grid}container-widget .adf-grid-list-item{box-sizing:border-box;padding-left:3px;padding-right:3px}@media screen and (max-width:959px){container-widget .adf-grid-list-item{flex:1 0 100%}container-widget .adf-grid-list--column-view{flex-direction:column}container-widget .adf-grid-list-single-column{width:90%!important}container-widget .adf-grid-list-column-view-item{flex:1 0 auto}}container-widget .mat-form-field,container-widget mat-form-field{width:100%}container-widget .mat-input-placeholder{top:1.8em!important}container-widget .mat-focused label{background-color:.3s cubic-bezier(.55,0,.55,.2);color:var(--theme-primary-color);transform:scaleX(1);transition:transform .15s linear}container-widget .mat-focused .mat-form-field-prefix{color:var(--theme-primary-color)}container-widget .mat-grid-tile{overflow:visible;width:80%}container-widget adf-form-field{width:100%}"], encapsulation: 2 });
ContainerWidgetComponent.ctorParameters = () => [
    { type: FormService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ContainerWidgetComponent, [{
        type: Component,
        args: [{
                selector: 'container-widget',
                template: "<div [hidden]=\"!content?.isGroup()\" class=\"adf-container-widget__header\">\n    <h4 class=\"adf-container-widget__header-text\" id=\"container-header\"\n        [class.adf-collapsible]=\"content?.isCollapsible()\">\n        <button *ngIf=\"content?.isCollapsible()\"\n                mat-icon-button\n                class=\"mdl-button--icon\"\n                (click)=\"onExpanderClicked()\">\n            <mat-icon>{{ content?.isExpanded ? 'expand_more' : 'expand_less' }}</mat-icon>\n        </button>\n        <span (click)=\"onExpanderClicked()\" id=\"container-header-label\">{{content.name | translate }}</span>\n    </h4>\n</div>\n\n<div *ngIf=\"field?.form?.enableFixedSpace else fixingTemplate\">\n    <div class=\"adf-grid-list\" [ngStyle]=\"{ 'grid-template-columns': 'repeat('+numberOfColumns+', 1fr)'}\"\n        *ngIf=\"content?.isExpanded\">\n        <div class=\"adf-grid-list-item\" *ngFor=\"let field of fields\"\n            [ngStyle]=\"{'grid-area': 'auto / auto / span '+(field?.rowspan || 1)+' / span '+(field?.colspan || 1)}\">\n            <adf-form-field *ngIf=\"field\" [field]=\"field\"></adf-form-field>\n        </div>\n    </div>\n</div>\n\n<ng-template #fixingTemplate>\n    <section class=\"adf-grid-list-column-view\" *ngIf=\"content?.isExpanded\">\n        <div class=\"adf-grid-list-single-column\" *ngFor=\"let column of content?.columns\" [style.width.%]=\"getColumnWith(field)\">\n            <div class=\"adf-grid-list-column-view-item\" *ngFor=\"let field of column?.fields\">\n                <adf-form-field *ngIf=\"field\" [field]=\"field\"></adf-form-field>\n            </div>\n        </div>\n    </section>\n</ng-template>\n",
                host: {
                    '(click)': 'event($event)',
                    '(blur)': 'event($event)',
                    '(change)': 'event($event)',
                    '(focus)': 'event($event)',
                    '(focusin)': 'event($event)',
                    '(focusout)': 'event($event)',
                    '(input)': 'event($event)',
                    '(invalid)': 'event($event)',
                    '(select)': 'event($event)'
                },
                encapsulation: ViewEncapsulation.None,
                styles: [".adf-hidden{display:none}.adf-container-widget__header-text{-moz-user-select:none;-ms-user-select:none;-webkit-touch-callout:none;-webkit-user-select:none;border-bottom:1px solid rgba(0,0,0,.87);cursor:default;padding-bottom:10px;user-select:none}.adf-container-widget__header-text.adf-collapsible{cursor:pointer}.adf-field-list{height:100%;list-style-type:none;padding:0;width:100%}container-widget .adf-grid-list-column-view{align-items:flex-start;display:flex;margin-right:-1%}container-widget .adf-grid-list-single-column{align-items:flex-start;display:flex;flex:1 1 auto;flex-direction:column}container-widget .adf-grid-list-column-view-item{box-sizing:border-box;flex-grow:1;padding-left:1%;padding-right:1%;width:100%}container-widget .adf-grid-list{display:grid}container-widget .adf-grid-list-item{box-sizing:border-box;padding-left:3px;padding-right:3px}@media screen and (max-width:959px){container-widget .adf-grid-list-item{flex:1 0 100%}container-widget .adf-grid-list--column-view{flex-direction:column}container-widget .adf-grid-list-single-column{width:90%!important}container-widget .adf-grid-list-column-view-item{flex:1 0 auto}}container-widget .mat-form-field,container-widget mat-form-field{width:100%}container-widget .mat-input-placeholder{top:1.8em!important}container-widget .mat-focused label{background-color:.3s cubic-bezier(.55,0,.55,.2);color:var(--theme-primary-color);transform:scaleX(1);transition:transform .15s linear}container-widget .mat-focused .mat-form-field-prefix{color:var(--theme-primary-color)}container-widget .mat-grid-tile{overflow:visible;width:80%}container-widget adf-form-field{width:100%}"]
            }]
    }], function () { return [{ type: ɵngcc1.FormService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGFpbmVyLndpZGdldC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL2NvcmUvZm9ybS9jb21wb25lbnRzL3dpZGdldHMvY29udGFpbmVyL2NvbnRhaW5lci53aWRnZXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUlILE9BQU8sRUFBaUIsU0FBUyxFQUFVLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3BGLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUUvRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDeEQsT0FBTyxFQUFFLDZCQUE2QixFQUFFLE1BQU0sMEJBQTBCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBbUJ6RSxNQUFNLE9BQU8sd0JBQXlCLFNBQVEsZUFBZTtBQUFHLElBTTVELFlBQW1CLFdBQXdCO0FBQy9DLFFBQVEsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQzNCLFFBRnVCLGdCQUFXLEdBQVgsV0FBVyxDQUFhO0FBQUMsSUFFNUMsQ0FBQztBQUNMLElBQ0ksaUJBQWlCO0FBQ3JCLFFBQVEsSUFBSSxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQUU7QUFDMUQsWUFBWSxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxD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VSx1QkFBVixVQUFVLENBQUUsTUFBTSwwQ0FBRSxNQUFNLENBQUEsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUM7QUFDN0csWUFBWSxDQUFDLDJDQUFHLE1BQU0sMENBQUUsTUFBTSxDQUFDO0FBQy9CLFNBQVM7QUFDVCxRQUFRLE9BQU8sWUFBWSxDQUFDO0FBQzVCLElBQUksQ0FBQztBQUNMLElBTUksYUFBYSxDQUFDLEtBQXFCO0FBQUksUUFDbkMsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDbEQsUUFBUSxPQUFPLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLE9BQU8sR0FBRyxFQUFFLENBQUM7QUFDeEUsSUFBSSxDQUFDO0FBQ0w7b0RBMUZDLFNBQVMsU0FBQyxrQkFDUCxRQUFRLEVBQUUsa0JBQWtCLGtCQUM1Qjs7OythQUFzQyxrQkFFdEMsSUFBSSxFQUFFLHNCQUNGLFNBQVMsRUFBRSxlQUFlLHNCQUMxQixRQUFRLEVBQUUsZUFBZSxzQkFDekIsVUFBVSxFQUFFLGVBQWUsc0JBQzNCLFNBQVMsRUFBRSxlQUFlLHNCQUMxQixXQUFXLEVBQUUsZUFBZSxzQkFDNUIsWUFBWSxFQUFFLGVBQWUsc0JBQzdCLFNBQVMsRUFBRSxlQUFlLHNCQUMxQixXQUFXLEVBQUUsZUFBZSxzQkFDNUIsVUFBVSxFQUFFLGVBQWUsa0JBQzlCLGtCQUNELGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7NEpBQ3hDLHkvQ0FDSTtBQUFDO0FBQWtELFlBdEIvQyxXQUFXO0FBQUc7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzRFQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vKiB0c2xpbnQ6ZGlzYWJsZTpjb21wb25lbnQtc2VsZWN0b3IgICovXG5cbmltcG9ydCB7IEFmdGVyVmlld0luaXQsIENvbXBvbmVudCwgT25Jbml0LCBWaWV3RW5jYXBzdWxhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybVNlcnZpY2UgfSBmcm9tICcuLy4uLy4uLy4uL3NlcnZpY2VzL2Zvcm0uc2VydmljZSc7XG5pbXBvcnQgeyBGb3JtRmllbGRNb2RlbCB9IGZyb20gJy4vLi4vY29yZS9mb3JtLWZpZWxkLm1vZGVsJztcbmltcG9ydCB7IFdpZGdldENvbXBvbmVudCB9IGZyb20gJy4vLi4vd2lkZ2V0LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBDb250YWluZXJXaWRnZXRDb21wb25lbnRNb2RlbCB9IGZyb20gJy4vY29udGFpbmVyLndpZGdldC5tb2RlbCc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnY29udGFpbmVyLXdpZGdldCcsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2NvbnRhaW5lci53aWRnZXQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vY29udGFpbmVyLndpZGdldC5zY3NzJ10sXG4gICAgaG9zdDoge1xuICAgICAgICAnKGNsaWNrKSc6ICdldmVudCgkZXZlbnQpJyxcbiAgICAgICAgJyhibHVyKSc6ICdldmVudCgkZXZlbnQpJyxcbiAgICAgICAgJyhjaGFuZ2UpJzogJ2V2ZW50KCRldmVudCknLFxuICAgICAgICAnKGZvY3VzKSc6ICdldmVudCgkZXZlbnQpJyxcbiAgICAgICAgJyhmb2N1c2luKSc6ICdldmVudCgkZXZlbnQpJyxcbiAgICAgICAgJyhmb2N1c291dCknOiAnZXZlbnQoJGV2ZW50KScsXG4gICAgICAgICcoaW5wdXQpJzogJ2V2ZW50KCRldmVudCknLFxuICAgICAgICAnKGludmFsaWQpJzogJ2V2ZW50KCRldmVudCknLFxuICAgICAgICAnKHNlbGVjdCknOiAnZXZlbnQoJGV2ZW50KSdcbiAgICB9LFxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgQ29udGFpbmVyV2lkZ2V0Q29tcG9uZW50IGV4dGVuZHMgV2lkZ2V0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcblxuICAgIGNvbnRlbnQ6IENvbnRhaW5lcldpZGdldENvbXBvbmVudE1vZGVsO1xuICAgIG51bWJlck9mQ29sdW1uczogbnVtYmVyO1xuICAgIGZpZWxkczogRm9ybUZpZWxkTW9kZWxbXTtcblxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBmb3JtU2VydmljZTogRm9ybVNlcnZpY2UpIHtcbiAgICAgICAgc3VwZXIoZm9ybVNlcnZpY2UpO1xuICAgIH1cblxuICAgIG9uRXhwYW5kZXJDbGlja2VkKCkge1xuICAgICAgICBpZiAodGhpcy5jb250ZW50ICYmIHRoaXMuY29udGVudC5pc0NvbGxhcHNpYmxlKCkpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGVudC5pc0V4cGFuZGVkID0gIXRoaXMuY29udGVudC5pc0V4cGFuZGVkO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIGlmICh0aGlzLmZpZWxkKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSBuZXcgQ29udGFpbmVyV2lkZ2V0Q29tcG9uZW50TW9kZWwodGhpcy5maWVsZCk7XG4gICAgICAgICAgICB0aGlzLmdldE51bWJlck9mQ29sdW1uc0Zyb21UaGVCaWdnZXN0QmV0d2Vlbkpzb25BbmRDb2x1bW5zTGVuZ3RoT3JPbmUoKTtcbiAgICAgICAgICAgIHRoaXMuZmllbGRzID0gdGhpcy5nZXRGaWVsZHMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0TnVtYmVyT2ZDb2x1bW5zRnJvbVRoZUJpZ2dlc3RCZXR3ZWVuSnNvbkFuZENvbHVtbnNMZW5ndGhPck9uZSgpIHtcbiAgICAgICAgdGhpcy5udW1iZXJPZkNvbHVtbnMgPSAodGhpcy5jb250ZW50Lmpzb24/Lm51bWJlck9mQ29sdW1ucyB8fCAxKSA+ICh0aGlzLmNvbnRlbnQuY29sdW1ucz8ubGVuZ3RoIHx8IDEpID9cbiAgICAgICAgICAgICh0aGlzLmNvbnRlbnQuanNvbj8ubnVtYmVyT2ZDb2x1bW5zIHx8IDEpIDpcbiAgICAgICAgICAgICh0aGlzLmNvbnRlbnQuY29sdW1ucz8ubGVuZ3RoIHx8IDEpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlcmlhbGl6ZXMgY29sdW1uIGZpZWxkc1xuICAgICAqL1xuICAgIHByaXZhdGUgZ2V0RmllbGRzKCk6IEZvcm1GaWVsZE1vZGVsW10ge1xuICAgICAgICBjb25zdCBzZXJpYWxpc2VkRm9ybUZpZWxkczogRm9ybUZpZWxkTW9kZWxbXSA9IFtdO1xuICAgICAgICBjb25zdCBtYXhDb2x1bW5GaWVsZHNTaXplID0gdGhpcy5nZXRNYXhDb2x1bW5GaWVsZFNpemUoKTtcbiAgICAgICAgZm9yIChsZXQgcm93SW5kZXggPSAwOyByb3dJbmRleCA8IG1heENvbHVtbkZpZWxkc1NpemU7IHJvd0luZGV4KyspIHtcbiAgICAgICAgICAgIHRoaXMuY29udGVudD8uY29sdW1ucy5mbGF0TWFwKChjdXJyZW50Q29sdW1uKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCEhY3VycmVudENvbHVtbj8uZmllbGRzW3Jvd0luZGV4XSkge1xuICAgICAgICAgICAgICAgICAgICBzZXJpYWxpc2VkRm9ybUZpZWxkcy5wdXNoKGN1cnJlbnRDb2x1bW4/LmZpZWxkc1tyb3dJbmRleF0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0Um93RWxlbWVudENvbFNwYW4gPSBjdXJyZW50Q29sdW1uPy5maWVsZHNbMF0/LmNvbHNwYW47XG4gICAgICAgICAgICAgICAgICAgIGlmICghIWZpcnN0Um93RWxlbWVudENvbFNwYW4gJiYgcm93SW5kZXggPiAwICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaXJzdFJvd0VsZW1lbnRDb2xTcGFuOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxpc2VkRm9ybUZpZWxkcy5wdXNoKG51bGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2VyaWFsaXNlZEZvcm1GaWVsZHM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRNYXhDb2x1bW5GaWVsZFNpemUoKTogbnVtYmVyIHtcbiAgICAgICAgbGV0IG1heEZpZWxkU2l6ZSA9IDA7XG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnQ/LmNvbHVtbnM/Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIG1heEZpZWxkU2l6ZSA9IHRoaXMuY29udGVudD8uY29sdW1ucz8ucmVkdWNlKChwcmV2Q29sdW1uLCBjdXJyZW50Q29sdW1uKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRDb2x1bW4uZmllbGRzLmxlbmd0aCA+IHByZXZDb2x1bW4/LmZpZWxkcz8ubGVuZ3RoID8gY3VycmVudENvbHVtbiA6IHByZXZDb2x1bW47XG4gICAgICAgICAgICB9KT8uZmllbGRzPy5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG1heEZpZWxkU2l6ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGUgdGhlIGNvbHVtbiB3aWR0aCBiYXNlZCBvbiB0aGUgbnVtYmVyT2ZDb2x1bW5zIGFuZCBjdXJyZW50IGZpZWxkJ3MgY29sc3BhbiBwcm9wZXJ0eVxuICAgICAqXG4gICAgICogQHBhcmFtIGZpZWxkXG4gICAgICovXG4gICAgZ2V0Q29sdW1uV2l0aChmaWVsZDogRm9ybUZpZWxkTW9kZWwpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBjb2xzcGFuID0gZmllbGQgPyBmaWVsZC5jb2xzcGFuIDogMTtcbiAgICAgICAgcmV0dXJuICgxMDAgLyB0aGlzLmNvbnRlbnQuanNvbi5udW1iZXJPZkNvbHVtbnMpICogY29sc3BhbiArICcnO1xuICAgIH1cbn1cbiJdfQ==