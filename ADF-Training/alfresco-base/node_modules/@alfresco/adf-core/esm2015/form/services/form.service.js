import { AlfrescoApiService } from '../../services/alfresco-api.service';
import { LogService } from '../../services/log.service';
import { Injectable } from '@angular/core';
import { Observable, Subject, from, of, throwError } from 'rxjs';
import { FormDefinitionModel } from '../models/form-definition.model';
import { FormModel, FormOutcomeModel } from './../components/widgets/core/index';
import { EcmModelService } from './ecm-model.service';
import { map, catchError, switchMap, combineAll, defaultIfEmpty } from 'rxjs/operators';
import { ModelsApi, ProcessInstanceVariablesApi, TasksApi, TaskFormsApi, ProcessInstancesApi, FormModelsApi, ProcessDefinitionsApi, UsersApi, ActivitiGroupsApi } from '@alfresco/js-api';
import * as i0 from "@angular/core";
import * as i1 from "./ecm-model.service";
import * as i2 from "../../services/alfresco-api.service";
import * as i3 from "../../services/log.service";
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './ecm-model.service';
import * as ɵngcc2 from '../../services/alfresco-api.service';
import * as ɵngcc3 from '../../services/log.service';
export class FormService {
    constructor(ecmModelService, apiService, logService) {
        this.ecmModelService = ecmModelService;
        this.apiService = apiService;
        this.logService = logService;
        this.formLoaded = new Subject();
        this.formDataRefreshed = new Subject();
        this.formFieldValueChanged = new Subject();
        this.formEvents = new Subject();
        this.taskCompleted = new Subject();
        this.taskCompletedError = new Subject();
        this.taskSaved = new Subject();
        this.taskSavedError = new Subject();
        this.formContentClicked = new Subject();
        this.validateForm = new Subject();
        this.validateFormField = new Subject();
        this.validateDynamicTableRow = new Subject();
        this.executeOutcome = new Subject();
        this.updateFormValuesRequested = new Subject();
    }
    get taskFormsApi() {
        var _a;
        this._taskFormsApi = (_a = this._taskFormsApi) !== null && _a !== void 0 ? _a : new TaskFormsApi(this.apiService.getInstance());
        return this._taskFormsApi;
    }
    get taskApi() {
        var _a;
        this._taskApi = (_a = this._taskApi) !== null && _a !== void 0 ? _a : new TasksApi(this.apiService.getInstance());
        return this._taskApi;
    }
    get modelsApi() {
        var _a;
        this._modelsApi = (_a = this._modelsApi) !== null && _a !== void 0 ? _a : new ModelsApi(this.apiService.getInstance());
        return this._modelsApi;
    }
    get editorApi() {
        var _a;
        this._editorApi = (_a = this._editorApi) !== null && _a !== void 0 ? _a : new FormModelsApi(this.apiService.getInstance());
        return this._editorApi;
    }
    get processDefinitionsApi() {
        var _a;
        this._processDefinitionsApi = (_a = this._processDefinitionsApi) !== null && _a !== void 0 ? _a : new ProcessDefinitionsApi(this.apiService.getInstance());
        return this._processDefinitionsApi;
    }
    get processInstanceVariablesApi() {
        var _a;
        this._processInstanceVariablesApi = (_a = this._processInstanceVariablesApi) !== null && _a !== void 0 ? _a : new ProcessInstanceVariablesApi(this.apiService.getInstance());
        return this._processInstanceVariablesApi;
    }
    get processInstancesApi() {
        var _a;
        this._processInstancesApi = (_a = this._processInstancesApi) !== null && _a !== void 0 ? _a : new ProcessInstancesApi(this.apiService.getInstance());
        return this._processInstancesApi;
    }
    get groupsApi() {
        var _a;
        this._groupsApi = (_a = this._groupsApi) !== null && _a !== void 0 ? _a : new ActivitiGroupsApi(this.apiService.getInstance());
        return this._groupsApi;
    }
    get usersApi() {
        var _a;
        this._usersApi = (_a = this._usersApi) !== null && _a !== void 0 ? _a : new UsersApi(this.apiService.getInstance());
        return this._usersApi;
    }
    parseForm(json, data, readOnly = false, fixedSpace) {
        if (json) {
            const form = new FormModel(json, data, readOnly, this, fixedSpace);
            if (!json.fields) {
                form.outcomes = [
                    new FormOutcomeModel(form, {
                        id: '$save',
                        name: FormOutcomeModel.SAVE_ACTION,
                        isSystem: true
                    })
                ];
            }
            return form;
        }
        return null;
    }
    createFormFromANode(formName) {
        return new Observable((observer) => {
            this.createForm(formName).subscribe((form) => {
                this.ecmModelService.searchEcmType(formName, EcmModelService.MODEL_NAME).subscribe((customType) => {
                    const formDefinitionModel = new FormDefinitionModel(form.id, form.name, form.lastUpdatedByFullName, form.lastUpdated, customType.entry.properties);
                    from(this.editorApi.saveForm(form.id, formDefinitionModel)).subscribe((formData) => {
                        observer.next(formData);
                        observer.complete();
                    }, (err) => this.handleError(err));
                }, (err) => this.handleError(err));
            }, (err) => this.handleError(err));
        });
    }
    createForm(formName) {
        const dataModel = {
            name: formName,
            description: '',
            modelType: 2,
            stencilSet: 0
        };
        return from(this.modelsApi.createModel(dataModel));
    }
    saveForm(formId, formModel) {
        return from(this.editorApi.saveForm(formId, formModel));
    }
    searchFrom(name) {
        const opts = {
            'modelType': 2
        };
        return from(this.modelsApi.getModels(opts))
            .pipe(map(function (forms) {
            return forms.data.find((formData) => formData.name === name);
        }), catchError((err) => this.handleError(err)));
    }
    getForms() {
        const opts = {
            'modelType': 2
        };
        return from(this.modelsApi.getModels(opts))
            .pipe(map(this.toJsonArray), catchError((err) => this.handleError(err)));
    }
    getProcessDefinitions() {
        return from(this.processDefinitionsApi.getProcessDefinitions({}))
            .pipe(map(this.toJsonArray), catchError((err) => this.handleError(err)));
    }
    getProcessVariablesById(processInstanceId) {
        return from(this.processInstanceVariablesApi.getProcessInstanceVariables(processInstanceId))
            .pipe(map(this.toJson), catchError((err) => this.handleError(err)));
    }
    getTasks() {
        return from(this.taskApi.listTasks({}))
            .pipe(map(this.toJsonArray), catchError((err) => this.handleError(err)));
    }
    getTask(taskId) {
        return from(this.taskApi.getTask(taskId))
            .pipe(map(this.toJson), catchError((err) => this.handleError(err)));
    }
    saveTaskForm(taskId, formValues) {
        const saveFormRepresentation = { values: formValues };
        return from(this.taskFormsApi.saveTaskForm(taskId, saveFormRepresentation))
            .pipe(catchError((err) => this.handleError(err)));
    }
    completeTaskForm(taskId, formValues, outcome) {
        const completeFormRepresentation = { values: formValues };
        if (outcome) {
            completeFormRepresentation.outcome = outcome;
        }
        return from(this.taskFormsApi.completeTaskForm(taskId, completeFormRepresentation))
            .pipe(catchError((err) => this.handleError(err)));
    }
    getTaskForm(taskId) {
        return from(this.taskFormsApi.getTaskForm(taskId))
            .pipe(map(this.toJson), catchError((err) => this.handleError(err)));
    }
    getFormDefinitionById(formId) {
        return from(this.editorApi.getForm(formId))
            .pipe(map(this.toJson), catchError((err) => this.handleError(err)));
    }
    getFormDefinitionByName(name) {
        const opts = {
            'filter': 'myReusableForms',
            'filterText': name,
            'modelType': 2
        };
        return from(this.modelsApi.getModels(opts))
            .pipe(map(this.getFormId), catchError((err) => this.handleError(err)));
    }
    getStartFormInstance(processId) {
        return from(this.processInstancesApi.getProcessInstanceStartForm(processId))
            .pipe(map(this.toJson), catchError((err) => this.handleError(err)));
    }
    getProcessInstance(processId) {
        return from(this.processInstancesApi.getProcessInstance(processId))
            .pipe(map(this.toJson), catchError((err) => this.handleError(err)));
    }
    getStartFormDefinition(processId) {
        return from(this.processDefinitionsApi.getProcessDefinitionStartForm(processId))
            .pipe(map(this.toJson), catchError((err) => this.handleError(err)));
    }
    getRestFieldValues(taskId, field) {
        return from(this.taskFormsApi.getRestFieldValues(taskId, field))
            .pipe(catchError((err) => this.handleError(err)));
    }
    getRestFieldValuesByProcessId(processDefinitionId, field) {
        return from(this.processDefinitionsApi.getRestFieldValues(processDefinitionId, field))
            .pipe(catchError((err) => this.handleError(err)));
    }
    getRestFieldValuesColumnByProcessId(processDefinitionId, field, column) {
        return from(this.processDefinitionsApi.getRestTableFieldValues(processDefinitionId, field, column))
            .pipe(catchError((err) => this.handleError(err)));
    }
    getRestFieldValuesColumn(taskId, field, column) {
        return from(this.taskFormsApi.getRestFieldColumnValues(taskId, field, column))
            .pipe(catchError((err) => this.handleError(err)));
    }
    getUserProfileImageApi(userId) {
        return this.usersApi.getUserProfilePictureUrl(userId);
    }
    getWorkflowUsers(filter, groupId) {
        const option = { filter: filter };
        if (groupId) {
            option.groupId = groupId;
        }
        return from(this.usersApi.getUsers(option))
            .pipe(switchMap(response => response.data || []), map((user) => {
            user.userImage = this.getUserProfileImageApi(user.id.toString());
            return of(user);
        }), combineAll(), defaultIfEmpty([]), catchError((err) => this.handleError(err)));
    }
    getWorkflowGroups(filter, groupId) {
        const option = { filter: filter };
        if (groupId) {
            option.groupId = groupId;
        }
        return from(this.groupsApi.getGroups(option))
            .pipe(map((response) => response.data || []), catchError((err) => this.handleError(err)));
    }
    getFormId(form) {
        let result = null;
        if (form && form.data && form.data.length > 0) {
            result = form.data[0].id;
        }
        return result;
    }
    toJson(res) {
        if (res) {
            return res || {};
        }
        return {};
    }
    toJsonArray(res) {
        if (res) {
            return res.data || [];
        }
        return [];
    }
    handleError(error) {
        let errMsg = FormService.UNKNOWN_ERROR_MESSAGE;
        if (error) {
            errMsg = (error.message) ? error.message :
                error.status ? `${error.status} - ${error.statusText}` : FormService.GENERIC_ERROR_MESSAGE;
        }
        this.logService.error(errMsg);
        return throwError(errMsg);
    }
}
FormService.ɵfac = function FormService_Factory(t) { return new (t || FormService)(ɵngcc0.ɵɵinject(ɵngcc1.EcmModelService), ɵngcc0.ɵɵinject(ɵngcc2.AlfrescoApiService), ɵngcc0.ɵɵinject(ɵngcc3.LogService)); };
FormService.UNKNOWN_ERROR_MESSAGE = 'Unknown error';
FormService.GENERIC_ERROR_MESSAGE = 'Server error';
FormService.ɵprov = i0.ɵɵdefineInjectable({ factory: function FormService_Factory() { return new FormService(i0.ɵɵinject(i1.EcmModelService), i0.ɵɵinject(i2.AlfrescoApiService), i0.ɵɵinject(i3.LogService)); }, token: FormService, providedIn: "root" });
FormService.ctorParameters = () => [
    { type: EcmModelService },
    { type: AlfrescoApiService },
    { type: LogService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(FormService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.EcmModelService }, { type: ɵngcc2.AlfrescoApiService }, { type: ɵngcc3.LogService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS5zZXJ2aWNlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9ob21lL3RyYXZpcy9idWlsZC9BbGZyZXNjby9hbGZyZXNjby1uZzItY29tcG9uZW50cy9saWIvY29yZS9mb3JtL3NlcnZpY2VzL2Zvcm0uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFpQkEsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDekUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRXhELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDakUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFHdEUsT0FBTyxFQUFFLFNBQVMsRUFBb0IsZ0JBQWdCLEVBQWMsTUFBTSxvQ0FBb0MsQ0FBQztBQUsvRyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxjQUFjLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4RixPQUFPLEVBRUgsU0FBUyxFQUNULDJCQUEyQixFQUUzQixRQUFRLEVBQ1IsWUFBWSxFQUNaLG1CQUFtQixFQUNuQixhQUFhLEVBQ2IscUJBQXFCLEVBQ3JCLFFBQVEsRUFDUixpQkFBaUIsRUFDcEIsTUFBTSxrQkFBa0IsQ0FBQztBQUMxQjtBQUVzQjtBQUlYO0FBQ0Q7Ozs7O0FBSFYsTUFBTSxPQUFPLFdBQVc7QUFDeEIsSUE0RUksWUFBb0IsZUFBZ0MsRUFDaEMsVUFBOEIsRUFDNUIsVUFBc0I7QUFDaEQsUUFId0Isb0JBQWUsR0FBZixlQUFlLENBQWlC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LyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQWxmcmVzY29BcGlTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvYWxmcmVzY28tYXBpLnNlcnZpY2UnO1xuaW1wb3J0IHsgTG9nU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2xvZy5zZXJ2aWNlJztcbmltcG9ydCB7IFVzZXJQcm9jZXNzTW9kZWwgfSBmcm9tICcuLi8uLi9tb2RlbHMnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgZnJvbSwgb2YsIHRocm93RXJyb3IgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEZvcm1EZWZpbml0aW9uTW9kZWwgfSBmcm9tICcuLi9tb2RlbHMvZm9ybS1kZWZpbml0aW9uLm1vZGVsJztcbmltcG9ydCB7IENvbnRlbnRMaW5rTW9kZWwgfSBmcm9tICcuLy4uL2NvbXBvbmVudHMvd2lkZ2V0cy9jb3JlL2NvbnRlbnQtbGluay5tb2RlbCc7XG5pbXBvcnQgeyBHcm91cE1vZGVsIH0gZnJvbSAnLi8uLi9jb21wb25lbnRzL3dpZGdldHMvY29yZS9ncm91cC5tb2RlbCc7XG5pbXBvcnQgeyBGb3JtTW9kZWwsIEZvcm1PdXRjb21lRXZlbnQsIEZvcm1PdXRjb21lTW9kZWwsIEZvcm1WYWx1ZXMgfSBmcm9tICcuLy4uL2NvbXBvbmVudHMvd2lkZ2V0cy9jb3JlL2luZGV4JztcbmltcG9ydCB7XG4gICAgRm9ybUVycm9yRXZlbnQsIEZvcm1FdmVudCwgRm9ybUZpZWxkRXZlbnQsXG4gICAgVmFsaWRhdGVEeW5hbWljVGFibGVSb3dFdmVudCwgVmFsaWRhdGVGb3JtRXZlbnQsIFZhbGlkYXRlRm9ybUZpZWxkRXZlbnRcbn0gZnJvbSAnLi8uLi9ldmVudHMvaW5kZXgnO1xuaW1wb3J0IHsgRWNtTW9kZWxTZXJ2aWNlIH0gZnJvbSAnLi9lY20tbW9kZWwuc2VydmljZSc7XG5pbXBvcnQgeyBtYXAsIGNhdGNoRXJyb3IsIHN3aXRjaE1hcCwgY29tYmluZUFsbCwgZGVmYXVsdElmRW1wdHkgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge1xuICAgIENvbXBsZXRlRm9ybVJlcHJlc2VudGF0aW9uLFxuICAgIE1vZGVsc0FwaSxcbiAgICBQcm9jZXNzSW5zdGFuY2VWYXJpYWJsZXNBcGksXG4gICAgU2F2ZUZvcm1SZXByZXNlbnRhdGlvbixcbiAgICBUYXNrc0FwaSxcbiAgICBUYXNrRm9ybXNBcGksXG4gICAgUHJvY2Vzc0luc3RhbmNlc0FwaSxcbiAgICBGb3JtTW9kZWxzQXBpLFxuICAgIFByb2Nlc3NEZWZpbml0aW9uc0FwaSxcbiAgICBVc2Vyc0FwaSxcbiAgICBBY3Rpdml0aUdyb3Vwc0FwaVxufSBmcm9tICdAYWxmcmVzY28vanMtYXBpJztcblxuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBGb3JtU2VydmljZSB7XG5cbiAgICBzdGF0aWMgVU5LTk9XTl9FUlJPUl9NRVNTQUdFOiBzdHJpbmcgPSAnVW5rbm93biBlcnJvcic7XG4gICAgc3RhdGljIEdFTkVSSUNfRVJST1JfTUVTU0FHRTogc3RyaW5nID0gJ1NlcnZlciBlcnJvcic7XG5cbiAgICBfdGFza0Zvcm1zQXBpOiBUYXNrRm9ybXNBcGk7XG4gICAgZ2V0IHRhc2tGb3Jtc0FwaSgpOiBUYXNrRm9ybXNBcGkge1xuICAgICAgICB0aGlzLl90YXNrRm9ybXNBcGkgPSB0aGlzLl90YXNrRm9ybXNBcGkgPz8gbmV3IFRhc2tGb3Jtc0FwaSh0aGlzLmFwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKSk7XG4gICAgICAgIHJldHVybiB0aGlzLl90YXNrRm9ybXNBcGk7XG4gICAgfVxuXG4gICAgX3Rhc2tBcGk6IFRhc2tzQXBpO1xuICAgIGdldCB0YXNrQXBpKCk6IFRhc2tzQXBpIHtcbiAgICAgICAgdGhpcy5fdGFza0FwaSA9IHRoaXMuX3Rhc2tBcGkgPz8gbmV3IFRhc2tzQXBpKHRoaXMuYXBpU2VydmljZS5nZXRJbnN0YW5jZSgpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Rhc2tBcGk7XG4gICAgfVxuXG4gICAgX21vZGVsc0FwaTogTW9kZWxzQXBpO1xuICAgIGdldCBtb2RlbHNBcGkoKTogTW9kZWxzQXBpIHtcbiAgICAgICAgdGhpcy5fbW9kZWxzQXBpID0gdGhpcy5fbW9kZWxzQXBpID8/IG5ldyBNb2RlbHNBcGkodGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5fbW9kZWxzQXBpO1xuICAgIH1cblxuICAgIF9lZGl0b3JBcGk6IEZvcm1Nb2RlbHNBcGk7XG4gICAgZ2V0IGVkaXRvckFwaSgpOiBGb3JtTW9kZWxzQXBpIHtcbiAgICAgICAgdGhpcy5fZWRpdG9yQXBpID0gdGhpcy5fZWRpdG9yQXBpID8/IG5ldyBGb3JtTW9kZWxzQXBpKHRoaXMuYXBpU2VydmljZS5nZXRJbnN0YW5jZSgpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VkaXRvckFwaTtcbiAgICB9XG5cbiAgICBfcHJvY2Vzc0RlZmluaXRpb25zQXBpOiBQcm9jZXNzRGVmaW5pdGlvbnNBcGk7XG4gICAgZ2V0IHByb2Nlc3NEZWZpbml0aW9uc0FwaSgpOiBQcm9jZXNzRGVmaW5pdGlvbnNBcGkge1xuICAgICAgICB0aGlzLl9wcm9jZXNzRGVmaW5pdGlvbnNBcGkgPSB0aGlzLl9wcm9jZXNzRGVmaW5pdGlvbnNBcGkgPz8gbmV3IFByb2Nlc3NEZWZpbml0aW9uc0FwaSh0aGlzLmFwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9wcm9jZXNzRGVmaW5pdGlvbnNBcGk7XG4gICAgfVxuXG4gICAgX3Byb2Nlc3NJbnN0YW5jZVZhcmlhYmxlc0FwaTogUHJvY2Vzc0luc3RhbmNlVmFyaWFibGVzQXBpO1xuICAgIGdldCBwcm9jZXNzSW5zdGFuY2VWYXJpYWJsZXNBcGkoKTogUHJvY2Vzc0luc3RhbmNlVmFyaWFibGVzQXBpIHtcbiAgICAgICAgdGhpcy5fcHJvY2Vzc0luc3RhbmNlVmFyaWFibGVzQXBpID0gdGhpcy5fcHJvY2Vzc0luc3RhbmNlVmFyaWFibGVzQXBpID8/IG5ldyBQcm9jZXNzSW5zdGFuY2VWYXJpYWJsZXNBcGkodGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5fcHJvY2Vzc0luc3RhbmNlVmFyaWFibGVzQXBpO1xuICAgIH1cblxuICAgIF9wcm9jZXNzSW5zdGFuY2VzQXBpOiBQcm9jZXNzSW5zdGFuY2VzQXBpO1xuICAgIGdldCBwcm9jZXNzSW5zdGFuY2VzQXBpKCk6IFByb2Nlc3NJbnN0YW5jZXNBcGkge1xuICAgICAgICB0aGlzLl9wcm9jZXNzSW5zdGFuY2VzQXBpID0gdGhpcy5fcHJvY2Vzc0luc3RhbmNlc0FwaSA/PyBuZXcgUHJvY2Vzc0luc3RhbmNlc0FwaSh0aGlzLmFwaVNlcnZpY2UuZ2V0SW5zdGFuY2UoKSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9wcm9jZXNzSW5zdGFuY2VzQXBpO1xuICAgIH1cblxuICAgIF9ncm91cHNBcGk6IEFjdGl2aXRpR3JvdXBzQXBpO1xuICAgIGdldCBncm91cHNBcGkoKTogQWN0aXZpdGlHcm91cHNBcGkge1xuICAgICAgICB0aGlzLl9ncm91cHNBcGkgPSB0aGlzLl9ncm91cHNBcGkgPz8gbmV3IEFjdGl2aXRpR3JvdXBzQXBpKHRoaXMuYXBpU2VydmljZS5nZXRJbnN0YW5jZSgpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dyb3Vwc0FwaTtcbiAgICB9XG5cbiAgICBfdXNlcnNBcGk6IFVzZXJzQXBpO1xuICAgIGdldCB1c2Vyc0FwaSgpOiBVc2Vyc0FwaSB7XG4gICAgICAgIHRoaXMuX3VzZXJzQXBpID0gdGhpcy5fdXNlcnNBcGkgPz8gbmV3IFVzZXJzQXBpKHRoaXMuYXBpU2VydmljZS5nZXRJbnN0YW5jZSgpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJzQXBpO1xuICAgIH1cblxuICAgIGZvcm1Mb2FkZWQgPSBuZXcgU3ViamVjdDxGb3JtRXZlbnQ+KCk7XG4gICAgZm9ybURhdGFSZWZyZXNoZWQgPSBuZXcgU3ViamVjdDxGb3JtRXZlbnQ+KCk7XG4gICAgZm9ybUZpZWxkVmFsdWVDaGFuZ2VkID0gbmV3IFN1YmplY3Q8Rm9ybUZpZWxkRXZlbnQ+KCk7XG4gICAgZm9ybUV2ZW50cyA9IG5ldyBTdWJqZWN0PEV2ZW50PigpO1xuICAgIHRhc2tDb21wbGV0ZWQgPSBuZXcgU3ViamVjdDxGb3JtRXZlbnQ+KCk7XG4gICAgdGFza0NvbXBsZXRlZEVycm9yID0gbmV3IFN1YmplY3Q8Rm9ybUVycm9yRXZlbnQ+KCk7XG4gICAgdGFza1NhdmVkID0gbmV3IFN1YmplY3Q8Rm9ybUV2ZW50PigpO1xuICAgIHRhc2tTYXZlZEVycm9yID0gbmV3IFN1YmplY3Q8Rm9ybUVycm9yRXZlbnQ+KCk7XG4gICAgZm9ybUNvbnRlbnRDbGlja2VkID0gbmV3IFN1YmplY3Q8Q29udGVudExpbmtNb2RlbD4oKTtcblxuICAgIHZhbGlkYXRlRm9ybSA9IG5ldyBTdWJqZWN0PFZhbGlkYXRlRm9ybUV2ZW50PigpO1xuICAgIHZhbGlkYXRlRm9ybUZpZWxkID0gbmV3IFN1YmplY3Q8VmFsaWRhdGVGb3JtRmllbGRFdmVudD4oKTtcbiAgICB2YWxpZGF0ZUR5bmFtaWNUYWJsZVJvdyA9IG5ldyBTdWJqZWN0PFZhbGlkYXRlRHluYW1pY1RhYmxlUm93RXZlbnQ+KCk7XG5cbiAgICBleGVjdXRlT3V0Y29tZSA9IG5ldyBTdWJqZWN0PEZvcm1PdXRjb21lRXZlbnQ+KCk7XG5cbiAgICB1cGRhdGVGb3JtVmFsdWVzUmVxdWVzdGVkID0gbmV3IFN1YmplY3Q8Rm9ybVZhbHVlcz4oKTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWNtTW9kZWxTZXJ2aWNlOiBFY21Nb2RlbFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhcGlTZXJ2aWNlOiBBbGZyZXNjb0FwaVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJvdGVjdGVkIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UpIHtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgSlNPTiBkYXRhIHRvIGNyZWF0ZSBhIGNvcnJlc3BvbmRpbmcgRm9ybSBtb2RlbC5cbiAgICAgKiBAcGFyYW0ganNvbiBKU09OIHRvIGNyZWF0ZSB0aGUgZm9ybVxuICAgICAqIEBwYXJhbSBkYXRhIFZhbHVlcyBmb3IgdGhlIGZvcm0gZmllbGRzXG4gICAgICogQHBhcmFtIHJlYWRPbmx5IFNob3VsZCB0aGUgZm9ybSBmaWVsZHMgYmUgcmVhZC1vbmx5P1xuICAgICAqIEBwYXJhbSBmaXhlZFNwYWNlXG4gICAgICogQHJldHVybnMgRm9ybSBtb2RlbCBjcmVhdGVkIGZyb20gaW5wdXQgZGF0YVxuICAgICAqL1xuICAgIHBhcnNlRm9ybShqc29uOiBhbnksIGRhdGE/OiBGb3JtVmFsdWVzLCByZWFkT25seTogYm9vbGVhbiA9IGZhbHNlLCBmaXhlZFNwYWNlPzogYm9vbGVhbik6IEZvcm1Nb2RlbCB7XG4gICAgICAgIGlmIChqc29uKSB7XG4gICAgICAgICAgICBjb25zdCBmb3JtID0gbmV3IEZvcm1Nb2RlbChqc29uLCBkYXRhLCByZWFkT25seSwgdGhpcywgZml4ZWRTcGFjZSk7XG4gICAgICAgICAgICBpZiAoIWpzb24uZmllbGRzKSB7XG4gICAgICAgICAgICAgICAgZm9ybS5vdXRjb21lcyA9IFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IEZvcm1PdXRjb21lTW9kZWwoPGFueT4gZm9ybSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICckc2F2ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBGb3JtT3V0Y29tZU1vZGVsLlNBVkVfQUNUSU9OLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNTeXN0ZW06IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZvcm07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIEZvcm0gd2l0aCBhIGZpZWxkIGZvciBlYWNoIG1ldGFkYXRhIHByb3BlcnR5LlxuICAgICAqIEBwYXJhbSBmb3JtTmFtZSBOYW1lIG9mIHRoZSBuZXcgZm9ybVxuICAgICAqIEByZXR1cm5zIFRoZSBuZXcgZm9ybVxuICAgICAqL1xuICAgIGNyZWF0ZUZvcm1Gcm9tQU5vZGUoZm9ybU5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZSgob2JzZXJ2ZXIpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlRm9ybShmb3JtTmFtZSkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgIChmb3JtKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWNtTW9kZWxTZXJ2aWNlLnNlYXJjaEVjbVR5cGUoZm9ybU5hbWUsIEVjbU1vZGVsU2VydmljZS5NT0RFTF9OQU1FKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgICAgICAgICAoY3VzdG9tVHlwZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvcm1EZWZpbml0aW9uTW9kZWwgPSBuZXcgRm9ybURlZmluaXRpb25Nb2RlbChmb3JtLmlkLCBmb3JtLm5hbWUsIGZvcm0ubGFzdFVwZGF0ZWRCeUZ1bGxOYW1lLCBmb3JtLmxhc3RVcGRhdGVkLCBjdXN0b21UeXBlLmVudHJ5LnByb3BlcnRpZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yQXBpLnNhdmVGb3JtKGZvcm0uaWQsIGZvcm1EZWZpbml0aW9uTW9kZWwpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKS5zdWJzY3JpYmUoKGZvcm1EYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoZm9ybURhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIEZvcm0uXG4gICAgICogQHBhcmFtIGZvcm1OYW1lIE5hbWUgb2YgdGhlIG5ldyBmb3JtXG4gICAgICogQHJldHVybnMgVGhlIG5ldyBmb3JtXG4gICAgICovXG4gICAgY3JlYXRlRm9ybShmb3JtTmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgY29uc3QgZGF0YU1vZGVsID0ge1xuICAgICAgICAgICAgbmFtZTogZm9ybU5hbWUsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgICAgICAgICBtb2RlbFR5cGU6IDIsXG4gICAgICAgICAgICBzdGVuY2lsU2V0OiAwXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGZyb20oXG4gICAgICAgICAgICB0aGlzLm1vZGVsc0FwaS5jcmVhdGVNb2RlbChkYXRhTW9kZWwpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2F2ZXMgYSBmb3JtLlxuICAgICAqIEBwYXJhbSBmb3JtSWQgSUQgb2YgdGhlIGZvcm0gdG8gc2F2ZVxuICAgICAqIEBwYXJhbSBmb3JtTW9kZWwgTW9kZWwgZGF0YSBmb3IgdGhlIGZvcm1cbiAgICAgKiBAcmV0dXJucyBEYXRhIGZvciB0aGUgc2F2ZWQgZm9ybVxuICAgICAqL1xuICAgIHNhdmVGb3JtKGZvcm1JZDogbnVtYmVyLCBmb3JtTW9kZWw6IEZvcm1EZWZpbml0aW9uTW9kZWwpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICByZXR1cm4gZnJvbShcbiAgICAgICAgICAgIHRoaXMuZWRpdG9yQXBpLnNhdmVGb3JtKGZvcm1JZCwgZm9ybU1vZGVsKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlYXJjaGVzIGZvciBhIGZvcm0gYnkgbmFtZS5cbiAgICAgKiBAcGFyYW0gbmFtZSBUaGUgZm9ybSBuYW1lIHRvIHNlYXJjaCBmb3JcbiAgICAgKiBAcmV0dXJucyBGb3JtIG1vZGVsKHMpIG1hdGNoaW5nIHRoZSBzZWFyY2ggbmFtZVxuICAgICAqL1xuICAgIHNlYXJjaEZyb20obmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgICAgICAgICdtb2RlbFR5cGUnOiAyXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGZyb20oXG4gICAgICAgICAgICB0aGlzLm1vZGVsc0FwaS5nZXRNb2RlbHMob3B0cylcbiAgICAgICAgKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKGZ1bmN0aW9uIChmb3JtczogYW55KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmb3Jtcy5kYXRhLmZpbmQoKGZvcm1EYXRhKSA9PiBmb3JtRGF0YS5uYW1lID09PSBuYW1lKTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhbGwgdGhlIGZvcm1zLlxuICAgICAqIEByZXR1cm5zIExpc3Qgb2YgZm9ybSBtb2RlbHNcbiAgICAgKi9cbiAgICBnZXRGb3JtcygpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICBjb25zdCBvcHRzID0ge1xuICAgICAgICAgICAgJ21vZGVsVHlwZSc6IDJcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLm1vZGVsc0FwaS5nZXRNb2RlbHMob3B0cykpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAodGhpcy50b0pzb25BcnJheSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgcHJvY2VzcyBkZWZpbml0aW9ucy5cbiAgICAgKiBAcmV0dXJucyBMaXN0IG9mIHByb2Nlc3MgZGVmaW5pdGlvbnNcbiAgICAgKi9cbiAgICBnZXRQcm9jZXNzRGVmaW5pdGlvbnMoKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5wcm9jZXNzRGVmaW5pdGlvbnNBcGkuZ2V0UHJvY2Vzc0RlZmluaXRpb25zKHt9KSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCh0aGlzLnRvSnNvbkFycmF5KSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBpbnN0YW5jZSB2YXJpYWJsZXMgZm9yIGEgcHJvY2Vzcy5cbiAgICAgKiBAcGFyYW0gcHJvY2Vzc0luc3RhbmNlSWQgSUQgb2YgdGhlIHRhcmdldCBwcm9jZXNzXG4gICAgICogQHJldHVybnMgTGlzdCBvZiBpbnN0YW5jZSB2YXJpYWJsZSBpbmZvcm1hdGlvblxuICAgICAqL1xuICAgIGdldFByb2Nlc3NWYXJpYWJsZXNCeUlkKHByb2Nlc3NJbnN0YW5jZUlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueVtdPiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMucHJvY2Vzc0luc3RhbmNlVmFyaWFibGVzQXBpLmdldFByb2Nlc3NJbnN0YW5jZVZhcmlhYmxlcyhwcm9jZXNzSW5zdGFuY2VJZCkpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAodGhpcy50b0pzb24pLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIGFsbCB0aGUgdGFza3MuXG4gICAgICogQHJldHVybnMgTGlzdCBvZiB0YXNrc1xuICAgICAqL1xuICAgIGdldFRhc2tzKCk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMudGFza0FwaS5saXN0VGFza3Moe30pKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKHRoaXMudG9Kc29uQXJyYXkpLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIGEgdGFzay5cbiAgICAgKiBAcGFyYW0gdGFza0lkIFRhc2sgSWRcbiAgICAgKiBAcmV0dXJucyBUYXNrIGluZm9cbiAgICAgKi9cbiAgICBnZXRUYXNrKHRhc2tJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy50YXNrQXBpLmdldFRhc2sodGFza0lkKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCh0aGlzLnRvSnNvbiksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNhdmVzIGEgdGFzayBmb3JtLlxuICAgICAqIEBwYXJhbSB0YXNrSWQgVGFzayBJZFxuICAgICAqIEBwYXJhbSBmb3JtVmFsdWVzIEZvcm0gVmFsdWVzXG4gICAgICogQHJldHVybnMgTnVsbCByZXNwb25zZSB3aGVuIHRoZSBvcGVyYXRpb24gaXMgY29tcGxldGVcbiAgICAgKi9cbiAgICBzYXZlVGFza0Zvcm0odGFza0lkOiBzdHJpbmcsIGZvcm1WYWx1ZXM6IEZvcm1WYWx1ZXMpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICBjb25zdCBzYXZlRm9ybVJlcHJlc2VudGF0aW9uID0gPFNhdmVGb3JtUmVwcmVzZW50YXRpb24+IHsgdmFsdWVzOiBmb3JtVmFsdWVzIH07XG5cbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy50YXNrRm9ybXNBcGkuc2F2ZVRhc2tGb3JtKHRhc2tJZCwgc2F2ZUZvcm1SZXByZXNlbnRhdGlvbikpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29tcGxldGVzIGEgVGFzayBGb3JtLlxuICAgICAqIEBwYXJhbSB0YXNrSWQgVGFzayBJZFxuICAgICAqIEBwYXJhbSBmb3JtVmFsdWVzIEZvcm0gVmFsdWVzXG4gICAgICogQHBhcmFtIG91dGNvbWUgRm9ybSBPdXRjb21lXG4gICAgICogQHJldHVybnMgTnVsbCByZXNwb25zZSB3aGVuIHRoZSBvcGVyYXRpb24gaXMgY29tcGxldGVcbiAgICAgKi9cbiAgICBjb21wbGV0ZVRhc2tGb3JtKHRhc2tJZDogc3RyaW5nLCBmb3JtVmFsdWVzOiBGb3JtVmFsdWVzLCBvdXRjb21lPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgY29uc3QgY29tcGxldGVGb3JtUmVwcmVzZW50YXRpb246IGFueSA9IDxDb21wbGV0ZUZvcm1SZXByZXNlbnRhdGlvbj4geyB2YWx1ZXM6IGZvcm1WYWx1ZXMgfTtcbiAgICAgICAgaWYgKG91dGNvbWUpIHtcbiAgICAgICAgICAgIGNvbXBsZXRlRm9ybVJlcHJlc2VudGF0aW9uLm91dGNvbWUgPSBvdXRjb21lO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy50YXNrRm9ybXNBcGkuY29tcGxldGVUYXNrRm9ybSh0YXNrSWQsIGNvbXBsZXRlRm9ybVJlcHJlc2VudGF0aW9uKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIGEgZm9ybSByZWxhdGVkIHRvIGEgdGFzay5cbiAgICAgKiBAcGFyYW0gdGFza0lkIElEIG9mIHRoZSB0YXJnZXQgdGFza1xuICAgICAqIEByZXR1cm5zIEZvcm0gZGVmaW5pdGlvblxuICAgICAqL1xuICAgIGdldFRhc2tGb3JtKHRhc2tJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy50YXNrRm9ybXNBcGkuZ2V0VGFza0Zvcm0odGFza0lkKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCh0aGlzLnRvSnNvbiksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgYSBmb3JtIGRlZmluaXRpb24uXG4gICAgICogQHBhcmFtIGZvcm1JZCBJRCBvZiB0aGUgdGFyZ2V0IGZvcm1cbiAgICAgKiBAcmV0dXJucyBGb3JtIGRlZmluaXRpb25cbiAgICAgKi9cbiAgICBnZXRGb3JtRGVmaW5pdGlvbkJ5SWQoZm9ybUlkOiBudW1iZXIpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmVkaXRvckFwaS5nZXRGb3JtKGZvcm1JZCkpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAodGhpcy50b0pzb24pLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBmb3JtIGRlZmluaXRpb24gd2l0aCBhIGdpdmVuIG5hbWUuXG4gICAgICogQHBhcmFtIG5hbWUgVGhlIGZvcm0gbmFtZVxuICAgICAqIEByZXR1cm5zIEZvcm0gZGVmaW5pdGlvblxuICAgICAqL1xuICAgIGdldEZvcm1EZWZpbml0aW9uQnlOYW1lKG5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICAgICAgICAnZmlsdGVyJzogJ215UmV1c2FibGVGb3JtcycsXG4gICAgICAgICAgICAnZmlsdGVyVGV4dCc6IG5hbWUsXG4gICAgICAgICAgICAnbW9kZWxUeXBlJzogMlxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMubW9kZWxzQXBpLmdldE1vZGVscyhvcHRzKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCh0aGlzLmdldEZvcm1JZCksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHN0YXJ0IGZvcm0gaW5zdGFuY2UgZm9yIGEgZ2l2ZW4gcHJvY2Vzcy5cbiAgICAgKiBAcGFyYW0gcHJvY2Vzc0lkIFByb2Nlc3MgZGVmaW5pdGlvbiBJRFxuICAgICAqIEByZXR1cm5zIEZvcm0gZGVmaW5pdGlvblxuICAgICAqL1xuICAgIGdldFN0YXJ0Rm9ybUluc3RhbmNlKHByb2Nlc3NJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5wcm9jZXNzSW5zdGFuY2VzQXBpLmdldFByb2Nlc3NJbnN0YW5jZVN0YXJ0Rm9ybShwcm9jZXNzSWQpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKHRoaXMudG9Kc29uKSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhIHByb2Nlc3MgaW5zdGFuY2UuXG4gICAgICogQHBhcmFtIHByb2Nlc3NJZCBJRCBvZiB0aGUgcHJvY2VzcyB0byBnZXRcbiAgICAgKiBAcmV0dXJucyBQcm9jZXNzIGluc3RhbmNlXG4gICAgICovXG4gICAgZ2V0UHJvY2Vzc0luc3RhbmNlKHByb2Nlc3NJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5wcm9jZXNzSW5zdGFuY2VzQXBpLmdldFByb2Nlc3NJbnN0YW5jZShwcm9jZXNzSWQpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKHRoaXMudG9Kc29uKSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgc3RhcnQgZm9ybSBkZWZpbml0aW9uIGZvciBhIGdpdmVuIHByb2Nlc3MuXG4gICAgICogQHBhcmFtIHByb2Nlc3NJZCBQcm9jZXNzIGRlZmluaXRpb24gSURcbiAgICAgKiBAcmV0dXJucyBGb3JtIGRlZmluaXRpb25cbiAgICAgKi9cbiAgICBnZXRTdGFydEZvcm1EZWZpbml0aW9uKHByb2Nlc3NJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5wcm9jZXNzRGVmaW5pdGlvbnNBcGkuZ2V0UHJvY2Vzc0RlZmluaXRpb25TdGFydEZvcm0ocHJvY2Vzc0lkKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCh0aGlzLnRvSnNvbiksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgdmFsdWVzIG9mIGZpZWxkcyBwb3B1bGF0ZWQgYnkgYSBSRVNUIGJhY2tlbmQuXG4gICAgICogQHBhcmFtIHRhc2tJZCBUYXNrIGlkZW50aWZpZXJcbiAgICAgKiBAcGFyYW0gZmllbGQgRmllbGQgaWRlbnRpZmllclxuICAgICAqIEByZXR1cm5zIEZpZWxkIHZhbHVlc1xuICAgICAqL1xuICAgIGdldFJlc3RGaWVsZFZhbHVlcyh0YXNrSWQ6IHN0cmluZywgZmllbGQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMudGFza0Zvcm1zQXBpLmdldFJlc3RGaWVsZFZhbHVlcyh0YXNrSWQsIGZpZWxkKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHZhbHVlcyBvZiBmaWVsZHMgcG9wdWxhdGVkIGJ5IGEgUkVTVCBiYWNrZW5kIHVzaW5nIGEgcHJvY2VzcyBJRC5cbiAgICAgKiBAcGFyYW0gcHJvY2Vzc0RlZmluaXRpb25JZCBQcm9jZXNzIGlkZW50aWZpZXJcbiAgICAgKiBAcGFyYW0gZmllbGQgRmllbGQgaWRlbnRpZmllclxuICAgICAqIEByZXR1cm5zIEZpZWxkIHZhbHVlc1xuICAgICAqL1xuICAgIGdldFJlc3RGaWVsZFZhbHVlc0J5UHJvY2Vzc0lkKHByb2Nlc3NEZWZpbml0aW9uSWQ6IHN0cmluZywgZmllbGQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMucHJvY2Vzc0RlZmluaXRpb25zQXBpLmdldFJlc3RGaWVsZFZhbHVlcyhwcm9jZXNzRGVmaW5pdGlvbklkLCBmaWVsZCkpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBjb2x1bW4gdmFsdWVzIG9mIGZpZWxkcyBwb3B1bGF0ZWQgYnkgYSBSRVNUIGJhY2tlbmQgdXNpbmcgYSBwcm9jZXNzIElELlxuICAgICAqIEBwYXJhbSBwcm9jZXNzRGVmaW5pdGlvbklkIFByb2Nlc3MgaWRlbnRpZmllclxuICAgICAqIEBwYXJhbSBmaWVsZCBGaWVsZCBpZGVudGlmaWVyXG4gICAgICogQHBhcmFtIGNvbHVtbiBDb2x1bW4gaWRlbnRpZmllclxuICAgICAqIEByZXR1cm5zIEZpZWxkIHZhbHVlc1xuICAgICAqL1xuICAgIGdldFJlc3RGaWVsZFZhbHVlc0NvbHVtbkJ5UHJvY2Vzc0lkKHByb2Nlc3NEZWZpbml0aW9uSWQ6IHN0cmluZywgZmllbGQ6IHN0cmluZywgY29sdW1uPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5wcm9jZXNzRGVmaW5pdGlvbnNBcGkuZ2V0UmVzdFRhYmxlRmllbGRWYWx1ZXMocHJvY2Vzc0RlZmluaXRpb25JZCwgZmllbGQsIGNvbHVtbikpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnIpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBjb2x1bW4gdmFsdWVzIG9mIGZpZWxkcyBwb3B1bGF0ZWQgYnkgYSBSRVNUIGJhY2tlbmQuXG4gICAgICogQHBhcmFtIHRhc2tJZCBUYXNrIGlkZW50aWZpZXJcbiAgICAgKiBAcGFyYW0gZmllbGQgRmllbGQgaWRlbnRpZmllclxuICAgICAqIEBwYXJhbSBjb2x1bW4gQ29sdW1uIGlkZW50aWZpZXJcbiAgICAgKiBAcmV0dXJucyBGaWVsZCB2YWx1ZXNcbiAgICAgKi9cbiAgICBnZXRSZXN0RmllbGRWYWx1ZXNDb2x1bW4odGFza0lkOiBzdHJpbmcsIGZpZWxkOiBzdHJpbmcsIGNvbHVtbj86IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMudGFza0Zvcm1zQXBpLmdldFJlc3RGaWVsZENvbHVtblZhbHVlcyh0YXNrSWQsIGZpZWxkLCBjb2x1bW4pKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBVUkwgZm9yIHRoZSBwcm9maWxlIHBpY3R1cmUgb2YgYSB1c2VyLlxuICAgICAqIEBwYXJhbSB1c2VySWQgSUQgb2YgdGhlIHRhcmdldCB1c2VyXG4gICAgICogQHJldHVybnMgVVJMIHN0cmluZ1xuICAgICAqL1xuICAgIGdldFVzZXJQcm9maWxlSW1hZ2VBcGkodXNlcklkOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy51c2Vyc0FwaS5nZXRVc2VyUHJvZmlsZVBpY3R1cmVVcmwodXNlcklkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIGEgbGlzdCBvZiB3b3JrZmxvdyB1c2Vycy5cbiAgICAgKiBAcGFyYW0gZmlsdGVyIEZpbHRlciB0byBzZWxlY3Qgc3BlY2lmaWMgdXNlcnNcbiAgICAgKiBAcGFyYW0gZ3JvdXBJZCBHcm91cCBJRCBmb3IgdGhlIHNlYXJjaFxuICAgICAqIEByZXR1cm5zIEFycmF5IG9mIHVzZXJzXG4gICAgICovXG4gICAgZ2V0V29ya2Zsb3dVc2VycyhmaWx0ZXI6IHN0cmluZywgZ3JvdXBJZD86IHN0cmluZyk6IE9ic2VydmFibGU8VXNlclByb2Nlc3NNb2RlbFtdPiB7XG4gICAgICAgIGNvbnN0IG9wdGlvbjogYW55ID0geyBmaWx0ZXI6IGZpbHRlciB9O1xuICAgICAgICBpZiAoZ3JvdXBJZCkge1xuICAgICAgICAgICAgb3B0aW9uLmdyb3VwSWQgPSBncm91cElkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMudXNlcnNBcGkuZ2V0VXNlcnMob3B0aW9uKSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIHN3aXRjaE1hcChyZXNwb25zZSA9PiA8VXNlclByb2Nlc3NNb2RlbFtdPiByZXNwb25zZS5kYXRhIHx8IFtdKSxcbiAgICAgICAgICAgICAgICBtYXAoKHVzZXIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlci51c2VySW1hZ2UgPSB0aGlzLmdldFVzZXJQcm9maWxlSW1hZ2VBcGkodXNlci5pZC50b1N0cmluZygpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHVzZXIpO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNvbWJpbmVBbGwoKSxcbiAgICAgICAgICAgICAgICBkZWZhdWx0SWZFbXB0eShbXSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgYSBsaXN0IG9mIGdyb3VwcyBpbiBhIHdvcmtmbG93LlxuICAgICAqIEBwYXJhbSBmaWx0ZXIgRmlsdGVyIHRvIHNlbGVjdCBzcGVjaWZpYyBncm91cHNcbiAgICAgKiBAcGFyYW0gZ3JvdXBJZCBHcm91cCBJRCBmb3IgdGhlIHNlYXJjaFxuICAgICAqIEByZXR1cm5zIEFycmF5IG9mIGdyb3Vwc1xuICAgICAqL1xuICAgIGdldFdvcmtmbG93R3JvdXBzKGZpbHRlcjogc3RyaW5nLCBncm91cElkPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxHcm91cE1vZGVsW10+IHtcbiAgICAgICAgY29uc3Qgb3B0aW9uOiBhbnkgPSB7IGZpbHRlcjogZmlsdGVyIH07XG4gICAgICAgIGlmIChncm91cElkKSB7XG4gICAgICAgICAgICBvcHRpb24uZ3JvdXBJZCA9IGdyb3VwSWQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5ncm91cHNBcGkuZ2V0R3JvdXBzKG9wdGlvbikpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKHJlc3BvbnNlOiBhbnkpID0+IDxHcm91cE1vZGVsW10+IHJlc3BvbnNlLmRhdGEgfHwgW10pLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBJRCBvZiBhIGZvcm0uXG4gICAgICogQHBhcmFtIGZvcm0gT2JqZWN0IHJlcHJlc2VudGluZyBhIGZvcm1cbiAgICAgKiBAcmV0dXJucyBJRCBzdHJpbmdcbiAgICAgKi9cbiAgICBnZXRGb3JtSWQoZm9ybTogYW55KTogc3RyaW5nIHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IG51bGw7XG5cbiAgICAgICAgaWYgKGZvcm0gJiYgZm9ybS5kYXRhICYmIGZvcm0uZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXN1bHQgPSBmb3JtLmRhdGFbMF0uaWQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIGZvcm0gZGF0YS5cbiAgICAgKiBAcGFyYW0gcmVzIE9iamVjdCByZXByZXNlbnRpbmcgZm9ybSBkYXRhXG4gICAgICogQHJldHVybnMgSlNPTiBkYXRhXG4gICAgICovXG4gICAgdG9Kc29uKHJlczogYW55KSB7XG4gICAgICAgIGlmIChyZXMpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMgfHwge307XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHt9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBKU09OIGFycmF5IHJlcHJlc2VudGF0aW9uIG9mIGZvcm0gZGF0YS5cbiAgICAgKiBAcGFyYW0gcmVzIE9iamVjdCByZXByZXNlbnRpbmcgZm9ybSBkYXRhXG4gICAgICogQHJldHVybnMgSlNPTiBkYXRhXG4gICAgICovXG4gICAgdG9Kc29uQXJyYXkocmVzOiBhbnkpIHtcbiAgICAgICAgaWYgKHJlcykge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5kYXRhIHx8IFtdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXBvcnRzIGFuIGVycm9yIG1lc3NhZ2UuXG4gICAgICogQHBhcmFtIGVycm9yIERhdGEgb2JqZWN0IHdpdGggb3B0aW9uYWwgYG1lc3NhZ2VgIGFuZCBgc3RhdHVzYCBmaWVsZHMgZm9yIHRoZSBlcnJvclxuICAgICAqIEByZXR1cm5zIEVycm9yIG1lc3NhZ2VcbiAgICAgKi9cbiAgICBoYW5kbGVFcnJvcihlcnJvcjogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgbGV0IGVyck1zZyA9IEZvcm1TZXJ2aWNlLlVOS05PV05fRVJST1JfTUVTU0FHRTtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICBlcnJNc2cgPSAoZXJyb3IubWVzc2FnZSkgPyBlcnJvci5tZXNzYWdlIDpcbiAgICAgICAgICAgICAgICBlcnJvci5zdGF0dXMgPyBgJHtlcnJvci5zdGF0dXN9IC0gJHtlcnJvci5zdGF0dXNUZXh0fWAgOiBGb3JtU2VydmljZS5HRU5FUklDX0VSUk9SX01FU1NBR0U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKGVyck1zZyk7XG4gICAgICAgIHJldHVybiB0aHJvd0Vycm9yKGVyck1zZyk7XG4gICAgfVxufVxuIl19