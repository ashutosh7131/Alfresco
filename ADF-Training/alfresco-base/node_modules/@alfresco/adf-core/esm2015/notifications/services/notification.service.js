import { Injectable } from '@angular/core';
import { MatSnackBar } from '@angular/material/snack-bar';
import { TranslationService } from '../../services/translation.service';
import { AppConfigService, AppConfigValues } from '../../app-config/app-config.service';
import { Subject } from 'rxjs';
import { info, warning, error } from '../helpers/notification.factory';
import * as i0 from "@angular/core";
import * as i1 from "@angular/material/snack-bar";
import * as i2 from "../../services/translation.service";
import * as i3 from "../../app-config/app-config.service";
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/material/snack-bar';
import * as ɵngcc2 from '../../services/translation.service';
import * as ɵngcc3 from '../../app-config/app-config.service';
const INFO_SNACK_CLASS = 'adf-info-snackbar';
const WARN_SNACK_CLASS = 'adf-warning-snackbar';
const ERROR_SNACK_CLASS = 'adf-error-snackbar';
export class NotificationService {
    constructor(snackBar, translationService, appConfigService) {
        this.snackBar = snackBar;
        this.translationService = translationService;
        this.appConfigService = appConfigService;
        this.DEFAULT_DURATION_MESSAGE = 5000;
        this.notifications$ = new Subject();
        this.DEFAULT_DURATION_MESSAGE = this.appConfigService.get(AppConfigValues.NOTIFY_DURATION) || this.DEFAULT_DURATION_MESSAGE;
    }
    openSnackMessage(message, config, interpolateArgs) {
        return this.dispatchNotification(message, null, config, interpolateArgs);
    }
    openSnackMessageAction(message, action, config, interpolateArgs) {
        return this.dispatchNotification(message, action, config, interpolateArgs);
    }
    showError(message, action, interpolateArgs) {
        return this.dispatchNotification(message, action, { panelClass: ERROR_SNACK_CLASS }, interpolateArgs);
    }
    showInfo(message, action, interpolateArgs) {
        return this.dispatchNotification(message, action, { panelClass: INFO_SNACK_CLASS }, interpolateArgs);
    }
    showWarning(message, action, interpolateArgs) {
        return this.dispatchNotification(message, action, { panelClass: WARN_SNACK_CLASS }, interpolateArgs);
    }
    dismissSnackMessageAction() {
        return this.snackBar.dismiss();
    }
    pushToNotificationHistory(notification) {
        this.notifications$.next(notification);
    }
    dispatchNotification(message, action, config, interpolateArgs) {
        const translatedMessage = this.translationService.instant(message, interpolateArgs);
        const translatedAction = this.translationService.instant(action, interpolateArgs);
        const createNotification = this.getNotificationCreator(config);
        this.notifications$.next(createNotification(translatedMessage));
        return this.snackBar.open(translatedMessage, translatedAction, Object.assign({ duration: (typeof config === 'number') ? config : this.DEFAULT_DURATION_MESSAGE, panelClass: INFO_SNACK_CLASS }, ((typeof config === 'object') ? config : {})));
    }
    getNotificationCreator(config) {
        let panelClass = null;
        if (typeof config === 'object') {
            panelClass = Array.isArray(config.panelClass) ? config.panelClass[0] : config.panelClass;
        }
        switch (panelClass) {
            case ERROR_SNACK_CLASS:
                return error;
            case WARN_SNACK_CLASS:
                return warning;
            default:
                return info;
        }
    }
}
NotificationService.ɵfac = function NotificationService_Factory(t) { return new (t || NotificationService)(ɵngcc0.ɵɵinject(ɵngcc1.MatSnackBar), ɵngcc0.ɵɵinject(ɵngcc2.TranslationService), ɵngcc0.ɵɵinject(ɵngcc3.AppConfigService)); };
NotificationService.ɵprov = i0.ɵɵdefineInjectable({ factory: function NotificationService_Factory() { return new NotificationService(i0.ɵɵinject(i1.MatSnackBar), i0.ɵɵinject(i2.TranslationService), i0.ɵɵinject(i3.AppConfigService)); }, token: NotificationService, providedIn: "root" });
NotificationService.ctorParameters = () => [
    { type: MatSnackBar },
    { type: TranslationService },
    { type: AppConfigService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NotificationService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.MatSnackBar }, { type: ɵngcc2.TranslationService }, { type: ɵngcc3.AppConfigService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9jb3JlL25vdGlmaWNhdGlvbnMvc2VydmljZXMvbm90aWZpY2F0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBaUJBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFdBQVcsRUFBcUMsTUFBTSw2QkFBNkIsQ0FBQztBQUM3RixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUN4RSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsZUFBZSxFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDeEYsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUUvQixPQUFPLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUN2RTtBQUNvQztBQUNLO0FBR3hDOzs7OztBQUpELE1BQU0sZ0JBQWdCLEdBQUcsbUJBQW1CLENBQUM7QUFDN0MsTUFBTSxnQkFBZ0IsR0FBRyxzQkFBc0IsQ0FBQztBQUNoRCxNQUFNLGlCQUFpQixHQUFHLG9CQUFvQixDQUFDO0FBSy9DLE1BQU0sT0FBTyxtQkFBbUI7QUFDaEMsSUFLSSxZQUFvQixRQUFxQixFQUNyQixrQkFBc0MsRUFDdEMsZ0JBQWtDO0FBQzFELFFBSHdCLGFBQVEsR0FBUixRQUFRLENBQWE7QUFBQyxRQUN0Qix1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO0FBQUMsUUFDdkMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtBQUFDLFFBTnZELDZCQUF3QixHQUFXLElBQUksQ0FBQztBQUM1QyxRQUNJLG1CQUFjLEdBQStCLElBQUksT0FBTyxFQUFFLENBQUM7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QXNCLENBQUMsTUFBbUM7QUFDdEUsUUFBUSxJQUFJLFVBQVUsR0FBVyxJQUFJLENBQUM7QUFDdEMsUUFBUSxJQUFJLE9BQU8sTUFBTSxLQUFLLFFBQVEsRUFBRTtBQUN4QyxZQUFZLFVBQVUsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQztBQUNyRyxTQUFTO0FBQ1QsUUFDUSxRQUFRLFVBQVUsRUFBRTtBQUM1QixZQUFZLEtBQUssaUJBQWlCO0FBQ2xDLGdCQUFnQixPQUFPLEtBQUssQ0FBQztBQUM3QixZQUFZLEtBQUssZ0JBQWdCO0FBQ2pDLGdCQUFnQixPQUFPLE9BQU8sQ0FBQztBQUMvQixZQUFZO0FBQ1osZ0JBQWdCLE9BQU8sSUFBSSxDQUFDO0FBQzVCLFNBQVM7QUFDVCxJQUFJLENBQUM7QUFDTDt5T0FBQztBQUNELDhSQTdHSztBQUFDO0VBSEwsVUFBVSxTQUFDLHJCQUtHLFlBaEJOLFdBQVc7WUFZaEIsVUFBVSxFQUFFLE1BQU0sOUJBWkUsWUFDZixrQkFBa0I7VUFZMUIsVkFaOEIsWUFDdEIsZ0JBQWdCO0FBQUc7Ozs7OztvSkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0U25hY2tCYXIsIE1hdFNuYWNrQmFyUmVmLCBNYXRTbmFja0JhckNvbmZpZyB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3NuYWNrLWJhcic7XG5pbXBvcnQgeyBUcmFuc2xhdGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy90cmFuc2xhdGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IEFwcENvbmZpZ1NlcnZpY2UsIEFwcENvbmZpZ1ZhbHVlcyB9IGZyb20gJy4uLy4uL2FwcC1jb25maWcvYXBwLWNvbmZpZy5zZXJ2aWNlJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvbk1vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL25vdGlmaWNhdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBpbmZvLCB3YXJuaW5nLCBlcnJvciB9IGZyb20gJy4uL2hlbHBlcnMvbm90aWZpY2F0aW9uLmZhY3RvcnknO1xuXG5jb25zdCBJTkZPX1NOQUNLX0NMQVNTID0gJ2FkZi1pbmZvLXNuYWNrYmFyJztcbmNvbnN0IFdBUk5fU05BQ0tfQ0xBU1MgPSAnYWRmLXdhcm5pbmctc25hY2tiYXInO1xuY29uc3QgRVJST1JfU05BQ0tfQ0xBU1MgPSAnYWRmLWVycm9yLXNuYWNrYmFyJztcblxuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBOb3RpZmljYXRpb25TZXJ2aWNlIHtcblxuICAgIERFRkFVTFRfRFVSQVRJT05fTUVTU0FHRTogbnVtYmVyID0gNTAwMDtcblxuICAgIG5vdGlmaWNhdGlvbnMkOiBTdWJqZWN0PE5vdGlmaWNhdGlvbk1vZGVsPiA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHNuYWNrQmFyOiBNYXRTbmFja0JhcixcbiAgICAgICAgICAgICAgICBwcml2YXRlIHRyYW5zbGF0aW9uU2VydmljZTogVHJhbnNsYXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgYXBwQ29uZmlnU2VydmljZTogQXBwQ29uZmlnU2VydmljZSkge1xuICAgICAgICB0aGlzLkRFRkFVTFRfRFVSQVRJT05fTUVTU0FHRSA9IHRoaXMuYXBwQ29uZmlnU2VydmljZS5nZXQ8bnVtYmVyPihBcHBDb25maWdWYWx1ZXMuTk9USUZZX0RVUkFUSU9OKSB8fCB0aGlzLkRFRkFVTFRfRFVSQVRJT05fTUVTU0FHRTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVucyBhIFNuYWNrQmFyIG5vdGlmaWNhdGlvbiB0byBzaG93IGEgbWVzc2FnZS5cbiAgICAgKiBAcGFyYW0gbWVzc2FnZSBUaGUgbWVzc2FnZSAob3IgcmVzb3VyY2Uga2V5KSB0byBzaG93LlxuICAgICAqIEBwYXJhbSBjb25maWcgVGltZSBiZWZvcmUgbm90aWZpY2F0aW9uIGRpc2FwcGVhcnMgYWZ0ZXIgYmVpbmcgc2hvd24gb3IgTWF0U25hY2tCYXJDb25maWcgb2JqZWN0XG4gICAgICogQHBhcmFtIGludGVycG9sYXRlQXJncyBUaGUgaW50ZXJwb2xhdGlvbiBwYXJhbWV0ZXJzIHRvIGFkZCBmb3IgdGhlIHRyYW5zbGF0aW9uXG4gICAgICogQHJldHVybnMgSW5mb3JtYXRpb24vY29udHJvbCBvYmplY3QgZm9yIHRoZSBTbmFja0JhclxuICAgICAqL1xuICAgIG9wZW5TbmFja01lc3NhZ2UobWVzc2FnZTogc3RyaW5nLCBjb25maWc/OiBudW1iZXIgfCBNYXRTbmFja0JhckNvbmZpZywgaW50ZXJwb2xhdGVBcmdzPzogYW55KTogTWF0U25hY2tCYXJSZWY8YW55PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpc3BhdGNoTm90aWZpY2F0aW9uKG1lc3NhZ2UsIG51bGwsIGNvbmZpZywgaW50ZXJwb2xhdGVBcmdzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVucyBhIFNuYWNrQmFyIG5vdGlmaWNhdGlvbiB3aXRoIGEgbWVzc2FnZSBhbmQgYSByZXNwb25zZSBidXR0b24uXG4gICAgICogQHBhcmFtIG1lc3NhZ2UgVGhlIG1lc3NhZ2UgKG9yIHJlc291cmNlIGtleSkgdG8gc2hvdy5cbiAgICAgKiBAcGFyYW0gYWN0aW9uIENhcHRpb24gZm9yIHRoZSByZXNwb25zZSBidXR0b25cbiAgICAgKiBAcGFyYW0gY29uZmlnIFRpbWUgYmVmb3JlIG5vdGlmaWNhdGlvbiBkaXNhcHBlYXJzIGFmdGVyIGJlaW5nIHNob3duIG9yIE1hdFNuYWNrQmFyQ29uZmlnIG9iamVjdFxuICAgICAqIEBwYXJhbSBpbnRlcnBvbGF0ZUFyZ3MgVGhlIGludGVycG9sYXRpb24gcGFyYW1ldGVycyB0byBhZGQgZm9yIHRoZSB0cmFuc2xhdGlvblxuICAgICAqIEByZXR1cm5zIEluZm9ybWF0aW9uL2NvbnRyb2wgb2JqZWN0IGZvciB0aGUgU25hY2tCYXJcbiAgICAgKi9cbiAgICBvcGVuU25hY2tNZXNzYWdlQWN0aW9uKG1lc3NhZ2U6IHN0cmluZywgYWN0aW9uOiBzdHJpbmcsIGNvbmZpZz86IG51bWJlciB8IE1hdFNuYWNrQmFyQ29uZmlnLCBpbnRlcnBvbGF0ZUFyZ3M/OiBhbnkpOiBNYXRTbmFja0JhclJlZjxhbnk+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGF0Y2hOb3RpZmljYXRpb24obWVzc2FnZSwgYWN0aW9uLCBjb25maWcsIGludGVycG9sYXRlQXJncyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmFzZSBlcnJvciBtZXNzYWdlXG4gICAgICogQHBhcmFtIG1lc3NhZ2UgVGV4dCBtZXNzYWdlIG9yIHRyYW5zbGF0aW9uIGtleSBmb3IgdGhlIG1lc3NhZ2UuXG4gICAgICogQHBhcmFtIGFjdGlvbiBBY3Rpb24gbmFtZVxuICAgICAqIEBwYXJhbSBpbnRlcnBvbGF0ZUFyZ3MgVGhlIGludGVycG9sYXRpb24gcGFyYW1ldGVycyB0byBhZGQgZm9yIHRoZSB0cmFuc2xhdGlvblxuICAgICAqL1xuICAgIHNob3dFcnJvcihtZXNzYWdlOiBzdHJpbmcsIGFjdGlvbj86IHN0cmluZywgaW50ZXJwb2xhdGVBcmdzPzogYW55KTogTWF0U25hY2tCYXJSZWY8YW55PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpc3BhdGNoTm90aWZpY2F0aW9uKG1lc3NhZ2UsIGFjdGlvbiwgeyBwYW5lbENsYXNzOiBFUlJPUl9TTkFDS19DTEFTUyB9LCBpbnRlcnBvbGF0ZUFyZ3MpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJhc2UgaW5mbyBtZXNzYWdlXG4gICAgICogQHBhcmFtIG1lc3NhZ2UgVGV4dCBtZXNzYWdlIG9yIHRyYW5zbGF0aW9uIGtleSBmb3IgdGhlIG1lc3NhZ2UuXG4gICAgICogQHBhcmFtIGFjdGlvbiBBY3Rpb24gbmFtZVxuICAgICAqIEBwYXJhbSBpbnRlcnBvbGF0ZUFyZ3MgVGhlIGludGVycG9sYXRpb24gcGFyYW1ldGVycyB0byBhZGQgZm9yIHRoZSB0cmFuc2xhdGlvblxuICAgICAqL1xuICAgIHNob3dJbmZvKG1lc3NhZ2U6IHN0cmluZywgYWN0aW9uPzogc3RyaW5nLCBpbnRlcnBvbGF0ZUFyZ3M/OiBhbnkpOiBNYXRTbmFja0JhclJlZjxhbnk+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGF0Y2hOb3RpZmljYXRpb24obWVzc2FnZSwgYWN0aW9uLCB7IHBhbmVsQ2xhc3M6IElORk9fU05BQ0tfQ0xBU1MgfSwgaW50ZXJwb2xhdGVBcmdzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSYXNlIHdhcm5pbmcgbWVzc2FnZVxuICAgICAqIEBwYXJhbSBtZXNzYWdlIFRleHQgbWVzc2FnZSBvciB0cmFuc2xhdGlvbiBrZXkgZm9yIHRoZSBtZXNzYWdlLlxuICAgICAqIEBwYXJhbSBhY3Rpb24gQWN0aW9uIG5hbWVcbiAgICAgKiBAcGFyYW0gaW50ZXJwb2xhdGVBcmdzIFRoZSBpbnRlcnBvbGF0aW9uIHBhcmFtZXRlcnMgdG8gYWRkIGZvciB0aGUgdHJhbnNsYXRpb25cbiAgICAgKi9cbiAgICBzaG93V2FybmluZyhtZXNzYWdlOiBzdHJpbmcsIGFjdGlvbj86IHN0cmluZywgaW50ZXJwb2xhdGVBcmdzPzogYW55KTogTWF0U25hY2tCYXJSZWY8YW55PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpc3BhdGNoTm90aWZpY2F0aW9uKG1lc3NhZ2UsIGFjdGlvbiwgeyBwYW5lbENsYXNzOiBXQVJOX1NOQUNLX0NMQVNTIH0sIGludGVycG9sYXRlQXJncyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogIGRpc21pc3MgdGhlIG5vdGlmaWNhdGlvbiBzbmFja2JhclxuICAgICAqL1xuICAgIGRpc21pc3NTbmFja01lc3NhZ2VBY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNuYWNrQmFyLmRpc21pc3MoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQdXNoIG5ldyBub3RpZmljYXRpb24gdG8gTm90aWZpY2F0aW9uIEhpc3RvcnlcbiAgICAgKiBAcGFyYW0gbm90aWZpY2F0aW9uIC0gTm90aWZpY2F0aW9uIG1vZGVsIHRvIGJlIHB1c2hlZC5cbiAgICAgKi9cbiAgICBwdXNoVG9Ob3RpZmljYXRpb25IaXN0b3J5KG5vdGlmaWNhdGlvbjogTm90aWZpY2F0aW9uTW9kZWwpIHtcbiAgICAgICAgdGhpcy5ub3RpZmljYXRpb25zJC5uZXh0KG5vdGlmaWNhdGlvbik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkaXNwYXRjaE5vdGlmaWNhdGlvbihtZXNzYWdlOiBzdHJpbmcsIGFjdGlvbj86IHN0cmluZywgY29uZmlnPzogbnVtYmVyIHwgTWF0U25hY2tCYXJDb25maWcsIGludGVycG9sYXRlQXJncz86IGFueSk6ICBNYXRTbmFja0JhclJlZjxhbnk+IHtcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZWRNZXNzYWdlOiBzdHJpbmcgPSB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS5pbnN0YW50KG1lc3NhZ2UsIGludGVycG9sYXRlQXJncyk7XG4gICAgICAgICAgICBjb25zdCB0cmFuc2xhdGVkQWN0aW9uOiBzdHJpbmcgPSB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS5pbnN0YW50KGFjdGlvbiwgaW50ZXJwb2xhdGVBcmdzKTtcbiAgICAgICAgICAgIGNvbnN0IGNyZWF0ZU5vdGlmaWNhdGlvbiA9IHRoaXMuZ2V0Tm90aWZpY2F0aW9uQ3JlYXRvcihjb25maWcpO1xuICAgICAgICAgICAgdGhpcy5ub3RpZmljYXRpb25zJC5uZXh0KGNyZWF0ZU5vdGlmaWNhdGlvbih0cmFuc2xhdGVkTWVzc2FnZSkpO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zbmFja0Jhci5vcGVuKHRyYW5zbGF0ZWRNZXNzYWdlLCB0cmFuc2xhdGVkQWN0aW9uLCB7XG4gICAgICAgICAgICAgICAgZHVyYXRpb246ICh0eXBlb2YgY29uZmlnID09PSAnbnVtYmVyJykgPyBjb25maWcgOiB0aGlzLkRFRkFVTFRfRFVSQVRJT05fTUVTU0FHRSxcbiAgICAgICAgICAgICAgICBwYW5lbENsYXNzOiBJTkZPX1NOQUNLX0NMQVNTLFxuICAgICAgICAgICAgICAgIC4uLiggKHR5cGVvZiBjb25maWcgPT09ICdvYmplY3QnKSA/IGNvbmZpZyA6IHt9IClcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0Tm90aWZpY2F0aW9uQ3JlYXRvcihjb25maWc/OiBudW1iZXIgfCBNYXRTbmFja0JhckNvbmZpZykge1xuICAgICAgICBsZXQgcGFuZWxDbGFzczogc3RyaW5nID0gbnVsbDtcbiAgICAgICAgaWYgKHR5cGVvZiBjb25maWcgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBwYW5lbENsYXNzID0gQXJyYXkuaXNBcnJheShjb25maWcucGFuZWxDbGFzcykgPyBjb25maWcucGFuZWxDbGFzc1swXSA6IGNvbmZpZy5wYW5lbENsYXNzO1xuICAgICAgICB9XG5cbiAgICAgICAgc3dpdGNoIChwYW5lbENsYXNzKSB7XG4gICAgICAgICAgICBjYXNlIEVSUk9SX1NOQUNLX0NMQVNTOlxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvcjtcbiAgICAgICAgICAgIGNhc2UgV0FSTl9TTkFDS19DTEFTUzpcbiAgICAgICAgICAgICAgICByZXR1cm4gd2FybmluZztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGluZm87XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=