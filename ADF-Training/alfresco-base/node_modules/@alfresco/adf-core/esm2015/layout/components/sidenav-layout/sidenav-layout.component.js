/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, ContentChild, Input, Output, ViewChild, EventEmitter, ViewEncapsulation } from '@angular/core';
import { MediaMatcher } from '@angular/cdk/layout';
import { UserPreferencesService } from '../../../services/user-preferences.service';
import { SidenavLayoutContentDirective } from '../../directives/sidenav-layout-content.directive';
import { SidenavLayoutHeaderDirective } from '../../directives/sidenav-layout-header.directive';
import { SidenavLayoutNavigationDirective } from '../../directives/sidenav-layout-navigation.directive';
import { BehaviorSubject, Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/cdk/layout';
import * as ɵngcc2 from '../../../services/user-preferences.service';
import * as ɵngcc3 from '@angular/common';
import * as ɵngcc4 from '../layout-container/layout-container.component';

const _c0 = ["container"];
const _c1 = ["emptyTemplate"];
function SidenavLayoutComponent_ng_container_1_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainer(0, 9);
} }
function SidenavLayoutComponent_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, SidenavLayoutComponent_ng_container_1_ng_container_1_Template, 1, 0, "ng-container", 8);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r0.headerTemplate)("ngTemplateOutletContext", ctx_r0.templateContext);
} }
function SidenavLayoutComponent_ng_container_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainer(0, 10);
} }
function SidenavLayoutComponent_ng_container_6_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainer(0);
} }
function SidenavLayoutComponent_ng_container_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, SidenavLayoutComponent_ng_container_6_ng_container_1_Template, 1, 0, "ng-container", 6);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r3.headerTemplate)("ngTemplateOutletContext", ctx_r3.templateContext);
} }
function SidenavLayoutComponent_ng_container_7_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainer(0);
} }
function SidenavLayoutComponent_ng_template_8_Template(rf, ctx) { }
export class SidenavLayoutComponent {
    constructor(mediaMatcher, userPreferencesService) {
        this.mediaMatcher = mediaMatcher;
        this.userPreferencesService = userPreferencesService;
        this.dir = 'ltr';
        this.position = 'start';
        this.hideSidenav = false;
        this.expandedSidenav = true;
        this.expanded = new EventEmitter();
        this.templateContext = {
            toggleMenu: () => { },
            isMenuMinimized: () => this.isMenuMinimized
        };
        this.onDestroy$ = new Subject();
        this.onMediaQueryChange = this.onMediaQueryChange.bind(this);
    }
    ngOnInit() {
        const initialMenuState = !this.expandedSidenav;
        this.menuOpenStateSubject = new BehaviorSubject(initialMenuState);
        this.menuOpenState$ = this.menuOpenStateSubject.asObservable();
        const stepOver = this.stepOver || SidenavLayoutComponent.STEP_OVER;
        this.isMenuMinimized = initialMenuState;
        this.mediaQueryList = this.mediaMatcher.matchMedia(`(max-width: ${stepOver}px)`);
        this.mediaQueryList.addListener(this.onMediaQueryChange);
        this.userPreferencesService
            .select('textOrientation')
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((direction) => {
            this.dir = direction;
        });
    }
    ngAfterViewInit() {
        this.templateContext.toggleMenu = this.toggleMenu.bind(this);
    }
    ngOnDestroy() {
        this.mediaQueryList.removeListener(this.onMediaQueryChange);
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
    toggleMenu() {
        if (!this.mediaQueryList.matches) {
            this.isMenuMinimized = !this.isMenuMinimized;
        }
        else {
            this.isMenuMinimized = false;
        }
        this.container.toggleMenu();
        this.expanded.emit(!this.isMenuMinimized);
    }
    get isMenuMinimized() {
        return this._isMenuMinimized;
    }
    set isMenuMinimized(menuState) {
        this._isMenuMinimized = menuState;
        this.menuOpenStateSubject.next(!menuState);
    }
    get isHeaderInside() {
        return this.mediaQueryList.matches;
    }
    get headerTemplate() {
        return this.headerDirective && this.headerDirective.template || this.emptyTemplate;
    }
    get navigationTemplate() {
        return this.navigationDirective && this.navigationDirective.template || this.emptyTemplate;
    }
    get contentTemplate() {
        return this.contentDirective && this.contentDirective.template || this.emptyTemplate;
    }
    onMediaQueryChange() {
        this.isMenuMinimized = false;
        this.expanded.emit(!this.isMenuMinimized);
    }
}
SidenavLayoutComponent.ɵfac = function SidenavLayoutComponent_Factory(t) { return new (t || SidenavLayoutComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.MediaMatcher), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.UserPreferencesService)); };
SidenavLayoutComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: SidenavLayoutComponent, selectors: [["adf-sidenav-layout"]], contentQueries: function SidenavLayoutComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, SidenavLayoutHeaderDirective, true);
        ɵngcc0.ɵɵcontentQuery(dirIndex, SidenavLayoutNavigationDirective, true);
        ɵngcc0.ɵɵcontentQuery(dirIndex, SidenavLayoutContentDirective, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.headerDirective = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.navigationDirective = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.contentDirective = _t.first);
    } }, viewQuery: function SidenavLayoutComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵstaticViewQuery(_c0, true);
        ɵngcc0.ɵɵstaticViewQuery(_c1, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.container = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.emptyTemplate = _t.first);
    } }, hostAttrs: [1, "adf-sidenav-layout"], inputs: { position: "position", hideSidenav: "hideSidenav", expandedSidenav: "expandedSidenav", sidenavMin: "sidenavMin", sidenavMax: "sidenavMax", stepOver: "stepOver" }, outputs: { expanded: "expanded" }, decls: 10, vars: 13, consts: [[1, "adf-sidenav-layout-full-space"], [4, "ngIf"], ["data-automation-id", "adf-layout-container", 1, "adf-layout__content", 3, "direction", "position", "sidenavMin", "sidenavMax", "mediaQueryList", "hideSidenav", "expandedSidenav"], ["container", ""], ["app-layout-navigation", "", 4, "ngTemplateOutlet", "ngTemplateOutletContext"], ["app-layout-content", ""], [4, "ngTemplateOutlet", "ngTemplateOutletContext"], ["emptyTemplate", ""], ["class", "adf-sidenav-layout-outer-header", 4, "ngTemplateOutlet", "ngTemplateOutletContext"], [1, "adf-sidenav-layout-outer-header"], ["app-layout-navigation", ""]], template: function SidenavLayoutComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵtemplate(1, SidenavLayoutComponent_ng_container_1_Template, 2, 2, "ng-container", 1);
        ɵngcc0.ɵɵelementStart(2, "adf-layout-container", 2, 3);
        ɵngcc0.ɵɵtemplate(4, SidenavLayoutComponent_ng_container_4_Template, 1, 0, "ng-container", 4);
        ɵngcc0.ɵɵelementContainerStart(5, 5);
        ɵngcc0.ɵɵtemplate(6, SidenavLayoutComponent_ng_container_6_Template, 2, 2, "ng-container", 1);
        ɵngcc0.ɵɵtemplate(7, SidenavLayoutComponent_ng_container_7_Template, 1, 0, "ng-container", 6);
        ɵngcc0.ɵɵelementContainerEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(8, SidenavLayoutComponent_ng_template_8_Template, 0, 0, "ng-template", null, 7, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.isHeaderInside);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("direction", ctx.dir)("position", ctx.position)("sidenavMin", ctx.sidenavMin)("sidenavMax", ctx.sidenavMax)("mediaQueryList", ctx.mediaQueryList)("hideSidenav", ctx.hideSidenav)("expandedSidenav", ctx.expandedSidenav);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx.navigationTemplate)("ngTemplateOutletContext", ctx.templateContext);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.isHeaderInside);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx.contentTemplate)("ngTemplateOutletContext", ctx.templateContext);
    } }, directives: [ɵngcc3.NgIf, ɵngcc4.LayoutContainerComponent, ɵngcc3.NgTemplateOutlet], styles: [".adf-sidenav-layout,.adf-sidenav-layout-full-space{display:flex;flex:1;flex-direction:column;height:100%;min-height:0;overflow:hidden;width:100%}.adf-sidenav-layout .adf-layout__content{flex:1 1 auto}.adf-sidenav-layout router-outlet{flex:0 0}@media (max-width:599.9px){.adf-sidenav-layout .mat-drawer{max-width:300px!important;width:calc(-50px + 100vw)!important}}.adf-sidenav-layout .mat-drawer-content{display:flex;flex:1;flex-direction:column;height:100%;min-height:0;overflow:hidden;overflow:auto;position:unset}"], encapsulation: 2 });
SidenavLayoutComponent.STEP_OVER = 600;
SidenavLayoutComponent.ctorParameters = () => [
    { type: MediaMatcher },
    { type: UserPreferencesService }
];
SidenavLayoutComponent.propDecorators = {
    position: [{ type: Input }],
    sidenavMin: [{ type: Input }],
    sidenavMax: [{ type: Input }],
    stepOver: [{ type: Input }],
    hideSidenav: [{ type: Input }],
    expandedSidenav: [{ type: Input }],
    expanded: [{ type: Output }],
    headerDirective: [{ type: ContentChild, args: [SidenavLayoutHeaderDirective,] }],
    navigationDirective: [{ type: ContentChild, args: [SidenavLayoutNavigationDirective,] }],
    contentDirective: [{ type: ContentChild, args: [SidenavLayoutContentDirective,] }],
    container: [{ type: ViewChild, args: ['container', { static: true },] }],
    emptyTemplate: [{ type: ViewChild, args: ['emptyTemplate', { static: true },] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(SidenavLayoutComponent, [{
        type: Component,
        args: [{
                selector: 'adf-sidenav-layout',
                template: "<div class=\"adf-sidenav-layout-full-space\">\n    <ng-container *ngIf=\"!isHeaderInside\">\n        <ng-container class=\"adf-sidenav-layout-outer-header\"\n                      *ngTemplateOutlet=\"headerTemplate; context:templateContext\"></ng-container>\n    </ng-container>\n\n    <adf-layout-container #container\n                          [direction]=\"dir\"\n                          [position]=\"position\"\n                          [sidenavMin]=\"sidenavMin\"\n                          [sidenavMax]=\"sidenavMax\"\n                          [mediaQueryList]=\"mediaQueryList\"\n                          [hideSidenav]=\"hideSidenav\"\n                          [expandedSidenav]=\"expandedSidenav\"\n                          data-automation-id=\"adf-layout-container\"\n                          class=\"adf-layout__content\">\n\n        <ng-container app-layout-navigation\n                      *ngTemplateOutlet=\"navigationTemplate; context:templateContext\"></ng-container>\n\n        <ng-container app-layout-content>\n            <ng-container *ngIf=\"isHeaderInside\">\n                <ng-container *ngTemplateOutlet=\"headerTemplate; context:templateContext\"></ng-container>\n            </ng-container>\n            <ng-container *ngTemplateOutlet=\"contentTemplate; context:templateContext\"></ng-container>\n        </ng-container>\n    </adf-layout-container>\n\n    <ng-template #emptyTemplate></ng-template>\n</div>\n",
                encapsulation: ViewEncapsulation.None,
                host: { class: 'adf-sidenav-layout' },
                styles: [".adf-sidenav-layout,.adf-sidenav-layout-full-space{display:flex;flex:1;flex-direction:column;height:100%;min-height:0;overflow:hidden;width:100%}.adf-sidenav-layout .adf-layout__content{flex:1 1 auto}.adf-sidenav-layout router-outlet{flex:0 0}@media (max-width:599.9px){.adf-sidenav-layout .mat-drawer{max-width:300px!important;width:calc(-50px + 100vw)!important}}.adf-sidenav-layout .mat-drawer-content{display:flex;flex:1;flex-direction:column;height:100%;min-height:0;overflow:hidden;overflow:auto;position:unset}"]
            }]
    }], function () { return [{ type: ɵngcc1.MediaMatcher }, { type: ɵngcc2.UserPreferencesService }]; }, { position: [{
            type: Input
        }], hideSidenav: [{
            type: Input
        }], expandedSidenav: [{
            type: Input
        }], expanded: [{
            type: Output
        }], sidenavMin: [{
            type: Input
        }], sidenavMax: [{
            type: Input
        }], stepOver: [{
            type: Input
        }], headerDirective: [{
            type: ContentChild,
            args: [SidenavLayoutHeaderDirective]
        }], navigationDirective: [{
            type: ContentChild,
            args: [SidenavLayoutNavigationDirective]
        }], contentDirective: [{
            type: ContentChild,
            args: [SidenavLayoutContentDirective]
        }], container: [{
            type: ViewChild,
            args: ['container', { static: true }]
        }], emptyTemplate: [{
            type: ViewChild,
            args: ['emptyTemplate', { static: true }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2lkZW5hdi1sYXlvdXQuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9ob21lL3RyYXZpcy9idWlsZC9BbGZyZXNjby9hbGZyZXNjby1uZzItY29tcG9uZW50cy9saWIvY29yZS9sYXlvdXQvY29tcG9uZW50cy9zaWRlbmF2LWxheW91dC9zaWRlbmF2LWxheW91dC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUVILE9BQU8sRUFDSCxTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFDTCxNQUFNLEVBR04sU0FBUyxFQUdULFlBQVksRUFDWixpQkFBaUIsRUFDcEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDRDQUE0QyxDQUFDO0FBQ3BGLE9BQU8sRUFBRSw2QkFBNkIsRUFBRSxNQUFNLG1EQUFtRCxDQUFDO0FBQ2xHLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLGtEQUFrRCxDQUFDO0FBQ2hHLE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxNQUFNLHNEQUFzRCxDQUFDO0FBQ3hHLE9BQU8sRUFBRSxlQUFlLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRTVELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVMzQyxNQUFNLE9BQU8sc0JBQXNCO0FBQUcsSUFvRGxDLFlBQW9CLFlBQTBCLEVBQVUsc0JBQThDO0FBQUksUUFBdEYsaUJBQVksR0FBWixZQUFZLENBQWM7QUFBQyxRQUFTLDJCQUFzQixH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RyxHQUFHLENBQUMsQUFEdEI7QUFBQztFQVBMLFNBQVMsU0FBQyxwQkFPMkMsWUFoQjdDLFlBQVk7VUFVakIsUUFBUSxFQUFFLHBCQVZXLFlBQ2hCLHNCQUFzQjtBQUFHO0FBU0Esa0JBQzlCLGxCQVZpQztBQUEwQyx1QkFzQjFFLEtBQUs7QUFBSyx5QkFHVixLQUFLO0FBQUsseUJBR1YsS0FBSztBQUFLLHVCQUdWLEtBQUs7QUFBSywwQkFHVixLQUFLO0FBQUssOEJBR1YsS0FBSztBQUFLLHVCQUdWLE1BQU07QUFBSyw4QkFFWCxZQUFZLFNBQUMsNEJBQTRCO0FBQ3pDLGtDQUVBLFlBQVksU0FBQyxnQ0FBZ0M7QUFDN0MsK0JBRUEsWUFBWSxTQUFDLDZCQUE2QjtBQUMxQyx3QkFLQSxTQUFTLFNBQUMsV0FBVyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtBQUFPLDRCQUM5QyxTQUFTLFNBQUMsZUFBZSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtBQUFNOzs7Ozt5a0JBN0NKLGtCQUU5QyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSSxrQkFDckMsSUFBSSxFQUFFLEVBQUUsS0FBSyxFQUFFLG9CQUFvQixFQUFFLGlqQkFDeEM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBeUN1RDtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHtcbiAgICBDb21wb25lbnQsXG4gICAgQ29udGVudENoaWxkLFxuICAgIElucHV0LFxuICAgIE91dHB1dCxcbiAgICBPbkluaXQsXG4gICAgQWZ0ZXJWaWV3SW5pdCxcbiAgICBWaWV3Q2hpbGQsXG4gICAgT25EZXN0cm95LFxuICAgIFRlbXBsYXRlUmVmLFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBWaWV3RW5jYXBzdWxhdGlvblxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1lZGlhTWF0Y2hlciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9sYXlvdXQnO1xuaW1wb3J0IHsgVXNlclByZWZlcmVuY2VzU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL3VzZXItcHJlZmVyZW5jZXMuc2VydmljZSc7XG5pbXBvcnQgeyBTaWRlbmF2TGF5b3V0Q29udGVudERpcmVjdGl2ZSB9IGZyb20gJy4uLy4uL2RpcmVjdGl2ZXMvc2lkZW5hdi1sYXlvdXQtY29udGVudC5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgU2lkZW5hdkxheW91dEhlYWRlckRpcmVjdGl2ZSB9IGZyb20gJy4uLy4uL2RpcmVjdGl2ZXMvc2lkZW5hdi1sYXlvdXQtaGVhZGVyLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBTaWRlbmF2TGF5b3V0TmF2aWdhdGlvbkRpcmVjdGl2ZSB9IGZyb20gJy4uLy4uL2RpcmVjdGl2ZXMvc2lkZW5hdi1sYXlvdXQtbmF2aWdhdGlvbi5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBEaXJlY3Rpb24gfSBmcm9tICdAYW5ndWxhci9jZGsvYmlkaSc7XG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLXNpZGVuYXYtbGF5b3V0JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vc2lkZW5hdi1sYXlvdXQuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3NpZGVuYXYtbGF5b3V0LmNvbXBvbmVudC5zY3NzJ10sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgICBob3N0OiB7IGNsYXNzOiAnYWRmLXNpZGVuYXYtbGF5b3V0JyB9XG59KVxuZXhwb3J0IGNsYXNzIFNpZGVuYXZMYXlvdXRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG4gICAgc3RhdGljIFNURVBfT1ZFUiA9IDYwMDtcblxuICAgIC8qKiBUaGUgZGlyZWN0aW9uIG9mIHRoZSBsYXlvdXQuICdsdHInIG9yICdydGwnICovXG4gICAgZGlyOiBEaXJlY3Rpb24gPSAnbHRyJztcblxuICAgIC8qKiBUaGUgc2lkZSB0aGF0IHRoZSBkcmF3ZXIgaXMgYXR0YWNoZWQgdG8uIFBvc3NpYmxlIHZhbHVlcyBhcmUgJ3N0YXJ0JyBhbmQgJ2VuZCcuICovXG4gICAgQElucHV0KCkgcG9zaXRpb246ICdzdGFydCcgfCAnZW5kJyA9ICdzdGFydCc7XG5cbiAgICAvKiogTWluaW11bSBzaXplIG9mIHRoZSBuYXZpZ2F0aW9uIHJlZ2lvbi4gKi9cbiAgICBASW5wdXQoKSBzaWRlbmF2TWluOiBudW1iZXI7XG5cbiAgICAvKiogTWF4aW11bSBzaXplIG9mIHRoZSBuYXZpZ2F0aW9uIHJlZ2lvbi4gKi9cbiAgICBASW5wdXQoKSBzaWRlbmF2TWF4OiBudW1iZXI7XG5cbiAgICAvKiogU2NyZWVuIHNpemUgYXQgd2hpY2ggZGlzcGxheSBzd2l0Y2hlcyBmcm9tIHNtYWxsIHNjcmVlbiB0byBsYXJnZSBzY3JlZW4gY29uZmlndXJhdGlvbi4gKi9cbiAgICBASW5wdXQoKSBzdGVwT3ZlcjogbnVtYmVyO1xuXG4gICAgLyoqIFRvZ2dsZXMgc2hvd2luZy9oaWRpbmcgdGhlIG5hdmlnYXRpb24gcmVnaW9uLiAqL1xuICAgIEBJbnB1dCgpIGhpZGVTaWRlbmF2ID0gZmFsc2U7XG5cbiAgICAvKiogU2hvdWxkIHRoZSBuYXZpZ2F0aW9uIHJlZ2lvbiBiZSBleHBhbmRlZCBpbml0aWFsbHk/ICovXG4gICAgQElucHV0KCkgZXhwYW5kZWRTaWRlbmF2ID0gdHJ1ZTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIG1lbnUgdG9nZ2xlIGFuZCB0aGUgY29sbGFwc2VkL2V4cGFuZGVkIHN0YXRlIG9mIHRoZSBzaWRlTmF2IGNoYW5nZXMuICovXG4gICAgQE91dHB1dCgpIGV4cGFuZGVkID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuXG4gICAgQENvbnRlbnRDaGlsZChTaWRlbmF2TGF5b3V0SGVhZGVyRGlyZWN0aXZlKVxuICAgIGhlYWRlckRpcmVjdGl2ZTogU2lkZW5hdkxheW91dEhlYWRlckRpcmVjdGl2ZTtcblxuICAgIEBDb250ZW50Q2hpbGQoU2lkZW5hdkxheW91dE5hdmlnYXRpb25EaXJlY3RpdmUpXG4gICAgbmF2aWdhdGlvbkRpcmVjdGl2ZTogU2lkZW5hdkxheW91dE5hdmlnYXRpb25EaXJlY3RpdmU7XG5cbiAgICBAQ29udGVudENoaWxkKFNpZGVuYXZMYXlvdXRDb250ZW50RGlyZWN0aXZlKVxuICAgIGNvbnRlbnREaXJlY3RpdmU6IFNpZGVuYXZMYXlvdXRDb250ZW50RGlyZWN0aXZlO1xuXG4gICAgcHJpdmF0ZSBtZW51T3BlblN0YXRlU3ViamVjdDogQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+O1xuICAgIHB1YmxpYyBtZW51T3BlblN0YXRlJDogT2JzZXJ2YWJsZTxib29sZWFuPjtcblxuICAgIEBWaWV3Q2hpbGQoJ2NvbnRhaW5lcicsIHsgc3RhdGljOiB0cnVlIH0pIGNvbnRhaW5lcjogYW55O1xuICAgIEBWaWV3Q2hpbGQoJ2VtcHR5VGVtcGxhdGUnLCB7IHN0YXRpYzogdHJ1ZSB9KSBlbXB0eVRlbXBsYXRlOiBhbnk7XG5cbiAgICBtZWRpYVF1ZXJ5TGlzdDogTWVkaWFRdWVyeUxpc3Q7XG4gICAgX2lzTWVudU1pbmltaXplZDtcblxuICAgIHRlbXBsYXRlQ29udGV4dCA9IHtcbiAgICAgICAgdG9nZ2xlTWVudTogKCkgPT4ge30sXG4gICAgICAgIGlzTWVudU1pbmltaXplZDogKCkgPT4gdGhpcy5pc01lbnVNaW5pbWl6ZWRcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBvbkRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbWVkaWFNYXRjaGVyOiBNZWRpYU1hdGNoZXIsIHByaXZhdGUgdXNlclByZWZlcmVuY2VzU2VydmljZTogVXNlclByZWZlcmVuY2VzU2VydmljZSApIHtcbiAgICAgICAgdGhpcy5vbk1lZGlhUXVlcnlDaGFuZ2UgPSB0aGlzLm9uTWVkaWFRdWVyeUNoYW5nZS5iaW5kKHRoaXMpO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICBjb25zdCBpbml0aWFsTWVudVN0YXRlID0gIXRoaXMuZXhwYW5kZWRTaWRlbmF2O1xuXG4gICAgICAgIHRoaXMubWVudU9wZW5TdGF0ZVN1YmplY3QgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+KGluaXRpYWxNZW51U3RhdGUpO1xuICAgICAgICB0aGlzLm1lbnVPcGVuU3RhdGUkID0gdGhpcy5tZW51T3BlblN0YXRlU3ViamVjdC5hc09ic2VydmFibGUoKTtcblxuICAgICAgICBjb25zdCBzdGVwT3ZlciA9IHRoaXMuc3RlcE92ZXIgfHwgU2lkZW5hdkxheW91dENvbXBvbmVudC5TVEVQX09WRVI7XG4gICAgICAgIHRoaXMuaXNNZW51TWluaW1pemVkID0gaW5pdGlhbE1lbnVTdGF0ZTtcblxuICAgICAgICB0aGlzLm1lZGlhUXVlcnlMaXN0ID0gdGhpcy5tZWRpYU1hdGNoZXIubWF0Y2hNZWRpYShgKG1heC13aWR0aDogJHtzdGVwT3Zlcn1weClgKTtcbiAgICAgICAgdGhpcy5tZWRpYVF1ZXJ5TGlzdC5hZGRMaXN0ZW5lcih0aGlzLm9uTWVkaWFRdWVyeUNoYW5nZSk7XG5cbiAgICAgICAgdGhpcy51c2VyUHJlZmVyZW5jZXNTZXJ2aWNlXG4gICAgICAgICAgICAuc2VsZWN0KCd0ZXh0T3JpZW50YXRpb24nKVxuICAgICAgICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMub25EZXN0cm95JCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKChkaXJlY3Rpb246IERpcmVjdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyID0gZGlyZWN0aW9uO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgICAgICB0aGlzLnRlbXBsYXRlQ29udGV4dC50b2dnbGVNZW51ID0gdGhpcy50b2dnbGVNZW51LmJpbmQodGhpcyk7XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgICAgIHRoaXMubWVkaWFRdWVyeUxpc3QucmVtb3ZlTGlzdGVuZXIodGhpcy5vbk1lZGlhUXVlcnlDaGFuZ2UpO1xuICAgICAgICB0aGlzLm9uRGVzdHJveSQubmV4dCh0cnVlKTtcbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLmNvbXBsZXRlKCk7XG4gICAgfVxuXG4gICAgdG9nZ2xlTWVudSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLm1lZGlhUXVlcnlMaXN0Lm1hdGNoZXMpIHtcbiAgICAgICAgICAgIHRoaXMuaXNNZW51TWluaW1pemVkID0gIXRoaXMuaXNNZW51TWluaW1pemVkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pc01lbnVNaW5pbWl6ZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnRvZ2dsZU1lbnUoKTtcbiAgICAgICAgdGhpcy5leHBhbmRlZC5lbWl0KCF0aGlzLmlzTWVudU1pbmltaXplZCk7XG4gICAgfVxuXG4gICAgZ2V0IGlzTWVudU1pbmltaXplZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzTWVudU1pbmltaXplZDtcbiAgICB9XG5cbiAgICBzZXQgaXNNZW51TWluaW1pemVkKG1lbnVTdGF0ZTogYm9vbGVhbikge1xuICAgICAgICB0aGlzLl9pc01lbnVNaW5pbWl6ZWQgPSBtZW51U3RhdGU7XG4gICAgICAgIHRoaXMubWVudU9wZW5TdGF0ZVN1YmplY3QubmV4dCghbWVudVN0YXRlKTtcbiAgICB9XG5cbiAgICBnZXQgaXNIZWFkZXJJbnNpZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1lZGlhUXVlcnlMaXN0Lm1hdGNoZXM7XG4gICAgfVxuXG4gICAgZ2V0IGhlYWRlclRlbXBsYXRlKCk6IFRlbXBsYXRlUmVmPGFueT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5oZWFkZXJEaXJlY3RpdmUgJiYgdGhpcy5oZWFkZXJEaXJlY3RpdmUudGVtcGxhdGUgfHwgdGhpcy5lbXB0eVRlbXBsYXRlO1xuICAgIH1cblxuICAgIGdldCBuYXZpZ2F0aW9uVGVtcGxhdGUoKTogVGVtcGxhdGVSZWY8YW55PiB7XG4gICAgICAgIHJldHVybiB0aGlzLm5hdmlnYXRpb25EaXJlY3RpdmUgJiYgdGhpcy5uYXZpZ2F0aW9uRGlyZWN0aXZlLnRlbXBsYXRlIHx8IHRoaXMuZW1wdHlUZW1wbGF0ZTtcbiAgICB9XG5cbiAgICBnZXQgY29udGVudFRlbXBsYXRlKCk6IFRlbXBsYXRlUmVmPGFueT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jb250ZW50RGlyZWN0aXZlICYmIHRoaXMuY29udGVudERpcmVjdGl2ZS50ZW1wbGF0ZSB8fCB0aGlzLmVtcHR5VGVtcGxhdGU7XG4gICAgfVxuXG4gICAgb25NZWRpYVF1ZXJ5Q2hhbmdlKCkge1xuICAgICAgICB0aGlzLmlzTWVudU1pbmltaXplZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmV4cGFuZGVkLmVtaXQoIXRoaXMuaXNNZW51TWluaW1pemVkKTtcbiAgICB9XG59XG4iXX0=