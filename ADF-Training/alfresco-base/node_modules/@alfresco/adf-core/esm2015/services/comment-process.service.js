import { Injectable } from '@angular/core';
import { from, throwError } from 'rxjs';
import { CommentModel } from '../models/comment.model';
import { UserProcessModel } from '../models/user-process.model';
import { AlfrescoApiService } from './alfresco-api.service';
import { LogService } from './log.service';
import { map, catchError } from 'rxjs/operators';
import { ActivitiCommentsApi } from '@alfresco/js-api';
import * as i0 from "@angular/core";
import * as i1 from "./alfresco-api.service";
import * as i2 from "./log.service";
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './alfresco-api.service';
import * as ɵngcc2 from './log.service';
export class CommentProcessService {
    constructor(apiService, logService) {
        this.apiService = apiService;
        this.logService = logService;
    }
    get commentsApi() {
        var _a;
        this._commentsApi = (_a = this._commentsApi) !== null && _a !== void 0 ? _a : new ActivitiCommentsApi(this.apiService.getInstance());
        return this._commentsApi;
    }
    addTaskComment(taskId, message) {
        return from(this.commentsApi.addTaskComment({ message: message }, taskId))
            .pipe(map((response) => {
            return new CommentModel({
                id: response.id,
                message: response.message,
                created: response.created,
                createdBy: response.createdBy
            });
        }), catchError((err) => this.handleError(err)));
    }
    getTaskComments(taskId) {
        return from(this.commentsApi.getTaskComments(taskId))
            .pipe(map((response) => {
            const comments = [];
            response.data.forEach((comment) => {
                const user = new UserProcessModel(comment.createdBy);
                comments.push(new CommentModel({
                    id: comment.id,
                    message: comment.message,
                    created: comment.created,
                    createdBy: user
                }));
            });
            return comments;
        }), catchError((err) => this.handleError(err)));
    }
    getProcessInstanceComments(processInstanceId) {
        return from(this.commentsApi.getProcessInstanceComments(processInstanceId))
            .pipe(map((response) => {
            const comments = [];
            response.data.forEach((comment) => {
                const user = new UserProcessModel(comment.createdBy);
                comments.push(new CommentModel({
                    id: comment.id,
                    message: comment.message,
                    created: comment.created,
                    createdBy: user
                }));
            });
            return comments;
        }), catchError((err) => this.handleError(err)));
    }
    addProcessInstanceComment(processInstanceId, message) {
        return from(this.commentsApi.addProcessInstanceComment({ message: message }, processInstanceId)).pipe(map((response) => {
            return new CommentModel({
                id: response.id,
                message: response.message,
                created: response.created,
                createdBy: response.createdBy
            });
        }), catchError((err) => this.handleError(err)));
    }
    handleError(error) {
        this.logService.error(error);
        return throwError(error || 'Server error');
    }
}
CommentProcessService.ɵfac = function CommentProcessService_Factory(t) { return new (t || CommentProcessService)(ɵngcc0.ɵɵinject(ɵngcc1.AlfrescoApiService), ɵngcc0.ɵɵinject(ɵngcc2.LogService)); };
CommentProcessService.ɵprov = i0.ɵɵdefineInjectable({ factory: function CommentProcessService_Factory() { return new CommentProcessService(i0.ɵɵinject(i1.AlfrescoApiService), i0.ɵɵinject(i2.LogService)); }, token: CommentProcessService, providedIn: "root" });
CommentProcessService.ctorParameters = () => [
    { type: AlfrescoApiService },
    { type: LogService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(CommentProcessService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.AlfrescoApiService }, { type: ɵngcc2.LogService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbWVudC1wcm9jZXNzLnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9jb3JlL3NlcnZpY2VzL2NvbW1lbnQtcHJvY2Vzcy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWlCQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBYyxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3BELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDakQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDdkQ7QUFFc0I7QUFJbEI7Ozs7QUFGSixNQUFNLE9BQU8scUJBQXFCO0FBQ2xDLElBT0ksWUFBb0IsVUFBOEIsRUFDOUIsVUFBc0I7QUFDOUMsUUFGd0IsZUFBVSxHQUFWLFVBQVUsQ0FBb0I7QUFBQyxRQUMvQixlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQUMsSUFDM0MsQ0FBQztBQUNMLElBUkksSUFBSSxXQUFXO0FBQUs7QUFBZ0IsUUFDaEMsSUFBSSxDQUFDLFlBQVksU0FBRyxJQUFJLENBQUMsWUFBWSxtQ0FBSSxJQUFJLG1CQUFtQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztBQUN4RyxRQUFRLE9BQU8sSUFBSSxDQUFDLFlB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QU12QixVQUFVLEVBQUUsTUFBTSx2QkFOUyxZQUN0QixVQUFVO0FBQUc7U0FNckI7Ozs7O2dIQU51QjtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZnJvbSwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgQ29tbWVudE1vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL2NvbW1lbnQubW9kZWwnO1xuaW1wb3J0IHsgVXNlclByb2Nlc3NNb2RlbCB9IGZyb20gJy4uL21vZGVscy91c2VyLXByb2Nlc3MubW9kZWwnO1xuaW1wb3J0IHsgQWxmcmVzY29BcGlTZXJ2aWNlIH0gZnJvbSAnLi9hbGZyZXNjby1hcGkuc2VydmljZSc7XG5pbXBvcnQgeyBMb2dTZXJ2aWNlIH0gZnJvbSAnLi9sb2cuc2VydmljZSc7XG5pbXBvcnQgeyBtYXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBBY3Rpdml0aUNvbW1lbnRzQXBpIH0gZnJvbSAnQGFsZnJlc2NvL2pzLWFwaSc7XG5cbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgQ29tbWVudFByb2Nlc3NTZXJ2aWNlIHtcblxuICAgIF9jb21tZW50c0FwaTogQWN0aXZpdGlDb21tZW50c0FwaTtcbiAgICBnZXQgY29tbWVudHNBcGkoKTogQWN0aXZpdGlDb21tZW50c0FwaSB7XG4gICAgICAgIHRoaXMuX2NvbW1lbnRzQXBpID0gdGhpcy5fY29tbWVudHNBcGkgPz8gbmV3IEFjdGl2aXRpQ29tbWVudHNBcGkodGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5fY29tbWVudHNBcGk7XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBhcGlTZXJ2aWNlOiBBbGZyZXNjb0FwaVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsb2dTZXJ2aWNlOiBMb2dTZXJ2aWNlKSB7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkcyBhIGNvbW1lbnQgdG8gYSB0YXNrLlxuICAgICAqIEBwYXJhbSB0YXNrSWQgSUQgb2YgdGhlIHRhcmdldCB0YXNrXG4gICAgICogQHBhcmFtIG1lc3NhZ2UgVGV4dCBmb3IgdGhlIGNvbW1lbnRcbiAgICAgKiBAcmV0dXJucyBEZXRhaWxzIGFib3V0IHRoZSBjb21tZW50XG4gICAgICovXG4gICAgYWRkVGFza0NvbW1lbnQodGFza0lkOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZyk6IE9ic2VydmFibGU8Q29tbWVudE1vZGVsPiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuY29tbWVudHNBcGkuYWRkVGFza0NvbW1lbnQoeyBtZXNzYWdlOiBtZXNzYWdlIH0sIHRhc2tJZCkpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ29tbWVudE1vZGVsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiByZXNwb25zZS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkOiByZXNwb25zZS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEJ5OiByZXNwb25zZS5jcmVhdGVkQnlcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyOiBhbnkpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhbGwgY29tbWVudHMgdGhhdCBoYXZlIGJlZW4gYWRkZWQgdG8gYSB0YXNrLlxuICAgICAqIEBwYXJhbSB0YXNrSWQgSUQgb2YgdGhlIHRhcmdldCB0YXNrXG4gICAgICogQHJldHVybnMgRGV0YWlscyBmb3IgZWFjaCBjb21tZW50XG4gICAgICovXG4gICAgZ2V0VGFza0NvbW1lbnRzKHRhc2tJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxDb21tZW50TW9kZWxbXT4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLmNvbW1lbnRzQXBpLmdldFRhc2tDb21tZW50cyh0YXNrSWQpKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21tZW50czogQ29tbWVudE1vZGVsW10gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5mb3JFYWNoKChjb21tZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VyID0gbmV3IFVzZXJQcm9jZXNzTW9kZWwoY29tbWVudC5jcmVhdGVkQnkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudHMucHVzaChuZXcgQ29tbWVudE1vZGVsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogY29tbWVudC5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBjb21tZW50Lm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZDogY29tbWVudC5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRCeTogdXNlclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbW1lbnRzO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycjogYW55KSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycikpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgYWxsIGNvbW1lbnRzIHRoYXQgaGF2ZSBiZWVuIGFkZGVkIHRvIGEgcHJvY2VzcyBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0gcHJvY2Vzc0luc3RhbmNlSWQgSUQgb2YgdGhlIHRhcmdldCBwcm9jZXNzIGluc3RhbmNlXG4gICAgICogQHJldHVybnMgRGV0YWlscyBmb3IgZWFjaCBjb21tZW50XG4gICAgICovXG4gICAgZ2V0UHJvY2Vzc0luc3RhbmNlQ29tbWVudHMocHJvY2Vzc0luc3RhbmNlSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8Q29tbWVudE1vZGVsW10+IHtcbiAgICAgICAgcmV0dXJuIGZyb20odGhpcy5jb21tZW50c0FwaS5nZXRQcm9jZXNzSW5zdGFuY2VDb21tZW50cyhwcm9jZXNzSW5zdGFuY2VJZCkpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1lbnRzOiBDb21tZW50TW9kZWxbXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLmZvckVhY2goKGNvbW1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlclByb2Nlc3NNb2RlbChjb21tZW50LmNyZWF0ZWRCeSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50cy5wdXNoKG5ldyBDb21tZW50TW9kZWwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjb21tZW50LmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGNvbW1lbnQubWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkOiBjb21tZW50LmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEJ5OiB1c2VyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tbWVudHM7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyOiBhbnkpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyKSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkcyBhIGNvbW1lbnQgdG8gYSBwcm9jZXNzIGluc3RhbmNlLlxuICAgICAqIEBwYXJhbSBwcm9jZXNzSW5zdGFuY2VJZCBJRCBvZiB0aGUgdGFyZ2V0IHByb2Nlc3MgaW5zdGFuY2VcbiAgICAgKiBAcGFyYW0gbWVzc2FnZSBUZXh0IGZvciB0aGUgY29tbWVudFxuICAgICAqIEByZXR1cm5zIERldGFpbHMgb2YgdGhlIGNvbW1lbnQgYWRkZWRcbiAgICAgKi9cbiAgICBhZGRQcm9jZXNzSW5zdGFuY2VDb21tZW50KHByb2Nlc3NJbnN0YW5jZUlkOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZyk6IE9ic2VydmFibGU8Q29tbWVudE1vZGVsPiB7XG4gICAgICAgIHJldHVybiBmcm9tKFxuICAgICAgICAgICAgdGhpcy5jb21tZW50c0FwaS5hZGRQcm9jZXNzSW5zdGFuY2VDb21tZW50KHsgbWVzc2FnZTogbWVzc2FnZSB9LCBwcm9jZXNzSW5zdGFuY2VJZClcbiAgICAgICAgKS5waXBlKFxuICAgICAgICAgICAgbWFwKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ29tbWVudE1vZGVsKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHJlc3BvbnNlLmlkLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiByZXNwb25zZS5tZXNzYWdlLFxuICAgICAgICAgICAgICAgICAgICBjcmVhdGVkOiByZXNwb25zZS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQnk6IHJlc3BvbnNlLmNyZWF0ZWRCeVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnI6IGFueSkgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlRXJyb3IoZXJyb3I6IGFueSkge1xuICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm4gdGhyb3dFcnJvcihlcnJvciB8fCAnU2VydmVyIGVycm9yJyk7XG4gICAgfVxuXG59XG4iXX0=