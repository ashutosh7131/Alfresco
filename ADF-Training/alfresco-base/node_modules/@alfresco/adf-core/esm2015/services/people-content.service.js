import { __awaiter } from "tslib";
import { Injectable } from '@angular/core';
import { from, throwError } from 'rxjs';
import { AlfrescoApiService } from './alfresco-api.service';
import { catchError, map } from 'rxjs/operators';
import { PeopleApi } from '@alfresco/js-api';
import { LogService } from './log.service';
import * as i0 from "@angular/core";
import * as i1 from "./alfresco-api.service";
import * as i2 from "./log.service";
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './alfresco-api.service';
import * as ɵngcc2 from './log.service';
export var ContentGroups;
(function (ContentGroups) {
    ContentGroups["ALFRESCO_ADMINISTRATORS"] = "ALFRESCO_ADMINISTRATORS";
})(ContentGroups || (ContentGroups = {}));
export class PeopleContentService {
    constructor(apiService, logService) {
        this.apiService = apiService;
        this.logService = logService;
        this.hasContentAdminRole = false;
        this.hasCheckedIsContentAdmin = false;
    }
    get peopleApi() {
        var _a;
        this._peopleApi = (_a = this._peopleApi) !== null && _a !== void 0 ? _a : new PeopleApi(this.apiService.getInstance());
        return this._peopleApi;
    }
    getPerson(personId) {
        const promise = this.peopleApi.getPerson(personId);
        return from(promise).pipe(catchError((error) => this.handleError(error)));
    }
    getCurrentPerson() {
        return this.getPerson('-me-');
    }
    listPeople(requestQuery) {
        const requestQueryParams = { skipCount: requestQuery === null || requestQuery === void 0 ? void 0 : requestQuery.skipCount, maxItems: requestQuery === null || requestQuery === void 0 ? void 0 : requestQuery.maxItems };
        const orderBy = this.buildOrderArray(requestQuery === null || requestQuery === void 0 ? void 0 : requestQuery.sorting);
        if (orderBy.length) {
            requestQueryParams['orderBy'] = orderBy;
        }
        const promise = this.peopleApi.listPeople(requestQueryParams);
        return from(promise).pipe(map(response => {
            return {
                pagination: response.list.pagination,
                entries: response.list.entries.map((person) => person.entry)
            };
        }), catchError((err) => this.handleError(err)));
    }
    createPerson(newPerson, opts) {
        return from(this.peopleApi.createPerson(newPerson, opts)).pipe(map((res) => res === null || res === void 0 ? void 0 : res.entry), catchError((error) => this.handleError(error)));
    }
    isContentAdmin() {
        var _a, _b;
        return __awaiter(this, void 0, void 0, function* () {
            if (!this.hasCheckedIsContentAdmin) {
                const user = yield this.getCurrentPerson().toPromise();
                this.hasContentAdminRole = (_b = (_a = user === null || user === void 0 ? void 0 : user.entry) === null || _a === void 0 ? void 0 : _a.capabilities) === null || _b === void 0 ? void 0 : _b.isAdmin;
                this.hasCheckedIsContentAdmin = true;
            }
            return this.hasContentAdminRole;
        });
    }
    buildOrderArray(sorting) {
        return (sorting === null || sorting === void 0 ? void 0 : sorting.orderBy) && (sorting === null || sorting === void 0 ? void 0 : sorting.direction) ? [`${sorting.orderBy} ${sorting.direction.toUpperCase()}`] : [];
    }
    handleError(error) {
        this.logService.error(error);
        return throwError(error || 'Server error');
    }
}
PeopleContentService.ɵfac = function PeopleContentService_Factory(t) { return new (t || PeopleContentService)(ɵngcc0.ɵɵinject(ɵngcc1.AlfrescoApiService), ɵngcc0.ɵɵinject(ɵngcc2.LogService)); };
PeopleContentService.ɵprov = i0.ɵɵdefineInjectable({ factory: function PeopleContentService_Factory() { return new PeopleContentService(i0.ɵɵinject(i1.AlfrescoApiService), i0.ɵɵinject(i2.LogService)); }, token: PeopleContentService, providedIn: "root" });
PeopleContentService.ctorParameters = () => [
    { type: AlfrescoApiService },
    { type: LogService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(PeopleContentService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.AlfrescoApiService }, { type: ɵngcc2.LogService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGVvcGxlLWNvbnRlbnQuc2VydmljZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL2NvcmUvc2VydmljZXMvcGVvcGxlLWNvbnRlbnQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBaUJBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFjLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDcEQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDNUQsT0FBTyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqRCxPQUFPLEVBQWUsU0FBUyxFQUFnQyxNQUFNLGtCQUFrQixDQUFDO0FBRXhGLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0M7QUFFUTtBQUE4Qzs7OztBQUR0RCxNQUFNLENBQU4sSUFBWSxhQUVYO0FBRkQsV0FBWSxhQUFhO0FBQ3hCLElBQUcsb0VBQW1ELENBQUE7QUFDdkQsQ0FBQyxFQUZXLGFBQWEsS0FBYixhQUFhLFFBRXhCO0FBcUJELE1BQU0sT0FBTyxvQkFBb0I7QUFDakMsSUFTSSxZQUFvQixVQUE4QixFQUFVLFVBQXNCO0FBQ3RGLFFBRHdCLGVBQVUsR0FBVixVQUFVLENBQW9CO0FBQUMsUUFBUyxlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQUMsUUFUM0Usd0JBQW1CLEdBQVksS0FBSyxDQUFDO0FBQ2pELFFBQUksNkJBQXdCLEdBQVksS0FBSyxDQUFDO0FBQzlDLElBUUksQ0FBQztBQUNMLElBUEksSUFBSSxTQUFTO0FBQUs7QUFDakIsUUFBRyxJQUFJLENBQUMsVUFBVSxTQUFHLElBQUksQ0FBQyxVQUFVLG1DQUFJLElBQUksU0FBUyxD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LGdCQUFZLElBQUksQ0FBQyx3QkFBd0IsR0FBRyxJQUFJLENBQUM7QUFDakQsYUFBUztBQUNULFlBQVEsT0FBTyxJQUFJLENBQUMsbUJBQW1CLENBQUM7QUFDeEM7QUFFSyxLQUZBO0FBQ0wsSUFDWSxlQUFlLENBQUMsT0FBa0M7QUFBSSxRQUMxRCxPQUFPLENBQUEsT0FBTyxhQUFQLE9BQU8sdUJBQVAsT0FBTyxDQUFFLE9BQU8sTUFBSSxPQUFPLGFBQVAsT0FBTyx1QkFBUCxPQUFPLENBQUUsU0FBUyxDQUFBLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUMsT0FBTyxJQUFJLE9BQU8sQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFDdkgsSUFBSSxDQUFDO0FBQ0wsSUFDWSxXQUFXLENBQUMsS0FBVTtBQUNsQyxRQUFRLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3JDLFFBQVEsT0FBTyxVQUFVLENBQUMsS0FBSyxJQUFJLGNBQWMsQ0FBQyxDQUFDO0FBQ25ELElBQUksQ0FBQztBQUNMO2lNQUFDO0FBQ0QsK1BBekZLO0FBQUM7RUFITCxVQUFVLFNBQUMsckJBSUksWUE5QlAsa0JBQWtCO0tBMkJ2QixVQUFVLEVBQUUsTUFBTSx2QkEzQlMsWUFJdEIsVUFBVTtBQUFHO1NBd0JyQjs7Ozs7Z0hBeEJ1QjtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZnJvbSwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgQWxmcmVzY29BcGlTZXJ2aWNlIH0gZnJvbSAnLi9hbGZyZXNjby1hcGkuc2VydmljZSc7XG5pbXBvcnQgeyBjYXRjaEVycm9yLCBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBQZXJzb25FbnRyeSwgUGVvcGxlQXBpLCBQZXJzb25Cb2R5Q3JlYXRlLCBQYWdpbmF0aW9uIH0gZnJvbSAnQGFsZnJlc2NvL2pzLWFwaSc7XG5pbXBvcnQgeyBFY21Vc2VyTW9kZWwgfSBmcm9tICcuLi9tb2RlbHMvZWNtLXVzZXIubW9kZWwnO1xuaW1wb3J0IHsgTG9nU2VydmljZSB9IGZyb20gJy4vbG9nLnNlcnZpY2UnO1xuXG5leHBvcnQgZW51bSBDb250ZW50R3JvdXBzIHtcbiAgICBBTEZSRVNDT19BRE1JTklTVFJBVE9SUyA9ICdBTEZSRVNDT19BRE1JTklTVFJBVE9SUydcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQZW9wbGVDb250ZW50UXVlcnlSZXNwb25zZSB7XG4gICAgcGFnaW5hdGlvbjogUGFnaW5hdGlvbjtcbiAgICBlbnRyaWVzOiBFY21Vc2VyTW9kZWxbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQZW9wbGVDb250ZW50U29ydGluZ01vZGVsIHtcbiAgICBvcmRlckJ5OiBzdHJpbmc7XG4gICAgZGlyZWN0aW9uOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGVvcGxlQ29udGVudFF1ZXJ5UmVxdWVzdE1vZGVsIHtcbiAgICBza2lwQ291bnQ/OiBudW1iZXI7XG4gICAgbWF4SXRlbXM/OiBudW1iZXI7XG4gICAgc29ydGluZz86IFBlb3BsZUNvbnRlbnRTb3J0aW5nTW9kZWw7XG59XG5cbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgUGVvcGxlQ29udGVudFNlcnZpY2Uge1xuICAgIHByaXZhdGUgaGFzQ29udGVudEFkbWluUm9sZTogYm9vbGVhbiA9IGZhbHNlO1xuICAgIGhhc0NoZWNrZWRJc0NvbnRlbnRBZG1pbjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgX3Blb3BsZUFwaTogUGVvcGxlQXBpO1xuICAgIGdldCBwZW9wbGVBcGkoKTogUGVvcGxlQXBpIHtcbiAgICAgICAgdGhpcy5fcGVvcGxlQXBpID0gdGhpcy5fcGVvcGxlQXBpID8/IG5ldyBQZW9wbGVBcGkodGhpcy5hcGlTZXJ2aWNlLmdldEluc3RhbmNlKCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5fcGVvcGxlQXBpO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYXBpU2VydmljZTogQWxmcmVzY29BcGlTZXJ2aWNlLCBwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UpIHtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIGluZm9ybWF0aW9uIGFib3V0IGEgdXNlciBpZGVudGlmaWVkIGJ5IHRoZWlyIHVzZXJuYW1lLlxuICAgICAqIEBwYXJhbSBwZXJzb25JZCBJRCBvZiB0aGUgdGFyZ2V0IHVzZXJcbiAgICAgKiBAcmV0dXJucyBVc2VyIGluZm9ybWF0aW9uXG4gICAgICovXG4gICAgZ2V0UGVyc29uKHBlcnNvbklkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICBjb25zdCBwcm9taXNlID0gdGhpcy5wZW9wbGVBcGkuZ2V0UGVyc29uKHBlcnNvbklkKTtcblxuICAgICAgICByZXR1cm4gZnJvbShwcm9taXNlKS5waXBlKFxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3IpID0+IHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHVzZXIgd2hvIGlzIGN1cnJlbnRseSBsb2dnZWQgaW4uXG4gICAgICogQHJldHVybnMgVXNlciBpbmZvcm1hdGlvblxuICAgICAqL1xuICAgIGdldEN1cnJlbnRQZXJzb24oKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGVyc29uKCctbWUtJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhIGxpc3Qgb2YgcGVvcGxlLlxuICAgICAqIEBwYXJhbSByZXF1ZXN0UXVlcnkgbWF4SXRlbXMgYW5kIHNraXBDb3VudCBwYXJhbWV0ZXJzIHN1cHBvcnRlZCBieSBKUy1BUElcbiAgICAgKiBAcmV0dXJucyBSZXNwb25zZSBjb250YWluaW5nIHBhZ2luYXRpb24gYW5kIGxpc3Qgb2YgZW50cmllc1xuICAgICAqL1xuICAgIGxpc3RQZW9wbGUocmVxdWVzdFF1ZXJ5PzogUGVvcGxlQ29udGVudFF1ZXJ5UmVxdWVzdE1vZGVsKTogT2JzZXJ2YWJsZTxQZW9wbGVDb250ZW50UXVlcnlSZXNwb25zZT4ge1xuICAgICAgICBjb25zdCByZXF1ZXN0UXVlcnlQYXJhbXMgPSB7IHNraXBDb3VudDogcmVxdWVzdFF1ZXJ5Py5za2lwQ291bnQsIG1heEl0ZW1zOiByZXF1ZXN0UXVlcnk/Lm1heEl0ZW1zIH07XG4gICAgICAgIGNvbnN0IG9yZGVyQnkgPSB0aGlzLmJ1aWxkT3JkZXJBcnJheShyZXF1ZXN0UXVlcnk/LnNvcnRpbmcpO1xuICAgICAgICBpZiAob3JkZXJCeS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJlcXVlc3RRdWVyeVBhcmFtc1snb3JkZXJCeSddID0gb3JkZXJCeTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHByb21pc2UgPSB0aGlzLnBlb3BsZUFwaS5saXN0UGVvcGxlKHJlcXVlc3RRdWVyeVBhcmFtcyk7XG4gICAgICAgIHJldHVybiBmcm9tKHByb21pc2UpLnBpcGUoXG4gICAgICAgICAgICBtYXAocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb246IHJlc3BvbnNlLmxpc3QucGFnaW5hdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZW50cmllczogcmVzcG9uc2UubGlzdC5lbnRyaWVzLm1hcCgocGVyc29uOiBQZXJzb25FbnRyeSkgPT4gPEVjbVVzZXJNb2RlbD4gcGVyc29uLmVudHJ5KVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnIpKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgbmV3IHBlcnNvbi5cbiAgICAgKiBAcGFyYW0gbmV3UGVyc29uIE9iamVjdCBjb250YWluaW5nIHRoZSBuZXcgcGVyc29uIGRldGFpbHMuXG4gICAgICogQHBhcmFtIG9wdHMgT3B0aW9uYWwgcGFyYW1ldGVyc1xuICAgICAqIEByZXR1cm5zIENyZWF0ZWQgbmV3IHBlcnNvblxuICAgICAqL1xuICAgIGNyZWF0ZVBlcnNvbihuZXdQZXJzb246IFBlcnNvbkJvZHlDcmVhdGUsIG9wdHM/OiBhbnkpOiBPYnNlcnZhYmxlPEVjbVVzZXJNb2RlbD4ge1xuICAgICAgICByZXR1cm4gZnJvbSh0aGlzLnBlb3BsZUFwaS5jcmVhdGVQZXJzb24obmV3UGVyc29uLCBvcHRzKSkucGlwZShcbiAgICAgICAgICAgIG1hcCgocmVzOiBQZXJzb25FbnRyeSkgPT4gPEVjbVVzZXJNb2RlbD4gcmVzPy5lbnRyeSksXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcikgPT4gdGhpcy5oYW5kbGVFcnJvcihlcnJvcikpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgYXN5bmMgaXNDb250ZW50QWRtaW4oKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIGlmICghdGhpcy5oYXNDaGVja2VkSXNDb250ZW50QWRtaW4pIHtcbiAgICAgICAgICAgIGNvbnN0IHVzZXI6IFBlcnNvbkVudHJ5ID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50UGVyc29uKCkudG9Qcm9taXNlKCk7XG4gICAgICAgICAgICB0aGlzLmhhc0NvbnRlbnRBZG1pblJvbGUgPSB1c2VyPy5lbnRyeT8uY2FwYWJpbGl0aWVzPy5pc0FkbWluO1xuICAgICAgICAgICAgdGhpcy5oYXNDaGVja2VkSXNDb250ZW50QWRtaW4gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmhhc0NvbnRlbnRBZG1pblJvbGU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBidWlsZE9yZGVyQXJyYXkoc29ydGluZzogUGVvcGxlQ29udGVudFNvcnRpbmdNb2RlbCk6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIHNvcnRpbmc/Lm9yZGVyQnkgJiYgc29ydGluZz8uZGlyZWN0aW9uID8gW2Ake3NvcnRpbmcub3JkZXJCeX0gJHtzb3J0aW5nLmRpcmVjdGlvbi50b1VwcGVyQ2FzZSgpfWBdIDogW107XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVFcnJvcihlcnJvcjogYW55KSB7XG4gICAgICAgIHRoaXMubG9nU2VydmljZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybiB0aHJvd0Vycm9yKGVycm9yIHx8ICdTZXJ2ZXIgZXJyb3InKTtcbiAgICB9XG59XG4iXX0=