import { Injectable } from '@angular/core';
import { StorageService } from './storage.service';
import * as i0 from "@angular/core";
import * as i1 from "./storage.service";
export class JwtHelperService {
    constructor(storageService) {
        this.storageService = storageService;
    }
    decodeToken(token) {
        const parts = token.split('.');
        if (parts.length !== 3) {
            throw new Error('JWT must have 3 parts');
        }
        const decoded = this.urlBase64Decode(parts[1]);
        if (!decoded) {
            throw new Error('Cannot decode the token');
        }
        return JSON.parse(decoded);
    }
    urlBase64Decode(token) {
        let output = token.replace(/-/g, '+').replace(/_/g, '/');
        switch (output.length % 4) {
            case 0: {
                break;
            }
            case 2: {
                output += '==';
                break;
            }
            case 3: {
                output += '=';
                break;
            }
            default: {
                throw new Error('Illegal base64url string!');
            }
        }
        return decodeURIComponent(escape(window.atob(output)));
    }
    getValueFromLocalAccessToken(key) {
        return this.getValueFromToken(this.getAccessToken(), key);
    }
    getAccessToken() {
        return this.storageService.getItem(JwtHelperService.USER_ACCESS_TOKEN);
    }
    getValueFromToken(accessToken, key) {
        let value;
        if (accessToken) {
            const tokenPayload = this.decodeToken(accessToken);
            value = tokenPayload[key];
        }
        return value;
    }
    getRealmRoles() {
        const access = this.getValueFromLocalAccessToken(JwtHelperService.REALM_ACCESS);
        return access ? access['roles'] : [];
    }
    getClientRoles(clientName) {
        const clientRole = this.getValueFromLocalAccessToken(JwtHelperService.RESOURCE_ACCESS)[clientName];
        return clientRole ? clientRole['roles'] : [];
    }
    hasRealmRole(role) {
        let hasRole = false;
        if (this.getAccessToken()) {
            const realmRoles = this.getRealmRoles();
            hasRole = realmRoles.some((currentRole) => {
                return currentRole === role;
            });
        }
        return hasRole;
    }
    hasRealmRoles(rolesToCheck) {
        return rolesToCheck.some((currentRole) => {
            return this.hasRealmRole(currentRole);
        });
    }
    hasRealmRolesForClientRole(clientName, rolesToCheck) {
        return rolesToCheck.some((currentRole) => {
            return this.hasClientRole(clientName, currentRole);
        });
    }
    hasClientRole(clientName, role) {
        let hasRole = false;
        if (this.getAccessToken()) {
            const clientRoles = this.getClientRoles(clientName);
            hasRole = clientRoles.some((currentRole) => {
                return currentRole === role;
            });
        }
        return hasRole;
    }
}
JwtHelperService.USER_NAME = 'name';
JwtHelperService.FAMILY_NAME = 'family_name';
JwtHelperService.GIVEN_NAME = 'given_name';
JwtHelperService.USER_EMAIL = 'email';
JwtHelperService.USER_ACCESS_TOKEN = 'access_token';
JwtHelperService.REALM_ACCESS = 'realm_access';
JwtHelperService.RESOURCE_ACCESS = 'resource_access';
JwtHelperService.USER_PREFERRED_USERNAME = 'preferred_username';
JwtHelperService.ɵprov = i0.ɵɵdefineInjectable({ factory: function JwtHelperService_Factory() { return new JwtHelperService(i0.ɵɵinject(i1.StorageService)); }, token: JwtHelperService, providedIn: "root" });
JwtHelperService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
JwtHelperService.ctorParameters = () => [
    { type: StorageService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiand0LWhlbHBlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Ii9ob21lL3RyYXZpcy9idWlsZC9BbGZyZXNjby9hbGZyZXNjby1uZzItY29tcG9uZW50cy9saWIvY29yZS8iLCJzb3VyY2VzIjpbInNlcnZpY2VzL2p3dC1oZWxwZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFpQkEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7OztBQUtuRCxNQUFNLE9BQU8sZ0JBQWdCO0lBV3pCLFlBQW9CLGNBQThCO1FBQTlCLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtJQUNsRCxDQUFDO0lBT0QsV0FBVyxDQUFDLEtBQUs7UUFDYixNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRS9CLElBQUksS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDcEIsTUFBTSxJQUFJLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1NBQzVDO1FBRUQsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMvQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ1YsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1NBQzlDO1FBRUQsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQy9CLENBQUM7SUFFTyxlQUFlLENBQUMsS0FBSztRQUN6QixJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3pELFFBQVEsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDdkIsS0FBSyxDQUFDLENB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SUFBSSxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNwRCxPQUFPLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLFdBQVcsRUFBRSxFQUFFO2dCQUN2QyxPQUFPLFdBQVcsS0FBSyxJQUFJLENBQUM7WUFDaEMsQ0FBQyxDQUFDLENBQUM7U0FDTjtRQUNELE9BQU8sT0FBTyxDQUFDO0lBQ25CLENBQUM7O0FBN0pNLDBCQUFTLEdBQUcsTUFBTSxDQUFDO0FBQ25CLDRCQUFXLEdBQUcsYUFBYSxDQUFDO0FBQzVCLDJCQUFVLEdBQUcsWUFBWSxDQUFDO0FBQzFCLDJCQUFVLEdBQUcsT0FBTyxDQUFDO0FBQ3JCLGtDQUFpQixHQUFHLGNBQWMsQ0FBQztBQUNuQyw2QkFBWSxHQUFHLGNBQWMsQ0FBQztBQUM5QixnQ0FBZSxHQUFHLGlCQUFpQixDQUFDO0FBQ3BDLHdDQUF1QixHQUFHLG9CQUFvQixDQUFDOzs7WUFaekQsVUFBVSxTQUFDO2dCQUNSLFVBQVUsRUFBRSxNQUFNO2FBQ3JCOzs7WUFKUSxjQUFjIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3RvcmFnZVNlcnZpY2UgfSBmcm9tICcuL3N0b3JhZ2Uuc2VydmljZSc7XG5cbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgSnd0SGVscGVyU2VydmljZSB7XG5cbiAgICBzdGF0aWMgVVNFUl9OQU1FID0gJ25hbWUnO1xuICAgIHN0YXRpYyBGQU1JTFlfTkFNRSA9ICdmYW1pbHlfbmFtZSc7XG4gICAgc3RhdGljIEdJVkVOX05BTUUgPSAnZ2l2ZW5fbmFtZSc7XG4gICAgc3RhdGljIFVTRVJfRU1BSUwgPSAnZW1haWwnO1xuICAgIHN0YXRpYyBVU0VSX0FDQ0VTU19UT0tFTiA9ICdhY2Nlc3NfdG9rZW4nO1xuICAgIHN0YXRpYyBSRUFMTV9BQ0NFU1MgPSAncmVhbG1fYWNjZXNzJztcbiAgICBzdGF0aWMgUkVTT1VSQ0VfQUNDRVNTID0gJ3Jlc291cmNlX2FjY2Vzcyc7XG4gICAgc3RhdGljIFVTRVJfUFJFRkVSUkVEX1VTRVJOQU1FID0gJ3ByZWZlcnJlZF91c2VybmFtZSc7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHN0b3JhZ2VTZXJ2aWNlOiBTdG9yYWdlU2VydmljZSkge1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlY29kZXMgYSBKU09OIHdlYiB0b2tlbiBpbnRvIGEgSlMgb2JqZWN0LlxuICAgICAqIEBwYXJhbSB0b2tlbiBUb2tlbiBpbiBlbmNvZGVkIGZvcm1cbiAgICAgKiBAcmV0dXJucyBEZWNvZGVkIHRva2VuIGRhdGEgb2JqZWN0XG4gICAgICovXG4gICAgZGVjb2RlVG9rZW4odG9rZW4pOiBPYmplY3Qge1xuICAgICAgICBjb25zdCBwYXJ0cyA9IHRva2VuLnNwbGl0KCcuJyk7XG5cbiAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCAhPT0gMykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdKV1QgbXVzdCBoYXZlIDMgcGFydHMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGRlY29kZWQgPSB0aGlzLnVybEJhc2U2NERlY29kZShwYXJ0c1sxXSk7XG4gICAgICAgIGlmICghZGVjb2RlZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgZGVjb2RlIHRoZSB0b2tlbicpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZGVjb2RlZCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cmxCYXNlNjREZWNvZGUodG9rZW4pOiBzdHJpbmcge1xuICAgICAgICBsZXQgb3V0cHV0ID0gdG9rZW4ucmVwbGFjZSgvLS9nLCAnKycpLnJlcGxhY2UoL18vZywgJy8nKTtcbiAgICAgICAgc3dpdGNoIChvdXRwdXQubGVuZ3RoICUgNCkge1xuICAgICAgICAgICAgY2FzZSAwOiB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIDI6IHtcbiAgICAgICAgICAgICAgICBvdXRwdXQgKz0gJz09JztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgMzoge1xuICAgICAgICAgICAgICAgIG91dHB1dCArPSAnPSc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbGxlZ2FsIGJhc2U2NHVybCBzdHJpbmchJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUod2luZG93LmF0b2Iob3V0cHV0KSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgYSBuYW1lZCB2YWx1ZSBmcm9tIHRoZSB1c2VyIGFjY2VzcyB0b2tlbi5cbiAgICAgKiBAcGFyYW0ga2V5IEtleSBuYW1lIG9mIHRoZSBmaWVsZCB0byByZXRyaWV2ZVxuICAgICAqIEByZXR1cm5zIFZhbHVlIGZyb20gdGhlIHRva2VuXG4gICAgICovXG4gICAgZ2V0VmFsdWVGcm9tTG9jYWxBY2Nlc3NUb2tlbjxUPihrZXk6IHN0cmluZyk6IFQge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZUZyb21Ub2tlbih0aGlzLmdldEFjY2Vzc1Rva2VuKCksIGtleSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBhY2Nlc3MgdG9rZW5cbiAgICAgKiBAcmV0dXJucyBhY2Nlc3MgdG9rZW5cbiAgICAgKi9cbiAgICBnZXRBY2Nlc3NUb2tlbigpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5zdG9yYWdlU2VydmljZS5nZXRJdGVtKEp3dEhlbHBlclNlcnZpY2UuVVNFUl9BQ0NFU1NfVE9LRU4pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgYSBuYW1lZCB2YWx1ZSBmcm9tIHRoZSB1c2VyIGFjY2VzcyB0b2tlbi5cbiAgICAgKiBAcGFyYW0gYWNjZXNzVG9rZW4geW91ciBTU08gYWNjZXNzIHRva2VuIHdoZXJlIHRoZSB2YWx1ZSBpcyBlbmNvZGVcbiAgICAgKiBAcGFyYW0ga2V5IEtleSBuYW1lIG9mIHRoZSBmaWVsZCB0byByZXRyaWV2ZVxuICAgICAqIEByZXR1cm5zIFZhbHVlIGZyb20gdGhlIHRva2VuXG4gICAgICovXG4gICAgZ2V0VmFsdWVGcm9tVG9rZW48VD4oYWNjZXNzVG9rZW46IHN0cmluZywga2V5OiBzdHJpbmcpOiBUIHtcbiAgICAgICAgbGV0IHZhbHVlO1xuICAgICAgICBpZiAoYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgIGNvbnN0IHRva2VuUGF5bG9hZCA9IHRoaXMuZGVjb2RlVG9rZW4oYWNjZXNzVG9rZW4pO1xuICAgICAgICAgICAgdmFsdWUgPSB0b2tlblBheWxvYWRba2V5XTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gPFQ+IHZhbHVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgcmVhbG0gcm9sZXMuXG4gICAgICogQHJldHVybnMgQXJyYXkgb2YgcmVhbG0gcm9sZXNcbiAgICAgKi9cbiAgICBnZXRSZWFsbVJvbGVzKCk6IHN0cmluZ1tdIHtcbiAgICAgICAgY29uc3QgYWNjZXNzID0gdGhpcy5nZXRWYWx1ZUZyb21Mb2NhbEFjY2Vzc1Rva2VuPGFueT4oSnd0SGVscGVyU2VydmljZS5SRUFMTV9BQ0NFU1MpO1xuICAgICAgICByZXR1cm4gYWNjZXNzID8gYWNjZXNzWydyb2xlcyddIDogW107XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBDbGllbnQgcm9sZXMuXG4gICAgICogQHJldHVybnMgQXJyYXkgb2YgY2xpZW50IHJvbGVzXG4gICAgICovXG4gICAgZ2V0Q2xpZW50Um9sZXMoY2xpZW50TmFtZTogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICBjb25zdCBjbGllbnRSb2xlID0gdGhpcy5nZXRWYWx1ZUZyb21Mb2NhbEFjY2Vzc1Rva2VuPGFueT4oSnd0SGVscGVyU2VydmljZS5SRVNPVVJDRV9BQ0NFU1MpW2NsaWVudE5hbWVdO1xuICAgICAgICByZXR1cm4gY2xpZW50Um9sZSA/IGNsaWVudFJvbGVbJ3JvbGVzJ10gOiBbXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgZm9yIHNpbmdsZSByZWFsbSByb2xlLlxuICAgICAqIEBwYXJhbSByb2xlIFJvbGUgbmFtZSB0byBjaGVja1xuICAgICAqIEByZXR1cm5zIFRydWUgaWYgaXQgY29udGFpbnMgZ2l2ZW4gcm9sZSwgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICovXG4gICAgaGFzUmVhbG1Sb2xlKHJvbGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICBsZXQgaGFzUm9sZSA9IGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5nZXRBY2Nlc3NUb2tlbigpKSB7XG4gICAgICAgICAgICBjb25zdCByZWFsbVJvbGVzID0gdGhpcy5nZXRSZWFsbVJvbGVzKCk7XG4gICAgICAgICAgICBoYXNSb2xlID0gcmVhbG1Sb2xlcy5zb21lKChjdXJyZW50Um9sZSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50Um9sZSA9PT0gcm9sZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBoYXNSb2xlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBmb3IgcmVhbG0gcm9sZXMuXG4gICAgICogQHBhcmFtIHJvbGVzVG9DaGVjayBMaXN0IG9mIHJvbGUgbmFtZXMgdG8gY2hlY2tcbiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIGl0IGNvbnRhaW5zIGF0IGxlYXN0IG9uZSBvZiB0aGUgZ2l2ZW4gcm9sZXMsIGZhbHNlIG90aGVyd2lzZVxuICAgICAqL1xuICAgIGhhc1JlYWxtUm9sZXMocm9sZXNUb0NoZWNrOiBzdHJpbmcgW10pOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHJvbGVzVG9DaGVjay5zb21lKChjdXJyZW50Um9sZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGFzUmVhbG1Sb2xlKGN1cnJlbnRSb2xlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGZvciBjbGllbnQgcm9sZXMuXG4gICAgICogQHBhcmFtIGNsaWVudE5hbWUgVGFyZ2V0ZWQgY2xpZW50IG5hbWVcbiAgICAgKiBAcGFyYW0gcm9sZXNUb0NoZWNrIExpc3Qgb2Ygcm9sZSBuYW1lcyB0byBjaGVja1xuICAgICAqIEByZXR1cm5zIFRydWUgaWYgaXQgY29udGFpbnMgYXQgbGVhc3Qgb25lIG9mIHRoZSBnaXZlbiByb2xlcywgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICovXG4gICAgaGFzUmVhbG1Sb2xlc0ZvckNsaWVudFJvbGUoY2xpZW50TmFtZTogc3RyaW5nLCByb2xlc1RvQ2hlY2s6IHN0cmluZyBbXSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gcm9sZXNUb0NoZWNrLnNvbWUoKGN1cnJlbnRSb2xlKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5oYXNDbGllbnRSb2xlKGNsaWVudE5hbWUsIGN1cnJlbnRSb2xlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGZvciBjbGllbnQgcm9sZS5cbiAgICAgKiBAcGFyYW0gY2xpZW50TmFtZSBUYXJnZXRlZCBjbGllbnQgbmFtZVxuICAgICAqIEBwYXJhbSByb2xlIFJvbGUgbmFtZSB0byBjaGVja1xuICAgICAqIEByZXR1cm5zIFRydWUgaWYgaXQgY29udGFpbnMgZ2l2ZW4gcm9sZSwgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICovXG4gICAgaGFzQ2xpZW50Um9sZShjbGllbnROYW1lOiBzdHJpbmcsIHJvbGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICBsZXQgaGFzUm9sZSA9IGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5nZXRBY2Nlc3NUb2tlbigpKSB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnRSb2xlcyA9IHRoaXMuZ2V0Q2xpZW50Um9sZXMoY2xpZW50TmFtZSk7XG4gICAgICAgICAgICBoYXNSb2xlID0gY2xpZW50Um9sZXMuc29tZSgoY3VycmVudFJvbGUpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudFJvbGUgPT09IHJvbGU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaGFzUm9sZTtcbiAgICB9XG59XG4iXX0=