/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { __awaiter } from "tslib";
import { Directive, HostListener, Input, Output, EventEmitter } from '@angular/core';
import { FavoritesApi } from '@alfresco/js-api';
import { AlfrescoApiService } from '../services/alfresco-api.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../services/alfresco-api.service';
export class LibraryFavoriteDirective {
    constructor(alfrescoApiService) {
        this.alfrescoApiService = alfrescoApiService;
        this.library = null;
        this.toggle = new EventEmitter();
        this.error = new EventEmitter();
        this.targetLibrary = null;
    }
    get favoritesApi() {
        var _a;
        this._favoritesApi = (_a = this._favoritesApi) !== null && _a !== void 0 ? _a : new FavoritesApi(this.alfrescoApiService.getInstance());
        return this._favoritesApi;
    }
    onClick() {
        const guid = this.targetLibrary.entry.guid;
        if (this.targetLibrary.isFavorite) {
            this.removeFavorite(guid);
        }
        else {
            this.addFavorite({
                target: {
                    site: {
                        guid
                    }
                }
            });
        }
    }
    ngOnChanges(changes) {
        if (!changes.library.currentValue) {
            this.targetLibrary = null;
            return;
        }
        this.targetLibrary = changes.library.currentValue;
        this.markFavoriteLibrary(changes.library.currentValue);
    }
    isFavorite() {
        return this.targetLibrary && this.targetLibrary.isFavorite;
    }
    markFavoriteLibrary(library) {
        return __awaiter(this, void 0, void 0, function* () {
            if (this.targetLibrary.isFavorite === undefined) {
                try {
                    yield this.favoritesApi.getFavoriteSite('-me-', library.entry.id);
                    this.targetLibrary.isFavorite = true;
                }
                catch (_a) {
                    this.targetLibrary.isFavorite = false;
                }
            }
            else {
                this.targetLibrary = library;
            }
        });
    }
    addFavorite(favoriteBody) {
        this.favoritesApi
            .createFavorite('-me-', favoriteBody)
            .then((libraryEntry) => {
            this.targetLibrary.isFavorite = true;
            this.toggle.emit(libraryEntry);
        })
            .catch((error) => this.error.emit(error));
    }
    removeFavorite(favoriteId) {
        this.favoritesApi
            .deleteFavorite('-me-', favoriteId)
            .then((libraryBody) => {
            this.targetLibrary.isFavorite = false;
            this.toggle.emit(libraryBody);
        })
            .catch((error) => this.error.emit(error));
    }
}
LibraryFavoriteDirective.ɵfac = function LibraryFavoriteDirective_Factory(t) { return new (t || LibraryFavoriteDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.AlfrescoApiService)); };
LibraryFavoriteDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: LibraryFavoriteDirective, selectors: [["", "adf-favorite-library", ""]], hostBindings: function LibraryFavoriteDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function LibraryFavoriteDirective_click_HostBindingHandler() { return ctx.onClick(); });
    } }, inputs: { library: ["adf-favorite-library", "library"] }, outputs: { toggle: "toggle", error: "error" }, exportAs: ["favoriteLibrary"], features: [ɵngcc0.ɵɵNgOnChangesFeature] });
LibraryFavoriteDirective.ctorParameters = () => [
    { type: AlfrescoApiService }
];
LibraryFavoriteDirective.propDecorators = {
    library: [{ type: Input, args: ['adf-favorite-library',] }],
    toggle: [{ type: Output }],
    error: [{ type: Output }],
    onClick: [{ type: HostListener, args: ['click',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(LibraryFavoriteDirective, [{
        type: Directive,
        args: [{
                selector: '[adf-favorite-library]',
                exportAs: 'favoriteLibrary'
            }]
    }], function () { return [{ type: ɵngcc1.AlfrescoApiService }]; }, { library: [{
            type: Input,
            args: ['adf-favorite-library']
        }], toggle: [{
            type: Output
        }], error: [{
            type: Output
        }], onClick: [{
            type: HostListener,
            args: ['click']
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlicmFyeS1mYXZvcml0ZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2hvbWUvdHJhdmlzL2J1aWxkL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2xpYi9jb3JlL2RpcmVjdGl2ZXMvbGlicmFyeS1mYXZvcml0ZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFhLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEcsT0FBTyxFQUErQyxZQUFZLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUM3RixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQzs7O0FBWXRFLE1BQU0sT0FBTyx3QkFBd0I7QUFBRyxJQWlDcEMsWUFBb0Isa0JBQXNDO0FBQzlELFFBRHdCLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7QUFBQyxRQS9CM0QsWUFBTyxHQUFrQixJQUFJLENBQUM7QUFDbEMsUUFDYyxXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztBQUMvQyxRQUNjLFVBQUssR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO0FBQzlDLFFBQ1ksa0JBQWEsR0FBRyxJQUFJLENBQUM7QUFDakMsSUF5QkksQ0FBQztBQUNMLElBeEJJLElBQUksWUFBWTtBQUFLO0FBQ3ZCLFFBQU0sSUFBSSxDQUFDLGFBQWEsU0FBRyxJQUFJLENBQUMsYUFBYSxtQ0FBSSxJQUFJLFlBQVksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztBQUMzRyxRQUFRLE9BQU8sSUFBSSxDQUFDLGFBQWEs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QUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQzlDLFFBQVksQ0FBQyxDQUFDO0FBQ2QsYUFBYSxLQUFLLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDdEQsSUFBSSxDQUFDO0FBQ0w7b0RBdEZDLFNBQVMsU0FBQyxrQkFDUCxRQUFRLEVBQUUsd0JBQXdCLGtCQUNsQyxRQUFRLEVBQUUsaUJBQWlCO0VBQzlCOzs0TEFDSTtBQUFDO0FBQWtELFlBWi9DLGtCQUFrQjtBQUFHO0FBQUc7QUFFNUIsc0JBV0EsS0FBSyxTQUFDLHNCQUFzQjtBQUM1QixxQkFFQSxNQUFNO0FBQUssb0JBRVgsTUFBTTtBQUFLLHNCQVVYLFlBQVksU0FBQyxPQUFPO0FBQ3JCOzs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgRGlyZWN0aXZlLCBIb3N0TGlzdGVuZXIsIElucHV0LCBPbkNoYW5nZXMsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTaXRlQm9keSwgRmF2b3JpdGVCb2R5LCBGYXZvcml0ZUVudHJ5LCBTaXRlLCBGYXZvcml0ZXNBcGkgfSBmcm9tICdAYWxmcmVzY28vanMtYXBpJztcbmltcG9ydCB7IEFsZnJlc2NvQXBpU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2FsZnJlc2NvLWFwaS5zZXJ2aWNlJztcblxuZXhwb3J0IGludGVyZmFjZSBMaWJyYXJ5RW50aXR5IHtcbiAgICBlbnRyeTogU2l0ZTtcbiAgICBpc0xpYnJhcnk6IGJvb2xlYW47XG4gICAgaXNGYXZvcml0ZTogYm9vbGVhbjtcbn1cblxuQERpcmVjdGl2ZSh7XG4gICAgc2VsZWN0b3I6ICdbYWRmLWZhdm9yaXRlLWxpYnJhcnldJyxcbiAgICBleHBvcnRBczogJ2Zhdm9yaXRlTGlicmFyeSdcbn0pXG5leHBvcnQgY2xhc3MgTGlicmFyeUZhdm9yaXRlRGlyZWN0aXZlIGltcGxlbWVudHMgT25DaGFuZ2VzIHtcbiAgICBASW5wdXQoJ2FkZi1mYXZvcml0ZS1saWJyYXJ5JylcbiAgICBsaWJyYXJ5OiBMaWJyYXJ5RW50aXR5ID0gbnVsbDtcblxuICAgIEBPdXRwdXQoKSB0b2dnbGUgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLW91dHB1dC1uYXRpdmVcbiAgICBAT3V0cHV0KCkgZXJyb3IgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIHByaXZhdGUgdGFyZ2V0TGlicmFyeSA9IG51bGw7XG5cbiAgICBfZmF2b3JpdGVzQXBpOiBGYXZvcml0ZXNBcGk7XG4gICAgZ2V0IGZhdm9yaXRlc0FwaSgpOiBGYXZvcml0ZXNBcGkge1xuICAgICAgICB0aGlzLl9mYXZvcml0ZXNBcGkgPSB0aGlzLl9mYXZvcml0ZXNBcGkgPz8gbmV3IEZhdm9yaXRlc0FwaSh0aGlzLmFsZnJlc2NvQXBpU2VydmljZS5nZXRJbnN0YW5jZSgpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Zhdm9yaXRlc0FwaTtcbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKCdjbGljaycpXG4gICAgb25DbGljaygpIHtcbiAgICAgICAgY29uc3QgZ3VpZCA9IHRoaXMudGFyZ2V0TGlicmFyeS5lbnRyeS5ndWlkO1xuXG4gICAgICAgIGlmICh0aGlzLnRhcmdldExpYnJhcnkuaXNGYXZvcml0ZSkge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVGYXZvcml0ZShndWlkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYWRkRmF2b3JpdGUoe1xuICAgICAgICAgICAgICAgIHRhcmdldDoge1xuICAgICAgICAgICAgICAgICAgICBzaXRlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBndWlkXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYWxmcmVzY29BcGlTZXJ2aWNlOiBBbGZyZXNjb0FwaVNlcnZpY2UpIHtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzKSB7XG4gICAgICAgIGlmICghY2hhbmdlcy5saWJyYXJ5LmN1cnJlbnRWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy50YXJnZXRMaWJyYXJ5ID0gbnVsbDtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudGFyZ2V0TGlicmFyeSA9IGNoYW5nZXMubGlicmFyeS5jdXJyZW50VmFsdWU7XG4gICAgICAgIHRoaXMubWFya0Zhdm9yaXRlTGlicmFyeShjaGFuZ2VzLmxpYnJhcnkuY3VycmVudFZhbHVlKTtcbiAgICB9XG5cbiAgICBpc0Zhdm9yaXRlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy50YXJnZXRMaWJyYXJ5ICYmIHRoaXMudGFyZ2V0TGlicmFyeS5pc0Zhdm9yaXRlO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgbWFya0Zhdm9yaXRlTGlicmFyeShsaWJyYXJ5OiBMaWJyYXJ5RW50aXR5KSB7XG4gICAgICAgIGlmICh0aGlzLnRhcmdldExpYnJhcnkuaXNGYXZvcml0ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuZmF2b3JpdGVzQXBpLmdldEZhdm9yaXRlU2l0ZSgnLW1lLScsIGxpYnJhcnkuZW50cnkuaWQpO1xuICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0TGlicmFyeS5pc0Zhdm9yaXRlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0TGlicmFyeS5pc0Zhdm9yaXRlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRhcmdldExpYnJhcnkgPSBsaWJyYXJ5O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhZGRGYXZvcml0ZShmYXZvcml0ZUJvZHk6IEZhdm9yaXRlQm9keSkge1xuICAgICAgICB0aGlzLmZhdm9yaXRlc0FwaVxuICAgICAgICAgICAgLmNyZWF0ZUZhdm9yaXRlKCctbWUtJywgZmF2b3JpdGVCb2R5KVxuICAgICAgICAgICAgLnRoZW4oKGxpYnJhcnlFbnRyeTogRmF2b3JpdGVFbnRyeSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0TGlicmFyeS5pc0Zhdm9yaXRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZS5lbWl0KGxpYnJhcnlFbnRyeSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gdGhpcy5lcnJvci5lbWl0KGVycm9yKSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW1vdmVGYXZvcml0ZShmYXZvcml0ZUlkOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5mYXZvcml0ZXNBcGlcbiAgICAgICAgICAgIC5kZWxldGVGYXZvcml0ZSgnLW1lLScsIGZhdm9yaXRlSWQpXG4gICAgICAgICAgICAudGhlbigobGlicmFyeUJvZHk6IFNpdGVCb2R5KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy50YXJnZXRMaWJyYXJ5LmlzRmF2b3JpdGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZS5lbWl0KGxpYnJhcnlCb2R5KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB0aGlzLmVycm9yLmVtaXQoZXJyb3IpKTtcbiAgICB9XG59XG4iXX0=