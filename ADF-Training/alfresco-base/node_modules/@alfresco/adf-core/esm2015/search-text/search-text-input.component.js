/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { ViewEncapsulation, Component, Input, ViewChild, ElementRef, Output, EventEmitter } from '@angular/core';
import { Subject, Observable } from 'rxjs';
import { debounceTime, takeUntil, filter } from 'rxjs/operators';
import { searchAnimation } from './animations';
import { UserPreferencesService } from '../services/user-preferences.service';
import { SearchTextStateEnum } from '../models/search-text-input.model';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../services/user-preferences.service';
import * as ɵngcc2 from '@angular/common';
import * as ɵngcc3 from '@angular/material/form-field';
import * as ɵngcc4 from '@angular/material/input';
import * as ɵngcc5 from '@angular/forms';
import * as ɵngcc6 from './search-trigger.directive';
import * as ɵngcc7 from '@angular/material/button';
import * as ɵngcc8 from '@angular/material/icon';
import * as ɵngcc9 from '@ngx-translate/core';

const _c0 = ["searchInput"];
function SearchTextInputComponent_button_2_Template(rf, ctx) { if (rf & 1) {
    const _r4 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 6);
    ɵngcc0.ɵɵlistener("click", function SearchTextInputComponent_button_2_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r4); const ctx_r3 = ɵngcc0.ɵɵnextContext(); return ctx_r3.toggleSearchBar(); })("keyup.enter", function SearchTextInputComponent_button_2_Template_button_keyup_enter_0_listener() { ɵngcc0.ɵɵrestoreView(_r4); const ctx_r5 = ɵngcc0.ɵɵnextContext(); return ctx_r5.toggleSearchBar(); });
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵelementStart(2, "mat-icon");
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵtext(4, "search");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("title", ɵngcc0.ɵɵpipeBind1(1, 2, "SEARCH.BUTTON.TOOLTIP"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵattribute("aria-label", ɵngcc0.ɵɵpipeBind1(3, 4, "SEARCH.BUTTON.ARIA-LABEL"));
} }
function SearchTextInputComponent_button_7_Template(rf, ctx) { if (rf & 1) {
    const _r7 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 7);
    ɵngcc0.ɵɵlistener("mousedown", function SearchTextInputComponent_button_7_Template_button_mousedown_0_listener() { ɵngcc0.ɵɵrestoreView(_r7); const ctx_r6 = ɵngcc0.ɵɵnextContext(); return ctx_r6.resetSearch(); });
    ɵngcc0.ɵɵelementStart(1, "mat-icon");
    ɵngcc0.ɵɵtext(2, "clear");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} }
export class SearchTextInputComponent {
    constructor(userPreferencesService) {
        this.userPreferencesService = userPreferencesService;
        this.autocomplete = false;
        this.expandable = true;
        this.inputType = 'text';
        this.liveSearchEnabled = true;
        this.searchAutocomplete = false;
        this.searchTerm = '';
        this.debounceTime = 0;
        this.collapseOnSubmit = true;
        this.defaultState = SearchTextStateEnum.collapsed;
        this.collapseOnBlur = true;
        this.showClearButton = false;
        this.placeholder = '';
        this.searchChange = new EventEmitter();
        this.submit = new EventEmitter();
        this.selectResult = new EventEmitter();
        this.reset = new EventEmitter();
        this.searchVisibility = new EventEmitter();
        this.animationStates = {
            ltr: {
                active: { value: 'active', params: { 'margin-left': 13 } },
                inactive: { value: 'inactive', params: { 'transform': 'translateX(82%)' } }
            },
            rtl: {
                active: { value: 'active', params: { 'margin-right': 13 } },
                inactive: { value: 'inactive', params: { 'transform': 'translateX(-82%)' } }
            }
        };
        this.dir = 'ltr';
        this.onDestroy$ = new Subject();
        this.toggleSearch = new Subject();
        this.valueChange = new Subject();
        this.toggleSearch
            .pipe(debounceTime(200), takeUntil(this.onDestroy$))
            .subscribe(() => {
            if (this.expandable) {
                this.subscriptAnimationState = this.toggleAnimation();
                if (this.subscriptAnimationState.value === 'inactive') {
                    this.searchTerm = '';
                    this.reset.emit(true);
                    if (document.activeElement.id === this.searchInput.nativeElement.id) {
                        this.searchInput.nativeElement.blur();
                    }
                }
                this.emitVisibilitySearch();
            }
        });
    }
    ngOnInit() {
        this.userPreferencesService
            .select('textOrientation')
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((direction) => {
            this.dir = direction;
            this.subscriptAnimationState = this.getDefaultState(this.dir);
        });
        this.subscriptAnimationState = this.getDefaultState(this.dir);
        this.setValueChangeHandler();
        this.setupFocusEventHandlers();
    }
    applySearchFocus(animationDoneEvent) {
        if (animationDoneEvent.toState === 'active' && this.isDefaultStateCollapsed()) {
            this.searchInput.nativeElement.focus();
        }
    }
    getAutoComplete() {
        return this.autocomplete ? 'on' : 'off';
    }
    toggleAnimation() {
        if (this.dir === 'ltr') {
            return this.subscriptAnimationState.value === 'inactive' ?
                { value: 'active', params: { 'margin-left': 13 } } :
                { value: 'inactive', params: { 'transform': 'translateX(82%)' } };
        }
        else {
            return this.subscriptAnimationState.value === 'inactive' ?
                { value: 'active', params: { 'margin-right': 13 } } :
                { value: 'inactive', params: { 'transform': 'translateX(-82%)' } };
        }
    }
    getDefaultState(dir) {
        if (this.dir) {
            return this.getAnimationState(dir);
        }
        return this.animationStates.ltr.inactive;
    }
    getAnimationState(dir) {
        if (this.expandable && this.isDefaultStateExpanded()) {
            return this.animationStates[dir].active;
        }
        else if (this.expandable) {
            return this.animationStates[dir].inactive;
        }
        else {
            return { value: 'no-animation' };
        }
    }
    setupFocusEventHandlers() {
        if (this.focusListener) {
            const focusEvents = this.focusListener
                .pipe(debounceTime(50), filter(($event) => {
                return this.isSearchBarActive() && ($event.type === 'blur' || $event.type === 'focusout' || $event.type === 'focus');
            }), takeUntil(this.onDestroy$));
            this.focusSubscription = focusEvents.subscribe((event) => {
                if (event.type === 'focus') {
                    this.searchInput.nativeElement.focus();
                }
                else {
                    this.toggleSearchBar();
                }
            });
        }
    }
    setValueChangeHandler() {
        this.valueChange.pipe(debounceTime(this.debounceTime), takeUntil(this.onDestroy$)).subscribe((value) => {
            this.searchChange.emit(value);
        });
    }
    selectFirstResult($event) {
        this.selectResult.emit($event);
    }
    onBlur($event) {
        if (this.collapseOnBlur && !$event.relatedTarget) {
            this.resetSearch();
        }
    }
    inputChange($event) {
        this.valueChange.next($event);
    }
    toggleSearchBar() {
        if (this.toggleSearch) {
            this.toggleSearch.next();
        }
    }
    searchSubmit(event) {
        this.submit.emit(event);
        if (this.collapseOnSubmit) {
            this.toggleSearchBar();
        }
    }
    activateToolbar() {
        if (!this.isSearchBarActive()) {
            this.toggleSearchBar();
        }
        return false;
    }
    isSearchBarActive() {
        return this.subscriptAnimationState.value === 'active';
    }
    ngOnDestroy() {
        if (this.toggleSearch) {
            this.toggleSearch.complete();
            this.toggleSearch = null;
        }
        if (this.focusSubscription) {
            this.focusSubscription.unsubscribe();
            this.focusSubscription = null;
            this.focusListener = null;
        }
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
    canShowClearSearch() {
        return this.showClearButton && this.isSearchBarActive();
    }
    resetSearch() {
        if (this.isSearchBarActive()) {
            this.toggleSearchBar();
        }
    }
    isDefaultStateCollapsed() {
        return this.defaultState === SearchTextStateEnum.collapsed;
    }
    isDefaultStateExpanded() {
        return this.defaultState === SearchTextStateEnum.expanded;
    }
    emitVisibilitySearch() {
        this.isSearchBarActive() ? this.searchVisibility.emit(true) : this.searchVisibility.emit(false);
    }
}
SearchTextInputComponent.ɵfac = function SearchTextInputComponent_Factory(t) { return new (t || SearchTextInputComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.UserPreferencesService)); };
SearchTextInputComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: SearchTextInputComponent, selectors: [["adf-search-text-input"]], viewQuery: function SearchTextInputComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵstaticViewQuery(_c0, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.searchInput = _t.first);
    } }, hostAttrs: [1, "adf-search-text-input"], inputs: { autocomplete: "autocomplete", expandable: "expandable", inputType: "inputType", liveSearchEnabled: "liveSearchEnabled", searchAutocomplete: "searchAutocomplete", searchTerm: "searchTerm", debounceTime: "debounceTime", collapseOnSubmit: "collapseOnSubmit", defaultState: "defaultState", collapseOnBlur: "collapseOnBlur", showClearButton: "showClearButton", placeholder: "placeholder", focusListener: "focusListener" }, outputs: { searchChange: "searchChange", submit: "submit", selectResult: "selectResult", reset: "reset", searchVisibility: "searchVisibility" }, decls: 8, vars: 12, consts: [[1, "adf-search-container"], ["mat-icon-button", "", "id", "adf-search-button", "class", "adf-search-button", 3, "title", "click", "keyup.enter", 4, "ngIf"], [1, "adf-input-form-field-divider"], ["matInput", "", "id", "adf-control-input", 3, "autocomplete", "ngModel", "placeholder", "searchAutocomplete", "ngModelChange", "focus", "blur", "keyup.escape", "keyup.arrowdown", "keyup.enter"], ["searchInput", ""], ["mat-icon-button", "", "matSuffix", "", "data-automation-id", "adf-clear-search-button", "class", "adf-clear-search-button", 3, "mousedown", 4, "ngIf"], ["mat-icon-button", "", "id", "adf-search-button", 1, "adf-search-button", 3, "title", "click", "keyup.enter"], ["mat-icon-button", "", "matSuffix", "", "data-automation-id", "adf-clear-search-button", 1, "adf-clear-search-button", 3, "mousedown"]], template: function SearchTextInputComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "div");
        ɵngcc0.ɵɵlistener("@transitionMessages.done", function SearchTextInputComponent_Template_div_animation_transitionMessages_done_1_listener($event) { return ctx.applySearchFocus($event); });
        ɵngcc0.ɵɵtemplate(2, SearchTextInputComponent_button_2_Template, 5, 6, "button", 1);
        ɵngcc0.ɵɵelementStart(3, "mat-form-field", 2);
        ɵngcc0.ɵɵelementStart(4, "input", 3, 4);
        ɵngcc0.ɵɵlistener("ngModelChange", function SearchTextInputComponent_Template_input_ngModelChange_4_listener($event) { return ctx.searchTerm = $event; })("focus", function SearchTextInputComponent_Template_input_focus_4_listener() { return ctx.activateToolbar(); })("blur", function SearchTextInputComponent_Template_input_blur_4_listener($event) { return ctx.onBlur($event); })("keyup.escape", function SearchTextInputComponent_Template_input_keyup_escape_4_listener() { return ctx.toggleSearchBar(); })("keyup.arrowdown", function SearchTextInputComponent_Template_input_keyup_arrowdown_4_listener($event) { return ctx.selectFirstResult($event); })("ngModelChange", function SearchTextInputComponent_Template_input_ngModelChange_4_listener($event) { return ctx.inputChange($event); })("keyup.enter", function SearchTextInputComponent_Template_input_keyup_enter_4_listener($event) { return ctx.searchSubmit($event); });
        ɵngcc0.ɵɵpipe(6, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(7, SearchTextInputComponent_button_7_Template, 3, 0, "button", 5);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("state", ctx.subscriptAnimationState.value);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("@transitionMessages", ctx.subscriptAnimationState);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.expandable);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("autocomplete", ctx.getAutoComplete())("ngModel", ctx.searchTerm)("placeholder", ctx.placeholder)("searchAutocomplete", ctx.searchAutocomplete ? ctx.searchAutocomplete : null);
        ɵngcc0.ɵɵattribute("aria-label", ɵngcc0.ɵɵpipeBind1(6, 10, "SEARCH.INPUT.ARIA-LABEL"))("type", ctx.inputType);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngIf", ctx.canShowClearSearch());
    } }, directives: [ɵngcc2.NgIf, ɵngcc3.MatFormField, ɵngcc4.MatInput, ɵngcc5.DefaultValueAccessor, ɵngcc6.SearchTriggerDirective, ɵngcc5.NgControlStatus, ɵngcc5.NgModel, ɵngcc7.MatButton, ɵngcc8.MatIcon, ɵngcc3.MatSuffix], pipes: [ɵngcc9.TranslatePipe], styles: [".adf-search-container{overflow:hidden!important}.adf-search-button{left:-13px}[dir=rtl] .adf-search-button{right:-13px}[dir=ltr] .adf-search-button{left:-13px}.adf-search-fixed-text{line-height:normal}.adf-input-form-field-divider{font-size:16px}.adf-input-form-field-divider .mat-form-field-underline,.adf-input-form-field-divider .mat-form-field-underline .mat-form-field-ripple{background-color:var(--adf-search-input-bg-color)}.adf-highlight{color:var(--adf-search-input-highlight-color)}"], encapsulation: 2, data: { animation: [searchAnimation] } });
SearchTextInputComponent.ctorParameters = () => [
    { type: UserPreferencesService }
];
SearchTextInputComponent.propDecorators = {
    autocomplete: [{ type: Input }],
    expandable: [{ type: Input }],
    inputType: [{ type: Input }],
    liveSearchEnabled: [{ type: Input }],
    searchAutocomplete: [{ type: Input }],
    searchTerm: [{ type: Input }],
    debounceTime: [{ type: Input }],
    focusListener: [{ type: Input }],
    collapseOnSubmit: [{ type: Input }],
    defaultState: [{ type: Input }],
    collapseOnBlur: [{ type: Input }],
    showClearButton: [{ type: Input }],
    placeholder: [{ type: Input }],
    searchChange: [{ type: Output }],
    submit: [{ type: Output }],
    selectResult: [{ type: Output }],
    reset: [{ type: Output }],
    searchVisibility: [{ type: Output }],
    searchInput: [{ type: ViewChild, args: ['searchInput', { static: true },] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(SearchTextInputComponent, [{
        type: Component,
        args: [{
                selector: 'adf-search-text-input',
                template: "<div class=\"adf-search-container\" [attr.state]=\"subscriptAnimationState.value\">\n    <div [@transitionMessages]=\"subscriptAnimationState\"\n         (@transitionMessages.done)=\"applySearchFocus($event)\">\n        <button mat-icon-button\n                *ngIf=\"expandable\"\n                id=\"adf-search-button\"\n                class=\"adf-search-button\"\n                [title]=\"'SEARCH.BUTTON.TOOLTIP' | translate\"\n                (click)=\"toggleSearchBar()\"\n                (keyup.enter)=\"toggleSearchBar()\">\n            <mat-icon [attr.aria-label]=\"'SEARCH.BUTTON.ARIA-LABEL' | translate\">search</mat-icon>\n        </button>\n        <mat-form-field class=\"adf-input-form-field-divider\">\n            <input matInput\n                   #searchInput\n                   [attr.aria-label]=\"'SEARCH.INPUT.ARIA-LABEL' | translate\"\n                   [attr.type]=\"inputType\"\n                   [autocomplete]=\"getAutoComplete()\"\n                   id=\"adf-control-input\"\n                   [(ngModel)]=\"searchTerm\"\n                   [placeholder]=\"placeholder\"\n                   (focus)=\"activateToolbar()\"\n                   (blur)=\"onBlur($event)\"\n                   (keyup.escape)=\"toggleSearchBar()\"\n                   (keyup.arrowdown)=\"selectFirstResult($event)\"\n                   (ngModelChange)=\"inputChange($event)\"\n                   [searchAutocomplete]=\"searchAutocomplete ? searchAutocomplete : null\"\n                   (keyup.enter)=\"searchSubmit($event)\">\n            <button mat-icon-button matSuffix\n                    data-automation-id=\"adf-clear-search-button\"\n                    class=\"adf-clear-search-button\"\n                    *ngIf=\"canShowClearSearch()\"\n                    (mousedown)=\"resetSearch()\">\n                <mat-icon>clear</mat-icon>\n            </button>\n        </mat-form-field>\n    </div>\n</div>\n",
                animations: [searchAnimation],
                encapsulation: ViewEncapsulation.None,
                host: {
                    'class': 'adf-search-text-input'
                },
                styles: [".adf-search-container{overflow:hidden!important}.adf-search-button{left:-13px}[dir=rtl] .adf-search-button{right:-13px}[dir=ltr] .adf-search-button{left:-13px}.adf-search-fixed-text{line-height:normal}.adf-input-form-field-divider{font-size:16px}.adf-input-form-field-divider .mat-form-field-underline,.adf-input-form-field-divider .mat-form-field-underline .mat-form-field-ripple{background-color:var(--adf-search-input-bg-color)}.adf-highlight{color:var(--adf-search-input-highlight-color)}"]
            }]
    }], function () { return [{ type: ɵngcc1.UserPreferencesService }]; }, { autocomplete: [{
            type: Input
        }], expandable: [{
            type: Input
        }], inputType: [{
            type: Input
        }], liveSearchEnabled: [{
            type: Input
        }], searchAutocomplete: [{
            type: Input
        }], searchTerm: [{
            type: Input
        }], debounceTime: [{
            type: Input
        }], collapseOnSubmit: [{
            type: Input
        }], defaultState: [{
            type: Input
        }], collapseOnBlur: [{
            type: Input
        }], showClearButton: [{
            type: Input
        }], placeholder: [{
            type: Input
        }], searchChange: [{
            type: Output
        }], submit: [{
            type: Output
        }], selectResult: [{
            type: Output
        }], reset: [{
            type: Output
        }], searchVisibility: [{
            type: Output
        }], focusListener: [{
            type: Input
        }], searchInput: [{
            type: ViewChild,
            args: ['searchInput', { static: true }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLXRleHQtaW5wdXQuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9ob21lL3RyYXZpcy9idWlsZC9BbGZyZXNjby9hbGZyZXNjby1uZzItY29tcG9uZW50cy9saWIvY29yZS9zZWFyY2gtdGV4dC9zZWFyY2gtdGV4dC1pbnB1dC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUVILE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFhLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUNwSSxPQUFPLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBZ0IsTUFBTSxNQUFNLENBQUM7QUFDekQsT0FBTyxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFakUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUMvQyxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUM5RSxPQUFPLEVBQUUsbUJBQW1CLEVBQWtELE1BQU0sbUNBQW1DLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFZeEgsTUFBTSxPQUFPLHdCQUF3QjtBQUFHLElBd0dwQyxZQUNZLHNCQUE4QztBQUMzRCxRQURhLDJCQUFzQixHQUF0QixzQkFBc0IsQ0FBd0I7QUFDOUQsUUF0R0ksaUJBQVksR0FBWSxLQUFLLENBQUM7QUFDbEMsUUFLSSxlQUFVLEdBQVksSUFBSSxDQUFDO0FBQy9CLFFBR0ksY0FBUyxHQUFXLE1BQU0sQ0FBQztBQUMvQixRQUdJLHNCQUFpQixHQUFZLElB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cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgVmlld0VuY2Fwc3VsYXRpb24sIENvbXBvbmVudCwgSW5wdXQsIE9uRGVzdHJveSwgVmlld0NoaWxkLCBFbGVtZW50UmVmLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJqZWN0LCBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgdGFrZVVudGlsLCBmaWx0ZXIgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBEaXJlY3Rpb24gfSBmcm9tICdAYW5ndWxhci9jZGsvYmlkaSc7XG5pbXBvcnQgeyBzZWFyY2hBbmltYXRpb24gfSBmcm9tICcuL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHsgVXNlclByZWZlcmVuY2VzU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3VzZXItcHJlZmVyZW5jZXMuc2VydmljZSc7XG5pbXBvcnQgeyBTZWFyY2hUZXh0U3RhdGVFbnVtLCBTZWFyY2hBbmltYXRpb25TdGF0ZSwgU2VhcmNoQW5pbWF0aW9uRGlyZWN0aW9uIH0gZnJvbSAnLi4vbW9kZWxzL3NlYXJjaC10ZXh0LWlucHV0Lm1vZGVsJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhZGYtc2VhcmNoLXRleHQtaW5wdXQnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9zZWFyY2gtdGV4dC1pbnB1dC5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vc2VhcmNoLXRleHQtaW5wdXQuY29tcG9uZW50LnNjc3MnXSxcbiAgICBhbmltYXRpb25zOiBbc2VhcmNoQW5pbWF0aW9uXSxcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICAgIGhvc3Q6IHtcbiAgICAgICAgJ2NsYXNzJzogJ2FkZi1zZWFyY2gtdGV4dC1pbnB1dCdcbiAgICB9XG59KVxuZXhwb3J0IGNsYXNzIFNlYXJjaFRleHRJbnB1dENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcblxuICAgIC8qKiBUb2dnbGVzIGF1dG8tY29tcGxldGlvbiBvZiB0aGUgc2VhcmNoIGlucHV0IGZpZWxkLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgYXV0b2NvbXBsZXRlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKiogVG9nZ2xlcyB3aGV0aGVyIHRvIHVzZSBhbiBleHBhbmRpbmcgc2VhcmNoIGNvbnRyb2wuIElmIGZhbHNlXG4gICAgICogdGhlbiBhIHJlZ3VsYXIgaW5wdXQgaXMgdXNlZC5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIGV4cGFuZGFibGU6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIFR5cGUgb2YgdGhlIGlucHV0IGZpZWxkIHRvIHJlbmRlciwgZS5nLiBcInNlYXJjaFwiIG9yIFwidGV4dFwiIChkZWZhdWx0KS4gKi9cbiAgICBASW5wdXQoKVxuICAgIGlucHV0VHlwZTogc3RyaW5nID0gJ3RleHQnO1xuXG4gICAgLyoqIFRvZ2dsZXMgXCJmaW5kLWFzLXlvdS10eXBlXCIgc3VnZ2VzdGlvbnMgZm9yIHBvc3NpYmxlIG1hdGNoZXMuICovXG4gICAgQElucHV0KClcbiAgICBsaXZlU2VhcmNoRW5hYmxlZDogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvKiogVHJpZ2dlciBhdXRvY29tcGxldGUgcmVzdWx0cyBvbiBpbnB1dCBjaGFuZ2UuICovXG4gICAgQElucHV0KClcbiAgICBzZWFyY2hBdXRvY29tcGxldGU6IGFueSA9IGZhbHNlO1xuXG4gICAgLyoqIFNlYXJjaCB0ZXJtIHByZXNlbGVjdGVkICovXG4gICAgQElucHV0KClcbiAgICBzZWFyY2hUZXJtOiBzdHJpbmcgPSAnJztcblxuICAgIC8qKiBEZWJvdW5jZSB0aW1lIGluIG1pbGxpc2Vjb25kcy4gKi9cbiAgICBASW5wdXQoKVxuICAgIGRlYm91bmNlVGltZTogbnVtYmVyID0gMDtcblxuICAgICAvKiogTGlzdGVuZXIgZm9yIHJlc3VsdHMtbGlzdCBldmVudHMgKGZvY3VzLCBibHVyIGFuZCBmb2N1c291dCkuICovXG4gICAgQElucHV0KClcbiAgICBmb2N1c0xpc3RlbmVyOiBPYnNlcnZhYmxlPEZvY3VzRXZlbnQ+O1xuXG4gICAgLyoqIENvbGxhcHNlIHNlYXJjaCBiYXIgb24gc3VibWl0LiAqL1xuICAgIEBJbnB1dCgpXG4gICAgY29sbGFwc2VPblN1Ym1pdDogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvKiogRGVmYXVsdCBzdGF0ZSBleHBhbmRlZCBvciBDb2xsYXBzZWQuICovXG4gICAgQElucHV0KClcbiAgICBkZWZhdWx0U3RhdGU6IFNlYXJjaFRleHRTdGF0ZUVudW0gPSBTZWFyY2hUZXh0U3RhdGVFbnVtLmNvbGxhcHNlZDtcblxuICAgIC8qKiBUb2dnbGVzIHdoZXRoZXIgdG8gY29sbGFwc2UgdGhlIHNlYXJjaCBvbiBibHVyLiAqL1xuICAgIEBJbnB1dCgpXG4gICAgY29sbGFwc2VPbkJsdXI6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqIFRvZ2dsZXMgd2hldGhlciB0byBzaG93IGEgY2xlYXIgYnV0dG9uIHRoYXQgY2xvc2VzIHRoZSBzZWFyY2ggKi9cbiAgICBASW5wdXQoKVxuICAgIHNob3dDbGVhckJ1dHRvbjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqIFBsYWNlaG9sZGVyIHRleHQgdG8gc2hvdyBpbiB0aGUgaW5wdXQgZmllbGQgKi9cbiAgICBASW5wdXQoKVxuICAgIHBsYWNlaG9sZGVyOiBzdHJpbmcgPSAnJztcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIHNlYXJjaCB0ZXJtIGlzIGNoYW5nZWQuIFRoZSBzZWFyY2ggdGVybSBpcyBwcm92aWRlZFxuICAgICAqIGluIHRoZSAndmFsdWUnIHByb3BlcnR5IG9mIHRoZSByZXR1cm5lZCBvYmplY3QuICBJZiB0aGUgdGVybSBpcyBsZXNzXG4gICAgICogdGhhbiB0aHJlZSBjaGFyYWN0ZXJzIGluIGxlbmd0aCB0aGVuIGl0IGlzIHRydW5jYXRlZCB0byBhbiBlbXB0eVxuICAgICAqIHN0cmluZy5cbiAgICAgKi9cbiAgICBAT3V0cHV0KClcbiAgICBzZWFyY2hDaGFuZ2U6IEV2ZW50RW1pdHRlcjxzdHJpbmc+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgLyoqIEVtaXR0ZWQgd2hlbiB0aGUgc2VhcmNoIGlzIHN1Ym1pdHRlZCBieSBwcmVzc2luZyB0aGUgRU5URVIga2V5LlxuICAgICAqIFRoZSBzZWFyY2ggdGVybSBpcyBwcm92aWRlZCBhcyB0aGUgdmFsdWUgb2YgdGhlIGV2ZW50LlxuICAgICAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHN1Ym1pdDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICAvKiogIEVtaXR0ZWQgd2hlbiB0aGUgcmVzdWx0IGxpc3QgaXMgc2VsZWN0ZWQgKi9cbiAgICBAT3V0cHV0KClcbiAgICBzZWxlY3RSZXN1bHQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgLyoqICBFbWl0dGVkIHdoZW4gdGhlIHJlc3VsdCBsaXN0IGlzIHJlc2V0ICovXG4gICAgQE91dHB1dCgpXG4gICAgcmVzZXQ6IEV2ZW50RW1pdHRlcjxib29sZWFuPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIHNlYXJjaCB2aXNpYmlsaXR5IGNoYW5nZXMuIFRydWUgd2hlbiB0aGUgc2VhcmNoIGlzIGFjdGl2ZSwgZmFsc2Ugd2hlbiBpdCBpcyBpbmFjdGl2ZSAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHNlYXJjaFZpc2liaWxpdHk6IEV2ZW50RW1pdHRlcjxib29sZWFuPiA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcblxuICAgIEBWaWV3Q2hpbGQoJ3NlYXJjaElucHV0JywgeyBzdGF0aWM6IHRydWUgfSlcbiAgICBzZWFyY2hJbnB1dDogRWxlbWVudFJlZjtcblxuICAgIHN1YnNjcmlwdEFuaW1hdGlvblN0YXRlOiBhbnk7XG5cbiAgICBhbmltYXRpb25TdGF0ZXM6IFNlYXJjaEFuaW1hdGlvbkRpcmVjdGlvbiA9IHtcbiAgICAgICAgbHRyIDoge1xuICAgICAgICAgICAgYWN0aXZlOiB7IHZhbHVlOiAnYWN0aXZlJywgcGFyYW1zOiB7ICdtYXJnaW4tbGVmdCc6IDEzIH0gfSxcbiAgICAgICAgICAgIGluYWN0aXZlOiB7IHZhbHVlOiAnaW5hY3RpdmUnLCBwYXJhbXM6IHsgJ3RyYW5zZm9ybSc6ICd0cmFuc2xhdGVYKDgyJSknIH0gfVxuICAgICAgICB9LFxuICAgICAgICBydGw6IHtcbiAgICAgICAgICAgIGFjdGl2ZTogIHsgdmFsdWU6ICdhY3RpdmUnLCBwYXJhbXM6IHsgJ21hcmdpbi1yaWdodCc6IDEzIH0gfSxcbiAgICAgICAgICAgIGluYWN0aXZlOiB7IHZhbHVlOiAnaW5hY3RpdmUnLCBwYXJhbXM6IHsgJ3RyYW5zZm9ybSc6ICd0cmFuc2xhdGVYKC04MiUpJyB9IH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcml2YXRlIGRpciA9ICdsdHInO1xuICAgIHByaXZhdGUgb25EZXN0cm95JCA9IG5ldyBTdWJqZWN0PGJvb2xlYW4+KCk7XG4gICAgcHJpdmF0ZSB0b2dnbGVTZWFyY2ggPSBuZXcgU3ViamVjdDxhbnk+KCk7XG4gICAgcHJpdmF0ZSBmb2N1c1N1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICAgIHByaXZhdGUgdmFsdWVDaGFuZ2UgPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XG5cbiAgICBjb25zdHJ1Y3RvciAoXG4gICAgICAgIHByaXZhdGUgdXNlclByZWZlcmVuY2VzU2VydmljZTogVXNlclByZWZlcmVuY2VzU2VydmljZVxuICAgICkge1xuICAgICAgICB0aGlzLnRvZ2dsZVNlYXJjaFxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgZGVib3VuY2VUaW1lKDIwMCksXG4gICAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMub25EZXN0cm95JClcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmV4cGFuZGFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRBbmltYXRpb25TdGF0ZSA9IHRoaXMudG9nZ2xlQW5pbWF0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN1YnNjcmlwdEFuaW1hdGlvblN0YXRlLnZhbHVlID09PSAnaW5hY3RpdmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaFRlcm0gPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzZXQuZW1pdCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50LmlkID09PSB0aGlzLnNlYXJjaElucHV0Lm5hdGl2ZUVsZW1lbnQuaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaElucHV0Lm5hdGl2ZUVsZW1lbnQuYmx1cigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdFZpc2liaWxpdHlTZWFyY2goKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy51c2VyUHJlZmVyZW5jZXNTZXJ2aWNlXG4gICAgICAgICAgICAuc2VsZWN0KCd0ZXh0T3JpZW50YXRpb24nKVxuICAgICAgICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMub25EZXN0cm95JCkpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKChkaXJlY3Rpb246IERpcmVjdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlyID0gZGlyZWN0aW9uO1xuICAgICAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0QW5pbWF0aW9uU3RhdGUgPSB0aGlzLmdldERlZmF1bHRTdGF0ZSh0aGlzLmRpcik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnN1YnNjcmlwdEFuaW1hdGlvblN0YXRlID0gdGhpcy5nZXREZWZhdWx0U3RhdGUodGhpcy5kaXIpO1xuICAgICAgICB0aGlzLnNldFZhbHVlQ2hhbmdlSGFuZGxlcigpO1xuICAgICAgICB0aGlzLnNldHVwRm9jdXNFdmVudEhhbmRsZXJzKCk7XG4gICAgfVxuXG4gICAgYXBwbHlTZWFyY2hGb2N1cyhhbmltYXRpb25Eb25lRXZlbnQpIHtcbiAgICAgICAgaWYgKGFuaW1hdGlvbkRvbmVFdmVudC50b1N0YXRlID09PSAnYWN0aXZlJyAmJiB0aGlzLmlzRGVmYXVsdFN0YXRlQ29sbGFwc2VkKCkpIHtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoSW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0QXV0b0NvbXBsZXRlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmF1dG9jb21wbGV0ZSA/ICdvbicgOiAnb2ZmJztcbiAgICB9XG5cbiAgICBwcml2YXRlIHRvZ2dsZUFuaW1hdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlyID09PSAnbHRyJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3Vic2NyaXB0QW5pbWF0aW9uU3RhdGUudmFsdWUgPT09ICdpbmFjdGl2ZScgP1xuICAgICAgICAgICAgICAgIHsgdmFsdWU6ICdhY3RpdmUnLCBwYXJhbXM6IHsgJ21hcmdpbi1sZWZ0JzogMTMgfSB9IDpcbiAgICAgICAgICAgICAgICB7IHZhbHVlOiAnaW5hY3RpdmUnLCBwYXJhbXM6IHsgJ3RyYW5zZm9ybSc6ICd0cmFuc2xhdGVYKDgyJSknIH0gfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnN1YnNjcmlwdEFuaW1hdGlvblN0YXRlLnZhbHVlID09PSAnaW5hY3RpdmUnID9cbiAgICAgICAgICAgICAgICB7IHZhbHVlOiAnYWN0aXZlJywgcGFyYW1zOiB7ICdtYXJnaW4tcmlnaHQnOiAxMyB9IH0gOlxuICAgICAgICAgICAgICAgIHsgdmFsdWU6ICdpbmFjdGl2ZScsIHBhcmFtczogeyAndHJhbnNmb3JtJzogJ3RyYW5zbGF0ZVgoLTgyJSknIH0gfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0RGVmYXVsdFN0YXRlKGRpcjogc3RyaW5nKTogU2VhcmNoQW5pbWF0aW9uU3RhdGUge1xuICAgICAgICBpZiAodGhpcy5kaXIpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEFuaW1hdGlvblN0YXRlKGRpcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0aW9uU3RhdGVzLmx0ci5pbmFjdGl2ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEFuaW1hdGlvblN0YXRlKGRpcjogc3RyaW5nKTogU2VhcmNoQW5pbWF0aW9uU3RhdGUge1xuICAgICAgICBpZiAodGhpcy5leHBhbmRhYmxlICYmIHRoaXMuaXNEZWZhdWx0U3RhdGVFeHBhbmRlZCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hbmltYXRpb25TdGF0ZXNbZGlyXS5hY3RpdmU7XG4gICAgICAgIH0gZWxzZSBpZiAoIHRoaXMuZXhwYW5kYWJsZSApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFuaW1hdGlvblN0YXRlc1tkaXJdLmluYWN0aXZlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6ICduby1hbmltYXRpb24nIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHNldHVwRm9jdXNFdmVudEhhbmRsZXJzKCkge1xuICAgICAgICBpZiAoIHRoaXMuZm9jdXNMaXN0ZW5lciApIHtcbiAgICAgICAgICAgIGNvbnN0IGZvY3VzRXZlbnRzOiBPYnNlcnZhYmxlPEZvY3VzRXZlbnQ+ID0gdGhpcy5mb2N1c0xpc3RlbmVyXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBkZWJvdW5jZVRpbWUoNTApLFxuICAgICAgICAgICAgICAgIGZpbHRlcigoJGV2ZW50OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNTZWFyY2hCYXJBY3RpdmUoKSAmJiAoJGV2ZW50LnR5cGUgPT09ICdibHVyJyB8fCAkZXZlbnQudHlwZSA9PT0gJ2ZvY3Vzb3V0JyB8fCAkZXZlbnQudHlwZSA9PT0gJ2ZvY3VzJyk7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMub25EZXN0cm95JClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIHRoaXMuZm9jdXNTdWJzY3JpcHRpb24gPSBmb2N1c0V2ZW50cy5zdWJzY3JpYmUoIChldmVudDogRm9jdXNFdmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICggZXZlbnQudHlwZSA9PT0gJ2ZvY3VzJykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaElucHV0Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZVNlYXJjaEJhcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRWYWx1ZUNoYW5nZUhhbmRsZXIoKSB7XG4gICAgICAgIHRoaXMudmFsdWVDaGFuZ2UucGlwZShcbiAgICAgICAgICAgIGRlYm91bmNlVGltZSh0aGlzLmRlYm91bmNlVGltZSksXG4gICAgICAgICAgICB0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKVxuICAgICAgICApLnN1YnNjcmliZSggKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoQ2hhbmdlLmVtaXQodmFsdWUpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzZWxlY3RGaXJzdFJlc3VsdCgkZXZlbnQpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RSZXN1bHQuZW1pdCgkZXZlbnQpO1xuICAgIH1cblxuICAgIG9uQmx1cigkZXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuY29sbGFwc2VPbkJsdXIgJiYgISRldmVudC5yZWxhdGVkVGFyZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLnJlc2V0U2VhcmNoKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpbnB1dENoYW5nZSgkZXZlbnQ6IGFueSkge1xuICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlLm5leHQoJGV2ZW50KTtcbiAgICB9XG5cbiAgICB0b2dnbGVTZWFyY2hCYXIoKSB7XG4gICAgICAgIGlmICh0aGlzLnRvZ2dsZVNlYXJjaCkge1xuICAgICAgICAgICAgdGhpcy50b2dnbGVTZWFyY2gubmV4dCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2VhcmNoU3VibWl0KGV2ZW50OiBhbnkpIHtcbiAgICAgICAgdGhpcy5zdWJtaXQuZW1pdChldmVudCk7XG4gICAgICAgIGlmICh0aGlzLmNvbGxhcHNlT25TdWJtaXQpIHtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlU2VhcmNoQmFyKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhY3RpdmF0ZVRvb2xiYXIoKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICghdGhpcy5pc1NlYXJjaEJhckFjdGl2ZSgpKSB7XG4gICAgICAgICAgICB0aGlzLnRvZ2dsZVNlYXJjaEJhcigpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpc1NlYXJjaEJhckFjdGl2ZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3Vic2NyaXB0QW5pbWF0aW9uU3RhdGUudmFsdWUgPT09ICdhY3RpdmUnO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICBpZiAodGhpcy50b2dnbGVTZWFyY2gpIHtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlU2VhcmNoLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICB0aGlzLnRvZ2dsZVNlYXJjaCA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5mb2N1c1N1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy5mb2N1c1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgdGhpcy5mb2N1c1N1YnNjcmlwdGlvbiA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmZvY3VzTGlzdGVuZXIgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLm5leHQodHJ1ZSk7XG4gICAgICAgIHRoaXMub25EZXN0cm95JC5jb21wbGV0ZSgpO1xuICAgIH1cblxuICAgIGNhblNob3dDbGVhclNlYXJjaCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2hvd0NsZWFyQnV0dG9uICYmIHRoaXMuaXNTZWFyY2hCYXJBY3RpdmUoKTtcbiAgICB9XG5cbiAgICByZXNldFNlYXJjaCgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNTZWFyY2hCYXJBY3RpdmUoKSkge1xuICAgICAgICAgICAgdGhpcy50b2dnbGVTZWFyY2hCYXIoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaXNEZWZhdWx0U3RhdGVDb2xsYXBzZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmRlZmF1bHRTdGF0ZSA9PT0gU2VhcmNoVGV4dFN0YXRlRW51bS5jb2xsYXBzZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0RlZmF1bHRTdGF0ZUV4cGFuZGVkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5kZWZhdWx0U3RhdGUgPT09IFNlYXJjaFRleHRTdGF0ZUVudW0uZXhwYW5kZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBlbWl0VmlzaWJpbGl0eVNlYXJjaCgpIHtcbiAgICAgICAgdGhpcy5pc1NlYXJjaEJhckFjdGl2ZSgpID8gdGhpcy5zZWFyY2hWaXNpYmlsaXR5LmVtaXQodHJ1ZSkgOiB0aGlzLnNlYXJjaFZpc2liaWxpdHkuZW1pdChmYWxzZSk7XG4gICAgfVxuXG59XG4iXX0=