/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { DecimalPipe } from '@angular/common';
import { Pipe } from '@angular/core';
import { AppConfigService } from '../app-config/app-config.service';
import { UserPreferencesService, UserPreferenceValues } from '../services/user-preferences.service';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
export class DecimalNumberPipe {
    constructor(userPreferenceService, appConfig) {
        this.userPreferenceService = userPreferenceService;
        this.appConfig = appConfig;
        this.defaultLocale = DecimalNumberPipe.DEFAULT_LOCALE;
        this.defaultMinIntegerDigits = DecimalNumberPipe.DEFAULT_MIN_INTEGER_DIGITS;
        this.defaultMinFractionDigits = DecimalNumberPipe.DEFAULT_MIN_FRACTION_DIGITS;
        this.defaultMaxFractionDigits = DecimalNumberPipe.DEFAULT_MAX_FRACTION_DIGITS;
        this.onDestroy$ = new Subject();
        if (this.userPreferenceService) {
            this.userPreferenceService.select(UserPreferenceValues.Locale)
                .pipe(takeUntil(this.onDestroy$))
                .subscribe((locale) => {
                if (locale) {
                    this.defaultLocale = locale;
                }
            });
        }
        if (this.appConfig) {
            this.defaultMinIntegerDigits = this.appConfig.get('decimalValues.minIntegerDigits', DecimalNumberPipe.DEFAULT_MIN_INTEGER_DIGITS);
            this.defaultMinFractionDigits = this.appConfig.get('decimalValues.minFractionDigits', DecimalNumberPipe.DEFAULT_MIN_FRACTION_DIGITS);
            this.defaultMaxFractionDigits = this.appConfig.get('decimalValues.maxFractionDigits', DecimalNumberPipe.DEFAULT_MAX_FRACTION_DIGITS);
        }
    }
    transform(value, digitsInfo, locale) {
        const actualMinIntegerDigits = digitsInfo && digitsInfo.minIntegerDigits ? digitsInfo.minIntegerDigits : this.defaultMinIntegerDigits;
        const actualMinFractionDigits = digitsInfo && digitsInfo.minFractionDigits ? digitsInfo.minFractionDigits : this.defaultMinFractionDigits;
        const actualMaxFractionDigits = digitsInfo && digitsInfo.maxFractionDigits ? digitsInfo.maxFractionDigits : this.defaultMaxFractionDigits;
        const actualDigitsInfo = `${actualMinIntegerDigits}.${actualMinFractionDigits}-${actualMaxFractionDigits}`;
        const actualLocale = locale || this.defaultLocale;
        const decimalPipe = new DecimalPipe(actualLocale);
        return decimalPipe.transform(value, actualDigitsInfo);
    }
    ngOnDestroy() {
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
}
DecimalNumberPipe.DEFAULT_LOCALE = 'en-US';
DecimalNumberPipe.DEFAULT_MIN_INTEGER_DIGITS = 1;
DecimalNumberPipe.DEFAULT_MIN_FRACTION_DIGITS = 0;
DecimalNumberPipe.DEFAULT_MAX_FRACTION_DIGITS = 2;
DecimalNumberPipe.decorators = [
    { type: Pipe, args: [{
                name: 'adfDecimalNumber',
                pure: false
            },] }
];
DecimalNumberPipe.ctorParameters = () => [
    { type: UserPreferencesService },
    { type: AppConfigService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjaW1hbC1udW1iZXIucGlwZS5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS90cmF2aXMvYnVpbGQvQWxmcmVzY28vYWxmcmVzY28tbmcyLWNvbXBvbmVudHMvbGliL2NvcmUvIiwic291cmNlcyI6WyJwaXBlcy9kZWNpbWFsLW51bWJlci5waXBlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQUVILE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM5QyxPQUFPLEVBQUUsSUFBSSxFQUE0QixNQUFNLGVBQWUsQ0FBQztBQUMvRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNwRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUVwRyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQU0zQyxNQUFNLE9BQU8saUJBQWlCO0lBYzFCLFlBQW1CLHFCQUE4QyxFQUM5QyxTQUE0QjtRQUQ1QiwwQkFBcUIsR0FBckIscUJBQXFCLENBQXlCO1FBQzlDLGNBQVMsR0FBVCxTQUFTLENBQW1CO1FBUi9DLGtCQUFhLEdBQVcsaUJBQWlCLENBQUMsY0FBYyxDQUFDO1FBQ3pELDRCQUF1QixHQUFXLGlCQUFpQixDQUFDLDBCQUEwQixDQUFDO1FBQy9FLDZCQUF3QixHQUFXLGlCQUFpQixDQUFDLDJCQUEyQixDQUFDO1FBQ2pGLDZCQUF3QixHQUFXLGlCQUFpQixDQUFDLDJCQUEyQixDQUFDO1FBRWpGLGVBQVUsR0FBcUIsSUFBSSxPQUFPLEVBQVcsQ0FBQztRQUtsRCxJQUFJLElBQUksQ0FBQyxxQkFBcUIsRUFBRTtZQUM1QixJQUFJLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQztpQkFDekQsSUFBSSxDQUNELFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQzdCO2lCQUNBLFNBQVMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFO2dCQUNsQixJQUFJLE1BQU0sRUFBRTtvQkFDUixJQUFJLENBQUMsYUFBYSxHQUFHLE1BQU0sQ0FBQztpQkFDL0I7WUFDTCxDQUFDLENBQUMsQ0FBQztTQUNWO1FBRUQsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ2hCLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBUyxnQ0FBZ0MsRUFBRSxpQkFBaUIsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1lBQzFJLElBQUksQ0FBQyx3QkFBd0IsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBUyxpQ0FBaUMsRUFBRSxpQkFBaUIsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1lBQzdJLElBQUksQ0FBQyx3QkFBd0IsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBUyxpQ0FBaUMsRUFBRSxpQkFBaUIsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1NBQ2hKO0lBQ0wsQ0FBQztJQUVELFNBQVMsQ0FBQyxLQUFVLEVBQUUsVUFBK0IsRUFBRSxNQUFlO1FBQ2xFLE1BQU0sc0JBQXNCLEdBQVcsVUFBVSxJQUFJLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUM7UUFDOUksTUFBTSx1QkFBdUIsR0FBVyxVQUFVLElBQUksVUFBVSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyx3QkFBd0IsQ0FBQztRQUNsSixNQUFNLHVCQUF1QixHQUFXLFVBQVUsSUFBSSxVQUFVLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLHdCQUF3QixDQUFDO1FBRWxKLE1BQU0sZ0JBQWdCLEdBQUcsR0FBRyxzQkFBc0IsSUFBSSx1QkFBdUIsSUFBSSx1QkFBdUIsRUFBRSxDQUFDO1FBQzNHLE1BQU0sWUFBWSxHQUFHLE1BQU0sSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDO1FBRWxELE1BQU0sV0FBVyxHQUFnQixJQUFJLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUMvRCxPQUFPLFdBQVcsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLGdCQUFnQixDQUFDLENBQUM7SUFDMUQsQ0FBQztJQUVELFdBQVc7UUFDUCxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQy9CLENBQUM7O0FBakRNLGdDQUFjLEdBQUcsT0FBTyxDQUFDO0FBQ3pCLDRDQUEwQixHQUFHLENBQUMsQ0FBQztBQUMvQiw2Q0FBMkIsR0FBRyxDQUFDLENBQUM7QUFDaEMsNkNBQTJCLEdBQUcsQ0FBQyxDQUFDOztZQVQxQyxJQUFJLFNBQUM7Z0JBQ0YsSUFBSSxFQUFFLGtCQUFrQjtnQkFDeEIsSUFBSSxFQUFFLEtBQUs7YUFDZDs7O1lBUlEsc0JBQXNCO1lBRHRCLGdCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IERlY2ltYWxQaXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IFBpcGUsIFBpcGVUcmFuc2Zvcm0sIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQXBwQ29uZmlnU2VydmljZSB9IGZyb20gJy4uL2FwcC1jb25maWcvYXBwLWNvbmZpZy5zZXJ2aWNlJztcbmltcG9ydCB7IFVzZXJQcmVmZXJlbmNlc1NlcnZpY2UsIFVzZXJQcmVmZXJlbmNlVmFsdWVzIH0gZnJvbSAnLi4vc2VydmljZXMvdXNlci1wcmVmZXJlbmNlcy5zZXJ2aWNlJztcbmltcG9ydCB7IERlY2ltYWxOdW1iZXJNb2RlbCB9IGZyb20gJy4uL21vZGVscy9kZWNpbWFsLW51bWJlci5tb2RlbCc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBQaXBlKHtcbiAgICBuYW1lOiAnYWRmRGVjaW1hbE51bWJlcicsXG4gICAgcHVyZTogZmFsc2Vcbn0pXG5leHBvcnQgY2xhc3MgRGVjaW1hbE51bWJlclBpcGUgaW1wbGVtZW50cyBQaXBlVHJhbnNmb3JtLCBPbkRlc3Ryb3kge1xuXG4gICAgc3RhdGljIERFRkFVTFRfTE9DQUxFID0gJ2VuLVVTJztcbiAgICBzdGF0aWMgREVGQVVMVF9NSU5fSU5URUdFUl9ESUdJVFMgPSAxO1xuICAgIHN0YXRpYyBERUZBVUxUX01JTl9GUkFDVElPTl9ESUdJVFMgPSAwO1xuICAgIHN0YXRpYyBERUZBVUxUX01BWF9GUkFDVElPTl9ESUdJVFMgPSAyO1xuXG4gICAgZGVmYXVsdExvY2FsZTogc3RyaW5nID0gRGVjaW1hbE51bWJlclBpcGUuREVGQVVMVF9MT0NBTEU7XG4gICAgZGVmYXVsdE1pbkludGVnZXJEaWdpdHM6IG51bWJlciA9IERlY2ltYWxOdW1iZXJQaXBlLkRFRkFVTFRfTUlOX0lOVEVHRVJfRElHSVRTO1xuICAgIGRlZmF1bHRNaW5GcmFjdGlvbkRpZ2l0czogbnVtYmVyID0gRGVjaW1hbE51bWJlclBpcGUuREVGQVVMVF9NSU5fRlJBQ1RJT05fRElHSVRTO1xuICAgIGRlZmF1bHRNYXhGcmFjdGlvbkRpZ2l0czogbnVtYmVyID0gRGVjaW1hbE51bWJlclBpcGUuREVGQVVMVF9NQVhfRlJBQ1RJT05fRElHSVRTO1xuXG4gICAgb25EZXN0cm95JDogU3ViamVjdDxib29sZWFuPiA9IG5ldyBTdWJqZWN0PGJvb2xlYW4+KCk7XG5cbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgdXNlclByZWZlcmVuY2VTZXJ2aWNlPzogVXNlclByZWZlcmVuY2VzU2VydmljZSxcbiAgICAgICAgICAgICAgICBwdWJsaWMgYXBwQ29uZmlnPzogQXBwQ29uZmlnU2VydmljZSkge1xuXG4gICAgICAgIGlmICh0aGlzLnVzZXJQcmVmZXJlbmNlU2VydmljZSkge1xuICAgICAgICAgICAgdGhpcy51c2VyUHJlZmVyZW5jZVNlcnZpY2Uuc2VsZWN0KFVzZXJQcmVmZXJlbmNlVmFsdWVzLkxvY2FsZSlcbiAgICAgICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMub25EZXN0cm95JClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZSgobG9jYWxlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsb2NhbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGVmYXVsdExvY2FsZSA9IGxvY2FsZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuYXBwQ29uZmlnKSB7XG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRNaW5JbnRlZ2VyRGlnaXRzID0gdGhpcy5hcHBDb25maWcuZ2V0PG51bWJlcj4oJ2RlY2ltYWxWYWx1ZXMubWluSW50ZWdlckRpZ2l0cycsIERlY2ltYWxOdW1iZXJQaXBlLkRFRkFVTFRfTUlOX0lOVEVHRVJfRElHSVRTKTtcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdE1pbkZyYWN0aW9uRGlnaXRzID0gdGhpcy5hcHBDb25maWcuZ2V0PG51bWJlcj4oJ2RlY2ltYWxWYWx1ZXMubWluRnJhY3Rpb25EaWdpdHMnLCBEZWNpbWFsTnVtYmVyUGlwZS5ERUZBVUxUX01JTl9GUkFDVElPTl9ESUdJVFMpO1xuICAgICAgICAgICAgdGhpcy5kZWZhdWx0TWF4RnJhY3Rpb25EaWdpdHMgPSB0aGlzLmFwcENvbmZpZy5nZXQ8bnVtYmVyPignZGVjaW1hbFZhbHVlcy5tYXhGcmFjdGlvbkRpZ2l0cycsIERlY2ltYWxOdW1iZXJQaXBlLkRFRkFVTFRfTUFYX0ZSQUNUSU9OX0RJR0lUUyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB0cmFuc2Zvcm0odmFsdWU6IGFueSwgZGlnaXRzSW5mbz86IERlY2ltYWxOdW1iZXJNb2RlbCwgbG9jYWxlPzogc3RyaW5nKTogYW55IHtcbiAgICAgICAgY29uc3QgYWN0dWFsTWluSW50ZWdlckRpZ2l0czogbnVtYmVyID0gZGlnaXRzSW5mbyAmJiBkaWdpdHNJbmZvLm1pbkludGVnZXJEaWdpdHMgPyBkaWdpdHNJbmZvLm1pbkludGVnZXJEaWdpdHMgOiB0aGlzLmRlZmF1bHRNaW5JbnRlZ2VyRGlnaXRzO1xuICAgICAgICBjb25zdCBhY3R1YWxNaW5GcmFjdGlvbkRpZ2l0czogbnVtYmVyID0gZGlnaXRzSW5mbyAmJiBkaWdpdHNJbmZvLm1pbkZyYWN0aW9uRGlnaXRzID8gZGlnaXRzSW5mby5taW5GcmFjdGlvbkRpZ2l0cyA6IHRoaXMuZGVmYXVsdE1pbkZyYWN0aW9uRGlnaXRzO1xuICAgICAgICBjb25zdCBhY3R1YWxNYXhGcmFjdGlvbkRpZ2l0czogbnVtYmVyID0gZGlnaXRzSW5mbyAmJiBkaWdpdHNJbmZvLm1heEZyYWN0aW9uRGlnaXRzID8gZGlnaXRzSW5mby5tYXhGcmFjdGlvbkRpZ2l0cyA6IHRoaXMuZGVmYXVsdE1heEZyYWN0aW9uRGlnaXRzO1xuXG4gICAgICAgIGNvbnN0IGFjdHVhbERpZ2l0c0luZm8gPSBgJHthY3R1YWxNaW5JbnRlZ2VyRGlnaXRzfS4ke2FjdHVhbE1pbkZyYWN0aW9uRGlnaXRzfS0ke2FjdHVhbE1heEZyYWN0aW9uRGlnaXRzfWA7XG4gICAgICAgIGNvbnN0IGFjdHVhbExvY2FsZSA9IGxvY2FsZSB8fCB0aGlzLmRlZmF1bHRMb2NhbGU7XG5cbiAgICAgICAgY29uc3QgZGVjaW1hbFBpcGU6IERlY2ltYWxQaXBlID0gbmV3IERlY2ltYWxQaXBlKGFjdHVhbExvY2FsZSk7XG4gICAgICAgIHJldHVybiBkZWNpbWFsUGlwZS50cmFuc2Zvcm0odmFsdWUsIGFjdHVhbERpZ2l0c0luZm8pO1xuICAgIH1cblxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgICAgICB0aGlzLm9uRGVzdHJveSQubmV4dCh0cnVlKTtcbiAgICAgICAgdGhpcy5vbkRlc3Ryb3kkLmNvbXBsZXRlKCk7XG4gICAgfVxufVxuIl19